!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).augLoop=e()}}((function(){return function e(t,n,o){function r(a,s){if(!n[a]){if(!t[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(i)return i(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[a]={exports:{}};t[a][0].call(l.exports,(function(e){return r(t[a][1][e]||e)}),l,l.exports,e,t,n,o)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<o.length;a++)r(o[a]);return r}({1:[function(e,t,n){"use strict";var o=e("exportStarHelper");Object.defineProperty(n,"__esModule",{value:!0}),o(e(2),n)},{2:2}],2:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.isStopWorkflowMessage=n.setStopAndFilterWorkflowMessage=n.setMessageException=n.getMessageExceptionType=n.getMessageExceptionDescription=n.filterWorkflowSchema=n.exceptionSchema=void 0;var o=e(109);n.exceptionSchema={category:o.TypeCategory.Schema,schema:{name:"Exception",path:"message-schema.proto"}},n.filterWorkflowSchema={category:o.TypeCategory.Schema,schema:{name:"Filter",path:"message-schema.proto"}};n.getMessageExceptionDescription=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(null==e)return"Invalid message passed";if(null==e.payload)return"".concat(o.ExceptionType[o.ExceptionType.NoOutput],": Payload is null");if(null==e.payload.exceptionType)return"Payload is not an exception";var n=o.ExceptionType[e.payload.exceptionType];return n+=e.payload.message?": ".concat(e.payload.message):": No description",n+=t&&e.payload.data?"\n".concat(e.payload.data.toString()):""};n.getMessageExceptionType=function(e){return null==e||null==e.payload||null==e.payload.exceptionType?o.ExceptionType.Unknown:e.payload.exceptionType};n.setMessageException=function(e,t){if(null==e)throw new Error("Cannot set exception on null message");e.payload=t,e.payloadSchema=n.exceptionSchema,e.messageType=o.MessageType.Exception};n.setStopAndFilterWorkflowMessage=function(e,t){if(null==e)throw new Error("Cannot set filter on null message");var r={condition:t};e.payload=r,e.payloadSchema=n.filterWorkflowSchema,e.messageType=o.MessageType.StopAndFilterWorkflow};n.isStopWorkflowMessage=function(e){return(e||{}).messageType==o.MessageType.StopAndFilterWorkflow}},{109:109}],3:[function(e,t,n){"use strict";var o=e("exportStarHelper");Object.defineProperty(n,"__esModule",{value:!0}),o(e(8),n),o(e(9),n)},{8:8,9:9}],4:[function(e,t,n){"use strict";var o=e(178),r=o(e(172)),i=o(e(174));Object.defineProperty(n,"__esModule",{value:!0}),n.ReduceTimerCache=void 0;var a=function(){function e(){(0,r.default)(this,e),this.cache=new Map}return(0,i.default)(e,[{key:"setReduceTimer",value:function(e,t,n){var o=this,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:function(){return!1},a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5e3;this.cache.has(e)||this.cache.set(e,new Map);var s=this.cache.get(e);s.has(t)&&clearTimeout(s.get(t).timer);var u=function(){var u=s.get(t),c=Date.now()-u.start;i()&&c<a?u.timer=setTimeout(u.timerCallback,Math.min(r,a-c)):(s.size>1?s.delete(t):o.cache.delete(e),n())};s.set(t,{start:Date.now(),timerCallback:u,timer:setTimeout(u,r)})}},{key:"clear",value:function(e,t){this.cache.forEach((function(n,o){e&&e!==o||n.forEach((function(e,n){t&&t!==n||clearTimeout(e.timer)}))})),this.cache.clear()}}]),e}();n.ReduceTimerCache=a},{172:172,174:174,178:178}],5:[function(e,t,n){"use strict";function o(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return r(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,i=function(){};return{s:i,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){u=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(u)throw a}}}}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}Object.defineProperty(n,"__esModule",{value:!0}),n.executeRemoteLambda=n.clearTokenCache=void 0;var i,a=e(40),s=e(76),u=e(109),c=e(11);n.clearTokenCache=function(){i=new c.TokenCache},(0,n.clearTokenCache)();var l=function e(t,n,r,c,l,f,d,p,h,g){var y={method:"POST",headers:{"content-type":"application/json","X-CorrelationId":l},body:JSON.stringify({payload:n.payload,payloadSchema:r,requestedSchema:c,clientMetadata:f,tokens:i.getAuthTokenEntries(d,h.docId)})};(0,s.internalFetch)(t,y,(function(s,y){s?g(new Error("Fetch error in remote lambda request to ".concat(t,": ").concat(s))):401===y.status?p>0?(a.Log.info(572838109,a.LogCategory.CoreDefault,"Auth token required for remote lambda request"),y.json().then((function(e){return i.updateAuthToken(d,{Tickets:[e],DocId:h.docId})})).then((function(){e(t,n,r,c,l,f,d,p-1,h,g)})).catch((function(e){g({exceptionType:u.ExceptionType.Authentication,message:e.message})}))):g({exceptionType:u.ExceptionType.Authentication,message:"Remote lambda request retry with authentication token failed"}):y.ok?y.json().then((function(e){if(Array.isArray(e))if(e.length>0){var t,r=0,i=o(e);try{for(i.s();!(t=i.n()).done;){var a=t.value;n.moreResults=++r<e.length,g(null,a)}}catch(e){i.e(e)}finally{i.f()}}else g(new Error("No output"));else g(new Error("Did not receive a valid response for remote lambda request"))})).catch((function(e){g({exceptionType:u.ExceptionType.LambdaThrow,message:e.message})})):g(new Error("Remote lambda request failed with status ".concat(y.status)))}))};n.executeRemoteLambda=function(e,t,n,o,r,a,s,c,f){Array.isArray(c.authTickets)?i.updateAuthToken(s,{Tickets:c.authTickets,DocId:c.docId}).then((function(){l(e,t,n,o,r.id,a,s,1,c,f)})).catch((function(e){f({exceptionType:u.ExceptionType.Authentication,message:e.message})})):l(e,t,n,o,r.id,a,s,1,c,f)}},{109:109,11:11,40:40,76:76}],6:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.testWebSocketConnection=n.executeRemoteLambda=n.clearTokenCache=void 0;var o,r=e(40),i=e(76),a=e(109),s=e(11),u=e(12);n.clearTokenCache=function(){o=new s.TokenCache},(0,n.clearTokenCache)();var c=new u.WebSocketRequestManager(3e4,(function(){return new i.WebSocketWorker}),50),l=function e(t,n,i,s,u,l,f,d,p,h){var g={payload:n.payload,payloadSchema:i,requestedSchema:s,clientMetadata:l,tokens:o.getAuthTokenEntries(f,p.docId)},y="";s&&s.schema&&(y=s.schema.name);var m=!1;c.addRequest(t,g,u,y,(function(c,g,y){if(!m)if(m=!0,null!=g)if(g.exceptionType===a.ExceptionType.Authentication)try{var v=JSON.parse(g.data);d>0?(r.Log.info(572838108,r.LogCategory.CoreDefault,"Auth token required for remote lambda WebSocket request"),o.updateAuthToken(f,{Tickets:[v],DocId:p.docId}).then((function(){e(t,n,i,s,u,l,f,d-1,p,h)})).catch((function(e){h({exceptionType:a.ExceptionType.Authentication,message:e.message})}))):h({exceptionType:a.ExceptionType.Authentication,message:"Remote lambda request retry with authentication token failed"})}catch(e){h({exceptionType:a.ExceptionType.Authentication,message:e.message})}else h(new Error("Error in remote lambda WebSocket request to ".concat(t,": ").concat(g)));else n.moreResults=!1,h(null,c)}))};n.executeRemoteLambda=function(e,t,n,r,i,s,u,c,f){Array.isArray(c.authTickets)?o.updateAuthToken(u,{Tickets:c.authTickets,DocId:c.docId}).then((function(){l(e,t,n,r,i.id,s,u,1,c,f)})).catch((function(e){f({exceptionType:a.ExceptionType.Authentication,message:e.message})})):l(e,t,n,r,i.id,s,u,1,c,f)};n.testWebSocketConnection=function(e,t){return c.testConnection(e,t)}},{109:109,11:11,12:12,40:40,76:76}],7:[function(e,t,n){"use strict";var o=e(178),r=o(e(172)),i=o(e(174));Object.defineProperty(n,"__esModule",{value:!0}),n.ResultCache=void 0;var a=function(){function e(){(0,r.default)(this,e),this.cache=new Map,this.bucketSizes=new Map}return(0,i.default)(e,[{key:"setBucketSize",value:function(e,t){this.bucketSizes.set(e,t)}},{key:"setResult",value:function(e,t,n){if(t.primary){var o=this.cache.get(e);o||(o=new Map,this.cache.set(e,o));var r=o.get(t.primary);if(r||(r=t.secondary?new Map:[],o.set(t.primary,r)),t.secondary){r.set(t.secondary,n)}else{var i=r;i.length==this.getBucketSize(e)&&i.shift(),i.push(n)}}}},{key:"getResults",value:function(e,t){var n=this.cache.get(e);if(n){var o=n.get(t.primary);if(o){if(!t.secondary)return o;var r=Array.from(o.values());if(r.length>0)return r}}return[]}},{key:"clear",value:function(e,t){t?this.cache.forEach((function(n,o){if(!e||e===o)if(t.secondary){var r=n.get(t.primary);r&&r.delete(t.secondary)}else n.delete(t.primary)})):e?this.cache.delete(e):this.cache.clear()}},{key:"getBucketSize",value:function(e){return this.bucketSizes.get(e)||10}}]),e}();n.ResultCache=a},{172:172,174:174,178:178}],8:[function(e,t,n){"use strict";var o=e(178),r=o(e(192)),i=o(e(189)),a=o(e(172)),s=o(e(174));function u(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}Object.defineProperty(n,"__esModule",{value:!0}),n.runtimeALv1=n.ClientRuntimeALv1=n.getTypeFromSchema=n.Workflow=void 0;var l,f=e(1),d=e(40),p=e(76),h=e(109),g=e(155),y=e(4),m=e(5),v=e(6),k=e(7),T=e(9),S=e(10);!function(e){e[e.Restricted=0]="Restricted",e[e.Unrestricted=1]="Unrestricted",e[e.Suppressed=2]="Suppressed"}(l||(l={}));var b=function(){function e(){(0,a.default)(this,e),this.canaryTextTileEventSubmittedByDocSessionId=new Set,this.stateByDocSessionId=new Map,this.executionQueueByDocSessionId=new Map,this.executionCountByDocSessionId=new Map}return(0,s.default)(e,[{key:"getOutputSchema",value:function(){return this.lambdas[this.lambdas.length-1].outputSchema}},{key:"scheduleExecution",value:function(e,t){var n=this.docSessionIdExtractor?this.docSessionIdExtractor(e):void 0,o=this.getStateForDocSessionId(n);if(o===l.Restricted){var r=this.getExecutionQueueForDocSessionId(n);r.push(t),1===r.length&&t()}else o===l.Unrestricted?t():l.Suppressed}},{key:"onStart",value:function(e){this.incrementExecutionCountForDocSessionId(e)}},{key:"onFinish",value:function(e,t){if(this.decrementExecutionCountForDocSessionId(e),t===h.ExceptionType.Authentication)this.stateByDocSessionId.set(e,l.Suppressed),this.executionQueueByDocSessionId.delete(e);else if(this.stateByDocSessionId.get(e)===l.Restricted){var n=this.getExecutionQueueForDocSessionId(e);if(n.shift(),void 0===t){this.stateByDocSessionId.set(e,l.Unrestricted),this.executionQueueByDocSessionId.delete(e);var o,r=u(n);try{for(r.s();!(o=r.n()).done;){(0,o.value)()}}catch(e){r.e(e)}finally{r.f()}}else if(n.length>0){(0,n[0])()}}}},{key:"onRefresh",value:function(e){this.stateByDocSessionId=new Map,this.triggerOnRefresh&&(e?(this.executionQueueByDocSessionId.delete(e),this.executionCountByDocSessionId.delete(e)):(this.executionQueueByDocSessionId=new Map,this.executionCountByDocSessionId=new Map)),this.canaryTextTileEventSubmittedByDocSessionId.delete(e)}},{key:"getStateForDocSessionId",value:function(t){var n=this.stateByDocSessionId.get(t);return void 0===n&&(n=e.executionQueuesEnabled?l.Restricted:l.Unrestricted,this.stateByDocSessionId.set(t,n)),n}},{key:"getExecutionQueueForDocSessionId",value:function(e){var t=this.executionQueueByDocSessionId.get(e);return void 0===t&&(t=[],this.executionQueueByDocSessionId.set(e,t)),t}},{key:"incrementExecutionCountForDocSessionId",value:function(e){var t=this.executionCountByDocSessionId.get(e)||0;this.executionCountByDocSessionId.set(e,t+1)}},{key:"decrementExecutionCountForDocSessionId",value:function(e){var t=this.executionCountByDocSessionId.get(e)||0;t<=1?this.executionCountByDocSessionId.delete(e):this.executionCountByDocSessionId.set(e,t-1)}}]),e}();n.Workflow=b,b.executionQueuesEnabled=!0;n.getTypeFromSchema=function(e){return{category:h.TypeCategory.Schema,schema:{name:e}}};var w="Tiling.TextTileEvent",C=function(e,t){return e===w&&t&&t.type==h.Tiling.TextTileEventType.Refresh},_=function(e,t){return"ClpSlideTile"===e&&t&&t.eventType==h.Ppt.SlideTileEventType.Refresh},x=function(e,t){return C(e,t)||_(e,t)},M=function(e,t){var n,o;return e===w?null===(o=null===(n=t.tile)||void 0===n?void 0:n.metadata)||void 0===o?void 0:o.docSessionId:"ClpSlideTile"===e?t.docId:void 0},A=function(e){return{type:e.type,tile:{metadata:{docSessionId:e.tile.metadata.docSessionId,docId:e.tile.metadata.docId,seqnoCLPRefresh:e.tile.metadata.seqnoCLPRefresh,tileId:"A56B3127DBDFD0D6"},elements:[{text:"B91153AE828B4E48"}]}}},O=function(){function e(){(0,a.default)(this,e),this.inputSchemasToWorkflows=new Map,this.inputSchemasToReduceWorkflows=new Map,this.reduceWorkflowsGroupingKeyExtractors=new Map,this.defaultWorkflowOptions={canProduceNullResult:!1,shouldSendResultsToHost:!0,enabledByDefault:!1,throttleSettings:{shouldBeThrottled:!1},triggerOnRefresh:!1},this.resultCache=new k.ResultCache,this.reduceTimerCache=new y.ReduceTimerCache,this.lookupTableCache=new Map,this.throttling=new S.ExecutionWithThrottling,this.lastTileRefreshSeq=-1,this.lastTileRefreshSeqByDocSessionId=new Map,this.tileRefreshByDocSessionIdEnabled=!0}return(0,s.default)(e,[{key:"init",value:function(e,t,n){var o=this,r=new d.Operation({operationName:"InitRuntimeALv1",resourceId:e});r.start(),this.clientMetadata=t,this.clientMetadata&&(this.clientMetadata.runtimeVersion=(0,p.getVersion)()),this.hostCallbacks=n;var i=[];return i.push(this.isFeatureEnabled("DisableWebSocket").then((function(n){if(!!n)return!1;return!(["Outlook Mac","Outlook Win32","PowerPoint Mac","PowerPoint Web","PowerPoint Win32","Word Mac","Word Win32"].indexOf("".concat(t.appName," ").concat(t.appPlatform))>=0)||v.testWebSocketConnection(p.Utils.convertServiceUrlToWebSocket(e),o.clientMetadata)})).then((function(t){e&&(o.serviceUrl=t?p.Utils.convertServiceUrlToWebSocket(e):e,o.executeRemoteLambda=t?v.executeRemoteLambda:m.executeRemoteLambda,o.clearRemoteLambdaTokenCache=t?v.clearTokenCache:m.clearTokenCache,o.serviceProtocol=o.serviceUrl.split(":")[0].toLowerCase())}))),i.push(this.isFeatureEnabled("WorkflowQueuesDisabled").then((function(e){b.executionQueuesEnabled=!e}))),i.push(this.isFeatureEnabled("TileRefreshByDocSessionIdDisabled").then((function(e){o.tileRefreshByDocSessionIdEnabled=!e}))),Promise.all(i).then((function(){o.logOperation(r,!0)})).catch((function(e){o.logOperation(r,!1,"Error",e?e.message:"(no error)")}))}},{key:"getServiceProtocol",value:function(){return this.serviceProtocol}},{key:"registerSchemas",value:function(e,t){return Promise.resolve()}},{key:"registerSimpleLocalWorkflow",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.defaultWorkflowOptions;return t.source=t.source||T.LambdaSource.Custom,this.registerHardcodedWorkflow(e,[t],this.inputSchemasToWorkflows,n)}},{key:"registerSimpleRemoteWorkflow",value:function(e,t,n,o){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.defaultWorkflowOptions,i=[];return t&&(t.source=T.LambdaSource.Custom,i.push(t)),n.source=n.func?T.LambdaSource.Custom:T.LambdaSource.Remote,i.push(n),o&&(o.source=T.LambdaSource.Custom,i.push(o)),this.registerHardcodedWorkflow(e,i,this.inputSchemasToWorkflows,r)}},{key:"registerMultipleLambdasWorkflow",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.defaultWorkflowOptions;return this.registerHardcodedWorkflow(e,t,this.inputSchemasToWorkflows,n)}},{key:"registerReduceWorkflow",value:function(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.defaultWorkflowOptions;return this.reduceWorkflowsGroupingKeyExtractors.set(t.inputSchema,n),this.resultCache.setBucketSize(t.inputSchema,o),t.source=t.source||T.LambdaSource.Custom,this.registerHardcodedWorkflow(e,[t],this.inputSchemasToReduceWorkflows,r)}},{key:"registerMultipleLambdasReduceWorkflow",value:function(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.defaultWorkflowOptions;return this.reduceWorkflowsGroupingKeyExtractors.set(t[0].inputSchema,n),this.resultCache.setBucketSize(t[0].inputSchema,o),this.registerHardcodedWorkflow(e,t,this.inputSchemasToReduceWorkflows,r)}},{key:"submit",value:function(e,t,n){this.submitToWorkflows(e,t,n,this.inputSchemasToWorkflows)}},{key:"getGroupingKey",value:function(e,t,n){var o=this.reduceWorkflowsGroupingKeyExtractors.get(n);if(null==o)throw new Error("Reduce workflow does not have a grouping extractor");return o(t,e)}},{key:"submitToWorkflows",value:function(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.inputSchemasToWorkflows;if(this.hostCallbacks){var r;r=n?d.CorrelationVector.fromString(n):new d.CorrelationVector,this.handleTileRefresh(e,t,r);var i,a=o.get(e)||[],s=u(a);try{for(s.s();!(i=s.n()).done;){var c=i.value;x(e,t)&&!c.triggerOnRefresh||(c.useCanaryTextTile&&e===w&&!c.canaryTextTileEventSubmittedByDocSessionId.has(M(e,t))&&(this.submitToWorkflow(w,A(t),r,c,o),c.canaryTextTileEventSubmittedByDocSessionId.add(M(e,t))),this.submitToWorkflow(e,t,r,c,o))}}catch(e){s.e(e)}finally{s.f()}}}},{key:"submitToWorkflow",value:function(e,t,o,r,i){var a=this,s={messageType:h.MessageType.Input,correlationVector:o.newChild(),payload:t,payloadSchema:(0,n.getTypeFromSchema)(r.lambdas[0].inputSchema),clientMetadata:this.clientMetadata},u=new d.Operation({cv:s.correlationVector.toString(),operationName:"ExecuteWorkflow",resourceId:r.name});u.setClientMetadata(this.clientMetadata),u.start(),r.scheduleExecution(t,(function(){try{if(s.payload&&s.payload.tile&&s.payload.tile.metadata&&s.payload.tile.metadata.tileId){var n=s.payload.tile.metadata.tileId;a.throttling.execute(n,r,(function(){return a.executeWorkflow(u,s,t,r,e,i)}))}else a.executeWorkflow(u,s,t,r,e,i)}catch(e){u.success=!1,u.resultSignature="ExecuteException",u.resultDescription=e?e.message:"(no error)",d.Log.error(559290447,d.LogCategory.CoreDefault,u.stop())}}))}},{key:"handleTileRefresh",value:function(e,t,n){var o=this;if(x(e,t)){var r=this.tileRefreshByDocSessionIdEnabled?M(e,t):void 0,a=function(e,t){var n,o;return C(e,t)?null===(o=null===(n=t.tile)||void 0===n?void 0:n.metadata)||void 0===o?void 0:o.seqnoCLPRefresh:(_(e,t),-1)}(e,t);if(this.tileRefreshByDocSessionIdEnabled){var s=this.lastTileRefreshSeqByDocSessionId.get(r);if(s>=0&&a<=s)return}else if(a<=this.lastTileRefreshSeq)return;var u=new d.Operation({cv:n.toString(),operationName:"TileRefresh",resultDescription:"",success:!0});if(u.start(),this.tileRefreshByDocSessionIdEnabled&&!r)return u.success=!1,u.resultDescription="NoDocSessionId",void d.Log.info(559290448,d.LogCategory.CoreDefault,u.stop());this.inputSchemasToReduceWorkflows.forEach((function(e,t){e.some((function(e){return e.triggerOnRefresh}))&&(o.tileRefreshByDocSessionIdEnabled?(o.resultCache.clear(t,{primary:r}),o.resultCache.clear(o.getForcedDocLevelSchema(t),{primary:r}),o.reduceTimerCache.clear(t,r)):(o.resultCache.clear(t),o.resultCache.clear(o.getForcedDocLevelSchema(t)),o.reduceTimerCache.clear(t)),e.some((function(e){return!e.triggerOnRefresh}))&&(u.resultDescription+="X_"),u.resultDescription+=t+" ")})),this.clearRemoteLambdaTokenCache();var c=[];this.inputSchemasToWorkflows.forEach((function(e){return c.push.apply(c,(0,i.default)(e))})),this.inputSchemasToReduceWorkflows.forEach((function(e){return c.push.apply(c,(0,i.default)(e))}));for(var l=0,f=c;l<f.length;l++){var p=f[l];this.tileRefreshByDocSessionIdEnabled?p.onRefresh(r):p.onRefresh()}this.tileRefreshByDocSessionIdEnabled?this.lastTileRefreshSeqByDocSessionId.set(r,a):this.lastTileRefreshSeq=a,d.Log.info(559290449,d.LogCategory.CoreDefault,u.stop())}}},{key:"executeWorkflow",value:function(e,t,n,o,r,i){var a=this,s=o.docIdExtractor?o.docIdExtractor(t.payload):void 0,u=o.docSessionIdExtractor(n),c=this.tileRefreshByDocSessionIdEnabled?this.lastTileRefreshSeqByDocSessionId.get(u):this.lastTileRefreshSeq;o.onStart(u);var l=function(t){var s=a.tileRefreshByDocSessionIdEnabled?a.lastTileRefreshSeqByDocSessionId.get(u):a.lastTileRefreshSeq;if(o.triggerOnRefresh&&s!==c)return e.success=!0,e.resultSignature="TileRefreshIgnore",void d.Log.info(559290450,d.LogCategory.CoreDefault,e.stop());var l=t.messageType==h.MessageType.Exception&&t.payload.exceptionType==h.ExceptionType.NoOutput,p=l&&o.canProduceNullResult,g=p?o.lambdas[o.lambdas.length-1].outputSchema:t.payloadSchema.schema.name,y=p?null:t.payload;t.messageType===h.MessageType.Input||p?(o.shouldSendResultsToHost&&(i===a.inputSchemasToReduceWorkflows?a.hostCallbacks.onResult("Reduce.Input",n,g,y):a.hostCallbacks.onResult(r,n,g,y)),e.success=!0,e.resultSignature=l?"NoOutput":"ValidOutput"):l?(e.success=!0,e.resultSignature="NoOutput"):(e.success=!1,e.resultSignature="Exception",e.resultDescription=(0,f.getMessageExceptionDescription)(t)),i!==a.inputSchemasToReduceWorkflows&&a.updateResultCacheForReduceWorkflows(r,n,g,y,t.correlationVector.toString()),t.moreResults||(e.stop(),d.Log.info(559290451,d.LogCategory.CoreDefault,e),o.onFinish(u,t.payload&&t.payload.exceptionType?(0,f.getMessageExceptionType)(t):void 0))};o.preExecutionPromise.then((function(){for(var e={lookupTable:a.lookupTableCache.get(o.name),docId:s,docSessionId:u},n=l,r=o.lambdas.length-1;r>=0;r--)n=a.createLambdaExecutionStep(o.name,o.lambdas[r],e,n,l);n(t)}))}},{key:"getForcedDocLevelSchema",value:function(e){return"~".concat(e)}},{key:"updateResultCacheForReduceWorkflows",value:function(e,t,n,o,a){var s=this,u=this.inputSchemasToReduceWorkflows.get(n);if(u){var c;"docSessionId"===e?(c=this.getGroupingKey(e,t,n),this.resultCache.setResult(this.getForcedDocLevelSchema(n),c,o),c.secondary="*"):(c=this.getGroupingKey(e,t,n),!function(e,t){return e===w&&t&&t.type==h.Tiling.TextTileEventType.Delete||"ClpSlideTile"===e&&t&&t.eventType==h.Ppt.SlideTileEventType.Delete}(e,t)||null==c.primary||null==c.secondary?this.resultCache.setResult(n,c,o):this.resultCache.clear(void 0,c));var l=u.some((function(e){return e.deferReduceUntilIdle})),f=[];this.inputSchemasToWorkflows.forEach((function(e){return f.push.apply(f,(0,i.default)(e.filter((function(e){return e.getOutputSchema()===n}))))}));var p=u.map((function(e){return e.deferReduceUntilIdleMaxDelayMs||0})).reduce((function(e,t){return Math.max(e,t)}));this.reduceTimerCache.setReduceTimer(n,c.primary,(function(){var e=s.resultCache.getResults(n,c);if(e.push.apply(e,(0,i.default)(s.resultCache.getResults(s.getForcedDocLevelSchema(n),{primary:c.primary}))),Array.isArray(e)){var t={id:c.primary,values:e,isReduceInput:!0};s.submitToWorkflows(n,t,a,s.inputSchemasToReduceWorkflows)}else d.Log.error(559290452,d.LogCategory.CoreDefault,'Cached results have unexpected type "'.concat((0,r.default)(e),'"'))}),500,(function(){return l&&f.some((function(e){return e.executionCountByDocSessionId.get(c.primary)>0}))}),p)}}},{key:"isFeatureEnabled",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"None";return this.hostCallbacks&&this.hostCallbacks.isFeatureEnabled?this.hostCallbacks.isFeatureEnabled("Microsoft.Office.AugLoop."+e,n).catch((function(){return Promise.resolve(t)})):Promise.resolve(t)}},{key:"areLicenseFeaturesEnabled",value:function(e){return this.hostCallbacks&&this.hostCallbacks.areLicenseFeaturesEnabled?this.hostCallbacks.areLicenseFeaturesEnabled(e).catch((function(){return Promise.resolve(!1)})):Promise.resolve(!1)}},{key:"isWorkflowEnabled",value:function(e,t,n,o,r){var i,a=this;if(t.some((function(e){return e.source===T.LambdaSource.Remote||e.source===T.LambdaSource.BatchedRemote}))){if(!this.serviceUrl)return r.resultDescription="Disabled because no service URL available for remote workflow",Promise.resolve(!1);if(this.clientMetadata&&this.clientMetadata.privateMode&&t.some((function(e){return(e.source===T.LambdaSource.Remote||e.source===T.LambdaSource.BatchedRemote)&&!e.canRunInPrivateMode})))return r.resultDescription="Disabled because we are running in private mode",Promise.resolve(!1)}return(!this.clientMetadata||"Mac"!==this.clientMetadata.appPlatform&&"Win32"!==this.clientMetadata.appPlatform)&&(o=!0,r.resultDescription="Enabled by default due to platform name"),i=o?Promise.resolve(!0):this.isFeatureEnabled("WorkflowEnabled."+e),i.then((function(t){return t?a.isFeatureEnabled("WorkflowDisabled."+e).then((function(e){return e?(r.resultDescription="Disabled because explicitly disabled",!1):!n||a.areLicenseFeaturesEnabled(n).then((function(e){return e||(r.resultDescription="Disabled because license check failed"),e}))})):(r.resultDescription="Disabled because not explicitly enabled",!1)}))}},{key:"registerHardcodedWorkflow",value:function(e,t){var o=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.inputSchemasToWorkflows,i=arguments.length>3?arguments[3]:void 0;if(!e||e.length>40)throw new Error("Workflow name has invalid length");if(!1===new RegExp(/^[A-Z][a-zA-Z0-9_]+$/).test(e))throw new Error("Workflow name has invalid format");r.forEach((function(t){if(t.some((function(t){return t.name===e})))throw new Error("Workflow name already registered.")}));var a=new d.Operation({operationName:"WorkflowRegistration",resourceId:e,success:!0});return a.setClientMetadata(this.clientMetadata),a.start(),this.isWorkflowEnabled(e,t,i.licenseFeatures,i.enabledByDefault,a).then((function(s){if(a.resultSignature=s?"Enabled":"Disabled",a.stop(),d.Log.info(559290453,d.LogCategory.CoreDefault,a),s){var u=t[0].inputSchema,c=r.get(u);c||(c=[],r.set(u,c));var l=Promise.resolve();i.lookupTableLambda&&(l=new Promise((function(t,r){var a=new d.CorrelationVector,s={messageType:h.MessageType.Input,correlationVector:a,payloadSchema:(0,n.getTypeFromSchema)(i.lookupTableLambda.inputSchema),clientMetadata:o.clientMetadata,payload:{}},u=function(n){n.messageType===h.MessageType.Input&&n.payload&&o.lookupTableCache.set(e,n.payload),t()};o.createLambdaExecutionStep("",i.lookupTableLambda,{},u,u)(s)})));var f=new b;f.name=e,f.lambdas=t,f.canProduceNullResult=i.canProduceNullResult,f.shouldSendResultsToHost=i.shouldSendResultsToHost,f.triggerOnRefresh=i.triggerOnRefresh,f.throttleSettings=i.throttleSettings||o.defaultWorkflowOptions.throttleSettings,f.docIdExtractor=i.docIdExtractor,f.docSessionIdExtractor=function(e){return e.isReduceInput?e.id:M(u,e)},f.deferReduceUntilIdle=i.deferReduceUntilIdle,f.deferReduceUntilIdleMaxDelayMs=i.deferReduceUntilIdleMaxDelayMs,f.useCanaryTextTile=i.useCanaryTextTile,f.preExecutionPromise=l,c.push(f)}}))}},{key:"logOperation",value:function(e,t,n,o){e.stop(),e.success=t,e.resultSignature=n,e.resultDescription=o,d.Log.info(559290454,d.LogCategory.CoreDefault,e)}},{key:"handleLambdaError",value:function(e,t,n,o,r){null!=e.exceptionType?(0,f.setMessageException)(t,e):e instanceof Error?(0,f.setMessageException)(t,{exceptionType:o,message:e.message}):(0,f.setMessageException)(t,{exceptionType:h.ExceptionType.Unknown,message:e?e.toString():void 0}),this.logOperation(n,!1,"Exception",(0,f.getMessageExceptionDescription)(t)),r(t)}},{key:"handleLambdaOutput",value:function(e,t,o,r,i,a){e&&e.exceptionType!==h.ExceptionType.NoOutput?null!=e.exceptionType?this.handleLambdaError(e,t,o,e.exceptionType,a):e instanceof Error?this.handleLambdaError(e,t,o,h.ExceptionType.LambdaErrorCallback,a):(t.payload=e,t.payloadSchema=(0,n.getTypeFromSchema)(r),this.logOperation(o,!0),i(t)):((0,f.setMessageException)(t,{exceptionType:h.ExceptionType.NoOutput}),this.logOperation(o,!0,"NoOutput"),a(t))}},{key:"executeCustomLambdaStep",value:function(e,t,n,o,r,i){var a=this;if(null==n.func)(0,f.setMessageException)(e,{exceptionType:h.ExceptionType.LambdaThrow,message:"No lambda function set"}),this.logOperation(t,!1,"Error",(0,f.getMessageExceptionDescription)(e)),i(e);else{try{n.func(e.payload,n.config,o,(function(o){a.handleLambdaOutput(o,e,t,n.outputSchema,r,i)}),(function(n,o){a.handleLambdaOutput(n,e,t,o,i,i)}))}catch(n){this.handleLambdaError(n,e,t,h.ExceptionType.LambdaThrow,i)}}}},{key:"executeLocalLambdaStep",value:function(e,t,n,o,r){var i=this;null==this.hostCallbacks.executeLocalLambda?((0,f.setMessageException)(e,{exceptionType:h.ExceptionType.LambdaThrow,message:"No local lambda host callback set"}),this.logOperation(t,!1,"Error",(0,f.getMessageExceptionDescription)(e)),r(e)):this.hostCallbacks.executeLocalLambda(n.inputSchema,e.payload,n.outputSchema).then((function(a){i.handleLambdaOutput(a,e,t,n.outputSchema,o,r)})).catch((function(n){i.handleLambdaError(n,e,t,h.ExceptionType.LambdaThrow,r)}))}},{key:"executeRemoteLambdaStep",value:function(e,t,o,r,i,a){var s=this;if(this.serviceUrl){t.resourceId+=".".concat(this.serviceProtocol);var u=function(n,r){n?s.handleLambdaError(n,e,t,n.exceptionType||h.ExceptionType.LambdaErrorCallback,a):s.handleLambdaOutput(r,e,t,o.outputSchema,i,a)};if(r.authTickets=o.authTickets,o.source===T.LambdaSource.Remote)this.executeRemoteLambda(this.serviceUrl,e,(0,n.getTypeFromSchema)(o.inputSchema),(0,n.getTypeFromSchema)(o.outputSchema),e.correlationVector,this.clientMetadata,this.hostCallbacks,r,u);else{this.batchedRemoteLambdaManager||(this.batchedRemoteLambdaManager=new p.BatchManager((function(e,t,o){var r=t.context,i=r.remoteLambda,a=r.lambdaContext;s.executeRemoteLambda(s.serviceUrl,{messageType:h.MessageType.Input,correlationVector:{id:t.cv},payload:e,payloadSchema:(0,n.getTypeFromSchema)(i.inputSchema),clientMetadata:s.clientMetadata},(0,n.getTypeFromSchema)(i.remoteInputSchema),(0,n.getTypeFromSchema)(i.remoteOutputSchema),{id:t.cv},s.clientMetadata,s.hostCallbacks,a,o)}),(function(e,t,n){var o,r=n.lambdaContext;s.updateResultCacheForReduceWorkflows("docSessionId",null!==(o=r.docSessionId)&&void 0!==o?o:r.docId,e,t)})));var c=o.batchOptions,l=this.normalizeBatchOptions(c),d=l.groupingKeyExtractor;l.groupingKeyExtractor=function(e){return"".concat(o.name,"-").concat(d(e))};var g={name:o.name,remoteLambda:o,lambdaContext:r};this.batchedRemoteLambdaManager.addBatchItem(e.payload,l,g,e.correlationVector.id.length>127?e.correlationVector.id.substring(0,127)+"!":e.correlationVector.id,void 0,u)}}else(0,f.setMessageException)(e,{exceptionType:h.ExceptionType.LambdaThrow,message:"No URL for remote lambda"}),this.logOperation(t,!1,"Error",(0,f.getMessageExceptionDescription)(e)),a(e)}},{key:"createLambdaExecutionStep",value:function(e,t,n,o,r){var i=this;return function(a){var s=new d.Operation({cv:a.correlationVector.toString(),operationName:"ExecuteLambda",resourceId:t.name,dimension0:e});s.start(),t.source===T.LambdaSource.Custom?i.executeCustomLambdaStep(a,s,t,n,o,r):t.source===T.LambdaSource.Local?i.executeLocalLambdaStep(a,s,t,o,r):t.source===T.LambdaSource.Remote||t.source===T.LambdaSource.BatchedRemote?i.executeRemoteLambdaStep(a,s,t,n,o,r):((0,f.setMessageException)(a,{exceptionType:h.ExceptionType.LambdaThrow,message:"Unknown/No lambda location set"}),i.logOperation(s,!1,"Error",(0,f.getMessageExceptionDescription)(a)),r(a))}}},{key:"normalizeBatchOptions",value:function(e){if(!e)throw new Error("Expected batchConfig");var t=Object.assign({},e);return e.estimateSize||(t.estimateSize=g.estimateSize),t}}]),e}();n.ClientRuntimeALv1=O,n.runtimeALv1=new O},{1:1,10:10,109:109,155:155,172:172,174:174,178:178,189:189,192:192,4:4,40:40,5:5,6:6,7:7,76:76,9:9}],9:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.LambdaSource=void 0,function(e){e[e.Unknown=0]="Unknown",e[e.Local=1]="Local",e[e.Custom=2]="Custom",e[e.Remote=3]="Remote",e[e.BatchedRemote=4]="BatchedRemote"}(n.LambdaSource||(n.LambdaSource={}))},{}],10:[function(e,t,n){"use strict";var o=e(178),r=o(e(172)),i=o(e(174));Object.defineProperty(n,"__esModule",{value:!0}),n.ExecutionWithThrottling=void 0;var a=e(76),s=function(){function e(){(0,r.default)(this,e),this.throttleInfoMap=new Map}return(0,i.default)(e,[{key:"execute",value:function(e,t,n){var o=this;if(t.throttleSettings.shouldBeThrottled&&t.throttleSettings.throttlingInterval>0){var r=this.getWorkflowThrottleInfo(t.name);if(null==r.currentTileId)r.currentTileId=e,r.timeOfPreviousStartedEvent=a.Utils.getCurrentTimeMs(),n();else if(r.currentTileId===e){var i=a.Utils.getCurrentTimeMs(),s=this.delayTime(r,i,t.throttleSettings.throttlingInterval);s>0?(r.latestCallback=n,null==r.lastTimeout&&(r.lastTimeout=setTimeout((function(){var e=o.getWorkflowThrottleInfo(t.name);e.lastTimeout=void 0,e.timeOfPreviousStartedEvent=a.Utils.getCurrentTimeMs(),e.latestCallback()}),s))):(r.timeOfPreviousStartedEvent=i,n())}else null!=r.lastTimeout&&(clearTimeout(r.lastTimeout),r.latestCallback(),r.lastTimeout=void 0),r.currentTileId=e,r.timeOfPreviousStartedEvent=a.Utils.getCurrentTimeMs(),n()}else n()}},{key:"delayTime",value:function(e,t,n){var o=t-e.timeOfPreviousStartedEvent;return Math.max(n-o,0)}},{key:"getWorkflowThrottleInfo",value:function(e){var t=this.throttleInfoMap.get(e);return t||(t={currentTileId:void 0,timeOfPreviousStartedEvent:-1,latestCallback:function(){},lastTimeout:void 0},this.throttleInfoMap.set(e,t)),t}}]),e}();n.ExecutionWithThrottling=s},{172:172,174:174,178:178,76:76}],11:[function(e,t,n){"use strict";var o=e(178),r=o(e(174)),i=o(e(172));Object.defineProperty(n,"__esModule",{value:!0}),n.TokenCache=void 0;var a=e(76),s=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:33e5;(0,i.default)(this,e),this.tokenCache=new Map,this.requestMap=new Map,this.requestRecordMap=new Map,this.tokenExpirationMs=t}return(0,r.default)(e,[{key:"updateAuthToken",value:function(e,t){var n=this,o=JSON.stringify(t),r=this.requestRecordMap.get(o);return(void 0===r||this.isTokenExpired(r))&&(r={requestPromise:e.requestAuthToken(t).then((function(e){if(!e||!e.Token)throw new Error("No token available for request ".concat(o));n.tokenCache.set(o,e.Token)})),requestTime:a.Utils.getCurrentTimeMs()},this.requestRecordMap.set(o,r)),r.requestPromise}},{key:"getAuthTokenEntries",value:function(e,t){var n=this;return Array.from(this.tokenCache.keys()).map((function(e){var t=n.requestMap.get(e);return void 0===t&&(t=JSON.parse(e),n.requestMap.set(e,t)),{requestKey:e,request:t}})).filter((function(e){var n=e.request;return!t||n.DocId===t})).map((function(t){var o=t.requestKey,r=t.request;return n.isTokenExpired(n.requestRecordMap.get(o))&&n.updateAuthToken(e,r),{ticket:r.Tickets[0],token:n.tokenCache.get(o)}}))}},{key:"isTokenExpired",value:function(e){return a.Utils.getCurrentTimeMs()>e.requestTime+this.tokenExpirationMs}}]),e}();n.TokenCache=s},{172:172,174:174,178:178,76:76}],12:[function(e,t,n){"use strict";var o=e(178),r=o(e(172)),i=o(e(174));function a(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){u=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw i}}}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}Object.defineProperty(n,"__esModule",{value:!0}),n.WebSocketRequestManager=void 0;var u=e(40),c=e(76),l=function(){function e(t,n,o,i,a,s){(0,r.default)(this,e),this.requestId=t,this.correlationId=n,this.schemaName=o,this.data=i,this.callback=a,this.requestTimeoutInMs=s,this.ended=!1,this.startTime=0}return(0,i.default)(e,[{key:"startRequest",value:function(){this.startTime=c.Utils.getCurrentTimeMs()}},{key:"getMsUntilTimeout",value:function(){var e=c.Utils.getCurrentTimeMs()-this.startTime;return this.requestTimeoutInMs-e}},{key:"endRequest",value:function(e){this.ended||(this.invokeCallback(null,e,!0),this.ended=!0)}},{key:"addResponseData",value:function(e){this.invokeCallback(e,null,!1)}},{key:"invokeCallback",value:function(e,t,n){var o=this;new Promise((function(){return o.callback(e,t,n)})).catch((function(e){}))}}]),e}(),f=function(){function e(t,n,o){(0,r.default)(this,e),this.requestCounter=0,this.activeRequests=[],this.pendingRequests=[],this.requestTimeoutInMs=t,this.workerFactory=n,this.maxActiveRequests=o}return(0,i.default)(e,[{key:"testConnection",value:function(e,t){var n=this,o=!1,r=new u.Operation({cv:(new u.CorrelationVector).toString(),operationName:"WebSocketTest",resourceId:e,success:!0}).start();return new Promise((function(i){var a=c.Utils.createHealthCheckRequest(t);e?n.addRequest(e,a,r.cv,"HealthCheckRequest",(function(e,t,n){t&&(r.success=!1,r.resultSignature="Error",r.resultDescription=t.message||t),e&&"OK"===e.status&&(o=!0),n&&(r.success&&!o&&(r.success=!1,r.resultSignature="NoResponseData"),u.Log.info(556617949,u.LogCategory.CoreDefault,r.stop()),i(r.success))})):(r.success=!1,r.resultSignature="EmptyUrl",u.Log.info(557641870,u.LogCategory.CoreDefault,r.stop()),i(r.success))}))}},{key:"addRequest",value:function(e,t,n,o,r){var i=(this.requestCounter++).toString(),a=new l(i,n,o,t,r,this.requestTimeoutInMs);this.getWorker(e),this.pendingRequests.push(a),this.egressPendingRequests()}},{key:"egressPendingRequests",value:function(){for(;this.pendingRequests.length>0&&this.activeRequests.length<this.maxActiveRequests;){var e=this.pendingRequests.shift();if(this.activeRequests.push(e),1===this.activeRequests.length){var t=e.getMsUntilTimeout();setTimeout(this.onTimeout.bind(this),t)}e.startRequest(),this.worker&&this.worker.egress({obj:this.createRequestMessage(e.data,e.requestId,e.correlationId)})}}},{key:"createRequestMessage",value:function(e,t,n){return JSON.stringify({correlationId:n,requestId:t,body:e})}},{key:"onTimeout",value:function(){for(;this.activeRequests.length>0;){var e=this.activeRequests[0],t=e.getMsUntilTimeout();if(!(t<=0))return void setTimeout(this.onTimeout.bind(this),t);var n=new Error("Request timed out");e.endRequest(n),this.activeRequests.shift(),this.egressPendingRequests()}}},{key:"onMessage",value:function(e){try{for(var t=JSON.parse(e),n=0;n<this.activeRequests.length;n++){var o=this.activeRequests[n];if(o.requestId===t.requestId){t.end?(this.activeRequests.splice(n,1),o.endRequest(t.error),this.egressPendingRequests()):t.body&&o.addResponseData(t.body);break}}}catch(e){u.Log.error(557641871,u.LogCategory.CoreDefault,e)}}},{key:"onClose",value:function(e){var t,n=new Error("Connection closed: ".concat(e)),o=a(this.activeRequests);try{for(o.s();!(t=o.n()).done;){t.value.endRequest(n)}}catch(e){o.e(e)}finally{o.f()}this.activeRequests=[];var r,i=a(this.pendingRequests);try{for(i.s();!(r=i.n()).done;){r.value.endRequest(n)}}catch(e){i.e(e)}finally{i.f()}this.pendingRequests=[],this.worker=void 0}},{key:"getWorker",value:function(e){return this.worker||(this.worker=this.workerFactory(),this.worker.init(e,this.onMessage.bind(this),(function(){}),this.onClose.bind(this))),this.worker}}]),e}();n.WebSocketRequestManager=f},{172:172,174:174,178:178,40:40,76:76}],13:[function(e,t,n){"use strict";var o=e(178),r=o(e(172)),i=o(e(174));function a(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){u=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw i}}}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}Object.defineProperty(n,"__esModule",{value:!0}),n.BufferingSequencer=void 0;var u=e(40),c=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:500,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];(0,r.default)(this,e),this.prevSeq=-1,this.bufferingTimeMs=t,this.rejectOutdatedSequenceNumbers=n}return(0,i.default)(e,[{key:"sequence",value:function(t){var n=this;return new Promise((function(o,r){if(t<n.prevSeq){if(n.rejectOutdatedSequenceNumbers){var i=new Error("BufferingSequencer: Item out of order. Expecting seqId > ".concat(n.prevSeq,". Actual seqId ").concat(t));return i.name=e.Rejected,void r(i)}n.prevSeq=-1}t!=n.prevSeq+1&&u.Log.warn(542712385,u.LogCategory.CoreDefault,"BufferingSequencer: got out of order sequence number. Got ".concat(t,", expected ").concat(n.prevSeq+1));var a={seq:t,resolve:o};n.insertItem(a),n.runInOrder(a,!0,!1)}))}},{key:"insertItem",value:function(e){if(!this.firstQueueItem)return this.firstQueueItem=e,void(this.lastQueueItem=e);var t=this.lastQueueItem,n=null;do{if(e.seq>t.seq)return e.prev=t,t.next=e,void(n?n.prev=e:this.lastQueueItem=e);n=t,t=t.prev}while(t);n&&(n.prev=e),e.next=n,this.firstQueueItem=e}},{key:"runInOrder",value:function(e,t,n){for(var o=this,r=this.prevSeq,i=!1,s=[];this.firstQueueItem;){var u=this.firstQueueItem;if(r+1!=u.seq&&(!n||u.seq>e.seq))break;r=u.seq,u.timeout&&clearTimeout(u.timeout),s.push(u),e==u&&(i=!0),this.firstQueueItem=this.firstQueueItem.next,this.firstQueueItem&&(this.firstQueueItem.prev=null)}s.length>0&&setTimeout((function(){var e,t=a(s);try{for(t.s();!(e=t.n()).done;){var n=e.value;n.resolve(n.seq)}}catch(e){t.e(e)}finally{t.f()}}),0),this.prevSeq=r,!i&&t&&(e.timeout=setTimeout((function(){o.runInOrder(e,!1,!0)}),this.bufferingTimeMs))}}]),e}();n.BufferingSequencer=c,c.Rejected="SequenceItemRejected"},{172:172,174:174,178:178,40:40}],14:[function(e,t,n){"use strict";var o=e("exportStarHelper");Object.defineProperty(n,"__esModule",{value:!0}),o(e(13),n)},{13:13}],15:[function(e,t,n){"use strict";var o=e("exportStarHelper");Object.defineProperty(n,"__esModule",{value:!0}),o(e(18),n)},{18:18}],16:[function(e,t,n){"use strict";var o=e(178)(e(189));function r(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){u=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(u)throw a}}}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}var a=e("importDefaultHelper");Object.defineProperty(n,"__esModule",{value:!0}),n.formatedTextTileDeltaBuilderHandler=n.textTileDeltaBuilderHandler=void 0;var s=e(150),u=e(19),c=a(e(199)),l=/[ \u00a0\u2000-\u200a\u202f\u205f\u3000\t]/g,f=/[.!?]/g;function d(e,t){var n=e.content,o=t.content,r=(0,u.getMinimalDifferenceBounds)(n,o),i=r.firstDiffLeft,a=n.length-r.firstDiffRight,c=o.length-r.firstDiffRight,d=s.TextTileDeltaType.Update,p=void 0;if(n.length!==o.length)a===i?(d=s.TextTileDeltaType.Add,p=n[n.length-1]):c===i&&(d=s.TextTileDeltaType.Delete,p=o[o.length-1]);else if(n===o)return;var h,g=0;switch(d){case s.TextTileDeltaType.Update:g=a-i,h=o.substring(i,c);break;case s.TextTileDeltaType.Add:h=o.substring(i,c);break;case s.TextTileDeltaType.Delete:g=a-i,h=n.substring(i,a)}var y=function(e,t){var n=Array.from(e.matchAll(l));if(l.lastIndex=0,0===n.length)return s.TextTileDeltaUnit.Chars;if(1===n.length){if(0===n[0].index)return t&&f.test(t)?s.TextTileDeltaUnit.Sentence:t&&!l.test(t)?s.TextTileDeltaUnit.Word:s.TextTileDeltaUnit.Chars;if(n[0].index+1===e.length)return f.test(e[n[0].index-1])?s.TextTileDeltaUnit.Sentence:l.test(e[n[0].index-1])?s.TextTileDeltaUnit.Chars:s.TextTileDeltaUnit.Word;if(e[n[0].index-1]){var o=e[n[0].index-1];if(f.test(o))return s.TextTileDeltaUnit.Sentence;if(l.test(o))return s.TextTileDeltaUnit.Chars}return s.TextTileDeltaUnit.Word}var r=Array.from(e.matchAll(f));if(f.lastIndex=0,0===r.length)return s.TextTileDeltaUnit.PartialSentence;if(r.length>1)return s.TextTileDeltaUnit.Paragraph;if(r[0].index+1<=e.length)return l.test(e[r[0].index+1])?s.TextTileDeltaUnit.Sentence:s.TextTileDeltaUnit.Paragraph;return}(h,p);if(void 0!==y)return new s.FormattedTextTileDelta({content:d!==s.TextTileDeltaType.Delete?h:void 0,deltaType:d,unit:y,position:i,length:d!==s.TextTileDeltaType.Add?g:0})}n.textTileDeltaBuilderHandler=function(e,t){var n=[],o=d(e,t);return o&&n.push(o),n},n.formatedTextTileDeltaBuilderHandler=function(e,t){var n=[],i=d(e,t);i&&n.push(i);var a=function(e,t,n){var o,r,i,a,u,c,l=e,f=t;if((null==l?void 0:l.ipPosition)===(null==f?void 0:f.ipPosition)&&(null==l?void 0:l.isColdIp)===(null==f?void 0:f.isColdIp))return;if((null==l?void 0:l.isColdIp)===(null==f?void 0:f.isColdIp)&&n)if(n.deltaType===s.TextTileDeltaType.Add){if((null==f?void 0:f.ipPosition)===(null!==(o=n.position)&&void 0!==o?o:0)+(null!==(r=n.length)&&void 0!==r?r:0))return}else if(n.deltaType===s.TextTileDeltaType.Update){if((null==f?void 0:f.ipPosition)===(null!==(i=n.position)&&void 0!==i?i:0)+(null!==(u=null===(a=n.content)||void 0===a?void 0:a.length)&&void 0!==u?u:0))return}else if(n.deltaType===s.TextTileDeltaType.Delete&&(null==f?void 0:f.ipPosition)===(null!==(c=n.position)&&void 0!==c?c:0))return;return new s.FormattedTextTileDelta({deltaType:s.TextTileDeltaType.CursorUpdate,cursorData:{ipPosition:null==f?void 0:f.ipPosition,isColdIp:null==f?void 0:f.isColdIp}})}(e,t,i);a&&n.push(a);var u=function(e,t,n){var i,a,u,l,f,d,p,h=e,g=t;if((null===(i=g.formattedRanges)||void 0===i?void 0:i.length)<=(null===(a=h.formattedRanges)||void 0===a?void 0:a.length))if(n){var y=h.formattedRanges?(0,o.default)(h.formattedRanges):[],m=function(e,t,n){if(!e)return;if(t.deltaType===s.TextTileDeltaType.Add){var o=e.find((function(e){return e.start===n&&0===e.length}));if(o)return o;n=Math.max(n-1,0)}return e.find((function(e){return 0===e.length?e.start===n:e.start<=n&&n<e.start+e.length}))}(h.formattedRanges,n,n.position),v=m?y.indexOf(m):-1;if(-1!==v&&(n.position+(n.length||0)>m.start+m.length?m.length=n.position+(null!==(u=n.content)&&void 0!==u?u:"").length-m.start:m.length+=(null!==(l=n.content)&&void 0!==l?l:"").length-(n.length||0),y[v]=m),y.length>0){var k,T=r(y.slice(v+1));try{for(T.s();!(k=T.n()).done;){var S=k.value;S.start<n.position||(n.position+(n.length||0)>S.start?(S.length=S.start+S.length-(n.position+(n.length||0)),S.start=n.position+(null!==(f=n.content)&&void 0!==f?f:"").length):S.start+=(null!==(d=n.content)&&void 0!==d?d:"").length-(n.length||0))}}catch(e){T.e(e)}finally{T.f()}y=y.filter((function(e){return e.length>0}))}var b=null!==(p=null==g?void 0:g.formattedRanges)&&void 0!==p?p:[];if((0,c.default)(y,b)||0===y.length&&0===b.length)return}else if((0,c.default)(null==h?void 0:h.formattedRanges,null==g?void 0:g.formattedRanges))return;return new s.FormattedTextTileDelta({deltaType:s.TextTileDeltaType.FormattingUpdate,formattedRanges:null==g?void 0:g.formattedRanges})}(e,t,i);u&&n.push(u);var l=function(e,t){var n,o=e,r=t,i={},a=!1;for(n in r)-1===["ipPosition","isColdIp","content","formattedRanges"].indexOf(n)&&((0,c.default)(r[n],o[n])||(a=!0,i[n]=r[n]));if(a)return new s.FormattedTextTileDelta({deltaType:s.TextTileDeltaType.OtherNonContentUpdate,otherNonContentData:i});return}(e,t);return l&&n.push(l),n}},{150:150,178:178,189:189,19:19,199:199}],17:[function(e,t,n){"use strict";var o=e(178),r=o(e(172)),i=o(e(174));Object.defineProperty(n,"__esModule",{value:!0}),n.DeltaBuilder=void 0;var a=e(150),s=e(16),u=function(){function e(){(0,r.default)(this,e),this.deltaBuilderHandlers=new Map,this.registerDeltaBuilderHandler(a.TextTile.getTypeName(),s.textTileDeltaBuilderHandler),this.registerDeltaBuilderHandler(a.FormattedTextTile.getTypeName(),s.formatedTextTileDeltaBuilderHandler)}return(0,i.default)(e,[{key:"registerDeltaBuilderHandler",value:function(e,t){this.deltaBuilderHandlers.set(e,t)}},{key:"executeDeltaBuilderHandler",value:function(e,t,n){var o=this.deltaBuilderHandlers.get(e);return o?o(t,n):[]}}]),e}();n.DeltaBuilder=u},{150:150,16:16,172:172,174:174,178:178}],18:[function(e,t,n){"use strict";var o=e(178),r=o(e(172)),i=o(e(174));Object.defineProperty(n,"__esModule",{value:!0}),n.DeltaGenerator=void 0;var a=e(139),s=e(40),u=e(150),c=e(17),l=function(e,t){return t?"".concat(t.join("\\"),"-").concat(e):e},f=function(){function e(){var t=this;(0,r.default)(this,e),this.createTextTileDeltasFromItem=function(e,n){var o,r=new s.Operation({operationName:"CreateTextTileDeltaFromItem",success:!0}).start();try{if(!e)return r.success=!1,r.resultDescription="Unable to create text tile delta, parent item is undefined",void s.Log.info(524883085,s.LogCategory.CoreDefault,r.stop());if(!e.body)return r.success=!1,r.resultDescription="Unable to create text tile delta, parent item has undefined body",void s.Log.info(524883086,s.LogCategory.CoreDefault,r.stop());var i=e.body;if(!u.TextTile.typeGuard(i))return r.success=!1,void(r.resultDescription="Unable to create text tile delta, parent item body is not proper type: expected ".concat(u.TextTile.getTypeName(),", received ").concat(a.SchemaObject.getTypeNameFor(i)));var c=l(e.id,n),f=null!==(o=t.lastSeenTileByTileId.get(c))&&void 0!==o?o:new u.TextTile({content:""}),d=t.createDeltas(f,i);return d&&0!==d.length?(r.dimension0=d.length.toString(),t.lastSeenTileByTileId.set(c,i)):(r.dimension0="0",r.resultDescription="No delta differences found"),s.Log.info(524883087,s.LogCategory.CoreDefault,r.stop()),d}catch(e){return r.success=!1,r.resultDescription="Error creating text tile delta: ".concat(e),void s.Log.info(524883088,s.LogCategory.CoreDefault,r.stop())}},this.lastSeenTileByTileId=new Map,this.deltaBuilder=new c.DeltaBuilder}return(0,i.default)(e,[{key:"addItemToLocalMap",value:function(e,t){var n=l(e.id,t),o=e.body;u.TextTile.typeGuard(o)&&!this.lastSeenTileByTileId.has(n)&&this.lastSeenTileByTileId.set(n,o)}},{key:"deleteItemFromLocalMap",value:function(e,t){var n=l(e.id,t);this.lastSeenTileByTileId.has(n)&&this.lastSeenTileByTileId.delete(n)}},{key:"createDeltas",value:function(e,t){return this.deltaBuilder.executeDeltaBuilderHandler(a.SchemaObject.getTypeNameFor(t),e,t)}}]),e}();n.DeltaGenerator=f},{139:139,150:150,17:17,172:172,174:174,178:178,40:40}],19:[function(e,t,n){"use strict";function o(e,t,n){if(e.firstDiffLeft>0){var o=e.firstDiffLeft<t.length&&a(t,e.firstDiffLeft),r=e.firstDiffLeft<n.length&&a(n,e.firstDiffLeft);(o||r)&&(e.firstDiffLeft-=1)}if(e.firstDiffRight>1){var i=e.firstDiffRight<t.length&&a(t,t.length-e.firstDiffRight),s=e.firstDiffRight<n.length&&a(n,n.length-e.firstDiffRight);(i||s)&&(e.firstDiffRight-=1)}}function r(e,t){var n,o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={firstDiffLeft:0,firstDiffRight:t.length};for(n=0;n<e.length&&n<t.length;n+=1){var a=e.charCodeAt(n),s=t.charCodeAt(n);if(!(a===s||i(a,o)&&i(s,o)))break}for(r.firstDiffLeft=n,n=0;n<e.length&&n<t.length;n+=1){var u=e.charCodeAt(e.length-n-1),c=t.charCodeAt(t.length-n-1);if(!(u===c||i(u,o)&&i(c,o)))break}return r.firstDiffRight=n,r}function i(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];switch(e){case 12288:case 8197:case 32:case 11:case 9:case 160:return!0;case 13:case 10:case 65532:return!t}return!1}function a(e,t){return e.charCodeAt(t)>=56320&&e.charCodeAt(t)<=57343}Object.defineProperty(n,"__esModule",{value:!0}),n.getMinimalDifferenceBounds=void 0,n.getMinimalDifferenceBounds=function(e,t){var n,i,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s={firstDiffLeft:0,firstDiffRight:t.length};return e.length<t.length?(n=e,i=t):(n=t,i=e),0===i.indexOf(n)?(s.firstDiffLeft=n.length,s.firstDiffRight=0):i.endsWith(n)?(s.firstDiffLeft=0,s.firstDiffRight=n.length):(s=r(e,t,a)).firstDiffLeft+s.firstDiffRight>n.length&&(s.firstDiffRight=n.length-s.firstDiffLeft),o(s,e,t),s}},{}],20:[function(e,t,n){"use strict";var o=e("exportStarHelper");Object.defineProperty(n,"__esModule",{value:!0}),o(e(21),n)},{21:21}],21:[function(e,t,n){"use strict";var o=e(178),r=o(e(172)),i=o(e(174));Object.defineProperty(n,"__esModule",{value:!0}),n.ObserverStatusAnnotation=n.ExcelSessionCloseReason=n.ExcelKeepAlive=n.ExcelAccessTokenRefreshed=n.ExcelWorkbookUpdated=n.ExcelServerSessionExtensionConfig=n.ExcelServerSessionInitMessage=void 0;var a=e(139),s=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Excel_Session_Protocol_ExcelServerSessionInitMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_SessionInitMessage","AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.ExcelServerSessionInitMessage=s,s.H_={T_:s.getTypeName(),B_:s.getBaseTypes()};var u=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Excel_Session_Protocol_ExcelServerSessionExtensionConfig"}},{key:"getBaseTypes",value:function(){return[]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.ExcelServerSessionExtensionConfig=u,u.H_={T_:u.getTypeName(),B_:u.getBaseTypes()};var c=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Excel_Session_Protocol_ExcelWorkbookUpdated"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.ExcelWorkbookUpdated=c,c.H_={T_:c.getTypeName(),B_:c.getBaseTypes()};var l=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Excel_Session_Protocol_ExcelAccessTokenRefreshed"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.ExcelAccessTokenRefreshed=l,l.H_={T_:l.getTypeName(),B_:l.getBaseTypes()};var f=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Excel_Session_Protocol_ExcelKeepAlive"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.ExcelKeepAlive=f,f.H_={T_:f.getTypeName(),B_:f.getBaseTypes()};var d=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Excel_Session_Protocol_ExcelSessionCloseReason"}},{key:"getBaseTypes",value:function(){return[]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.ExcelSessionCloseReason=d,d.H_={T_:d.getTypeName(),B_:d.getBaseTypes()};var p=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,[{key:"metadata",get:function(){return this.M_},set:function(e){this.M_=e}}],[{key:"getTypeName",value:function(){return"AugLoop_Excel_Session_Protocol_ObserverStatusAnnotation"}},{key:"getBaseTypes",value:function(){return["AugLoop_Core_Annotation"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.ObserverStatusAnnotation=p,p.H_={T_:p.getTypeName(),B_:p.getBaseTypes()}},{139:139,172:172,174:174,178:178}],22:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.OAuth2V2LoginStatus=n.OAuth2GrantFlow=n.UserType=n.AuthTokenType=void 0,function(e){e[e.EditorLowPrivilege=0]="EditorLowPrivilege",e[e.AugLoopLowPrivilege=1]="AugLoopLowPrivilege",e[e.Anonymous=2]="Anonymous",e[e.ClientAssertion=3]="ClientAssertion",e[e.ClientAssertionV2=4]="ClientAssertionV2",e[e.AutoClpLowPrivilege=5]="AutoClpLowPrivilege",e[e.AutoClpAppOnlyLowPrivilege=6]="AutoClpAppOnlyLowPrivilege",e[e.Substrate=7]="Substrate",e[e.WacUserInfo=8]="WacUserInfo",e[e.OwaExchange=9]="OwaExchange",e[e.SmartCompose=10]="SmartCompose",e[e.WritingAnalyticsLowPrivilege=11]="WritingAnalyticsLowPrivilege",e[e.DWEngineLowPrivilege=12]="DWEngineLowPrivilege",e[e.SubstrateApp=13]="SubstrateApp",e[e.CortanaAppPop=14]="CortanaAppPop",e[e.OfficeAppsAppOnly=15]="OfficeAppsAppOnly",e[e.PPTFrontdoorAppPop=16]="PPTFrontdoorAppPop",e[e.EditorAppOnlyLowPrivilege=17]="EditorAppOnlyLowPrivilege",e[e.AugLoopApp=18]="AugLoopApp",e[e.MeetingIntelligenceApp=19]="MeetingIntelligenceApp",e[e.GraphApp=20]="GraphApp",e[e.IceServicesApp=21]="IceServicesApp",e[e.AzureMapsApp=22]="AzureMapsApp",e[e.SpoApp=23]="SpoApp",e[e.OneDrive=24]="OneDrive",e[e.GoogleDrive=25]="GoogleDrive",e[e.GettyApp=26]="GettyApp",e[e.Dropbox=27]="Dropbox",e[e.GooglePhotos=28]="GooglePhotos",e[e.EditorApp=29]="EditorApp",e[e.AmazonKindle=30]="AmazonKindle",e[e.ShredderApp=31]="ShredderApp",e[e.FormsLowPrivilege=32]="FormsLowPrivilege",e[e.VivaSalesLowPrivilege=33]="VivaSalesLowPrivilege",e[e.IntentSvcApp=34]="IntentSvcApp",e[e.DcgLowPrivilege=35]="DcgLowPrivilege",e[e.CSALowPrivilege=36]="CSALowPrivilege",e[e.ConsumerSydneyLowPrivilege=37]="ConsumerSydneyLowPrivilege",e[e.CompliantSydneyApp=38]="CompliantSydneyApp",e[e.M365AdminApp=39]="M365AdminApp",e[e.MeetingArtifactsServiceLowPrivilege=40]="MeetingArtifactsServiceLowPrivilege",e[e.AlchemyApp=41]="AlchemyApp",e[e.M365Admin=42]="M365Admin",e[e.ConsumerShellApp=43]="ConsumerShellApp",e[e.PowerQueryLowPrivilege=44]="PowerQueryLowPrivilege",e[e.CIIApp=45]="CIIApp",e[e.ConsumerShell=46]="ConsumerShell",e[e.AssistCopilotLowPrivilege=47]="AssistCopilotLowPrivilege",e[e.Pva=48]="Pva",e[e.TeamsCopilotServiceLowPrivilege=49]="TeamsCopilotServiceLowPrivilege"}(n.AuthTokenType||(n.AuthTokenType={})),function(e){e[e.Unknown=0]="Unknown",e[e.Consumer=1]="Consumer",e[e.Enterprise=2]="Enterprise"}(n.UserType||(n.UserType={})),function(e){e.AuthorizationCode="authorization_code",e.ClientCredentials="client_credentials",e.RefreshToken="refresh_token"}(n.OAuth2GrantFlow||(n.OAuth2GrantFlow={})),function(e){e[e.LoggedIn=0]="LoggedIn",e[e.LoggedOut=1]="LoggedOut"}(n.OAuth2V2LoginStatus||(n.OAuth2V2LoginStatus={}))},{}],23:[function(e,t,n){"use strict";var o=e("exportStarHelper");Object.defineProperty(n,"__esModule",{value:!0}),o(e(22),n),o(e(24),n),o(e(25),n),o(e(26),n),o(e(27),n),o(e(28),n),o(e(29),n),o(e(30),n),o(e(31),n),o(e(32),n),o(e(33),n),o(e(35),n),o(e(34),n)},{22:22,24:24,25:25,26:26,27:27,28:28,29:29,30:30,31:31,32:32,33:33,34:34,35:35}],24:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Type=void 0,function(e){e[e.None=0]="None",e[e.Booleans=1]="Booleans",e[e.Float32s=2]="Float32s",e[e.Float64s=3]="Float64s",e[e.Int8s=4]="Int8s",e[e.Int16s=5]="Int16s",e[e.Int32s=6]="Int32s",e[e.Strings=7]="Strings",e[e.UnsignedInt8s=8]="UnsignedInt8s",e[e.UnsignedInt16s=9]="UnsignedInt16s",e[e.UnsignedInt32s=10]="UnsignedInt32s"}(n.Type||(n.Type={}))},{}],25:[function(e,t,n){"use strict";var o=e(178)(e(192));Object.defineProperty(n,"__esModule",{value:!0}),n.stringifyReplacer=void 0;n.stringifyReplacer=function(e,t){return"object"==(0,o.default)(t)&&0==Object.keys(t).length?void 0:t}},{178:178,192:192}],26:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.isExceptionMessage=void 0;var o=e(109);n.isExceptionMessage=function(e){return null==e||null==e.messageType||e.messageType==o.MessageType.Exception}},{109:109}],27:[function(e,t,n){"use strict";var o=e(178),r=o(e(174)),i=o(e(172)),a=o(e(177)),s=o(e(185)),u=o(e(176)),c=o(e(194));function l(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=(0,u.default)(e);if(t){var r=(0,u.default)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return(0,s.default)(this,n)}}Object.defineProperty(n,"__esModule",{value:!0}),n.ExpectedError=n.WorkflowDefinitionScope=void 0,function(e){e[e.JoinContext=0]="JoinContext",e[e.Session=1]="Session"}(n.WorkflowDefinitionScope||(n.WorkflowDefinitionScope={}));var f=function(e){(0,a.default)(n,e);var t=l(n);function n(){var e,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"ExpectedError";return(0,i.default)(this,n),(e=t.call(this,o)).__proto__=n.prototype,e}return(0,r.default)(n)}((0,c.default)(Error));n.ExpectedError=f},{172:172,174:174,176:176,177:177,178:178,185:185,194:194}],28:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.gatewayType=void 0,n.gatewayType="Gateway"},{}],29:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.LoggingLevel=void 0,function(e){e[e.error=0]="error",e[e.warn=1]="warn",e[e.info=3]="info",e[e.metric=4]="metric",e[e.verbose=5]="verbose",e[e.debug=6]="debug",e[e.disabled=7]="disabled"}(n.LoggingLevel||(n.LoggingLevel={}))},{}],30:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.EventStatus=void 0,function(e){e[e.Active=0]="Active",e[e.Stopped=1]="Stopped",e[e.Paused=2]="Paused"}(n.EventStatus||(n.EventStatus={}))},{}],31:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.DiagnosticLevel=n.DataCategories=void 0,function(e){e[e.ProductServiceUsage=2]="ProductServiceUsage",e[e.ProductServicePerformance=4]="ProductServicePerformance"}(n.DataCategories||(n.DataCategories={})),function(e){e[e.BasicEvent=10]="BasicEvent",e[e.FullEvent=100]="FullEvent",e[e.RequiredServiceDataEvent=110]="RequiredServiceDataEvent"}(n.DiagnosticLevel||(n.DiagnosticLevel={}))},{}],32:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.PrefilterActionType=n.PrefilterType=n.UnitType=n.TriggerCondition=n.InputStage=n.ProducerWaitPolicy=n.RequestedContextCardinality=n.ActivationTier=n.WorkflowVisibility=n.BillingDomain=n.WorkflowKind=void 0,function(e){e[e.SingleItem=0]="SingleItem",e[e.Reduce=1]="Reduce",e[e.Grid=2]="Grid",e[e.DynamicText=3]="DynamicText",e[e.Join=4]="Join",e[e.Generic=5]="Generic"}(n.WorkflowKind||(n.WorkflowKind={})),function(e){e[e.Default=0]="Default",e[e.Copilot=1]="Copilot"}(n.BillingDomain||(n.BillingDomain={})),function(e){e[e.Default=0]="Default",e[e.LocalOnly=1]="LocalOnly",e[e.Exclusive=2]="Exclusive"}(n.WorkflowVisibility||(n.WorkflowVisibility={})),function(e){e[e.PreActivate=0]="PreActivate",e[e.Default=1]="Default",e[e.DelayActivate=1]="DelayActivate",e[e.NeverActivate=2]="NeverActivate"}(n.ActivationTier||(n.ActivationTier={})),function(e){e[e.Required=-3]="Required",e[e.Optional=-1]="Optional"}(n.RequestedContextCardinality||(n.RequestedContextCardinality={})),function(e){e[e.Never=0]="Never",e[e.Always=1]="Always"}(n.ProducerWaitPolicy||(n.ProducerWaitPolicy={})),function(e){e[e.PreSeed=1]="PreSeed",e[e.OnSeed=2]="OnSeed",e[e.PostSeed=4]="PostSeed",e[e.All=5]="All"}(n.InputStage||(n.InputStage={})),function(e){e[e.UpstreamWorkflowsReady=0]="UpstreamWorkflowsReady",e[e.AnnotationMetadataUpdated=1]="AnnotationMetadataUpdated",e[e.DeltaUpdate=2]="DeltaUpdate",e[e.NonExclusiveTriggerSignals=3]="NonExclusiveTriggerSignals"}(n.TriggerCondition||(n.TriggerCondition={})),function(e){e[e.Character=1]="Character",e[e.Paragraph=2]="Paragraph"}(n.UnitType||(n.UnitType={})),function(e){e.Input="Input",e.Delta="Delta",e.UILanguage="UILanguage",e.MaxInputCount="MaxInputCount"}(n.PrefilterType||(n.PrefilterType={})),function(e){e.SetPredefinedAnnotation="SetPredefinedAnnotation",e.ClearAnnotations="ClearAnnotations"}(n.PrefilterActionType||(n.PrefilterActionType={}))},{}],33:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},{}],34:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},{}],35:[function(e,t,n){"use strict";var o=e(178),r=o(e(174)),i=o(e(172)),a=o(e(177)),s=o(e(185)),u=o(e(176)),c=o(e(194));function l(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=(0,u.default)(e);if(t){var r=(0,u.default)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return(0,s.default)(this,n)}}Object.defineProperty(n,"__esModule",{value:!0}),n.CoherencyError=n.GridRangeFilterCondition=void 0,function(e){e[e.None=0]="None",e[e.NotPartOfTables=1]="NotPartOfTables"}(n.GridRangeFilterCondition||(n.GridRangeFilterCondition={}));var f=function(e){(0,a.default)(n,e);var t=l(n);function n(){var e,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"CoherencyError";return(0,i.default)(this,n),(e=t.call(this,o)).__proto__=n.prototype,e}return(0,r.default)(n)}((0,c.default)(Error));n.CoherencyError=f},{172:172,174:174,176:176,177:177,178:178,185:185,194:194}],36:[function(e,t,n){"use strict";var o;Object.defineProperty(n,"__esModule",{value:!0}),n.AugLoopTextDecoder=n.AugLoopTextEncoder=void 0;o=function(){if("undefined"==typeof TextEncoder){e(200);var t={AugLoopTextEncoder:TextEncoder,AugLoopTextDecoder:TextDecoder};return TextEncoder=void 0,TextDecoder=void 0,t}return{AugLoopTextEncoder:TextEncoder,AugLoopTextDecoder:TextDecoder}}(),n.AugLoopTextEncoder=o.AugLoopTextEncoder,n.AugLoopTextDecoder=o.AugLoopTextDecoder},{200:200}],37:[function(e,t,n){"use strict";var o=e("exportStarHelper");Object.defineProperty(n,"__esModule",{value:!0}),o(e(38),n)},{38:38}],38:[function(e,t,n){"use strict";var o=e(178),r=o(e(172)),i=o(e(174));Object.defineProperty(n,"__esModule",{value:!0}),n.JSOND=void 0;var a=e(36),s=function(){function e(){(0,r.default)(this,e)}return(0,i.default)(e,null,[{key:"deserialize",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return e};if(t[0]!==e.IDENTIFIERBYTE)throw new Error("Invalid Binary: Incorrect Identifier");for(var o=1,r=[],i=new DataView(t.buffer,t.byteOffset,t.byteLength);o<t.byteLength;){if(o+4>t.byteLength)throw new Error("Invalid Binary: Error reading fragment length");var a=i.getUint32(o);if(o+a+4>t.byteLength)throw new Error("Invalid Binary: Fragment out of range");"undefined"!=typeof Buffer&&Buffer.from?r.push(Buffer.from(t.buffer,t.byteOffset+o+4,a)):r.push(new Uint8Array(t.buffer,t.byteOffset+o+4,a)),o+=4+a}if(r.length<1)throw new Error("Invalid Binary: No fragments found");var s=e.textDecoder.decode(r[0]),u=function(t,o){if("string"==typeof o){if(o.substring(0,e.BINARYKEYWORD.length)===e.BINARYKEYWORD){var i=parseInt(o.substring(e.BINARYKEYWORD.length),10);if("number"!=typeof i||i>=r.length-1)throw new Error("Invalid Binary: Binary index out of range");return n(r[i+1])}if(o.substring(0,e.ESCAPEKEYWORD.length)===e.ESCAPEKEYWORD)return o.substring(e.ESCAPEKEYWORD.length)}return o};return JSON.parse(s,u)}},{key:"serialize",value:function(t){var n=[void 0],o=JSON.stringify(t,(function(t,o){return ArrayBuffer.isView(o)?(n.push(o),"".concat(e.BINARYKEYWORD).concat(n.length-2)):o&&"Buffer"===o.type&&Array.isArray(o.data)?(n.push(new Uint8Array(o.data)),"".concat(e.BINARYKEYWORD).concat(n.length-2)):"string"==typeof o&&o.substring(0,e.ESCAPEKEYWORD.length)===e.ESCAPEKEYWORD?e.ESCAPEKEYWORD+o:o}));n[0]=e.textEncoder.encode(o);var r=n.reduce((function(e,t){return e+4+t.byteLength}),0),i=new Uint8Array(r+1);i[0]=e.IDENTIFIERBYTE;for(var a=1,s=new DataView(i.buffer,i.byteOffset,i.byteLength),u=0,c=n;u<c.length;u++){var l=c[u];s.setUint32(a,l.byteLength),i.set(l,a+4),a+=4+l.byteLength}return i}}]),e}();n.JSOND=s,s.IDENTIFIERBYTE=3,s.BINARYKEYWORD=":b",s.ESCAPEKEYWORD=":",s.textDecoder=new a.AugLoopTextDecoder,s.textEncoder=new a.AugLoopTextEncoder},{172:172,174:174,178:178,36:36}],39:[function(e,t,n){"use strict";var o=e(178),r=o(e(174)),i=o(e(172)),a=o(e(177)),s=o(e(185)),u=o(e(176));function c(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=(0,u.default)(e);if(t){var r=(0,u.default)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return(0,s.default)(this,n)}}Object.defineProperty(n,"__esModule",{value:!0}),n.AnnotationMetaDataChange=void 0;var l=function(e){(0,a.default)(n,e);var t=c(n);function n(e){var o;return(0,i.default)(this,n),(o=t.call(this,e)).eventName="AnnotationMetaDataChange",o}return(0,r.default)(n)}(e(130).AnnotationMetaDataChangeEvent);n.AnnotationMetaDataChange=l},{130:130,172:172,174:174,176:176,177:177,178:178,185:185}],40:[function(e,t,n){"use strict";var o=e("exportStarHelper");Object.defineProperty(n,"__esModule",{value:!0}),n.SessionHealthSource=n.SessionHealthReason=n.SessionHealthImpact=n.SessionHealthEvent=void 0,o(e(39),n),o(e(41),n),o(e(43),n),o(e(42),n),o(e(45),n);var r=e(47);Object.defineProperty(n,"SessionHealthEvent",{enumerable:!0,get:function(){return r.SessionHealth}}),Object.defineProperty(n,"SessionHealthImpact",{enumerable:!0,get:function(){return r.SessionHealthImpact}}),Object.defineProperty(n,"SessionHealthReason",{enumerable:!0,get:function(){return r.SessionHealthReason}}),Object.defineProperty(n,"SessionHealthSource",{enumerable:!0,get:function(){return r.SessionHealthSource}})},{39:39,41:41,42:42,43:43,45:45,47:47}],41:[function(e,t,n){"use strict";var o=e(178),r=o(e(172)),i=o(e(174));Object.defineProperty(n,"__esModule",{value:!0}),n.CorrelationVector=void 0;var a=function(){function e(t){(0,r.default)(this,e),this.childCount=0,this.id=t||function(){for(var e=0;e<22;e++)u[e]=s[Math.floor(Math.random()*s.length)];return u.join("")}()}return(0,i.default)(e,[{key:"newChild",value:function(){return++this.childCount,new e(this.id+"."+this.childCount.toString())}},{key:"toString",value:function(){return this.id.length>127?this.id.substring(0,127)+"!":this.id}}],[{key:"fromString",value:function(t,n){if(!t)throw new Error("Received invalid correlation vector string");var o;return o=t.endsWith(".0")?new e(t.substring(0,t.length-2)):new e(t),n&&(o.childCount=n),o}}]),e}();n.CorrelationVector=a;var s=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],u=new Array(22)},{172:172,174:174,178:178}],42:[function(e,t,n){"use strict";var o=e(178),r=o(e(174)),i=o(e(172));function a(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){u=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw i}}}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}Object.defineProperty(n,"__esModule",{value:!0}),n.LoggingAggregator=void 0;var u=/\|\~/g,c=(0,r.default)((function e(){(0,i.default)(this,e),this.count=0,this.measureSums=new Map})),l=(0,r.default)((function e(t,n,o,r,s){var l=this;(0,i.default)(this,e),this.buckets=new Map,this.init=function(e){l.log=e},this.add=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!l.condition||!l.condition(e))return!0===t&&l.log(e,!1),!1;var n,o=[],r=a(l.dimensions);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(void 0===e[i]||null===e[i])o.push(null);else{var s="";"boolean"==typeof e[i]?s="b~":"number"==typeof e[i]&&(s="n~"),o.push("".concat(s).concat(e[i].toString().replace(u,"_")))}}}catch(e){r.e(e)}finally{r.f()}var f=o.join("|"),d=l.buckets.get(f);if(!d){(d=new c).traceLevel=e.traceLevel;var p,h=a(l.avgMeasures);try{for(h.s();!(p=h.n()).done;){var g=p.value;d.measureSums.set(g,0)}}catch(e){h.e(e)}finally{h.f()}l.buckets.set(f,d)}d.count++;var y,m=a(l.avgMeasures);try{for(m.s();!(y=m.n()).done;){var v=y.value;e[v]&&d.measureSums.set(v,d.measureSums.get(v)+e[v])}}catch(e){m.e(e)}finally{m.f()}return!0},this.flush=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];l.buckets.forEach((function(e,t){for(var n={traceLevel:e.traceLevel,eventName:l.eventName,count:e.count},o=t.split("|"),r=0;r<l.dimensions.length;r++){var i=l.dimensions[r],s=o[r];0===s.indexOf("b~")?n[i]="b~true"===s:0===s.indexOf("n~")?n[i]=parseInt(s.slice("n~".length),10):n[i]=s}var u,c=a(l.avgMeasures);try{for(c.s();!(u=c.n()).done;){var f=u.value;n[f]=Math.round(e.measureSums.get(f)/e.count)}}catch(e){c.e(e)}finally{c.f()}l.log(n,!0)})),l.buckets.clear(),e&&(l.condition=null,clearInterval(l.interval))},this.eventName=t,this.condition=n,this.dimensions=o,this.avgMeasures=r,s>0&&(this.interval=setInterval(this.flush,1e3*s))}));n.LoggingAggregator=l},{172:172,174:174,178:178}],43:[function(e,t,n){"use strict";var o=e(178),r=o(e(174)),i=o(e(172)),a=o(e(192));function s(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return u(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}Object.defineProperty(n,"__esModule",{value:!0}),n.LogCategory=n.tagIdToString=n.getNumLoggers=n.argsToString=n.Log=void 0;var c,l,f=e(23),d=e(46),p="undefined"!=typeof process&&process.env?process.env.SERVICE_NAME:"client",h="abcdefghijklmnopqrstuvwxyz0123456789",g={97:0,98:1,99:2,100:3,101:4,102:5,103:6,104:7,105:8,106:9,107:10,108:11,109:12,110:13,111:14,112:15,113:16,114:17,115:18,116:19,117:20,118:21,119:22,120:23,121:24,122:25,48:26,49:27,50:28,51:29,52:30,53:31,54:32,55:33,56:34,57:35},y=[],m=[],v=function(e){return null},k=function(e){},T=new Map,S=new Map,b=new Map,w=new Map;!function(e){e.defineCoreLogCategory=function(e){return{root:"Core",name:e}},e.defineWorkflowLogCategory=function(e){return{root:"Workflow",name:e}},e.clearLoggers=function(){y=[],m=[],S.clear(),b.clear()},e.clearAggregators=function(){T.clear()},e.addLogger=function(e){-1===y.indexOf(e)&&(y.push(e),C(S,e))},e.addDecidingLogger=function(e){-1===m.indexOf(e)&&(m.push(e),C(b,e))},e.setCorrelationContextCallback=function(e){c=e},e.setStartPerformanceEventCallback=function(e){v=e},e.setStopPerformanceEventCallback=function(e){k=e},e.addAggregator=function(e){e.init((function(e,t){L(e,t)})),T.has(e.eventName)?T.get(e.eventName).push(e):T.set(e.eventName,[e])},e.flushAggregators=function(e){T.forEach((function(t){t.forEach((function(t){return t.flush(e)}))}))},e.setTagLevelOverride=function(e,t){var n=P(e);w.set(n,t)},e.resetTagLevelOverrides=function(){w.clear()},e.error=function(e,t,n,o,r,i,a,s,u,c){I(e,t,f.LoggingLevel.error,n,o,r,i,a,s,u,c)},e.warn=function(e,t,n,o,r,i,a,s,u,c){I(e,t,f.LoggingLevel.warn,n,o,r,i,a,s,u,c)},e.info=function(e,t,n,o,r,i,a,s,u,c){I(e,t,f.LoggingLevel.info,n,o,r,i,a,s,u,c)},e.verbose=function(e,t,n,o,r,i,a,s,u,c){I(e,t,f.LoggingLevel.verbose,n,o,r,i,a,s,u,c)},e.debug=function(e,t,n,o,r,i,a,s,u,c){I(e,t,f.LoggingLevel.debug,n,o,r,i,a,s,u,c)},e.metric=function(e,t,n,o,r,i,a,s,u,c){I(e,t,f.LoggingLevel.metric,n,o,r,i,a,s,u,c)},e.formatMetric=function(e,t,n,o){var r={};return r[e]={dimensionNames:n,dimensionValues:o,value:t},r},e.dynamic=function(e){L(e)}}(l=n.Log||(n.Log={}));var C=function(e,t){var n=t.level;Object.keys(f.LoggingLevel).map((function(e){return f.LoggingLevel[e]})).filter((function(e){return"string"!=typeof e})).filter((function(e){return e<=n})).forEach((function(n){e.has(n)?e.get(n).push(t):e.set(n,[t])}))};n.argsToString=function(e){if("string"==typeof e)return e;for(var t="",n=0;n<e.length;n++){n>0&&(t+=" ");var o=e[n];o instanceof Error?t+=JSON.stringify({message:o.message,name:o.name,stack:o.stack}):"object"===(0,a.default)(o)?t+=JSON.stringify(o):t+=o}return t};var _=[],x=["Level","Tag"],M=["Level","Tag","Workflow"];n.getNumLoggers=function(e){return A(e).length};var A=function(e){return void 0!==e?S.get(e)||_:y},O=function(e,t){return(void 0!==e?b.get(e)||[]:m).filter((function(e){return e.shouldLog(t)}))},I=function(e,t,o,r,i,s,u,l,f,p,h){o=w.get(e)||o;var g=A(o),y=O(o,r);if(0!=g.length||0!=y.length){var m=v(d.PerformanceEventType.Log),S=(0,n.tagIdToString)(e),b=function(e,t,n,o,r,i,s,u){if(void 0===t&&("string"==typeof e||"object"===(0,a.default)(e)))return e;if(void 0===t&&"function"==typeof e)return e();for(var c=[],l=0,f=[e,t,n,o,r,i,s,u];l<f.length;l++){var d=f[l];void 0!==d&&c.push("function"==typeof d?d():d)}return c}(r,i,s,u,l,f,p,h);if(D(t))E(b)&&L({eventName:"Metrics",tagId:S,category:"".concat(t.root,".").concat(t.name),traceLevel:o,message:"",getMetrics:function(){return b}},!1,g,y);else if(E(b)){var C=b;C.tagId=S,C.category="".concat(t.root,".").concat(t.name),"Operation"===C.eventName&&"Workflow"===t.root&&(C.eventName="WorkflowOperation",c&&(C.joinContextId=c().joinContextId)),C.traceLevel=o;var _=T.get(C.eventName);if(_)for(var I=0;I<_.length;++I){var P=_[I];if(P&&P.add(C,I===_.length-1))break}else L(C,!1,g,y)}else{L({eventName:"Log",tagId:S,category:"".concat(t.root,".").concat(t.name),traceLevel:o,message:(0,n.argsToString)(b),getMetrics:function(){var e;return"Core"===t.root?{TraceEventV2:{dimensionNames:function(){return x},dimensionValues:[String(o),S],value:1}}:{WorkflowTraceEvent:{dimensionNames:function(){return M},dimensionValues:[String(o),S,c?null===(e=c())||void 0===e?void 0:e.workflow:""],value:1}}}},!1,g,y)}k(m)}},L=function(e){var t,n,o,r,i,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],u=arguments.length>2?arguments[2]:void 0,l=arguments.length>3?arguments[3]:void 0;if(null==u&&(u=A(e.traceLevel)),l=l||_,u.length>0||l.length>0){if(e.serviceName=p,!a&&c){var f=c();if(f){e.cv=e.cv?e.cv:f.cv.toString(),e.sessionKey=e.sessionKey?e.sessionKey:f.sessionKey,e.workflow=e.workflow?e.workflow:f.workflow;var d=null===(t=f.clientMetadata)||void 0===t?void 0:t.appName;e.clientAppName=e.clientAppName?e.clientAppName:d;var h=null===(n=f.clientMetadata)||void 0===n?void 0:n.appPlatform;e.clientAppPlatform=e.clientAppPlatform?e.clientAppPlatform:h;var g=null===(o=f.clientMetadata)||void 0===o?void 0:o.releaseAudienceGroup;e.clientReleaseAudienceGroup=e.clientReleaseAudienceGroup?e.clientReleaseAudienceGroup:g;var y=null===(r=f.clientMetadata)||void 0===r?void 0:r.flights;null!==(i=e.clientFlights)&&void 0!==i||(e.clientFlights=y)}}var m,v=s(u);try{for(v.s();!(m=v.n()).done;){var k=m.value;k.log(e)}}catch(e){v.e(e)}finally{v.f()}var T,S=s(l);try{for(S.s();!(T=S.n()).done;){var b=T.value;b.log(e)}}catch(e){S.e(e)}finally{S.f()}}},D=function(e){return e.name===R.WorkflowMetricsOnly.name&&e.root===R.WorkflowMetricsOnly.root},E=function(e){return!Array.isArray(e)&&"object"===(0,a.default)(e)};n.tagIdToString=function(e){return h[e>>24&63]+h[e>>18&63]+h[e>>12&63]+h[e>>6&63]+h[e>>0&63]};var P=function(e){return e&&5===e.length?g[e.charCodeAt(0)]<<24|g[e.charCodeAt(1)]<<18|g[e.charCodeAt(2)]<<12|g[e.charCodeAt(3)]<<6|g[e.charCodeAt(4)]:-1},R=(0,r.default)((function e(){(0,i.default)(this,e)}));n.LogCategory=R,R.CoreDefault=l.defineCoreLogCategory("Default"),R.CoreSystem=l.defineCoreLogCategory("System"),R.WorkflowDefault=l.defineWorkflowLogCategory("Default"),R.WorkflowUnsampled=l.defineWorkflowLogCategory("Unsampled"),R.WorkflowMetricsOnly=l.defineWorkflowLogCategory("MetricsOnly"),R.PrivacyGuardEvent=l.defineCoreLogCategory("PrivacyGuardEvent")},{172:172,174:174,178:178,192:192,23:23,46:46}],44:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.now=void 0;n.now="undefined"!=typeof process&&process.hrtime?function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}:"undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return Date.now()}},{}],45:[function(e,t,n){"use strict";var o=e(178),r=o(e(172)),i=o(e(174)),a=o(e(177)),s=o(e(185)),u=o(e(176));function c(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=(0,u.default)(e);if(t){var r=(0,u.default)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return(0,s.default)(this,n)}}Object.defineProperty(n,"__esModule",{value:!0}),n.Operation=void 0;var l=e(130),f=e(44),d=function(e){(0,a.default)(n,e);var t=c(n);function n(e,o){var i;return(0,r.default)(this,n),(i=t.call(this,e)).eventName="Operation",i.options=o,i.durationMs=null==e?void 0:e.durationMs,e&&null!=e.count||(i.count=1),i}return(0,i.default)(n,[{key:"setClientMetadata",value:function(e){return e&&(this.clientAppName=e.appName,this.clientAppPlatform=e.appPlatform,this.clientAppVersion=e.appVersion,this.clientFlights=e.flights,this.clientReleaseAudienceGroup=e.releaseAudienceGroup,this.clientReleaseChannel=e.releaseChannel,this.clientReleaseFork=e.releaseFork,this.clientRuntimeVersion=e.runtimeVersion,this.clientSessionId=e.sessionId,this.clientDocSessionId=e.docSessionId,this.clientDeviceId=e.deviceId,this.clientUserAgent=e.userAgent),this}},{key:"setUserContext",value:function(e){return e&&(this.userId=e.puid||e.oid,this.userType=e.userType&&e.userType.toString(),this.userTenantId=e.tid),this}},{key:"setMetricCustomDimensions",value:function(e,t){if(!this.options)throw new Error("Attempting to set custom dimensions ".concat(e," to operation ").concat(this.operationName," without activating MetricCount or MetricDuration"));this.options.metricCustomDimensions=this.options.metricCustomDimensions||{},this.options.metricCustomDimensions[e]=t}},{key:"setDataField",value:function(e,t){var n=this.dataFields?JSON.parse(this.dataFields):{};n[e]=t,this.dataFields=JSON.stringify(n)}},{key:"setDataFields",value:function(e){this.dataFields?this.dataFields=JSON.stringify(Object.assign(Object.assign({},JSON.parse(this.dataFields)),e)):this.dataFields=JSON.stringify(e)}},{key:"start",value:function(){return this.startTime=(0,f.now)(),this}},{key:"stop",value:function(){var e=(0,f.now)();return this.durationMs=Math.round(e-this.startTime),this}},{key:"getMetrics",value:function(e){var t,o,r={};if(this.operationName)switch(this.operationName){case"SessionHealthOrphanedEventsWithoutProperSessionKey":case"SessionHealthOrphanedSessions":case"WorkflowActivationState":r[this.operationName+".CountV2"]={dimensionNames:n.getOrphanedSessionHealthDimensionNames.bind(n),dimensionValues:this.getOrphanedSessionHealthDimensionValues(),value:this.count};break;case"MarkUnhealthySession":case"MarkHealthWarningSession":r[this.operationName+".Reason"]={dimensionNames:n.getSessionHealthDimensionNames.bind(n),dimensionValues:this.getSessionHealthDimensionValues(),value:1};break;default:if("matchmaker_timer"===this.operationName&&(r["Workflow.DurationMs"]={dimensionNames:n.getWorkflowDimensionNames.bind(n),dimensionValues:this.getWorkflowDimensionValues(),value:this.durationMs||0},r["Workflow.Count"]={dimensionNames:n.getWorkflowDimensionNames.bind(n),dimensionValues:this.getWorkflowDimensionValues(),value:1}),void 0!==this.durationMs){var i="".concat(this.operationName,".DurationMsV2");((null===(t=this.options)||void 0===t?void 0:t.metricDuration)||e.indexOf(i)>=0)&&(r[i]={dimensionNames:this.getDimensionNames.bind(this),dimensionValues:this.getDimensionValues(),value:this.durationMs})}var a="".concat(this.operationName,".CountV2");((null===(o=this.options)||void 0===o?void 0:o.metricCount)||e.indexOf(a)>=0)&&(r[a]={dimensionNames:this.getDimensionNames.bind(this),dimensionValues:this.getDimensionValues(),value:this.count})}return r}},{key:"getDimensionNames",value:function(){var e,t,o=n.dimensionNames;if(null===(e=this.options)||void 0===e?void 0:e.metricCustomDimensions)for(var r in o=o.slice(),null===(t=this.options)||void 0===t?void 0:t.metricCustomDimensions)o.push(r);return o}},{key:"getDimensionValues",value:function(){var e,t,n=[this.success,this.clientAppName,this.clientAppPlatform,this.resourceId,this.dimension0,this.dimension1,this.dimension2,this.dimension3];if(null===(e=this.options)||void 0===e?void 0:e.metricCustomDimensions)for(var o in null===(t=this.options)||void 0===t?void 0:t.metricCustomDimensions)n.push(this.options.metricCustomDimensions[o]);return n}},{key:"getOrphanedSessionHealthDimensionValues",value:function(){return[this.success,this.clientAppName,this.clientAppPlatform,this.clientReleaseAudienceGroup,this.resourceId,this.dimension0,this.dimension1,this.dimension2,this.dimension3]}},{key:"getSessionHealthDimensionValues",value:function(){return[this.resultSignature,this.clientAppName,this.clientAppPlatform,this.clientAppVersion,this.dimension0,this.dimension1,this.dimension2,this.dimension3]}},{key:"getWorkflowDimensionValues",value:function(){return[this.resultSignature,this.resourceId,this.resourceId,this.success]}}],[{key:"getOrphanedSessionHealthDimensionNames",value:function(){return this.orphanedSessionHealthDimensionNames}},{key:"getSessionHealthDimensionNames",value:function(){return this.sessionHealthDimensionNames}},{key:"getWorkflowDimensionNames",value:function(){return this.workflowDimensionNames}}]),n}(l.OperationEvent);n.Operation=d,d.dimensionNames=["Success","ClientAppName","ClientAppPlatform","ResourceId","Dimension0","Dimension1","Dimension2","Dimension3"],d.orphanedSessionHealthDimensionNames=["Success","ClientAppName","ClientAppPlatform","ClientReleaseAudienceGroup","ResourceId","Dimension0","Dimension1","Dimension2","Dimension3"],d.sessionHealthDimensionNames=["Reason","ClientAppName","ClientAppPlatform","ClientAppVersion","Dimension0","Dimension1","Dimension2","Dimension3"],d.workflowDimensionNames=["ResultSignature","WorkflowId","ResourceId","Success"]},{130:130,172:172,174:174,176:176,177:177,178:178,185:185,44:44}],46:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.PerformanceEventType=void 0,function(e){e.Log="Log"}(n.PerformanceEventType||(n.PerformanceEventType={}))},{}],47:[function(e,t,n){"use strict";var o=e(178),r=o(e(172)),i=o(e(174)),a=o(e(177)),s=o(e(185)),u=o(e(176));function c(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=(0,u.default)(e);if(t){var r=(0,u.default)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return(0,s.default)(this,n)}}Object.defineProperty(n,"__esModule",{value:!0}),n.SessionHealth=n.SessionHealthImpact=n.SessionHealthReason=n.SessionHealthSource=void 0;var l,f,d,p=e(130),h=e(44);!function(e){e[e.Unknown=0]="Unknown",e[e.Core=1]="Core",e[e.Workflow=2]="Workflow",e[e.SessionExtension=3]="SessionExtension",e[e.Client=4]="Client",e[e.ClientRuntime=5]="ClientRuntime"}(l=n.SessionHealthSource||(n.SessionHealthSource={})),function(e){e[e.Unknown=0]="Unknown",e[e.Core=1]="Core",e[e.Workflow=2]="Workflow",e[e.SessionExtension=3]="SessionExtension",e[e.Client=4]="Client",e[e.Network=5]="Network",e[e.AugLoopDependency=6]="AugLoopDependency",e[e.WorkflowDependency=7]="WorkflowDependency",e[e.ClientRuntime=8]="ClientRuntime"}(f=n.SessionHealthReason||(n.SessionHealthReason={})),function(e){e[e.Unknown=0]="Unknown",e[e.None=1]="None",e[e.MissingInput=2]="MissingInput",e[e.MissingOutput=3]="MissingOutput"}(d=n.SessionHealthImpact||(n.SessionHealthImpact={}));var g=function(e){(0,a.default)(n,e);var t=c(n);function n(e,o){var i,a,s;return(0,r.default)(this,n),(i=t.call(this,{source:l[e.source],reason:f[e.reason],reasonDependency:e.reasonDependency,subReason:e.subReason,sessionHealthEventName:e.sessionHealthEventName,impact:d[e.impact],success:e.success,durationMs:null!==(a=e.durationMs)&&void 0!==a?a:0,count:"number"==typeof e.count?e.count:1,message:e.message,affectedWorkflows:(null!==(s=e.affectedWorkflows)&&void 0!==s?s:[]).join(","),resourceId:e.resourceId,dimension0:e.dimension0,dimension1:e.dimension1,dimension2:e.dimension2,dimension3:e.dimension3,cv:e.cv,resultSignature:e.resultSignature,resultDescription:e.resultDescription,joinContextId:e.joinContextId})).eventName="SessionHealth",o&&i.setClientMetadata(o),i.metricCount=e.metricCount,i.metricDuration=e.metricDuration,i}return(0,i.default)(n,[{key:"getMetrics",value:function(){var e={};return(void 0===this.metricCount||this.metricCount)&&(e["".concat(this.sessionHealthEventName,".CountV2")]={dimensionNames:function(){return n.dimensionNames},dimensionValues:this.getDimensionValues(),value:this.count}),(void 0===this.metricDuration||this.metricDuration)&&(e["".concat(this.sessionHealthEventName,".DurationMsV2")]={dimensionNames:function(){return n.dimensionNames},dimensionValues:this.getDimensionValues(),value:this.durationMs}),e}},{key:"setClientMetadata",value:function(e){return e&&(this.clientAppName=e.appName,this.clientAppPlatform=e.appPlatform,this.clientAppVersion=e.appVersion,this.clientFlights=e.flights,this.clientReleaseAudienceGroup=e.releaseAudienceGroup,this.clientReleaseChannel=e.releaseChannel,this.clientReleaseFork=e.releaseFork,this.clientRuntimeVersion=e.runtimeVersion,this.clientSessionId=e.sessionId,this.clientDocSessionId=e.docSessionId,this.clientUserAgent=e.userAgent,this.clientDeviceId=e.deviceId),this}},{key:"setReason",value:function(e){return this.reason=f[e],this}},{key:"setSource",value:function(e){return this.source=l[e],this}},{key:"setImpact",value:function(e){return this.impact=d[e],this}},{key:"setAffectedWorkflows",value:function(e){return this.affectedWorkflows=(null!=e?e:[]).join(","),this}},{key:"getAffectedWorkflows",value:function(){return this.affectedWorkflows.split(",")}},{key:"start",value:function(){return this.startTime=(0,h.now)(),this}},{key:"stop",value:function(){var e=(0,h.now)();return this.durationMs=Math.round(e-this.startTime),this}},{key:"getDimensionValues",value:function(){var e;return[this.clientAppName,this.clientAppPlatform,this.clientAppVersion,this.success?"1":"0","".concat(this.reason,"_").concat(this.reasonDependency),this.impact,null!==(e=this.getAffectedWorkflows()[0])&&void 0!==e?e:"",this.resourceId,this.dimension0,this.dimension1,this.dimension2,this.dimension3]}}]),n}(p.SessionHealthEvent);n.SessionHealth=g,g.dimensionNames=["ClientAppName","ClientAppPlatform","ClientAppVersion","Success","Reason","Impact","FirstAffectedWorkflow","ResourceId","Dimension0","Dimension1","Dimension2","Dimension3"]},{130:130,172:172,174:174,176:176,177:177,178:178,185:185,44:44}],48:[function(e,t,n){"use strict";var o=e("exportStarHelper");Object.defineProperty(n,"__esModule",{value:!0}),o(e(49),n),o(e(50),n),o(e(51),n),o(e(52),n),o(e(53),n),o(e(54),n)},{49:49,50:50,51:51,52:52,53:53,54:54}],49:[function(e,t,n){"use strict";var o=e(178),r=o(e(172)),i=o(e(174));function a(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){u=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw i}}}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}Object.defineProperty(n,"__esModule",{value:!0}),n.ExecutionState=n.ContextIdManager=n.supportedOperationSet=void 0;var u=e(139),c=e(40),l=e(52);n.supportedOperationSet=new Set([u.AddOperation.getTypeName(),u.UpdateOperation.getTypeName(),u.SignalOperation.getTypeName(),u.DeltaUpdateOperation.getTypeName()]);var f=function(){function e(t,n){(0,r.default)(this,e),this.nextId=1,this.runtimeKind=t,this.workflowGraph=n}return(0,i.default)(e,[{key:"applyContextIdOnOperations",value:function(e){var t,n=a(e);try{for(n.s();!(t=n.n()).done;){var o=t.value,r=u.SchemaObject.getTypeNameFor(o);if(this.isSupportedOperation(r)){var i,s=a(o.items);try{for(s.s();!(i=s.n()).done;){var l=i.value;l.contextId?l.source&&this.workflowGraph.getWorkflow(l.source,!1)?l.contextId=this.addNewContextId(l.contextId):this.tryLogMessage(new c.Operation({operationName:"ApplyContextIdOnOperations",success:!0}).start(),"Item with a contextId but without a workflow source atribute"):l.contextId=this.addNewContextId()}}catch(e){s.e(e)}finally{s.f()}}}}catch(e){n.e(e)}finally{n.f()}}},{key:"addNewContextId",value:function(e){var t="".concat(this.runtimeKind).concat(this.nextId++);return e?"".concat(e,".").concat(t):t}},{key:"isSupportedOperation",value:function(e){return n.supportedOperationSet.has(e)}},{key:"tryLogMessage",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];e&&(e.success=n,e.resultDescription=t,c.Log.verbose(527308633,c.LogCategory.CoreDefault,e.stop()))}}],[{key:"isParentContextId",value:function(e,t){return(0,l.isParentContextId)(e,t)}}]),e}();n.ContextIdManager=f,function(e){e[e.Idle=1]="Idle",e[e.Pending=2]="Pending",e[e.Running=3]="Running",e[e.Executed=4]="Executed"}(n.ExecutionState||(n.ExecutionState={}))},{139:139,172:172,174:174,178:178,40:40,52:52}],50:[function(e,t,n){"use strict";var o=e(178)(e(189));function r(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){u=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(u)throw a}}}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}Object.defineProperty(n,"__esModule",{value:!0}),n.findRangeForDeltaType=n.applyFormattedTextTileDelta=n.applyTextTileDelta=void 0;var a=e(139),s=e(40),u=e(150),c=[u.TextTileDeltaType.CursorUpdate,u.TextTileDeltaType.FormattingUpdate,u.TextTileDeltaType.OtherNonContentUpdate];function l(e,t,n){var o=new s.Operation({operationName:"FindRangeForDelta",success:!0});if(o.start(),!e)return o.resultDescription="No formatted ranges found within the tile, skipping.",void s.Log.info(538798212,s.LogCategory.CoreDefault,o.stop());if(t===u.TextTileDeltaType.Add){var r=e.find((function(e){return e.start===n&&0===e.length}));if(r)return o.resultDescription="Found a zero-length formatted range for add operation with start ".concat(r.start,"."),s.Log.info(538798213,s.LogCategory.CoreDefault,o.stop()),r;n=Math.max(n-1,0)}var i=e.find((function(e){return 0===e.length?e.start===n:e.start<=n&&n<e.start+e.length}));return i?(o.resultDescription="Updating formatted range for operation with start: ".concat(i.start," and length: ").concat(i.length),s.Log.info(538798214,s.LogCategory.CoreDefault,o.stop())):(o.resultDescription="Unable to find formatted range for operation at position ".concat(n,", skipping."),s.Log.info(538798215,s.LogCategory.CoreDefault,o.stop())),i}function f(e){return-1!==c.indexOf(e)}function d(e){return f(e)||u.TextTileDeltaType.Delete===e}n.applyTextTileDelta=function(e,t,n){var o=new s.Operation({operationName:"ApplyTextTileDeltaForLocalWorkflows",dimension0:"0",success:!0}).start();try{if(!t)return o.success=!1,o.resultDescription="Unable to apply text tile delta, parent tile is undefined",void s.Log.info(538798173,s.LogCategory.CoreDefault,o.stop());if(a.SchemaObject.getTypeNameFor(t)!==u.TextTile.getTypeName())return o.success=!1,o.resultDescription="Unable to apply text tile delta, parent tile is not proper type: expected ".concat(u.TextTileDelta.getTypeName(),", received ").concat(a.SchemaObject.getTypeNameFor(t)),void s.Log.info(538798174,s.LogCategory.CoreDefault,o.stop());var r=e,i=t.content,c="";if(void 0===r.position||r.position<0)return o.success=!1,o.resultDescription="Unable to apply text tile delta, invalid text tile position",void s.Log.info(538798175,s.LogCategory.CoreDefault,o.stop());switch(r.deltaType){case u.TextTileDeltaType.Add:c=r.position<i.length?"".concat(i.slice(0,r.position)).concat(r.content).concat(i.slice(r.position,i.length)):i+r.content;break;case u.TextTileDeltaType.Update:r.content||r.unit!==u.TextTileDeltaUnit.Sentence||(o.dimension0="1"),c="".concat(i.slice(0,r.position)).concat(r.content).concat(i.slice(r.position+(r.length||0),i.length));break;case u.TextTileDeltaType.Delete:c="".concat(i.slice(0,r.position)).concat(i.slice(r.position+(r.length||0),i.length))}return s.Log.info(538837071,s.LogCategory.CoreDefault,o.stop()),new u.TextTile({content:c})}catch(e){return o.success=!1,o.resultDescription="Error applying text tile delta: ".concat(e),void s.Log.info(538798176,s.LogCategory.CoreDefault,o.stop())}},n.applyFormattedTextTileDelta=function(e,t,n){var i,c,p,h,g,y,m,v,k=new s.Operation({operationName:"ApplyFormattedTextTileDeltaForLocalWorkflows",dimension0:"0",success:!0}).start();k.clientFlights=n;try{if(!t)return k.success=!1,k.resultDescription="Unable to apply formatted text tile delta, parent tile is undefined",void s.Log.info(538798177,s.LogCategory.CoreDefault,k.stop());if(a.SchemaObject.getTypeNameFor(t)!==u.FormattedTextTile.getTypeName())return k.success=!1,k.resultDescription="Unable to apply formatted text tile delta, parent tile is not proper type: expected ".concat(u.FormattedTextTile.getTypeName(),", received ").concat(a.SchemaObject.getTypeNameFor(t)),void s.Log.info(538798178,s.LogCategory.CoreDefault,k.stop());var T=t,S=e,b=T.content,w="";if((void 0===S.position||S.position<0)&&!d(S.deltaType))return k.success=!1,k.resultDescription="Unable to apply formatted text tile delta, invalid text tile position",void s.Log.info(538798179,s.LogCategory.CoreDefault,k.stop());if(void 0===S.content&&!d(S.deltaType))return k.success=!1,k.resultDescription="Unable to apply formatted text tile delta, non-delete, non-formatting, non-other-non-content-update and non-cursor-update operation without content defined",void s.Log.info(538798208,s.LogCategory.CoreDefault,k.stop());if(S.deltaType===u.TextTileDeltaType.Add&&0!==S.length?s.Log.info(538798209,s.LogCategory.CoreDefault,new s.Operation({operationName:"ApplyDeltaChecks",resultDescription:"Received formatted text tile delta add operation with delta length, expected length 0",success:!0})):d(S.deltaType)&&void 0!==S.content&&s.Log.info(538798210,s.LogCategory.CoreDefault,new s.Operation({operationName:"ApplyDeltaChecks",resultDescription:"Received formatted text tile delta delete or non-content related operation with content defined, expected undefined",success:!0})),!f(S.deltaType)){var C=l(T.formattedRanges,S.deltaType,S.position),_=T.formattedRanges?(0,o.default)(T.formattedRanges):[],x=C?_.indexOf(C):-1;-1!==x&&(S.position+(S.length||0)>C.start+C.length?C.length=S.position+(null!==(i=S.content)&&void 0!==i?i:"").length-C.start:C.length+=(null!==(c=S.content)&&void 0!==c?c:"").length-(S.length||0),_[x]=C);var M=T.ipPosition;switch(S.deltaType){case u.TextTileDeltaType.Add:w=S.position<b.length?"".concat(b.slice(0,S.position)).concat(S.content).concat(b.slice(S.position,b.length)):b+S.content,M=S.position+S.length;break;case u.TextTileDeltaType.Update:S.content||S.unit!==u.TextTileDeltaUnit.Sentence||(k.dimension0="1"),w="".concat(b.slice(0,S.position)).concat(S.content).concat(b.slice(S.position+(null!==(p=S.length)&&void 0!==p?p:0),b.length)),M=S.position+S.content.length;break;case u.TextTileDeltaType.Delete:w="".concat(b.slice(0,S.position)).concat(b.slice(S.position+(null!==(h=S.length)&&void 0!==h?h:0),b.length)),M=S.position}var A,O=r(_.slice(x+1));try{for(O.s();!(A=O.n()).done;){var I=A.value;I.start<S.position||(S.position+(S.length||0)>I.start?(I.length=I.start+I.length-(S.position+(S.length||0)),I.start=S.position+(null!==(g=S.content)&&void 0!==g?g:"").length):I.start+=(null!==(y=S.content)&&void 0!==y?y:"").length-(S.length||0))}}catch(e){O.e(e)}finally{O.f()}_=_.filter((function(e){return e.length>0}));var L=new u.FormattedTextTile(Object.assign(Object.assign({},T),{ipPosition:M,content:w,formattedRanges:_,queryRange:S.queryRange}));return s.Log.info(538837073,s.LogCategory.CoreDefault,k.stop()),L}if(S.deltaType===u.TextTileDeltaType.CursorUpdate)return new u.FormattedTextTile(Object.assign(Object.assign({},T),{ipPosition:null===(m=S.cursorData)||void 0===m?void 0:m.ipPosition,isColdIp:null===(v=S.cursorData)||void 0===v?void 0:v.isColdIp}));if(S.deltaType===u.TextTileDeltaType.FormattingUpdate)return new u.FormattedTextTile(Object.assign(Object.assign({},T),{formattedRanges:S.formattedRanges}));if(S.deltaType===u.TextTileDeltaType.OtherNonContentUpdate){var D,E={};for(D in S.otherNonContentData)E[D]=S.otherNonContentData[D];return new u.FormattedTextTile(Object.assign(Object.assign({},T),E))}return}catch(e){return k.success=!1,k.resultDescription="Error applying formatted text tile delta: ".concat(e),void s.Log.info(538798211,s.LogCategory.CoreDefault,k.stop())}},n.findRangeForDeltaType=l},{139:139,150:150,178:178,189:189,40:40}],51:[function(e,t,n){"use strict";var o=e(178),r=o(e(172)),i=o(e(174));Object.defineProperty(n,"__esModule",{value:!0}),n.DynamicWorkflowDefinitionManager=void 0;var a=e(52),s=function(){function e(){(0,r.default)(this,e),this.workflowDefByWorkflowAndContextId=new Map,this.workflowDefByWorkflow=new Map}return(0,i.default)(e,[{key:"mergeWorkflowDefinition",value:function(t,n,o){if(o){var r=(0,a.getOrSetDefaultValue)(this.workflowDefByWorkflowAndContextId,t.id,(function(){return new Map}));r.set(o,e.mergeDefinitions(t,r.get(o),n))}else this.workflowDefByWorkflow.set(t.id,e.mergeDefinitions(t,this.workflowDefByWorkflow.get(t.id),n))}},{key:"getWorkflowDefinition",value:function(e,t){var n,o;return t&&(o=null===(n=this.workflowDefByWorkflowAndContextId.get(e.id))||void 0===n?void 0:n.get(t)),o||(o=this.workflowDefByWorkflow.get(e.id)),o||(o=e),o}},{key:"deleteWorkflowDefinition",value:function(e,t){var n=this.workflowDefByWorkflowAndContextId.get(e.id);n&&(n.delete(t),0===n.size&&this.workflowDefByWorkflowAndContextId.delete(e.id))}}],[{key:"mergeDefinitions",value:function(e,t,n){return Object.assign(Object.assign(Object.assign({},e),t),n)}}]),e}();n.DynamicWorkflowDefinitionManager=s},{172:172,174:174,178:178,52:52}],52:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.isWorkflowTriggeredByNonExclusiveSignals=n.isSignalTriggeredWorkflow=n.isParentContextId=n.compareRevisions=n.isHybridWorkflow=n.getWorkflowDefinitionBase=n.getOrSetDefaultValue=void 0;var o=e(23);n.getOrSetDefaultValue=function(e,t,n){var o=e.get(t);return o||(o=n(),e.set(t,o)),o};n.getWorkflowDefinitionBase=function(e){return{id:e.id,kind:e.kind,visibility:e.visibility,collectionScopeType:e.collectionScopeType,inputTypes:e.inputTypes,outputTypes:e.outputTypes,correlatedSignals:e.correlatedSignals}};n.isHybridWorkflow=function(e){return Array.isArray(e.correlatedSignals)&&e.correlatedSignals.length>0};n.compareRevisions=function(e,t){return e.revId&&t.revId&&e.revId!==t.revId?parseInt(e.revId,10)>parseInt(t.revId,10)?1:-1:0};n.isParentContextId=function(e,t){return null!=e&&(null!=t&&(e.length>0&&(e===t||0===t.indexOf(e)&&"."===t.charAt(e.length))))};n.isSignalTriggeredWorkflow=function(e){return Array.isArray(e.triggerSignals)&&e.triggerSignals.length>0};n.isWorkflowTriggeredByNonExclusiveSignals=function(e){var t,n;return null!==(n=null===(t=e.triggerConditions)||void 0===t?void 0:t.indexOf(o.TriggerCondition.NonExclusiveTriggerSignals)>=0)&&void 0!==n&&n}},{23:23}],53:[function(e,t,n){"use strict";var o=e(178),r=o(e(189)),i=o(e(172)),a=o(e(174));function s(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return u(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}Object.defineProperty(n,"__esModule",{value:!0}),n.GraphNode=n.WorkflowGraph=n.Location=void 0;var c,l=e(23),f=e(40);!function(e){e[e.Local=0]="Local",e[e.External=1]="External"}(c=n.Location||(n.Location={}));var d=function(){function e(){(0,i.default)(this,e),this.graphNodeByLocationAndWorkflowId=new Map}return(0,a.default)(e,[{key:"getWorkflow",value:function(e,t){var n,o=this.getLocation(t);return null===(n=this.graphNodeByLocationAndWorkflowId.get(o))||void 0===n?void 0:n.get(e)}},{key:"addWorkflow",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.getWorkflow(e.id,t)){var n=new f.Operation({operationName:"AddWorkflowToGraphFailure",success:!1,resourceId:e.id,resultDescription:"Adding a new with workflow with a duplicated workflowId: ".concat(t)}).start();f.Log.error(524300630,f.LogCategory.CoreDefault,n.stop())}else{var o=this.getLocation(t),r=new p(e,o);this.addWorkflowAsDependency(r);var i=this.graphNodeByLocationAndWorkflowId.get(o);i||(i=new Map,this.graphNodeByLocationAndWorkflowId.set(o,i)),i.set(e.id,r)}}},{key:"getUpstreamRuntimeVisibleWorkflows",value:function(){var e,t=[],n=s(this.graphNodeByLocationAndWorkflowId.values()||[]);try{for(n.s();!(e=n.n()).done;){var o,i=s(e.value.values()||[]);try{for(i.s();!(o=i.n()).done;){var a,u=o.value,c=this.createWorkflowDefinition(u.workflow);if(u.workflow.visibility===l.WorkflowVisibility.LocalOnly)this.compressDownstreamWorkflows(c,u);else(a=c.outputTypes).push.apply(a,(0,r.default)(u.workflow.outputTypes));0!==c.inputTypes.length&&t.push(c)}}catch(e){i.e(e)}finally{i.f()}}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"removeWorkflows",value:function(e){for(var t=this.getLocation(e),n=this.graphNodeByLocationAndWorkflowId.get(t),o=0,r=Array.from((null==n?void 0:n.values())||[]);o<r.length;o++){var i,a=r[o],u=s(a.upstreamWorkflows.values());try{for(u.s();!(i=u.n()).done;){i.value.downstreamWorkflows.delete(a)}}catch(e){u.e(e)}finally{u.f()}var c,l=s(a.downstreamWorkflows.values());try{for(l.s();!(c=l.n()).done;){c.value.upstreamWorkflows.delete(a)}}catch(e){l.e(e)}finally{l.f()}n.delete(a.workflow.id)}}},{key:"getWorkflowsDefinitions",value:function(){var e,t=[],n=s(this.graphNodeByLocationAndWorkflowId.values()||[]);try{for(n.s();!(e=n.n()).done;){var o,r=s(e.value.values()||[]);try{for(r.s();!(o=r.n()).done;){var i=o.value;t.push(i.workflow)}}catch(e){r.e(e)}finally{r.f()}}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"getWorkflowNodes",value:function(e){var t,n=[],o=s(this.graphNodeByLocationAndWorkflowId.values());try{for(o.s();!(t=o.n()).done;){var r,i=s(t.value.values());try{for(i.s();!(r=i.n()).done;){var a=r.value;n.push(a)}}catch(e){i.e(e)}finally{i.f()}}}catch(e){o.e(e)}finally{o.f()}return n}},{key:"getLocation",value:function(e){return e?c.External:c.Local}},{key:"createWorkflowDefinition",value:function(e){return Object.assign(Object.assign({},e),{outputTypes:[]})}},{key:"compressDownstreamWorkflows",value:function(e,t){var n,o=s(t.downstreamWorkflows);try{for(o.s();!(n=o.n()).done;){var r=n.value;if(r.workflow.visibility!==l.WorkflowVisibility.LocalOnly){if(r.workflow.kind!==l.WorkflowKind.Join||-1!==e.inputTypes.indexOf(r.workflow.collectionScopeType)){var i,a=s(r.workflow.outputTypes);try{for(a.s();!(i=a.n()).done;){var u=i.value;-1===e.outputTypes.indexOf(u)&&e.outputTypes.push(u)}}catch(e){a.e(e)}finally{a.f()}}}else this.compressDownstreamWorkflows(e,r)}}catch(e){o.e(e)}finally{o.f()}}},{key:"addWorkflowAsDependency",value:function(e){var t,n=s(this.graphNodeByLocationAndWorkflowId.values());try{for(n.s();!(t=n.n()).done;){var o,r=s(t.value.values());try{for(r.s();!(o=r.n()).done;){var i,a=o.value,u=s(a.workflow.inputTypes);try{for(u.s();!(i=u.n()).done;){var c=i.value;-1!==e.workflow.outputTypes.indexOf(c)&&this.addWorkflowChain(e,a)}}catch(e){u.e(e)}finally{u.f()}var l,f=s(a.workflow.outputTypes);try{for(f.s();!(l=f.n()).done;){var d=l.value;-1!==e.workflow.inputTypes.indexOf(d)&&this.addWorkflowChain(a,e)}}catch(e){f.e(e)}finally{f.f()}}}catch(e){r.e(e)}finally{r.f()}}}catch(e){n.e(e)}finally{n.f()}}},{key:"addWorkflowChain",value:function(e,t){e.downstreamWorkflows.add(t),t.upstreamWorkflows.add(e)}}]),e}();n.WorkflowGraph=d;var p=(0,a.default)((function e(t,n){(0,i.default)(this,e),this.isActivated=!0,this.upstreamWorkflows=new Set,this.downstreamWorkflows=new Set,this.location=n,this.workflow=Object.assign(Object.assign({},t),{inputTypes:Array.isArray(t.inputTypes)?t.inputTypes:[],outputTypes:Array.isArray(t.outputTypes)?t.outputTypes:[]})}));n.GraphNode=p},{172:172,174:174,178:178,189:189,23:23,40:40}],54:[function(e,t,n){"use strict";var o=e(178),r=o(e(188)),i=o(e(172)),a=o(e(174));function s(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return u(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}Object.defineProperty(n,"__esModule",{value:!0}),n.WorkflowItemStorage=void 0;var c=e(40),l=e(52),f=function(){function e(t){(0,i.default)(this,e),this.scopeItemsByContextId=new Map,this.itemsByWorkflowAndContextId=new Map,this.workflowDefinitionManager=t}return(0,a.default)(e,[{key:"setScopeItem",value:function(e,t){var n,o=e.contextId;if(o)if(this.itemsByWorkflowAndContextId.has(t.id)||this.itemsByWorkflowAndContextId.set(t.id,new Map),this.itemsByWorkflowAndContextId.get(t.id).set(o,[]),this.scopeItemsByContextId.has(o)){if(null===(n=this.itemsByWorkflowAndContextId.get(t.id))||void 0===n?void 0:n.has(o)){var r=new c.Operation({resultDescription:"Trying to set new scope item: ".concat(e.id," with already existing contextId ").concat(o," for workflow ").concat(t.id),operationName:"WIS.setScopeItem",resourceId:t.id,success:!0}).start();c.Log.verbose(527291288,c.LogCategory.CoreDefault,r.stop())}}else this.scopeItemsByContextId.set(o,e)}},{key:"getScopeItem",value:function(e,t){var n,o,r=s((null===(n=this.itemsByWorkflowAndContextId.get(t.id))||void 0===n?void 0:n.keys())||[]);try{for(r.s();!(o=r.n()).done;){var i=o.value;if((0,l.isParentContextId)(i,e))return this.scopeItemsByContextId.get(i)}}catch(e){r.e(e)}finally{r.f()}}},{key:"addItemToWorkflowList",value:function(e,t){var n=e.contextId;if(n){var o=this.itemsByWorkflowAndContextId.get(t.id);if(o){var i,a=s(o);try{for(a.s();!(i=a.n()).done;){var u=(0,r.default)(i.value,2),f=u[0],d=u[1];if((0,l.isParentContextId)(f,n)){d.push(e);var p=new c.Operation({resultDescription:"Items for contextId ".concat(f,": [").concat(d.map((function(e){return e.id})).join(","),"]"),operationName:"WIS.addItemOnContextIdList",resourceId:t.id,success:!0}).start();c.Log.info(526403808,c.LogCategory.CoreDefault,p.stop())}}}catch(e){a.e(e)}finally{a.f()}}}}},{key:"isWorkflowReady",value:function(e,t){var n=this.workflowDefinitionManager.getWorkflowDefinition(t,e).maxAnnotations;return this.getGeneratedItems(e,t).length>=n}},{key:"getItemsToExecute",value:function(e,t){var n=this.getGeneratedItems(e,t);return this.itemsByWorkflowAndContextId.get(t.id).delete(e),n}},{key:"onWorkflowExecuted",value:function(e,t){var n=e.contextId,o=this.itemsByWorkflowAndContextId.get(t.id);o&&(o.delete(n),0===o.size&&this.itemsByWorkflowAndContextId.delete(t.id)),this.hasWorkflowsAwaitingExecution(n)||this.scopeItemsByContextId.delete(n)}},{key:"getGeneratedItems",value:function(e,t){var n;if(!(null===(n=this.itemsByWorkflowAndContextId.get(t.id))||void 0===n?void 0:n.get(e)))return[];var o=this.workflowDefinitionManager.getWorkflowDefinition(t,e).maxAnnotations;return this.itemsByWorkflowAndContextId.get(t.id).get(e).slice(0,o)}},{key:"hasWorkflowsAwaitingExecution",value:function(e){var t,n=s(this.itemsByWorkflowAndContextId.values());try{for(n.s();!(t=n.n()).done;){var o,r=s(t.value.keys());try{for(r.s();!(o=r.n()).done;){if(o.value===e)return!0}}catch(e){r.e(e)}finally{r.f()}}}catch(e){n.e(e)}finally{n.f()}return!1}}]),e}();n.WorkflowItemStorage=f},{172:172,174:174,178:178,188:188,40:40,52:52}],55:[function(e,t,n){"use strict";var o=e("exportStarHelper");Object.defineProperty(n,"__esModule",{value:!0}),o(e(56),n)},{56:56}],56:[function(e,t,n){"use strict";var o=e(178),r=o(e(172)),i=o(e(174));function a(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){u=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw i}}}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}Object.defineProperty(n,"__esModule",{value:!0}),n.ModelDownloader=void 0;var u,c=e(40),l=e(201),f=e(196),d="undefined"!=typeof fetch?fetch:f;!function(e){e.URL="URL",e.ArrayBuffer="ArrayBuffer"}(u||(u={}));var p=function(){function e(t,n,o,i){var a=this;(0,r.default)(this,e),this.dbName="ALModels_db",this.osName="ALModels_os",this.dbVersion=2,this.isPolymerSupported=Boolean(o),this.baseURL="https://".concat(n,"/web/").concat(t),this.polymerBaseURL=this.isPolymerSupported?"https://".concat(o):"",this.checkIdbByFeatures=null==i?void 0:i.checkIdbByFeatures;var s=new c.Operation({operationName:"CreateModelDownloader",success:!0,resultDescription:""});s.start(),this.isBrowserIdbCompatible().then((function(e){if(e){var t,n=0,o=0,r=0,i=new Promise((function(e,n){t=setTimeout((function(){n(new Error("Took longer than ".concat(1e4," ms")))}),1e4)})),u=a.accessDB().then((function(e){var t=e.transaction(a.osName,"readwrite");return t.objectStore(a.osName).openCursor().then((function e(i){if(r++,i){var a,s=i.value;return s.timesSinceUsage||(s.timesSinceUsage=0),s.timesSinceUsage++,s.timesSinceUsage>5?(o++,a=i.delete()):(n++,a=i.update(s)),a.then((function(){return i.continue()})).then(e)}return t.done}))}));a.initPromise=Promise.race([i,u]).catch((function(e){s.success=!1,s.resultDescription+="".concat(e.message," ")})).then((function(){s.dimension0="".concat(r),s.dimension1="".concat(n),s.dimension2="".concat(o),clearTimeout(t),a.closeDBAndEndLog(s,"initializing idb storage")}))}else s.resultDescription="Incompatible browser for IDB",c.Log.info(538706242,c.LogCategory.CoreDefault,s.stop())})).catch((function(){s.resultDescription="Issue determining idb compatibility",c.Log.info(536966936,c.LogCategory.CoreDefault,s.stop())}))}return(0,i.default)(e,[{key:"getResourceAsArrayBuffer",value:function(e,t,n){var o=new c.Operation({operationName:"GetResource",success:!0,resultDescription:"",dimension0:u.ArrayBuffer,dimension1:e,dimension2:t});o.start();var r={};return this.getResource(e,t,n,u.ArrayBuffer,o,(function(e){return Promise.all(Array.from(e.keys()).map((function(t){var n=e.get(t);return n.arrayBuffer?n.arrayBuffer().then((function(e){r[t]=e})):new Promise((function(e,o){var i=new FileReader;i.readAsArrayBuffer(n),i.onload=function(n){var i=n.target.result;i instanceof ArrayBuffer?(r[t]=i,e()):o(new Error("Unable to obtain ArrayBuffer"))}}))})))})).then((function(){return r}))}},{key:"getResourceAsURL",value:function(e,t,n){var o=new c.Operation({operationName:"GetResource",success:!0,resultDescription:"",dimension0:u.URL,dimension1:e,dimension2:t});o.start();var r={};return this.getResource(e,t,n,u.URL,o,(function(e){return Promise.all(Array.from(e.keys()).map((function(t){r[t]=URL.createObjectURL(e.get(t))})))})).then((function(){return r}))}},{key:"getResource",value:function(e,t,n,o,r,i){var a=this;return this.getFiles(e,t,n,r).then((function(e){return i(e)})).then((function(){a.closeDBAndEndLog(r,"retrieving ".concat(e))})).catch((function(t){throw r.resultDescription.indexOf(t.message)>=0&&(r.success=!1,r.resultDescription+="".concat(t.message," ")),r.resultSignature="Issue retrieving from CDN or translating to ".concat(o),a.closeDBAndEndLog(r,"retrieving ".concat(e)),t}))}},{key:"checkFirefoxCompatibility",value:function(e){var t=globalThis.navigator.userAgent.substring(e+8,e+11);return t.replace(".",""),parseInt(t,10)<=70?new Promise((function(e,t){var n=globalThis.indexedDB.open(this.dbName,this.dbVersion);n.onsuccess=function(){e(!0)},n.onerror=function(e){return t(e),!0}})):Promise.resolve(!0)}},{key:"isBrowserIdbCompatible",value:function(){var e,t;return"undefined"==typeof Array||void 0===Array.from||"undefined"==typeof Proxy||"undefined"==typeof URL||void 0===URL.createObjectURL?Promise.resolve(!1):"undefined"!=typeof globalThis&&(null===(e=globalThis.navigator)||void 0===e?void 0:e.userAgent)?globalThis.navigator.userAgent.toLowerCase().indexOf("firefox")>-1?globalThis.indexedDB?this.checkFirefoxCompatibility(globalThis.navigator.userAgent.toLowerCase().indexOf("firefox")):Promise.resolve(!1):globalThis.navigator.userAgent.toLowerCase().indexOf("safari")>-1&&globalThis.navigator.userAgent.toLowerCase().indexOf("chrome")<=-1?this.checkIdbByFeatures&&(null===(t=globalThis.document)||void 0===t?void 0:t.hasStorageAccess)?globalThis.document.hasStorageAccess().then((function(){return!0})).catch((function(){return!1})):Promise.resolve(!1):Promise.resolve(!0):Promise.resolve(!1)}},{key:"accessDB",value:function(){var e=this;return this.accessDBPromise?this.accessDBPromise.then((function(t){return t.transaction(e.osName).done})).then((function(){return e.accessDBPromise})).catch((function(){return e.callOpenDB()})):this.callOpenDB()}},{key:"callOpenDB",value:function(){var e=this;return this.accessDBPromise=(0,l.openDB)(this.dbName,this.dbVersion,{upgrade:function(t){t.objectStoreNames.contains(e.osName)&&t.deleteObjectStore(e.osName),t.createObjectStore(e.osName,{keyPath:"id",autoIncrement:!0})}})}},{key:"endLog",value:function(e,t){e.success?(e.resultDescription="Success ".concat(t),c.Log.info(573329487,c.LogCategory.CoreDefault,e.stop())):(e.resultDescription+="error ".concat(t),c.Log.error(573329488,c.LogCategory.CoreDefault,e.stop()))}},{key:"closeDBAndEndLog",value:function(e,t){var n=this;this.accessDBPromise?this.accessDBPromise.then((function(e){e.close()})).catch((function(t){e.resultDescription.indexOf(t.message)>=0&&(e.success=!1,e.resultDescription+="".concat(t.message?t.message:"Error closing db"," "),e.resultSignature="Issue closing db")})).then((function(){n.accessDBPromise=void 0,n.endLog(e,t)})):this.endLog(e,t)}},{key:"getFiles",value:function(e,t,n,o){var r=this;return this.isBrowserIdbCompatible().catch((function(e){return o.success=!1,o.resultDescription+="".concat(e.message," "),o.resultSignature="Issue determining idb compatibility",!1})).then((function(i){var a=function(){if(n){if(r.isPolymerSupported)return r.downloadFiles1CDN(e,t,n,o,i);throw new Error("Missing polymerBaseURL provided at host level for queries with modelFilters")}return r.downloadFiles(e,t,o,i)};return i?r.getFilesFromIDB(e,t,n,o).catch((function(e){return e&&(o.resultDescription.indexOf(e.message)>=0&&(o.success=!1,o.resultDescription+="".concat(e.message," ")),o.resultSignature="Issue retrieving from DB"),a()})):a()}))}},{key:"getFilesFromIDB",value:function(e,t,n,o){var r=this;return this.initPromise.catch((function(e){o.success=!1,o.resultDescription+="".concat(e.message," "),o.resultSignature="Issue initializing"})).then((function(){return r.getModelOptions(e)})).then((function(i){var s,u=a(i);try{for(u.s();!(s=u.n()).done;){var c=s.value;if(c&&c.model&&c.version==t){if(!r.checkModelFiltersPass(n,c.filters))continue;return r.putModel(e,c.model,t,c.filters,o,c.id),Promise.resolve(c.model)}}}catch(e){u.e(e)}finally{u.f()}return Promise.reject()}))}},{key:"checkModelFiltersPass",value:function(e,t){var n,o,r=a(e);try{for(r.s();!(o=r.n()).done;){var i=o.value,s=null===(n=t.get(i[0]))||void 0===n?void 0:n.map((function(e){return e.toLocaleLowerCase()}));if(!s)throw new Error("Expected filter ".concat(i[0]," to exist in metadata file"));if(s.indexOf(i[1].toLocaleLowerCase())<0)return!1}}catch(e){r.e(e)}finally{r.f()}return!0}},{key:"downloadFiles1CDN",value:function(e,t,n,o,r){var i,s=this;return o.dimension3="Polymer",n||(n=new Map),d("".concat(this.polymerBaseURL,"/").concat(e,"/").concat(t,"/metadata.json")).then((function(e){if(e.ok)return e.text();throw new Error("CDN download response status: ".concat(e.status))})).then((function(r){var u,c,l=JSON.parse(r);if(l.name!==e||l.version!==t)throw new Error("Expected: ".concat(e," version ").concat(t,", received: ").concat(l.name," version ").concat(l.version));var f,d=a(l.variants);try{for(d.s();!(f=d.n()).done;){var p=f.value;if(i=new Map(Object.entries(p)),s.checkModelFiltersPass(n,i))return(l.catalog?n.size+2:n.size+1!==i.size)&&(o.success=!1,o.resultDescription+="Expected ".concat(null===(u=i.keys)||void 0===u?void 0:u.length," # of filters, received ").concat(null===(c=n.keys)||void 0===c?void 0:c.length)),p.model_files}}catch(e){d.e(e)}finally{d.f()}throw new Error("No model found with given filters")})).then((function(n){return Promise.all(n.map((function(n){return d("".concat(s.polymerBaseURL,"/").concat(e,"/").concat(t,"/").concat(n)).then((function(e){if(e.ok)return e.blob();throw new Error("CDN download response status: ".concat(e.status))})).then((function(e){return[n,e]}))})))})).then((function(n){var a=new Map(n);return r?s.putModel(e,a,t,i,o):a}))}},{key:"downloadFiles",value:function(e,t,n,o){var r=this;return n.dimension3="FS",d("".concat(this.baseURL,"/catalog_").concat(e,"_").concat(t,".json")).then((function(e){if(e.ok)return e.text();throw new Error("CDN download response status: ".concat(e.status))})).then((function(n){var o=JSON.parse(n),i="".concat(o.MajorVersion,".").concat(o.MinorVersion,"/ModelResources"),a="".concat(e,"/").concat(t,"/");return Promise.all(o.Resources.map((function(e){return e.Name.length>a.length&&e.Name.substring(0,a.length)===a&&(e.Name=e.Name.substring(a.length)),d("".concat(r.baseURL,"/").concat(i,"/").concat(a).concat(e.Name,".").concat(e.Type)).then((function(e){if(e.ok)return e.blob();throw new Error("CDN download response status: ".concat(e.status))})).then((function(t){return["".concat(e.Name,".").concat(e.Type),t]}))})))})).then((function(i){var a=new Map(i);return o?r.putModel(e,a,t,new Map,n):a}))}},{key:"getModelOptions",value:function(e){var t=this;return this.accessDB().then((function(n){var o=[],r=n.transaction(t.osName,"readonly");return r.objectStore(t.osName).openCursor().then((function t(n){if(n){var i=n.value;return i.modelId==e&&o.push(i),n.continue().then(t)}return r.done})).then((function(){return o}))}))}},{key:"putModel",value:function(e,t,n,o,r,i){var a=this;return o||(o=new Map),this.accessDB().then((function(r){return r.put(a.osName,{modelId:e,model:t,version:n,filters:o,timesSinceUsage:0},i)})).catch((function(e){r.resultDescription.indexOf(e.message)>=0&&(r.success=!1,r.resultDescription+="".concat(e.message," ")),r.resultSignature="Issue adding to DB"})).then((function(){return t}))}}]),e}();n.ModelDownloader=p},{172:172,174:174,178:178,196:196,201:201,40:40}],57:[function(e,t,n){"use strict";var o=e(61),r=o(e(59)),i=o(e(60));Object.defineProperty(n,"__esModule",{value:!0}),n.ALFactoryGlobal=n.AugLoopFactory=void 0;var a=e(58),s=e(76),u=function(){function e(){(0,r.default)(this,e),this._augLoopRuntimeManager=new a.AugLoopRuntimeManager}return(0,i.default)(e,[{key:"getAugLoopRuntimeManager",value:function(){return this._augLoopRuntimeManager}},{key:"createSingleItemWorkflow",value:function(e){return s.SingleItemWorkflow.create(e)}},{key:"createChatHelper",value:function(e){return this.getAugLoopRuntimeManager().getSession().then((function(t){return s.ChatHelper.create(Object.assign({session:t},e))}))}}]),e}();n.AugLoopFactory=u,n.ALFactoryGlobal=new u},{58:58,59:59,60:60,61:61,76:76}],58:[function(e,t,n){"use strict";var o=e(61),r=o(e(60)),i=o(e(59));function a(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){u=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw i}}}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}Object.defineProperty(n,"__esModule",{value:!0}),n.AugLoopRuntimeManager=n.ServerAuthenticationState=n.IdentityProvider=void 0;var u=e(76),c=e(3),l=e(109);Object.defineProperty(n,"IdentityProvider",{enumerable:!0,get:function(){return l.IdentityProvider}});var f=e(122);Object.defineProperty(n,"ServerAuthenticationState",{enumerable:!0,get:function(){return f.ServerAuthenticationState}});var d=e(139),p=e(55),h=e(62),g=e(164),y=e(165),m=e(166),v=e(20),k=e(66),T=function(e,t){for(var n,o=[],r=0,i=Object.keys(e);r<i.length;r++){var a=i[r];if(void 0!==e[a]&&null!==e[a]){var s={name:t?"".concat(t,".").concat(a):a,dataType:(n=e[a],"string"==typeof n?0:"boolean"==typeof n?1:"number"==typeof n?2:void m.ULS.sendTraceTag(572838285,g.LogCategory.msoulscat_Wac_BrowserGeneral,y.TraceLevel.Warning,"Unsupported data field type")),value:e[a],classification:4};o.push(s)}}return o},S=function(e){return Promise.resolve(!1)},b=(0,r.default)((function e(){var t=this;(0,i.default)(this,e),this._telemetryAggregationIntervalSec=30,this._eventHandlerDictionary={},this._sessionCloseReason=null,this._serverAuthenticationState=f.ServerAuthenticationState.NotAuthenticated,this.initialize=function(e){if(t._runtimeInitPromise)m.ULS.sendTraceTag(572838286,g.LogCategory.msoulscat_Wac_BrowserGeneral,y.TraceLevel.Info,"Runtime already initialized");else{m.ULS.sendTraceTag(572838287,g.LogCategory.msoulscat_Wac_BrowserGeneral,y.TraceLevel.Info,"Start and initialize augloop runtime ..."),t.checkParametersAndThrow("initialize",e);var n=t.isFeatureEnabled("ModelDownloaderEbrake","None").then((function(n){n?m.ULS.sendTraceTag(556376070,g.LogCategory.msoulscat_Wac_BrowserGeneral,y.TraceLevel.Info,"Resource downloader not created due to feature gate"):t.modelDownloaderFromCDN=e.appName&&e.downloadBaseUrl||e.downloadPolymerBaseUrl?new p.ModelDownloader(e.appName,e.downloadBaseUrl,e.downloadPolymerBaseUrl):void 0}));t.inferenceServiceFactory=e.appName&&e.inferenceServiceVersion?h.OnnxInferenceService.createFactory(e.appName,e.inferenceServiceVersion):void 0,t.excelServerParameters=e.excelServer,t.powerpointParameters=e.powerpoint;var o={appName:e.appName,appPlatform:"Web",appVersion:e.appVersion,uiLanguage:e.uiLanguage,releaseAudienceGroup:e.releaseAudienceGroup,releaseChannel:e.releaseChannel,releaseCustomAudience:e.releaseCustomAudience,releaseFork:e.releaseFork,sessionId:e.sessionId,flights:e.flights,privateMode:e.privateMode,disabledServiceGroups:e.disabledServiceGroups},r={onResult:t.onResult.bind(t),onAnnotationResult:t.onAnnotationResult.bind(t),sendTelemetryEvent:t.sendTelemetryEvent.bind(t),sendDiagnosticTrace:t.sendDiagnosticTrace.bind(t),requestAuthToken:t.requestAuthToken.bind(t),isFeatureEnabled:t.isFeatureEnabled.bind(t),setSessionData:t.setSessionData.bind(t),areLicenseFeaturesEnabled:S,onInitSession:t.onInitSession.bind(t),overrideSessionInitMessage:t.overrideSessionInitMessage.bind(t)},i=n.then((function(){return u.runtime.init(e.serviceUrl,o,r,{telemetryAggregationIntervalSec:t._telemetryAggregationIntervalSec,modelDownloader:t.modelDownloaderFromCDN,inferenceServiceFactory:t.inferenceServiceFactory,isDeltaGeneratorEnabled:e.isDeltaGeneratorEnabled,disableSyncDeltaSending:e.disableSyncDeltaSending,syncDeltaTimeout:e.syncDeltaTimeout})})).then((function(){return c.runtimeALv1.init(e.serviceUrl,o,r)})),a=e.sessionCreationOptions;a||(a={});var s=a.onServerAuthenticationStateChangeCallback;a.onServerAuthenticationStateChangeCallback=function(e){t._serverAuthenticationState=e,s&&s(e),t._bridge&&t.sendBridgeMessage({bridgeId:"*",docSessionId:"*",message:new f.ServerAuthenticationStateChangeMessage({serverAuthenticationState:e})})};var l=a.onSessionClose;a.onSessionClose=function(e){t._sessionCloseReason=e.reason,l&&l(e),t._bridge&&t.sendBridgeMessage({bridgeId:"*",docSessionId:"*",message:new f.SessionCloseMessage({reason:t._sessionCloseReason})})};var d=a.onSessionConnect;a.onSessionConnect=function(e,n,o,r){d&&d(e,n,o,r),t._bridge&&t.sendBridgeMessage({bridgeId:"*",docSessionId:"*",message:new f.SessionConnectMessage({isSeedingRequired:e,sessionUrl:n,origin:o,authToken:r})})};var v=a.onSessionReconnect;a.onSessionReconnect=function(){v&&v(),t._bridge&&t.sendBridgeMessage({bridgeId:"*",docSessionId:"*",message:new f.SessionReconnectMessage})};var k=a.onSessionDisconnect;a.onSessionDisconnect=function(e){k&&k(e),t._bridge&&t.sendBridgeMessage({bridgeId:"*",docSessionId:"*",message:new f.SessionDisconnectMessage({error:e})})},t.createSession=function(){t._runtimeInitPromise=i.then((function(){var t=a&&a.docSessionId||e.sessionId;return u.runtime.createSession(Object.assign(Object.assign({},a),{docSessionId:t}))}))},t.createSession()}},this.getSession=function(){return t._runtimeInitPromise},this.setULSLogger=function(e){t.checkParametersAndThrow("setULSLogger",e&&e.ulsLogger),m.ULS.setLogger(e.ulsLogger)},this.setSendOTelEventCallback=function(e){t.checkParametersAndPropertyAndThrow("setSendOTelEventCallback",e&&e.sendOTelEvent,t._sendOTelEventCallback),t._sendOTelEventCallback=e.sendOTelEvent},this.setSendDiagnosticTraceCallback=function(e){t.checkParametersAndPropertyAndThrow("setSendDiagnosticTraceCallback",e&&e.sendDiagnosticTraceCallback,t._sendDiagnosticTraceCallback),t._sendDiagnosticTraceCallback=e.sendDiagnosticTraceCallback},this.setRequestAuthTokenCallback=function(e){t.checkParametersAndPropertyAndThrow("setRequestAuthTokenCallback",e&&e.requestAuthTokenCallback,t._requestAuthTokenCallback),t._requestAuthTokenCallback=e.requestAuthTokenCallback},this.setIsFeatureEnabledCallback=function(e){t.checkParametersAndPropertyAndThrow("setIsFeatureEnabledCallback",e&&e.featureEnabledCallback,t._featureEnabledCallback),t._featureEnabledCallback=e.featureEnabledCallback},this.registerLocalWorkflow=function(e){t.checkParametersAndThrow("registerLocalWorkflow",e&&e.workflow),t.checkRuntimeInitAndThrow("registerLocalWorkflow"),t._runtimeInitPromise.then((function(t){t.registerLocalWorkflow(e.workflow)}))},this.activateAnnotation=function(e){var n=t.checkParameters("activateAnnotation",e&&e.annotationType)||t.checkRuntimeInit("activateAnnotation");return n?Promise.reject(n):t._runtimeInitPromise.then((function(t){var n;return(e.config||e.handler||e.stateUpdateHandler)&&(n={config:e.config,callback:e.handler,stateUpdateCallback:e.stateUpdateHandler}),t.activateAnnotation(e.annotationType,n)}))},this.updateAnnotationConfig=function(e){var n=t.checkParameters("updateAnnotationConfig",e&&e.token&&e.config)||t.checkRuntimeInit("updateAnnotationConfig");return n?Promise.reject(n):t._runtimeInitPromise.then((function(t){t.updateAnnotationConfig(e.token,e.config)}))},this.releaseAnnotation=function(e){var n=t.checkParameters("releaseAnnotation",e&&e.token)||t.checkRuntimeInit("releaseAnnotation");return n?Promise.reject(n):t._runtimeInitPromise.then((function(t){return t.releaseAnnotation(e.token)}))},this.submitOperation=function(e){t.checkParametersAndThrow("submitOperation",e&&e.operation),t.checkRuntimeInit("submitOperation"),t._runtimeInitPromise.then((function(t){t.submitOperation(e.operation)}))},this.setSessionDataCallback=function(e){t.checkParametersAndPropertyAndThrow("setSessionDataCallback",e&&(e.sessionDataCallback||e.handler),t._setSessionDataCallback),e.sessionDataCallback?t._setSessionDataCallback=e.sessionDataCallback:e.handler&&(t._setSessionDataCallback=function(t,n,o){return e.handler(t,n)})},this.setAnnotationResultCallback=function(e){if(t.checkParametersAndThrow("setAnnotationResultCallback",e&&e.handler),t._annotationResultCallback){var n="".concat("setAnnotationResultCallback"," already called");m.ULS.sendTraceTag(537401028,g.LogCategory.msoulscat_Wac_BrowserGeneral,y.TraceLevel.Error,n)}t._annotationResultCallback=e.handler},this.setAnnotationState=function(e){t.checkParametersAndThrow("setAnnotationState",e&&e.parentPath&&e.id&&e.value),t.checkRuntimeInitAndThrow("setAnnotationState"),t._runtimeInitPromise.then((function(t){t.setAnnotationState(e.parentPath,e.id,e.value)}))},this.setAnnotationMetadata=function(e){t.checkParametersAndThrow("setAnnotationMetadata",e&&e.parentPath&&e.id&&e.value),t.checkRuntimeInitAndThrow("setAnnotationMetadata"),t._runtimeInitPromise.then((function(t){t.setAnnotationMetadata(e.parentPath,e.id,e.value)}))},this.setInitSessionCallback=function(e){t.checkParametersAndPropertyAndThrow("setInitSessionCallback",e&&e.initSessionCallback,t._initSessionCallback),t._initSessionCallback=e.initSessionCallback},this.setSessionInitOverrideCallback=function(e){t.checkParametersAndPropertyAndThrow("setSessionInitOverrideCallback",e&&e.handler,t._sessionInitOverrideCallback),t._sessionInitOverrideCallback=e.handler},this.setMessageBridge=function(e){t.checkParametersAndPropertyAndThrow("setSessionInitOverrideCallback",e&&e.bridge,t._bridge),t._bridge=e.bridge,t._bridge.registerMessageReceivedCallback(t.onBridgeMessage.bind(t))},this.forceReconnectSession=function(e){var n=t.checkParameters("forceReconnectSession",e)||t.checkRuntimeInit("forceReconnectSession");return n?Promise.reject(n):t._runtimeInitPromise.then((function(n){return e.excelServerParameters&&(t.excelServerParameters=e.excelServerParameters),n.forceReconnect()}))},this.setSessionCloseCallback=function(e){var n=t.checkParameters("setSessionCloseCallback",e&&e.callback)||t.checkRuntimeInit("setSessionCloseCallback");return n?Promise.reject(n):t._runtimeInitPromise.then((function(t){t.setSessionCloseCallback(e.callback)}))},this.submitCustomMessage=function(e){var n=t.checkParameters("submitCustomMessage",e&&e.message)||t.checkRuntimeInit("submitCustomMessage");return n?Promise.reject(n):t._runtimeInitPromise.then((function(t){return t.submitCustomMessage(e.message)}))},this.submitLargeBinaryDataMessage=function(e){var n="submitLargeBinaryDataMessage",o=t.checkParameters(n,e&&e.message)||t.checkRuntimeInit(n);return o?Promise.reject(o):f.MicroSyncMessage.typeGuard(e.message)?t._runtimeInitPromise.then((function(t){return t.submitLargeBinaryDataMessage(e.message)})):Promise.reject("".concat(n," only supports MicroSyncMessage"))},this.requestBinaryDataForBlob=function(e){var n=t.checkParameters("requestBinaryDataForBlob",e&&e.blob)||t.checkRuntimeInit("requestBinaryDataForBlob");return n?Promise.reject(n):t._runtimeInitPromise.then((function(t){return t.requestBinaryDataForBlob(e.blob)}))},this.closeSession=function(){var e=t.checkRuntimeInit("closeSession");return e?Promise.reject(e):t._runtimeInitPromise.then((function(e){e.close()}))},this.startNewSession=function(){if(!t.createSession){var e="startNewSession called before runtime init";throw m.ULS.sendTraceTag(537408074,g.LogCategory.msoulscat_Wac_BrowserGeneral,y.TraceLevel.Error,e),new Error(e)}t.createSession(),t._sessionCloseReason=null},this.submit=function(e){t.checkParametersAndThrow("submit",e&&e.inputSchema&&e.input),t.checkRuntimeInitAndThrow("submit"),t._runtimeInitPromise.then((function(){c.runtimeALv1.submit(e.inputSchema,e.input,e.correlationVector)}))},this.addEventHandler=function(e){t.checkParametersAndThrow("addEventHandler",e&&e.schemaName&&e.handler);var n=t._eventHandlerDictionary[e.schemaName]||[];n.push(e.handler),t._eventHandlerDictionary[e.schemaName]=n},this.removeEventHandler=function(e){t.checkParametersAndThrow("removeEventHandler",e&&e.schemaName&&e.handler);var n=t._eventHandlerDictionary[e.schemaName];if(Array.isArray(n)){var o=n.indexOf(e.handler);o>=0&&n.splice(o,1)}},this.registerSimpleRemoteWorkflow=function(e){var n=t.checkParameters("registerSimpleRemoteWorkflow",e&&e.name&&e.lambdaRemote)||t.checkRuntimeInit("registerSimpleRemoteWorkflow");return n?Promise.reject(n):t._runtimeInitPromise.then((function(){return c.runtimeALv1.registerSimpleRemoteWorkflow(e.name,e.lambdaBefore,e.lambdaRemote,e.lambdaAfter)}))},this.registerSimpleLocalWorkflow=function(e){var n=t.checkParameters("registerSimpleLocalWorkflow",e&&e.name&&e.lambda)||t.checkRuntimeInit("registerSimpleLocalWorkflow");return n?Promise.reject(n):t._runtimeInitPromise.then((function(){return c.runtimeALv1.registerSimpleLocalWorkflow(e.name,e.lambda)}))},this.registerReduceWorkflow=function(e){return Promise.resolve()},this.registerSchemas=function(e){return Promise.resolve()},this.onResult=function(e,n,o,r){var i=t._eventHandlerDictionary[o];if(i){var s,u=a(i);try{for(u.s();!(s=u.n()).done;){var c=s.value;if(c)c({inputSchema:e,input:n,outputSchema:o,output:r})}}catch(e){u.e(e)}finally{u.f()}}},this.onAnnotationResult=function(e){t._annotationResultCallback&&t._annotationResultCallback(e)},this.requestAuthToken=function(e){return t._requestAuthTokenCallback?(t._requestAuthTokenCallback(e)||Promise.resolve("")).then((function(e){var t=e||"";return Promise.resolve({Token:t})})):Promise.resolve({Token:""})},this.sendTelemetryEvent=function(e,n,o,r,i,a,s,u){t._sendOTelEventCallback&&t._sendOTelEventCallback(function(e,t,n,o,r,i,a){var s={telemetryProperties:{ariaTenantToken:e,nexusTenantToken:-1},eventName:t.split("_").join("."),dataFields:T(n),eventFlags:{dataCategories:i,diagnosticLevel:a,samplingPolicy:1}};return o&&(s.eventContract={name:o,dataFields:T(r,o.split(".").slice(-1)[0])}),s}(e,n,o,r,i,s,u))},this.sendDiagnosticTrace=function(e,n,o){t._sendDiagnosticTraceCallback&&t._sendDiagnosticTraceCallback(e,n,o)},this.isFeatureEnabled=function(e,n){if(!e)return Promise.resolve(!1);var o="Microsoft.Office.AugLoop.";if(0===e.indexOf(o)&&t._featureEnabledCallback){var r=e.slice(o.length);return Promise.resolve(t._featureEnabledCallback(r))}return Promise.resolve(!1)},this.setSessionData=function(e,n,o){t._setSessionDataCallback&&t._setSessionDataCallback(e,n,o)},this.overrideSessionInitMessage=function(e){return t._sessionInitOverrideCallback?t._sessionInitOverrideCallback(e):0===e.clientMetadata.appName.indexOf("Excel")&&t.excelServerParameters?t.overrideExcelSessionInitMessage(e):0===e.clientMetadata.appName.indexOf("PowerPoint")&&t.powerpointParameters?t.overridePowerPointSessionInitMessage(e):e},this.overrideExcelSessionInitMessage=function(e){for(var n={cluster:t.excelServerParameters.wacCluster,restUrl:t.excelServerParameters.ecsRestUrl,ecsId:t.excelServerParameters.ecsSessionId,ecsOperationUrl:t.excelServerParameters.ecsOperationUrl,workbookMetadataVersion:t.excelServerParameters.metadataVersion,serverEventVersion:t.excelServerParameters.serverEventVersion,permissionFlags:t.excelServerParameters.permissionFlags,configurations:t.excelServerParameters.configurations,collabUserListVersion:t.excelServerParameters.userListVersion,collabStateId:t.excelServerParameters.collabStateId,accessToken:t.excelServerParameters.accessToken,accessTokenTTL:t.excelServerParameters.accessTokenTTL,supportCustomMessages:t.excelServerParameters.supportCustomMessages},o=0,r=Object.keys(e);o<r.length;o++){var i=r[o];n[i]=e[i]}return new v.ExcelServerSessionInitMessage(n)},this.overridePowerPointSessionInitMessage=function(e){for(var n={downloadUrl:t.powerpointParameters.downloadUrl,getItemsEndPoint:t.powerpointParameters.getItemsEndPoint,documentOpenType:t.powerpointParameters.documentOpenType},o=0,r=Object.keys(e);o<r.length;o++){var i=r[o];n[i]=e[i]}return new k.PowerPointSessionInitMessage(n)},this.onInitSession=function(){return t._initSessionCallback?t._initSessionCallback():Promise.resolve()},this.checkParameters=function(e,t){if(!t){var n="".concat(e," called with invalid parameters");return m.ULS.sendTraceTag(537408075,g.LogCategory.msoulscat_Wac_BrowserGeneral,y.TraceLevel.Error,n),new Error(n)}},this.checkParametersAndThrow=function(e,n){var o=t.checkParameters(e,n);if(o)throw o},this.checkParametersAndPropertyAndThrow=function(e,n,o){if(t.checkParametersAndThrow(e,n),o){var r="".concat(e," already called");throw m.ULS.sendTraceTag(537408076,g.LogCategory.msoulscat_Wac_BrowserGeneral,y.TraceLevel.Error,r),new Error(r)}},this.checkRuntimeInit=function(e){if(!t._runtimeInitPromise){var n="".concat(e," called before runtime init");return m.ULS.sendTraceTag(537408077,g.LogCategory.msoulscat_Wac_BrowserGeneral,y.TraceLevel.Error,n),new Error(n)}},this.checkRuntimeInitAndThrow=function(e){var n=t.checkRuntimeInit(e);if(n)throw n},this.sendBridgeMessage=function(e){t._bridge.sendMessage(JSON.stringify(new f.BridgeMessage(e)))},this.onBridgeMessage=function(e){try{var n=JSON.parse(e),o=n.bridgeId,r=n.docSessionId,i=n.message,s=d.SchemaObject.getTypeNameFor(i);if(m.ULS.sendTraceTag(509092291,g.LogCategory.msoulscat_Wac_BrowserGeneral,y.TraceLevel.Info,"Received ".concat(s)),null!=t._sessionCloseReason&&t.sendBridgeMessage({bridgeId:"*",docSessionId:"*",message:new f.SessionCloseMessage({reason:t._sessionCloseReason})}),f.AnnotationActivationMessage.typeGuard(i)){var u=t.activateAnnotation({annotationType:i.annotationType,config:i.config,handler:function(e){t.sendBridgeMessage({bridgeId:o,docSessionId:r,message:new f.AnnotationResultsMessage({annotationType:i.annotationType,ops:[e]})})}}).then((function(e){return new f.AnnotationActivationResponse({messageId:i.messageId,token:e.token})}));t.sendResponseAcrossBridge(u,i,o,r)}else if(f.SyncMessage.typeGuard(i)){var c,l=a(i.ops);try{for(l.s();!(c=l.n()).done;){var p=c.value;t.submitOperation({operation:p})}}catch(e){l.e(e)}finally{l.f()}t.sendBridgeMessage({bridgeId:o,docSessionId:r,response:new f.Response({messageId:i.messageId})}),m.ULS.sendTraceTag(509092288,g.LogCategory.msoulscat_Wac_BrowserGeneral,y.TraceLevel.Info,"Responded to ".concat(s))}else if(f.AnnotationReleaseMessage.typeGuard(i)){var h=t.releaseAnnotation({token:i.token}).then((function(e){return new f.AnnotationReleaseResponse({messageId:i.messageId,lastRelease:e})}));t.sendResponseAcrossBridge(h,i,o,r)}else f.SubmittedCustomMessage.typeGuard(i)?t.submitCustomMessage({message:i.customMessage}).then((function(e){f.Response.typeGuard(e)?(e.messageId=i.messageId,m.ULS.sendTraceTag(508432467,g.LogCategory.msoulscat_Wac_BrowserGeneral,y.TraceLevel.Info,"Responded to ".concat(s))):m.ULS.sendTraceTag(508420946,g.LogCategory.msoulscat_Wac_BrowserGeneral,y.TraceLevel.Error,"Unexpeced response type from SubmitCustomMessage"),t.sendBridgeMessage({bridgeId:o,docSessionId:r,response:e})})).catch((function(e){m.ULS.sendTraceTag(508436636,g.LogCategory.msoulscat_Wac_BrowserGeneral,y.TraceLevel.Error,e.message),t.sendBridgeMessage({bridgeId:o,docSessionId:r,response:new f.ErrorResponse({messageId:i.messageId,error:e.message})})})):f.SessionInitMessage.typeGuard(i)?t.sendBridgeMessage({bridgeId:o,docSessionId:r,message:new f.ServerAuthenticationStateChangeMessage({serverAuthenticationState:t._serverAuthenticationState})}):m.ULS.sendTraceTag(509092259,g.LogCategory.msoulscat_Wac_BrowserGeneral,y.TraceLevel.Warning,"Did not respond to ".concat(s," with Id ").concat(i.messageId))}catch(e){m.ULS.sendTraceTag(509092363,g.LogCategory.msoulscat_Wac_BrowserGeneral,y.TraceLevel.Error,e.message),t.sendBridgeMessage({bridgeId:"unknown",docSessionId:"unknown",response:new f.ErrorResponse({messageId:"unknown",error:e.message})})}},this.sendResponseAcrossBridge=function(e,n,o,r){e.catch((function(e){return new f.ErrorResponse({messageId:n.messageId,error:e.message})})).then((function(e){t.sendBridgeMessage({bridgeId:o,docSessionId:r,response:e}),m.ULS.sendTraceTag(508937624,g.LogCategory.msoulscat_Wac_BrowserGeneral,y.TraceLevel.Info,"Responded to ".concat(d.SchemaObject.getTypeNameFor(n)))})).catch((function(e){m.ULS.sendTraceTag(508937623,g.LogCategory.msoulscat_Wac_BrowserGeneral,y.TraceLevel.Error,e.message)}))}}));n.AugLoopRuntimeManager=b},{109:109,122:122,139:139,164:164,165:165,166:166,20:20,3:3,55:55,59:59,60:60,61:61,62:62,66:66,76:76}],59:[function(e,t,n){t.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},{}],60:[function(e,t,n){function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}t.exports=function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}},{}],61:[function(e,t,n){t.exports=function(e){return e&&e.__esModule?e:{default:e}}},{}],62:[function(e,t,n){"use strict";var o=e("exportStarHelper");Object.defineProperty(n,"__esModule",{value:!0}),o(e(64),n)},{64:64}],63:[function(e,t,n){"use strict";var o=e(178),r=o(e(195)),i=o(e(172)),a=o(e(174)),s=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function a(e){try{u(o.next(e))}catch(e){i(e)}}function s(e){try{u(o.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((o=o.apply(e,t||[])).next())}))};Object.defineProperty(n,"__esModule",{value:!0}),n.Inputs=n.Model=n.lackingPromiseOrWasmSupport=void 0;var u=e(23),c=e(40);n.lackingPromiseOrWasmSupport=function(e){var t="";if("undefined"!=typeof navigator&&navigator.userAgent){var n=navigator.userAgent;!n.indexOf||n.indexOf("MSIE ")>0||n.indexOf("Trident/")>0?t="Error: IE lacks necessary support":"undefined"==typeof Promise?t="Error: Promise is not supported":"undefined"==typeof WebAssembly&&(t="Error: WASM is not supported")}else t="Error: No window userAgent";return""!=t&&(e.resultDescription=t,c.Log.info(540406806,c.LogCategory.CoreDefault,e.stop()),!0)};var l=function(){function e(t,n,o){(0,i.default)(this,e),this.session=t,this.onnxObject=o,this.modelName=n}return(0,a.default)(e,[{key:"run",value:function(e){var t;return s(this,void 0,void 0,r.default.mark((function n(){var o,i,a,s=this;return r.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if((o=new c.Operation({operationName:"RunModelForInferencing",success:!0,resourceId:this.modelName})).start(),!(null===(t=this.onnxObject)||void 0===t?void 0:t.Tensor)){n.next=9;break}return i=e.getInputs(),a={},Object.keys(i).forEach((function(e){var t=i[e];if(Array.isArray(t.values)&&t.values.length>0&&"boolean"==typeof t.values[0]){var n=new Uint8Array(t.values);a[e]=new s.onnxObject.Tensor(n,t.dimensions)}else a[e]=new s.onnxObject.Tensor(t.values,t.dimensions)})),n.abrupt("return",this.session.run(a).then((function(e){return c.Log.info(540406809,c.LogCategory.CoreDefault,o.stop()),new d(e)})).catch((function(e){o.resultDescription="Problem running model. ".concat(e.message),c.Log.info(540406810,c.LogCategory.CoreDefault,o.stop())})));case 9:throw o.resultDescription="Unable to run model. Tensor not defined",c.Log.info(540406811,c.LogCategory.CoreDefault,o.stop()),new Error("Tensor is not defined");case 12:case"end":return n.stop()}}),n,this)})))}}],[{key:"create",value:function(t,n,o){return s(this,void 0,void 0,r.default.mark((function i(){var a;return r.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if((a=new c.Operation({operationName:"CreateModelForInferencing",success:!0,resourceId:n})).start(),!o[t]){r.next=8;break}return a.resultDescription="Model already existed",c.Log.info(509699716,c.LogCategory.CoreDefault,a.stop()),r.abrupt("return",o[t]);case 8:return r.abrupt("return",o[t]=this.getInferenceSession(o).create(t).then((function(t){return c.Log.info(540406807,c.LogCategory.CoreDefault,a.stop()),new e(t,n,o)})).catch((function(e){throw a.resultDescription="Error: ".concat(e),c.Log.info(540406808,c.LogCategory.CoreDefault,a.stop()),e})));case 9:case"end":return r.stop()}}),i,this)})))}},{key:"getInferenceSession",value:function(e){if(null==e?void 0:e.InferenceSession)return e.InferenceSession;throw new Error("InferenceSession is not defined")}}]),e}();n.Model=l;var f=function(){function e(){(0,i.default)(this,e),this.map={}}return(0,a.default)(e,[{key:"getInputs",value:function(){return this.map}},{key:"add",value:function(e,t,n){return this.map[e]={dimensions:t,values:n},this}}],[{key:"create",value:function(){return new e}}]),e}();n.Inputs=f;var d=(0,a.default)((function e(t){(0,i.default)(this,e);for(var n=0,o=Object.keys(t);n<o.length;n++){var r=o[n];this[r]=new p(r,t[r])}})),p=function(){function e(t,n){(0,i.default)(this,e),this.resultName=t,this.result=n}return(0,a.default)(e,[{key:"name",value:function(){return this.resultName}},{key:"outputType",value:function(){switch(this.result.type){case"string":return u.Type.Strings;case"int8":return u.Type.Int8s;case"int16":return u.Type.Int16s;case"int32":return u.Type.Int32s;case"bool":return u.Type.Booleans;case"uint8":return u.Type.UnsignedInt8s;case"uint16":return u.Type.UnsignedInt16s;case"uint32":return u.Type.UnsignedInt32s;case"float32":return u.Type.Float32s;case"float64":return u.Type.Float64s;default:throw new Error("The output type ".concat(this.result.type," is not supported."))}}},{key:"dimensions",value:function(){return this.result.dims}},{key:"asBooleans",value:function(){if(this.outputType()===u.Type.Booleans)return this.result.data.map((function(e){return!!e}));throw new Error("asBooleans() was called; however, outputType() is ".concat(this.outputType(),", not Type.Booleans."))}},{key:"asFloat32s",value:function(){if(this.outputType()===u.Type.Float32s)return this.result.data;throw new Error("asFloat32s() was called; however, outputType() is ".concat(this.outputType(),", not Type.Float32s."))}},{key:"asFloat64s",value:function(){if(this.outputType()===u.Type.Float64s)return this.result.data;throw new Error("asFloat64s() was called; however, outputType() is ".concat(this.outputType(),", not Type.Float64s."))}},{key:"asInt8s",value:function(){if(this.outputType()===u.Type.Int8s)return this.result.data;throw new Error("asInt8s() was called; however, outputType() is ".concat(this.outputType(),", not Type.Int8s."))}},{key:"asInt16s",value:function(){if(this.outputType()===u.Type.Int16s)return this.result.data;throw new Error("asInt16s() was called; however, outputType() is ".concat(this.outputType(),", not Type.Int16s."))}},{key:"asInt32s",value:function(){if(this.outputType()===u.Type.Int32s)return this.result.data;throw new Error("asInt32s() was called; however, outputType() is ".concat(this.outputType(),", not Type.Int32s."))}},{key:"asStrings",value:function(){if(this.outputType()===u.Type.Strings)return this.result.data;throw new Error("asStrings() was called; however, outputType() is ".concat(this.outputType(),", not Type.Strings."))}},{key:"asUnsignedInt8s",value:function(){if(this.outputType()===u.Type.UnsignedInt8s)return this.result.data;throw new Error("asUnsignedInt8s() was called; however, outputType() is ".concat(this.outputType(),", not Type.UnsignedInt8s."))}},{key:"asUnsignedInt16s",value:function(){if(this.outputType()===u.Type.UnsignedInt16s)return this.result.data;throw new Error("asUnsignedInt16s() was called; however, outputType() is ".concat(this.outputType(),", not Type.UnsignedInt16s."))}},{key:"asUnsignedInt32s",value:function(){if(this.outputType()===u.Type.UnsignedInt32s)return this.result.data;throw new Error("asUnsignedInt32s() was called; however, outputType() is ".concat(this.outputType(),", not Type.UnsignedInt32s."))}}]),e}()},{172:172,174:174,178:178,195:195,23:23,40:40}],64:[function(e,t,n){"use strict";var o=e(178),r=o(e(172)),i=o(e(174));Object.defineProperty(n,"__esModule",{value:!0}),n.OnnxInferenceService=void 0;var a=e(65),s=function(){function e(){(0,r.default)(this,e)}return(0,i.default)(e,[{key:"createModel",value:function(e,t){var n,o=null===(n=null===globalThis||void 0===globalThis?void 0:globalThis.top)||void 0===n?void 0:n.ort;return(0,a.createModel)(e,t||"",o)}},{key:"createInputs",value:function(){return(0,a.createInputs)()}}],[{key:"createFactory",value:function(t,n,o){var r=this;return function(){var i;return e.onnxRetrievalPromise?e.onnxRetrievalPromise:t&&n?((null===(i=null===globalThis||void 0===globalThis?void 0:globalThis.top)||void 0===i?void 0:i.ort)?Promise.resolve():(0,a.loadOnnx)(r.createCdnUrl(t,n),"ort",o)).then((function(){e.onnxRetrievalPromise=Promise.resolve(new e)})).catch((function(t){e.onnxRetrievalPromise=Promise.reject(t)})).then((function(){return e.onnxRetrievalPromise})):Promise.reject(new Error("Error: appName and/or version not provided"))}}},{key:"createCdnUrl",value:function(e,t){return"https://".concat(e).concat(t)}}]),e}();n.OnnxInferenceService=s},{172:172,174:174,178:178,65:65}],65:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.createInputs=n.createModel=n.loadOnnx=void 0;var o=e(40),r=e(63);function i(e){var t=globalThis[e];return!!(t&&t.InferenceSession&&t.Tensor)&&((null===globalThis||void 0===globalThis?void 0:globalThis.top)&&!globalThis.top[e]&&(globalThis.top[e]=t),!0)}n.loadOnnx=function(e,t,n){var a=new o.Operation({operationName:"CreateOnnxInferenceService",success:!0,resultDescription:""});if(a.start(),(0,r.lackingPromiseOrWasmSupport)(a)){var s="Browser lacks necessary support for inference service";return a.success=!1,a.resultDescription=s,o.Log.info(540406803,o.LogCategory.CoreDefault,a.stop()),Promise.reject(new Error(s))}return new Promise((function(o,r){if("undefined"!=typeof document){var a=document.createElement("script");a.src=e,a.onload=function(){i(t)?(n&&(globalThis.top[t].env.wasm.wasmPaths=n),o()):(a.remove(),r(new Error("ort.Tensor and/or ort.InferenceSession are undefined")))},a.onerror=r,document.body.appendChild(a)}else globalThis.importScripts?(globalThis.importScripts(e),globalThis[t]=self[t],globalThis.top||(globalThis.top={}),i(t)?(n&&(globalThis.top[t].env.wasm.wasmPaths=n),o()):r(new Error("ort.Tensor and/or ort.InferenceSession are undefined"))):r(new Error("Unexpected lack of document and importScripts"))})).then((function(){o.Log.info(540406804,o.LogCategory.CoreDefault,a.stop())})).catch((function(e){throw a.success=!1,a.resultDescription=e.message,o.Log.info(509871835,o.LogCategory.CoreDefault,a.stop()),e}))},n.createModel=function(e,t,n){return r.Model.create(e,t,n)},n.createInputs=function(){return r.Inputs.create()}},{40:40,63:63}],66:[function(e,t,n){"use strict";var o=e("exportStarHelper");Object.defineProperty(n,"__esModule",{value:!0}),o(e(67),n)},{67:67}],67:[function(e,t,n){"use strict";var o=e(178),r=o(e(172)),i=o(e(174));Object.defineProperty(n,"__esModule",{value:!0}),n.PowerPointSessionExtensionConfig=n.PowerPointSessionInitMessage=void 0;var a=e(139),s=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Powerpoint_Session_Protocol_PowerPointSessionInitMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_SessionInitMessage","AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.PowerPointSessionInitMessage=s,s.H_={T_:s.getTypeName(),B_:s.getBaseTypes()};var u=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Powerpoint_Session_Protocol_PowerPointSessionExtensionConfig"}},{key:"getBaseTypes",value:function(){return[]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.PowerPointSessionExtensionConfig=u,u.H_={T_:u.getTypeName(),B_:u.getBaseTypes()}},{139:139,172:172,174:174,178:178}],68:[function(e,t,n){"use strict";var o=e(178),r=o(e(172)),i=o(e(174));Object.defineProperty(n,"__esModule",{value:!0}),n.AnnotationActivationTracker=void 0;var a=e(122),s=function(){function e(t,n,o){(0,r.default)(this,e),this.sendMessage=t,this.annotationType=n,this.options=o,this.token="".concat(n,"-").concat(e.nextActivationResultBatchId++)}return(0,i.default)(e,[{key:"activate",value:function(e,t){var n=this;return new Promise((function(o,r){n.sendMessage(new a.AnnotationActivationMessage({annotationType:n.annotationType,token:n.token,config:n.options?n.options.config:void 0,ignoreExistingAnnotations:e,sendStateUpdates:n.options?!!n.options.stateUpdateCallback:void 0}),(function(e,t){e?r(new Error(e.error)):o({token:n.token})}),t)}))}},{key:"release",value:function(){var e=this;return new Promise((function(t,n){e.sendMessage(new a.AnnotationReleaseMessage({token:e.token}),(function(e,o){e?n(new Error(e.error)):t(o.lastRelease)}))}))}}]),e}();n.AnnotationActivationTracker=s,s.nextActivationResultBatchId=1},{122:122,172:172,174:174,178:178}],69:[function(e,t,n){"use strict";var o=e(178),r=o(e(172)),i=o(e(174));function a(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){u=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw i}}}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}Object.defineProperty(n,"__esModule",{value:!0}),n.OrderedAnnotationResultsProcessor=void 0;var u=e(70),c=function(){function e(t){(0,r.default)(this,e),this.annotationSequencer=null!=t?t:new u.AnnotationSequencer}return(0,i.default)(e,[{key:"process",value:function(e,t,n,o){var r,i=this,s=[],u=a(e.ops);try{var c=function(){var e=r.value,o=[];if(null==e?void 0:e.items){var u,c=a(e.items);try{var l=function(){var n=u.value,r=i.annotationSequencer.sequence(n.body).then((function(){t(e,n)}));o.push(r)};for(c.s();!(u=c.n()).done;)l()}catch(e){c.e(e)}finally{c.f()}}s.push(Promise.all(o).then((function(){n(e)})))};for(u.s();!(r=u.n()).done;)c()}catch(e){u.e(e)}finally{u.f()}Promise.all(s).then((function(){return o(e)}))}}]),e}();n.OrderedAnnotationResultsProcessor=c},{172:172,174:174,178:178,70:70}],70:[function(e,t,n){"use strict";var o=e(178),r=o(e(195)),i=o(e(172)),a=o(e(174)),s=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function a(e){try{u(o.next(e))}catch(e){i(e)}}function s(e){try{u(o.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((o=o.apply(e,t||[])).next())}))};Object.defineProperty(n,"__esModule",{value:!0}),n.AnnotationSequencer=void 0;var u=e(71),c=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:500,n=arguments.length>1?arguments[1]:void 0;(0,i.default)(this,e),this.sequencerFactory=null!=n?n:new u.BufferingSequencerFactory(t)}return(0,a.default)(e,[{key:"sequence",value:function(e){var t;return s(this,void 0,void 0,r.default.mark((function n(){var o;return r.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=(null===(t=null==e?void 0:e.M_)||void 0===t?void 0:t.seq)){n.next=3;break}return n.abrupt("return");case 3:if(o=this.sequencerFactory.create(e)){n.next=6;break}return n.abrupt("return");case 6:return n.next=8,o.sequence(e.M_.seq);case 8:case"end":return n.stop()}}),n,this)})))}}]),e}();n.AnnotationSequencer=c},{172:172,174:174,178:178,195:195,71:71}],71:[function(e,t,n){"use strict";var o=e(178),r=o(e(172)),i=o(e(174));Object.defineProperty(n,"__esModule",{value:!0}),n.BufferingSequencerFactory=void 0;var a=e(14),s=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:500;(0,r.default)(this,e),this.bufferingTimeMs=500,this.workflowIdToSequencersMap=new Map,this.bufferingTimeMs=t}return(0,i.default)(e,[{key:"create",value:function(e){if(!e.ownerId)return null;var t=this.workflowIdToSequencersMap.get(e.ownerId);return t||(t=new a.BufferingSequencer(this.bufferingTimeMs),this.workflowIdToSequencersMap.set(e.ownerId,t)),t}}]),e}();n.BufferingSequencerFactory=s},{14:14,172:172,174:174,178:178}],72:[function(e,t,n){"use strict";var o=e(178),r=o(e(172)),i=o(e(174));Object.defineProperty(n,"__esModule",{value:!0}),n.RoutingAnnotationResultsProcessor=void 0;var a=e(69),s=e(73),u=function(){function e(t,n,o){(0,r.default)(this,e),this.isOrderingEnabled=t,this.orderedAnnotationResultsProcessor=null!=n?n:new a.OrderedAnnotationResultsProcessor,this.unorderedAnnotationResultsProcessor=null!=o?o:new s.UnorderedAnnotationResultsProcessor}return(0,i.default)(e,[{key:"process",value:function(e,t,n,o){this.isOrderingEnabled()?this.orderedAnnotationResultsProcessor.process(e,t,n,o):this.unorderedAnnotationResultsProcessor.process(e,t,n,o)}}]),e}();n.RoutingAnnotationResultsProcessor=u},{172:172,174:174,178:178,69:69,73:73}],73:[function(e,t,n){"use strict";var o=e(178),r=o(e(172)),i=o(e(174));function a(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){u=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw i}}}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}Object.defineProperty(n,"__esModule",{value:!0}),n.UnorderedAnnotationResultsProcessor=void 0;var u=function(){function e(){(0,r.default)(this,e)}return(0,i.default)(e,[{key:"process",value:function(e,t,n,o){var r,i=a(e.ops);try{for(i.s();!(r=i.n()).done;){var s=r.value;if(null==s?void 0:s.items){var u,c=a(s.items);try{for(c.s();!(u=c.n()).done;){t(s,u.value)}}catch(e){c.e(e)}finally{c.f()}}n(s)}}catch(e){i.e(e)}finally{i.f()}o(e)}}]),e}();n.UnorderedAnnotationResultsProcessor=u},{172:172,174:174,178:178}],74:[function(e,t,n){"use strict";var o=e(178),r=o(e(188)),i=o(e(172)),a=o(e(174));function s(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return u(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}Object.defineProperty(n,"__esModule",{value:!0}),n.BatchManager=void 0;var c,l=e(40),f=e(109);!function(e){e[e.ExceedingMaxSize=0]="ExceedingMaxSize",e[e.GroupComplete=1]="GroupComplete",e[e.BatchIntervalElapsed=2]="BatchIntervalElapsed"}(c||(c={}));var d=function(){function e(t,n){(0,i.default)(this,e),this.batchesByGroupingKey=new Map,this.submit=t,this.onSummary=n}return(0,a.default)(e,[{key:"addBatchItem",value:function(e,t,n,o,r,i){var a=this,s=t.delayMs,u=t.delayMsMax,f=t.maxInputSize,d=t.estimateSize,p=t.groupingKeyExtractor,h=d(e),g=p(e);if(t.split&&h>f){var y;try{y=t.split(e)}catch(e){var m=new Error("Split error: "+e.message);return void(i?i(m):l.Log.error(573366352,l.LogCategory.CoreDefault,m))}if(y&&Array.isArray(y.inputs)&&y.inputs.length>1){for(var v,k=[],T=i?function(e,t){if(v=v||e,k.push(t),k.length===y.inputs.length){var n;try{n=y.join(k)}catch(e){return void i(new Error("Join error: "+e.message))}i(v,n)}}:void 0,S=0;S<y.inputs.length;S++){var b=y.inputs[S];this.addBatchItem(b,t,n,o,r&&S===y.inputs.length-1,T)}return}}var w=this.batchesByGroupingKey.get(g);w&&w.size+h>f&&(this.executeBatch(g,w,t,c.ExceedingMaxSize),w=void 0),w||(w={items:[],size:0,hasItemsWithCallbacks:!1,context:n,creationTime:Date.now()},this.batchesByGroupingKey.set(g,w)),w.items.push({input:e,size:h,callback:i}),w.size+=h,w.hasItemsWithCallbacks=w.hasItemsWithCallbacks||!!i,w.cv=o,w.groupComplete=r,w.groupComplete?this.executeBatch(g,w,t,c.GroupComplete):(Date.now()-w.creationTime+s<u&&(clearTimeout(w.timeout),w.timeout=void 0),w.timeout||(w.timeout=setTimeout((function(){a.executeBatch(g,w,t,c.BatchIntervalElapsed)}),s)))}},{key:"removeAllBatchedItems",value:function(){this.batchesByGroupingKey.forEach((function(e){e.timeout&&clearTimeout(e.timeout)})),this.batchesByGroupingKey.clear()}},{key:"executeBatch",value:function(e,t,n,o){var i=this;clearTimeout(t.timeout),t.timeout=void 0,this.batchesByGroupingKey.delete(e);var a,u=t.items,c=function(e){return e<0?"Negative":0===e?"0":1===e?"1":"Magnitude ".concat(e.toString().length)},d=new l.Operation({operationName:"ExecuteBatch",cv:t.cv,resourceId:t.context.name,resultDescription:"batching duration: ".concat(Date.now()-t.creationTime,"ms"),dimension0:"Count ".concat(c(u.length)),dimension1:"Size ".concat(c(t.size)),dimension2:o.toString()}).start(),p=function(e,n,o){var r;if(n&&n.exceptionType===f.ExceptionType.NoOutput)d.success=!0,l.Log.info(573366353,l.LogCategory.CoreDefault,d.stop());else{var i="".concat(e," error: ").concat(n?n.message||n:"Unknown error");r=n||new Error(i),d.success=!1,d.resultDescription="Batch of ".concat(u.length," items of size ").concat(t.size," with ").concat(i),d.resultSignature="".concat(e," Error"),l.Log.error(573366354,l.LogCategory.CoreDefault,d.stop())}if(t.hasItemsWithCallbacks){var a,c=s(u);try{for(c.s();!(a=c.n()).done;){var p=a.value;p.callback&&p.callback(r,o)}}catch(n){c.e(n)}finally{c.f()}}};try{a=n.multiplex(u.map((function(e){return e.input})))}catch(e){return void p("Multiplex",e)}this.submit(a.input,t,(function(e,o){if(e||o&&("exceptionType"in o||o instanceof Error))p("Submit",e||o,o);else if(t.hasItemsWithCallbacks||n.summaryExtractor){var s,c,f;if(t.hasItemsWithCallbacks)try{if((s=a.demultiplex(o)).length!==u.length)throw new Error("Mismatched output length")}catch(e){return void p("Demultiplex",e)}if(n.summaryExtractor)try{var h=n.summaryExtractor(o),g=(0,r.default)(h,2);f=g[0],c=g[1]}catch(e){return void p("SummaryExtractor",e)}if(d.success=!0,l.Log.info(573366342,l.LogCategory.CoreDefault,d.stop()),t.hasItemsWithCallbacks)for(var y=0;y<u.length;y++)u[y].callback&&u[y].callback(void 0,s[y]);c&&i.onSummary(f,c,t.context)}else d.success=!0,l.Log.info(573366343,l.LogCategory.CoreDefault,d.stop())}))}}]),e}();n.BatchManager=d},{109:109,172:172,174:174,178:178,188:188,40:40}],75:[function(e,t,n){"use strict";var o=e(178),r=o(e(189)),i=o(e(172)),a=o(e(174));function s(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return u(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}Object.defineProperty(n,"__esModule",{value:!0}),n.ChatHelper=void 0;var c=e(135),l=e(139),f=e(155),d=function(){function e(t){(0,i.default)(this,e),this.config=t,this.nextMessageId=0,this.responseCallbacks=new Map;var n=["session","chats"],o=(0,f.v4)(),a=[].concat(n,[o]);this.messagesPath=[].concat((0,r.default)(a),["messages"]),this.config.session.submitOperations([new l.AddOperation({parentPath:n,items:[{id:o,body:t.chat}]}),new l.AddOperation({parentPath:a,items:[{id:"messages",body:new c.MessagesHolder}]})])}return(0,a.default)(e,[{key:"send",value:function(e,t){var n="".concat(this.nextMessageId++);this.responseCallbacks.set(n,t),this.config.session.submitOperations([new l.AddOperation({parentPath:this.messagesPath,items:[{id:n,body:e}]})])}},{key:"close",value:function(){return this.config.session.releaseAnnotation(this.activatedAnnotationToken)}},{key:"activateAnnotation",value:function(e){var t=this;return this.config.session.activateAnnotation(e,{callback:function(e){if(l.AddOperation.typeGuard(e)&&t.isUnderSubtree(e.parentPath,t.messagesPath)){var n,o=s(e.items);try{for(o.s();!(n=o.n()).done;){var r=n.value,i=e.parentPath[e.parentPath.length-1],a=t.responseCallbacks.get(i);a&&(a(r.body),t.responseCallbacks.delete(i))}}catch(e){o.e(e)}finally{o.f()}}}}).then((function(e){var n=e.token;t.activatedAnnotationToken=n}))}},{key:"isUnderSubtree",value:function(e,t){if(e.length<t.length)return!1;for(var n=0;n<t.length;n++)if(e[n]!==t[n])return!1;return!0}}],[{key:"create",value:function(t){var n=new e(t);return n.activateAnnotation(t.responseType).then((function(){return n}))}}]),e}();n.ChatHelper=d},{135:135,139:139,155:155,172:172,174:174,178:178,189:189}],76:[function(e,t,n){"use strict";var o=e("exportStarHelper");Object.defineProperty(n,"__esModule",{value:!0}),o(e(74),n),o(e(75),n),o(e(77),n),o(e(78),n),o(e(79),n),o(e(80),n),o(e(82),n),o(e(86),n),o(e(96),n),o(e(97),n),o(e(101),n),o(e(103),n)},{101:101,103:103,74:74,75:75,77:77,78:78,79:79,80:80,82:82,86:86,96:96,97:97}],77:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.asyncFetchWithTimeout=n.internalFetch=n.timeoutErrorString=void 0;var o=e(98),r=e(196);n.timeoutErrorString="Request timed out",n.internalFetch=function(e,t,n){var o=new r.Request(e,t);return i.add(o,n)};var i=new o.SequentialFetchQueue(r.fetch,2e4,12e4);n.asyncFetchWithTimeout=function(e,t,o){return new Promise((function(i,a){var s=setTimeout((function(){a(new Error(n.timeoutErrorString))}),t);(0,r.fetch)(e,o||{}).then((function(e){clearTimeout(s),i(e)})).catch((function(e){clearTimeout(s),a(e)}))}))}},{196:196,98:98}],78:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},{}],79:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},{}],80:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},{}],81:[function(e,t,n){"use strict";var o=e(178),r=o(e(172)),i=o(e(174));Object.defineProperty(n,"__esModule",{value:!0}),n.LocalWorkflowContext=void 0;var a=e(158),s=function(){function e(t){(0,r.default)(this,e),this.model=t.model,this.clientMetadata=t.clientMetadata,this.userContext=t.userContext,this.site=t.site,this.getToken=t.getTokenCallback}return(0,i.default)(e,[{key:"flights",get:function(){var e;return null!==(e=this._flights)&&void 0!==e||(this._flights=(0,a.parseFlights)(this.clientMetadata.flights)),this._flights}},{key:"getToken",value:function(e,t){return this.getToken(e,t)}}]),e}();n.LocalWorkflowContext=s},{158:158,172:172,174:174,178:178}],82:[function(e,t,n){"use strict";var o=e(178),r=o(e(189)),i=o(e(188)),a=o(e(172)),s=o(e(174));function u(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}Object.defineProperty(n,"__esModule",{value:!0}),n.LocalWorkflowExecutionManager=void 0;var l,f=e(139),d=e(23),p=e(40),h=e(122),g=e(118),y=e(99),m=e(104),v=e(101),k=e(48),T=e(81),S=e(160),b=e(150),w=e(116),C=e(83);!function(e){e.Unknown="",e.InputReceived="input",e.JoinMaxAnnnotation="maxAnnotation",e.JoinMaxTimeout="maxTimeout",e.JoinEarlyCompletion="earlyCompletion"}(l||(l={}));var _=function(){function e(t,n,o){var r=this;(0,a.default)(this,e),this.executionTrackersByWorkflowNameBySession=new Map,this.workflowsWithSessionAffinity=new Map,this.workflowDefinitionsWithSessionAffinity=[],this.workflowsWithoutSessionAffinity=[],this.pendingScopeExecutionNotificationsByWorkflow=new Map,this.sweepIntervalMs=200,this.sweepTimers=new Map,this.getResourceAsArrayBuffer=function(e,t,n){return r.modelDownloader?r.modelDownloader.getResourceAsArrayBuffer(e,t,n):Promise.reject(new Error("Resource Downloader never created"))},this.getResourceAsURL=function(e,t,n){return r.modelDownloader?r.modelDownloader.getResourceAsURL(e,t,n):Promise.reject(new Error("Resource Downloader never created"))},this.createModel=function(e){return!r.inferenceService&&r.inferenceServiceFactory&&(r.inferenceService=r.inferenceServiceFactory()),r.inferenceService?r.inferenceService.then((function(t){return t.createModel(e)})):Promise.reject(new Error("Inference Service never created"))},this.createModelInputs=function(){if(!r.inferenceService&&r.inferenceServiceFactory&&(r.inferenceService=r.inferenceServiceFactory()),r.inferenceService)return r.inferenceService.then((function(e){return e.createInputs()}));throw new Error("Inference Service never created")},this.nextAnnotationId=1,this.nextSignalId=1,this.modelDownloader=t,this.inferenceServiceFactory=n,o.enableDeltas&&(this.deltaHandlers=(new Map).set(f.SchemaObject.getTypeNameFor(b.TextTileDelta),k.applyTextTileDelta).set(f.SchemaObject.getTypeNameFor(b.FormattedTextTileDelta),k.applyFormattedTextTileDelta),this.deltaItems=new Map),this.enableEarlyJoin=o.enableEarlyJoin||!1,this.site={getResourceAsArrayBuffer:this.getResourceAsArrayBuffer,getResourceAsURL:this.getResourceAsURL,createModel:this.createModel,createModelInputs:this.createModelInputs}}return(0,s.default)(e,[{key:"getNextClientAnnotationId",value:function(){return"#AC"+this.nextAnnotationId++}},{key:"getNextClientSignalId",value:function(){return"#SC"+this.nextSignalId++}},{key:"registerLocalWorkflow",value:function(e,t){var n=this,o=new p.Operation({operationName:"WorkflowRegistration",resourceId:e.id}).start();if(0===e.inputTypes.length)throw new Error("Invalid workflow params");t?(this.workflowsWithSessionAffinity.get(t).push(this.createWorkflowImplementation(e,t)),t.registerContextTypes((0,S.getContextTypes)(e.requestedContextTypesRules).map((function(e){var t=(0,i.default)(e,2),n=t[0];t[1];return n}))),t.attachToWorkflowGraph(e),o.setClientMetadata(t.getClientMetadata())):(e.isStateful?(this.workflowDefinitionsWithSessionAffinity.push(e),this.workflowsWithSessionAffinity.forEach((function(t,o){t.push(n.createWorkflowImplementation(e,o))}))):this.workflowsWithoutSessionAffinity.push(this.createWorkflowImplementation(e)),this.workflowsWithSessionAffinity.forEach((function(t,n){n.registerContextTypes((0,S.getContextTypes)(e.requestedContextTypesRules).map((function(e){var t=(0,i.default)(e,2),n=t[0];t[1];return n}))),n.attachToWorkflowGraph(e)}))),o.success=!0,p.Log.info(572838110,p.LogCategory.CoreDefault,o.stop())}},{key:"getAllRegisteredWorkflowsFromSession",value:function(e){var t=[];return t.push.apply(t,(0,r.default)(this.workflowsWithoutSessionAffinity||[])),t.push.apply(t,(0,r.default)(this.workflowsWithSessionAffinity.get(e)||[])),t.map((function(e){return e.workflow}))}},{key:"getWorkflowDefinitionsByName",value:function(e){var t,n=new Map;return null===(t=this.workflowsWithSessionAffinity.get(e))||void 0===t||t.forEach((function(e){return n.set(e.workflow.id,e.workflow)})),n}},{key:"getWorkflowDefinitionsWithSessionAffinity",value:function(){return this.workflowDefinitionsWithSessionAffinity}},{key:"attachExecutionTrackerToEachWorkflow",value:function(e,t,n){var o,r=this,i=e.getWorkflowNodes(),a=this.executionTrackersByWorkflowNameBySession.get(t),s=function(e,o){if(n&&n(e,o),r.enableEarlyJoin){(function(){var e,n=u(r.executionTrackersByWorkflowNameBySession.get(t).values());try{for(n.s();!(e=n.n()).done;){var i=e.value;if(i.graphNode.workflow.kind===d.WorkflowKind.Join){var a,s=u(i.getExecutionState().keys());try{for(s.s();!(a=s.n()).done;){var c=a.value;if(k.ContextIdManager.isParentContextId(c,o))return!0}}catch(e){s.e(e)}finally{s.f()}}}}catch(e){n.e(e)}finally{n.f()}return!1})()&&(r.cancelSweepTimer(t),r.ensureSweepTimer(t),r.sweepScopeExecutionNotifications())}},c=u(i);try{for(c.s();!(o=c.n()).done;){var l=o.value,f=a.get(l.workflow.id),p=new C.WorkflowExecutionTracker(l,s.bind(this),f);a.set(l.workflow.id,p)}}catch(e){c.e(e)}finally{c.f()}var h,g=u(a.values());try{for(g.s();!(h=g.n()).done;){var y=h.value;this.setDownstreamWorkflowExecutionTrackers(y,a),this.setUpstreamWorkflowExecutionTrackers(y,a)}}catch(e){g.e(e)}finally{g.f()}}},{key:"canActivateWorkflow",value:function(e,t){var n;return e.location===k.Location.Local||!!t.hasConnected&&!((null===(n=e.workflow.requiredTokenTypes)||void 0===n?void 0:n.length)>0&&t.getServerAuthenticationState()===h.ServerAuthenticationState.NotAuthenticated)}},{key:"setDownstreamWorkflowExecutionTrackers",value:function(e,t){if(void 0===e.downstreamWorkflowExecutionTrackers){e.downstreamWorkflowExecutionTrackers=new Set;var n,o=u(e.graphNode.downstreamWorkflows||[]);try{for(o.s();!(n=o.n()).done;){var r=n.value,i=t.get(r.workflow.id);this.setDownstreamWorkflowExecutionTrackers(i,t),e.downstreamWorkflowExecutionTrackers.add(i)}}catch(e){o.e(e)}finally{o.f()}}}},{key:"setUpstreamWorkflowExecutionTrackers",value:function(e,t){if(void 0===e.upstreamWorkflowExecutionTrackers){e.upstreamWorkflowExecutionTrackers=new Set;var n,o=u(e.graphNode.upstreamWorkflows||[]);try{for(o.s();!(n=o.n()).done;){var r=n.value,i=t.get(r.workflow.id);this.setUpstreamWorkflowExecutionTrackers(i,t),e.upstreamWorkflowExecutionTrackers.add(i)}}catch(e){o.e(e)}finally{o.f()}}}},{key:"deactivateServerWorkflow",value:function(e,t){var n;e.location!==k.Location.Local&&(null===(n=this.executionTrackersByWorkflowNameBySession.get(t))||void 0===n||n.get(e.workflow.id).clearWorkflowExecutions(),e.isActivated=!1)}},{key:"addSession",value:function(e){this.executionTrackersByWorkflowNameBySession.set(e,new Map);var t,n=[],o=u(this.workflowDefinitionsWithSessionAffinity);try{for(o.s();!(t=o.n()).done;){var r=t.value;n.push(this.createWorkflowImplementation(r)),e.attachToWorkflowGraph(r)}}catch(e){o.e(e)}finally{o.f()}this.workflowsWithSessionAffinity.set(e,n);var i,a=u(this.workflowsWithoutSessionAffinity);try{for(a.s();!(i=a.n()).done;){var s=i.value;e.attachToWorkflowGraph(s.workflow)}}catch(e){a.e(e)}finally{a.f()}}},{key:"closeSession",value:function(e){this.cancelSweepTimer(e);var t,n=u(this.workflowsWithSessionAffinity.get(e)||[]);try{for(n.s();!(t=n.n()).done;){t.value.workflowLambda.dispose()}}catch(e){n.e(e)}finally{n.f()}this.workflowsWithSessionAffinity.delete(e)}},{key:"setTokenCallback",value:function(e){this.getAuthTokenCallback=e}},{key:"preProcessItemToWorkflow",value:function(e,t,n){var o=this.executionTrackersByWorkflowNameBySession.get(n).get(e.id);e.kind===d.WorkflowKind.Join&&f.SchemaObject.matchesTypesFor(t.body,e.inputTypes)&&o.addInputItemToProcess(t.contextId),(e.kind===d.WorkflowKind.SingleItem&&f.SchemaObject.matchesTypesFor(t.body,e.inputTypes)||e.kind===d.WorkflowKind.Join&&f.SchemaObject.matchesTypesFor(t.body,[e.collectionScopeType]))&&o.beforeWorkflowExecution(t.contextId)}},{key:"isReadyToEarlyJoin",value:function(e,t,n){var o=this,r=function(r){var i,a=Array.from(null!==(i=r.states)&&void 0!==i?i:[]).map((function(e){return"".concat(e[0],": ").concat(e[1].map((function(e){return e.join()})))})).join(),s=new p.Operation({operationName:"EarlyJoinCompletion",resourceId:e.graphNode.workflow.id,joinContextId:t,success:!0}).start();s.setClientMetadata(n),s.resultDescription="isReadyToEarlyJoin (".concat(o.enableEarlyJoin,") -> hasProcessedAllInputItems: ").concat(r.hasProcessedAllInputItems,", allUpstreamComplete: ").concat(r.allUpstreamComplete,", states: ").concat(a),p.Log.info(512550800,p.LogCategory.CoreDefault,s.stop())},i=0===e.countItemsToProcess(t);if(!i)return this.enableEarlyJoin||r({hasProcessedAllInputItems:i}),!1;var a=this.areAllUpstreamWorkflowComplete(e,t),s=a.allUpstreamComplete,u=a.states;return this.enableEarlyJoin?s:(r({hasProcessedAllInputItems:i,allUpstreamComplete:s,states:u}),!1)}},{key:"areAllUpstreamWorkflowComplete",value:function(e,t){var n,o=new Map,r=u(e.upstreamWorkflowExecutionTrackers);try{for(r.s();!(n=r.n()).done;){var a,s=n.value,c=[],l=u(s.getExecutionState());try{for(l.s();!(a=l.n()).done;){var f=(0,i.default)(a.value,2),d=f[0],p=f[1];if(c.push([d,p]),k.ContextIdManager.isParentContextId(t,d))return o.set(s.graphNode.workflow.id,c),{allUpstreamComplete:!1,states:o}}}catch(e){l.e(e)}finally{l.f()}c.length>0&&o.set(s.graphNode.workflow.id,c)}}catch(e){r.e(e)}finally{r.f()}return{allUpstreamComplete:!0,states:o}}},{key:"runLocalWorkflows",value:function(e,t){var n,o,a,s=this,c=arguments.length>2&&void 0!==arguments[2]&&arguments[2],h=function(e,n,o){var a,c,h=t.getWorkflowItemStorage(),g=e.workflow,m=null===(a=s.executionTrackersByWorkflowNameBySession.get(t))||void 0===a?void 0:a.get(g.id),v=g.inputTypes.concat(g.kind===d.WorkflowKind.Join?g.collectionScopeType:[]),k=new p.Operation({operationName:"RunLocalWorkflows",success:!0,resourceId:g.id,joinContextId:n.contextId}).start();if(k.setClientMetadata(t.getClientMetadata()),f.SchemaObject.matchesTypesFor(n.body,v)){var T=(0,w.shallowCloneItemWithPath)(o.parentPath,n);if(g.kind===d.WorkflowKind.Join){if(f.SchemaObject.matchesTypesFor(T.body,[g.collectionScopeType]))return h.setScopeItem(T,g),k.resultDescription="Scope item: ".concat(n.id," (").concat(f.SchemaObject.getTypeNameFor(n.body),")"),p.Log.info(524126153,p.LogCategory.CoreDefault,k.stop()),void s.setScopeExecutionNotification(t,e,T,y.LocalWorkflowOrchestrationMode.Internal);m.removeProcessedInputItem(T.contextId);var S=h.getScopeItem(T.contextId,g);if(!S)return k.resultDescription="Filtered out join invalidation: out of scope type (".concat(g.collectionScopeType,"), item id: ").concat(T.id),void p.Log.info(541173894,p.LogCategory.CoreDefault,k.stop());h.addItemToWorkflowList(T,g),k.joinContextId=S.contextId,k.resultDescription="Input item: ".concat(n.id," (").concat(f.SchemaObject.getTypeNameFor(n.body),")")}if(f.SchemaObject.getBaseTypesFor(T.body).indexOf(f.ContextHolder.getTypeName())>=0){var b,C=[].concat((0,r.default)(T.parentPath),[T.id]),_=!0,x=u(null!==(c=g.outputTypes)&&void 0!==c?c:[]);try{for(x.s();!(b=x.n()).done;){var M=b.value;if(!t.getContextAnnotations(M,y.AnnotationSource.LocalWorkflow,C,g.id)){_=!1;break}}}catch(e){x.e(e)}finally{x.f()}if(_)return}!function o(){var r,a=t.resolveRequestedContexts(g),u=(0,i.default)(a,2),c=u[0],f=u[1];if(!c)return k.resultDescription="Required contexts are not ready for ".concat(g.id,". Retrying execution in ").concat(500," milliseconds..."),p.Log.info(545837259,p.LogCategory.CoreDefault,k.stop()),void setTimeout(o,500);if(g.kind===d.WorkflowKind.SingleItem)s.queueWorkflow({workflowInfo:e,scopeItem:T,inputItems:[T],requestedContexts:f,session:t,orchestrationMode:y.LocalWorkflowOrchestrationMode.Internal,triggerReason:l.InputReceived,onCompleteCallback:s.onWorkflowExecuted.bind(s,T,g,t)}).then((function(){p.Log.info(509154263,p.LogCategory.WorkflowDefault,k.stop())})).catch((function(e){k.resultDescription=e,p.Log.error(572838111,p.LogCategory.CoreDefault,k.stop())}));else if(g.kind===d.WorkflowKind.Join){var v=n.contextId,S=h.getScopeItem(v,e.workflow);if(!S)return k.resultDescription="No scope item for ".concat(g.id," workflow from contextId ").concat(v),void p.Log.info(526758475,p.LogCategory.CoreDefault,k.stop());var b=s.isReadyToEarlyJoin(m,S.contextId,t.getClientMetadata()),w=b?l.JoinEarlyCompletion:l.JoinMaxAnnnotation;if(h.isWorkflowReady(S.contextId,g)||b){if(!(null===(r=s.pendingScopeExecutionNotificationsByWorkflow.get(g.id))||void 0===r?void 0:r.get(S.contextId)))return k.resultDescription="Workflow ".concat(g.id,", contextId ").concat(S.contextId,", already queued, skipping new scope execution"),void p.Log.info(528048977,p.LogCategory.CoreDefault,k.stop());var C=h.getItemsToExecute(S.contextId,g);s.queueWorkflow({workflowInfo:e,scopeItem:S,inputItems:C,requestedContexts:f,session:t,orchestrationMode:y.LocalWorkflowOrchestrationMode.Internal,triggerReason:w,onCompleteCallback:s.onWorkflowExecuted.bind(s,S,g,t)}).then((function(){p.Log.info(509154262,p.LogCategory.WorkflowDefault,k.stop())})).catch((function(e){k.resultDescription=e,p.Log.error(541173895,p.LogCategory.CoreDefault,k.stop())})),s.pendingScopeExecutionNotificationsByWorkflow.get(g.id).delete(S.contextId),0===s.pendingScopeExecutionNotificationsByWorkflow.get(g.id).size&&s.pendingScopeExecutionNotificationsByWorkflow.delete(g.id)}}}()}},g=e;c&&(g=[new f.AddOperation({parentPath:["session"],items:[{id:"#userContext#",body:new f.UserContextHolder}]}),new f.AddOperation({parentPath:["session"],items:[{id:"#tenantContext#",body:new f.TenantContextHolder}]})],t.getContextIdManager().applyContextIdOnOperations(g),g=g.concat(e));var m,v=u(g);try{for(v.s();!(m=v.n()).done;){var k,T=m.value,S=f.SchemaObject.getTypeNameFor(T),b=u(T.items);try{for(b.s();!(k=b.n()).done;){var C=k.value;if(t.applyOperationForContext(T,C,y.AnnotationSource.Submitted),S!==f.DeleteOperation.getTypeName()){if(C.body)if(S===f.DeltaUpdateOperation.getTypeName()&&this.deltaHandlers&&this.deltaItems)this.handleLocalDeltaUpdate(C,T,t);else{null===(o=this.deltaItems)||void 0===o||o.set(T.parentPath.concat(C.id).toString(),C.body);var _,x=u(this.workflowsWithoutSessionAffinity);try{for(x.s();!(_=x.n()).done;){var M=_.value;h(M,C,T)}}catch(e){x.e(e)}finally{x.f()}var A,O=u(null!==(a=this.workflowsWithSessionAffinity.get(t))&&void 0!==a?a:[]);try{for(O.s();!(A=O.n()).done;){var I=A.value;h(I,C,T)}}catch(e){O.e(e)}finally{O.f()}}}else null===(n=this.deltaItems)||void 0===n||n.delete(T.parentPath.concat(C.id).toString())}}catch(e){b.e(e)}finally{b.f()}}}catch(e){v.e(e)}finally{v.f()}}},{key:"handleLocalDeltaUpdate",value:function(e,t,n){var o=new p.Operation({operationName:"LocalDeltaUpdate",dimension0:f.SchemaObject.getTypeNameFor(e.body),success:!0});o.start();try{var r=this.deltaHandlers.get(f.SchemaObject.getTypeNameFor(e.body)),i=this.deltaItems.get(t.parentPath.toString());if(r&&i){var a=r(e.body,i);if(a){var s={id:e.id,revId:e.revId,body:a,parentPath:t.parentPath,delta:e.body,contextId:e.contextId},u=new f.Operation({parentPath:s.parentPath,items:[s]});p.Log.info(539637591,p.LogCategory.CoreDefault,o.stop()),this.runLocalWorkflows([u],n)}else o.success=!1,o.resultDescription="Failed because the handler did not produce valid updated item",p.Log.info(539637592,p.LogCategory.CoreDefault,o.stop())}else o.success=!1,o.resultDescription="Failed due to lack of handler or parent item",p.Log.info(539637593,p.LogCategory.CoreDefault,o.stop())}catch(e){o.success=!1,o.resultDescription="Failed to apply delta, error: ".concat(e),p.Log.info(539637594,p.LogCategory.CoreDefault,o.stop())}}},{key:"createWorkflowImplementation",value:function(e,t){var n=e.factory();return{workflow:e,workflowLambda:n,initPromise:this.initWorkflow(e.kind,n,t)}}},{key:"initWorkflow",value:function(e,t,n){var o,r=new T.LocalWorkflowContext({model:void 0,clientMetadata:n?n.getClientMetadata():void 0,userContext:n?n.getUserContext():void 0,site:this.site,getTokenCallback:null===(o=this.getAuthTokenCallback)||void 0===o?void 0:o.bind(this)});return e===d.WorkflowKind.SingleItem||e===d.WorkflowKind.Join?t.init(this.site,r):Promise.resolve()}},{key:"queueWorkflow",value:function(e){var t,n,o=this,r=e.session.getClientMetadata(),i=void 0;return r&&"outlook"==(null===(t=r.appName)||void 0===t?void 0:t.toLowerCase())&&"web"==(null===(n=r.appPlatform)||void 0===n?void 0:n.toLowerCase())&&"Production"!=r.releaseAudienceGroup&&(i=new p.Operation({operationName:"QueueLocalWorkflows",success:!0,resourceId:e.workflowInfo.workflow.id,joinContextId:e.scopeItem.contextId,dimension0:e.triggerReason}).start().setClientMetadata(r)),i&&p.Log.info(509154261,p.LogCategory.CoreDefault,i.stop()),this.executionTrackersByWorkflowNameBySession.get(e.session).get(e.workflowInfo.workflow.id).setExecutionState(e.scopeItem.contextId,k.ExecutionState.Running),this.executeLocalWorkflow(e.workflowInfo,e.scopeItem,e.inputItems,e.session,e.requestedContexts,e.orchestrationMode,e.triggerReason).then((function(t){o.processAnnotationResults(t,e.session),e.onCompleteCallback()})).catch((function(t){throw e.onCompleteCallback(),t}))}},{key:"processAnnotationResults",value:function(e,t){var n,o=u(e);try{for(o.s();!(n=o.n()).done;){var r=n.value;t.onAnnotationResults(r,y.AnnotationSource.LocalWorkflow,(function(){}))}}catch(e){o.e(e)}finally{o.f()}}},{key:"executeLocalWorkflow",value:function(t,n,o,r,i,a,s){var c=this;return new Promise((function(l,v){var k,S,b,w=[],C=t.workflow,_=new p.Operation({operationName:"ExecuteWorkflow",resourceId:C.id,joinContextId:null!==(k=null==n?void 0:n.contextId)&&void 0!==k?k:"",resultDescription:null!=s?s:"",success:!0}).setClientMetadata(r.getClientMetadata());_.start();var x=null!==(S=null==n?void 0:n.contextId)&&void 0!==S?S:o[0].contextId,M=null!==(b=null==n?void 0:n.revId)&&void 0!==b?b:o[0].revId,A=function(){var e=new Map;if(n&&(n.parentPath||p.Log.error(525382231,p.LogCategory.CoreDefault,"Missing scope item parent. Workflow: ".concat(C.id,". Type: ").concat(f.SchemaObject.getTypeNameFor(n.body))),e.set(n.body,n)),Array.isArray(o)){var t,r=u(o);try{for(r.s();!(t=r.n()).done;){var i=t.value;i&&i.body&&(i.parentPath||p.Log.error(525382232,p.LogCategory.CoreDefault,"Missing parent. Workflow: ".concat(C.id,". Type: ").concat(f.SchemaObject.getTypeNameFor(i.body))),e.set(i.body,i))}}catch(e){r.e(e)}finally{r.f()}}return e}(),O=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_;if(e)return t.success=!1,t.resultDescription+="string"==typeof e?e:e.message,t.resultSignature="Exception",p.Log.error(572838112,p.LogCategory.CoreDefault,t.stop()),"string"==typeof e?new Error(e):e;p.Log.info(572838113,p.LogCategory.CoreDefault,t.stop())},I=new T.LocalWorkflowContext({model:new m.WorkflowModel(o[0],i),clientMetadata:r.getClientMetadata(),userContext:r.getUserContext(),site:c.site,getTokenCallback:c.getAuthTokenCallback.bind(c)}),L=function(e){O(e?e.message:void 0),e?v(e):l(w)},D={setAnnotations:function(e,i,s,l){var g,m=new p.Operation({operationName:"SetAnnotations",resourceId:i,joinContextId:null!==(g=null==n?void 0:n.contextId)&&void 0!==g?g:"",success:!0}).setClientMetadata(r.getClientMetadata());m.start();var k,T=function(e){p.Log.info(555866112,p.LogCategory.CoreDefault,new p.AnnotationMetaDataChange({annotationType:i,annotationState:e,workflowId:t.workflow.id}))},S=u(s);try{for(S.s();!(k=S.n()).done;){var b=k.value;b.metadata=Object.assign(Object.assign({},b.metadata),{state:f.AnnotationState.Created}),T(f.AnnotationState.Created)}}catch(e){S.e(e)}finally{S.f()}var _=A.get(e),I=f.SchemaObject.getTypeNameFor(_.body),L=function(){var t,n,g;if(C.kind===d.WorkflowKind.SingleItem&&o[0].body!==e){var k="Expected obj to be ".concat(o[0].body," but instead it was ").concat(e);return O(k,m),void v(O(k))}if(Array.isArray(s))if(!C.outputTypes||C.outputTypes.indexOf(i)<0)n="Workflow said it would output one of [".concat(C.outputTypes,"] but instead output ").concat(i);else if(_){var S,b=u(s);try{for(b.s();!(S=b.n()).done;){var w=S.value;f.SchemaObject.matchesTypesFor(w,[f.Annotation.getTypeName()])?f.SchemaObject.getTypeNameFor(w)!==i&&(n="Workflow produced inconsistent annotation types in setAnnotations call (".concat(f.SchemaObject.getTypeNameFor(w)," did not match expected ").concat(i,")")):n="Workflow produced an output that is not an annotation ".concat(f.SchemaObject.getTypeNameFor(w))}}catch(k){b.e(k)}finally{b.f()}}else n="No item provided";else n="Workflow produced an invalid annotation array";if(n)return O(n,m),void v(O(n));if(g=l&&l.isSessionAnnotation?["session"]:l&&l.ancestorType?_.parentPath:_.parentPath.concat(_.id),a!==y.LocalWorkflowOrchestrationMode.External){var A,I=[],L=[],D=u(s);try{var E=function(){var e=A.value;e.metadata=Object.assign(Object.assign({},e.metadata),{state:f.AnnotationState.Sent}),T(f.AnnotationState.Sent);var n=e.id,o=n?null===(t=r.getContextAnnotations(i,y.AnnotationSource.LocalWorkflow,g,C.id))||void 0===t?void 0:t.filter((function(e){var t;return(null===(t=e.body)||void 0===t?void 0:t.id)==n})):void 0;1==(null==o?void 0:o.length)?1==o.length?L.push({id:o[0].id,source:C.id,revId:M,body:e,contextId:x}):p.Log.error(545837260,p.LogCategory.CoreDefault,"Assert: Multiple existing context annotations with body id ".concat(n," found for ").concat(i," and local workflow ").concat(C.id,").")):I.push({id:c.getNextClientAnnotationId(),source:C.id,revId:M,body:e,contextId:x})};for(D.s();!(A=D.n()).done;)E()}catch(k){D.e(k)}finally{D.f()}var P=[];return I.length>0&&P.push(new f.AddOperation({parentPath:g,items:I,parentRevId:M})),L.length>0&&P.push(new f.UpdateOperation({parentPath:g,items:L,parentRevId:M})),new h.AnnotationResultsMessage({annotationType:i,ops:P})}}();L?(l&&l.immediate?r.onAnnotationResults(L,y.AnnotationSource.LocalWorkflow,(function(){})):w.push(L),(I==f.UserContextHolder.getTypeName()||I==f.TenantContextHolder.getTypeName()||f.SchemaObject.matchesTypesFor(_.body,[f.Document.getTypeName(),f.SubDocument.getTypeName()]))&&r.submitOperationsToSession(L.ops),p.Log.info(509644822,p.LogCategory.CoreDefault,m.stop())):p.Log.info(509644823,p.LogCategory.CoreDefault,m.stop())},submitSignals:function(t){if(a!==y.LocalWorkflowOrchestrationMode.External){var n,o=new p.Operation({operationName:"submitSignalsAction",resourceId:C.id,success:!0}).setClientMetadata(r.getClientMetadata()),i=u(t);try{for(i.s();!(n=i.n()).done;){var s=n.value,l=f.SchemaObject.getTypeNameFor(s);f.SchemaObject.matchesTypesFor(s,[f.Signal.getTypeName()])||(o.resultDescription="Workflow produced an output that is not an signal (".concat(f.SchemaObject.getTypeNameFor(s),")"),p.Log.info(521413954,p.LogCategory.CoreDefault,o)),C.outputTypes&&-1!==C.outputTypes.indexOf(l)||(o.resultDescription="Workflow said it would output one of [".concat(C.outputTypes,"] but instead output ").concat(l),p.Log.info(521413953,p.LogCategory.CoreDefault,o)),s.timestamp&&(e.logTimestampUsageByWorkflowId.has(C.id)||(e.logTimestampUsageByWorkflowId.add(C.id),o.resultDescription='Workflow "'.concat(C.id,'" sets signal.timeStamp'),p.Log.info(509212803,p.LogCategory.CoreDefault,o)))}}catch(e){i.e(e)}finally{i.f()}var d=t.map((function(e){return{id:c.getNextClientSignalId(),source:C.id,revId:M,body:e,contextId:x}})),h=new f.SignalOperation({parentPath:["session"],parentRevId:M,items:d});r.submitOperations([h])}else v(O("NYI"))},done:L,overrideWorkflowDefinition:function(e,t,o){var i;switch(o){case d.WorkflowDefinitionScope.JoinContext:if(!n.contextId){var a="ContextId is not defined for this scope item.";throw p.Log.error(527472289,p.LogCategory.CoreDefault,a),new Error(a)}i=n.contextId;break;case d.WorkflowDefinitionScope.Session:i=void 0;break;default:var s="Defined scope is not supported. "+o;throw p.Log.error(527472290,p.LogCategory.CoreDefault,s),new Error(s)}var u=new g.WorkflowDefinitionOverrideMessage({definition:t,contextId:i,sourceWorkflowId:C.id,targetWorkflowId:e});r.onWorkflowDefinitionOverrideMessage(u)},getDynamicAnnotations:void 0},E=t.workflowLambda;if(C.kind===d.WorkflowKind.SingleItem){1!==o.length&&L(new Error("Single item workflows expect a single input")),I.delta=o[0].delta,I.deltas=o[0].deltas;try{var P=E;t.initPromise||(t.initPromise=P.init(c.site,I)),t.initPromise.then((function(){P.execute(o[0].body,I,D)})).catch((function(e){O(e)}))}catch(e){O(e)}}else if(C.kind===d.WorkflowKind.Join){0===o.length&&L(new Error("Join workflows expect an inputs array")),I.delta=n.delta,I.deltas=n.deltas;try{var R=E;t.initPromise||(t.initPromise=R.init(c.site,I)),t.initPromise.then((function(){R.execute(n.body,o.map((function(e){return e.body})),I,D)})).catch((function(e){O(e)}))}catch(e){O(e)}}else O("Workflow kind ".concat(C.kind," not supported"))}))}},{key:"ensureSweepTimer",value:function(e){if(!this.sweepTimers.get(e)){var t=setInterval(this.onSweep.bind(this),this.sweepIntervalMs);this.sweepTimers.set(e,t)}}},{key:"cancelSweepTimer",value:function(e){var t=this.sweepTimers.get(e);this.sweepTimers.get(e)&&(clearInterval(t),this.sweepTimers.delete(e))}},{key:"onSweep",value:function(){this.sweepScopeExecutionNotifications()}},{key:"setScopeExecutionNotification",value:function(e,t,n,o){var r,i,a=Date.now(),s={session:e,workflowImplementation:t,scopeItem:n,startTime:a,minTime:a+(0,v.getSafeNumber)(t.workflow.minDelayMs,1e3),maxTime:a+(0,v.getSafeNumber)(t.workflow.maxDelayMs,5e3),orchestrationMode:o},u=t.workflow.kind===d.WorkflowKind.Join?n.contextId:s.scopeItem.parentPath.concat(n.id).join("\\");if(this.pendingScopeExecutionNotificationsByWorkflow.get(t.workflow.id)||this.pendingScopeExecutionNotificationsByWorkflow.set(t.workflow.id,new Map),this.pendingScopeExecutionNotificationsByWorkflow.get(t.workflow.id).get(u)){var c=new p.Operation({resultDescription:"Duplicated pending scope execution for ".concat(t.workflow.id," at ").concat(u),operationName:"LocalScopeExecutionNotification",resourceId:t.workflow.id,joinContextId:null!==(i=null==n?void 0:n.contextId)&&void 0!==i?i:"",success:!0}).setClientMetadata(e.getClientMetadata()).start();p.Log.info(509727899,p.LogCategory.CoreDefault,c.stop())}else{var l=new p.Operation({resultDescription:"New pending scope execution for ".concat(t.workflow.id," at ").concat(u),operationName:"LocalScopeExecutionNotification",resourceId:t.workflow.id,joinContextId:null!==(r=null==n?void 0:n.contextId)&&void 0!==r?r:"",success:!0}).setClientMetadata(e.getClientMetadata()).start();p.Log.info(539883075,p.LogCategory.CoreDefault,l.stop()),this.pendingScopeExecutionNotificationsByWorkflow.get(t.workflow.id).set(u,s)}this.ensureSweepTimer(e)}},{key:"sweepScopeExecutionNotifications",value:function(){for(var e,t,n=this,o=new Set(Array.from(this.sweepTimers.keys())),r=0,a=Array.from(this.pendingScopeExecutionNotificationsByWorkflow.entries());r<a.length;r++)for(var s=(0,i.default)(a[r],2),u=s[0],c=s[1],f=function(){var r=(0,i.default)(g[h],2),a=r[0],s=r[1],c=s.session,f=s.workflowImplementation.workflow,y=s.orchestrationMode,m=c.getWorkflowItemStorage(),v=new p.Operation({operationName:"LocalScopeExecutionNotification",resourceId:f.id,joinContextId:null!==(t=null===(e=s.scopeItem)||void 0===e?void 0:e.contextId)&&void 0!==t?t:"",success:!0}).setClientMetadata(c.getClientMetadata()).start();!function(){var e=function(){if(f.kind===d.WorkflowKind.Join){var e=Date.now(),t=s.workflowImplementation.workflow,o=s.scopeItem.contextId,r=c.getWorkflowDefinition(t,o).maxDelayMs;return m.isWorkflowReady(o,t)?(v.resultDescription="Join Workflow: ".concat(t.id," queuing by maxAnnotation, contextId: ").concat(o),p.Log.info(528048978,p.LogCategory.CoreDefault,v.stop()),{isValid:!0,triggerReason:l.JoinMaxAnnnotation}):s.startTime+r<e?(v.resultDescription="Join Workflow: ".concat(t.id," queuing by maxTimeout, contextId: ").concat(o),p.Log.info(528048979,p.LogCategory.CoreDefault,v.stop()),{isValid:!0,triggerReason:l.JoinMaxTimeout}):n.isReadyToEarlyJoin(n.executionTrackersByWorkflowNameBySession.get(c).get(t.id),o,c.getClientMetadata())?(p.Log.info(512550856,p.LogCategory.CoreDefault,"Workflow: ".concat(t.id," queuing by early completion, contextId: ").concat(o,", timeout: ").concat(r)),{isValid:!0,triggerReason:l.JoinEarlyCompletion}):{isValid:!1,triggerReason:l.Unknown}}return{isValid:!0,triggerReason:l.Unknown}}(),t=e.isValid,o=e.triggerReason;if(!t)return!1;var r=c.resolveRequestedContexts(f),a=(0,i.default)(r,2),u=a[0],h=a[1];if(!u)return!1;try{if(f.kind===d.WorkflowKind.Join){var g=s.scopeItem.contextId,k=m.getScopeItem(g,f);if(k){var T=m.getItemsToExecute(k.contextId,f);if(0===T.length)return v.resultDescription="Failed to retrieve items for workflow: ".concat(f.id,", contextId: ").concat(g,", skipping execution"),p.Log.info(527472291,p.LogCategory.CoreDefault,v.stop()),n.onWorkflowExecuted(k,f,c),!0;n.queueWorkflow({workflowInfo:s.workflowImplementation,scopeItem:k,inputItems:T,requestedContexts:h,session:c,orchestrationMode:y,triggerReason:o,onCompleteCallback:n.onWorkflowExecuted.bind(n,k,f,c)}).catch((function(e){v.success=!1,v.resultDescription=e.message,p.Log.error(509092189,p.LogCategory.CoreDefault,v.stop())}))}else v.resultDescription="ContextId no longer exists, skipping workflow execution",p.Log.info(539883076,p.LogCategory.CoreDefault,v.stop())}else v.resultDescription="Workflow in type ".concat(f.kind," is not supported"),p.Log.error(539883077,p.LogCategory.CoreDefault,v.stop())}catch(e){v.resultDescription="Trying to execute ".concat(f.id," caused an exception: ").concat(e),p.Log.warn(539883078,p.LogCategory.CoreDefault,v.stop())}return!0}()?o.delete(c):(n.pendingScopeExecutionNotificationsByWorkflow.get(u).delete(a),0===n.pendingScopeExecutionNotificationsByWorkflow.get(u).size&&n.pendingScopeExecutionNotificationsByWorkflow.delete(u))},h=0,g=Array.from(c.entries());h<g.length;h++)f();if(0!==o.size)for(var y=0,m=Array.from(o);y<m.length;y++){var v=m[y],k=new p.Operation({resultDescription:"No pending scope notifications left, cancelling sweep timer",operationName:"LocalScopeExecutionNotification",success:!0}).start();p.Log.debug(539883079,p.LogCategory.CoreDefault,k.stop()),this.cancelSweepTimer(v)}}},{key:"onExternalWorkflowExecuted",value:function(e,t,n){var o={id:"",parentPath:[],contextId:e},r={id:t};this.onWorkflowExecuted(o,r,n,!1)}},{key:"onWorkflowExecuted",value:function(e,t,n){var o,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];null===(o=this.executionTrackersByWorkflowNameBySession.get(n).get(t.id))||void 0===o||o.afterWorkflowExecution(e.contextId),r&&t.kind===d.WorkflowKind.Join&&n.getWorkflowItemStorage().onWorkflowExecuted(e,t)}}]),e}();n.LocalWorkflowExecutionManager=_},{101:101,104:104,116:116,118:118,122:122,139:139,150:150,160:160,172:172,174:174,178:178,188:188,189:189,23:23,40:40,48:48,81:81,83:83,99:99}],83:[function(e,t,n){"use strict";var o=e(178),r=o(e(188)),i=o(e(172)),a=o(e(174));function s(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return u(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}Object.defineProperty(n,"__esModule",{value:!0}),n.WorkflowExecutionTracker=void 0;var c=e(40),l=e(48),f=function(){function e(t,n,o){(0,i.default)(this,e),this.itemsContextId=new Set,this.executionState=new Map,this.graphNode=t,this.onContextIdWorkflowExecutionComplete=n,o&&(this.itemsContextId=o.itemsContextId,this.executionState=o.executionState)}return(0,a.default)(e,[{key:"addInputItemToProcess",value:function(e){this.itemsContextId.add(e)}},{key:"removeProcessedInputItem",value:function(e){this.itemsContextId.delete(e)}},{key:"countItemsToProcess",value:function(e){var t,n=0,o=s(this.itemsContextId);try{for(o.s();!(t=o.n()).done;){0===t.value.indexOf(e)&&(n+=1)}}catch(e){o.e(e)}finally{o.f()}return n}},{key:"getExecutionState",value:function(){return this.executionState}},{key:"setExecutionState",value:function(e,t){return this.graphNode.isActivated?e?(this.executionState.set(e,t),!0):(c.Log.info(520217546,c.LogCategory.CoreDefault,new c.Operation({operationName:"WorkflowExecutionTracker",resourceId:this.graphNode.workflow.id,joinContextId:e,resultDescription:"Trying to set state ".concat(t," for a undefined contextId (setExecutionState)")})),!1):(c.Log.info(508883415,c.LogCategory.CoreDefault,new c.Operation({operationName:"WorkflowExecutionTracker",resourceId:this.graphNode.workflow.id,joinContextId:e,resultDescription:"Trying to set state ".concat(t," for a not activated workflow")})),!1)}},{key:"beforeWorkflowExecution",value:function(e){this.setExecutionState(e,l.ExecutionState.Pending)}},{key:"afterWorkflowExecution",value:function(e){this.setExecutionState(e,l.ExecutionState.Executed)&&this.tryToCompleteWorkflowExecution(e)}},{key:"clearWorkflowExecutions",value:function(){var e=this;this.executionState.forEach((function(t,n){return e.afterWorkflowExecution(n)}))}},{key:"tryToCompleteWorkflowExecution",value:function(e){if(this.executionState.get(e)===l.ExecutionState.Executed&&this.canCompleteExecution(e)){this.executionState.delete(e),this.onContextIdWorkflowExecutionComplete&&this.onContextIdWorkflowExecutionComplete(this.graphNode.workflow.id,e);var t,n=s(this.downstreamWorkflowExecutionTrackers);try{for(n.s();!(t=n.n()).done;){var o,i=t.value,a=s(i.getExecutionState());try{for(a.s();!(o=a.n()).done;){var u=(0,r.default)(o.value,2),c=u[0];u[1]===l.ExecutionState.Executed&&l.ContextIdManager.isParentContextId(e,c)&&i.tryToCompleteWorkflowExecution(c)}}catch(e){a.e(e)}finally{a.f()}}}catch(e){n.e(e)}finally{n.f()}}}},{key:"canCompleteExecution",value:function(e){var t,n=s(this.upstreamWorkflowExecutionTrackers);try{for(n.s();!(t=n.n()).done;){var o,r=s(t.value.getExecutionState().keys());try{for(r.s();!(o=r.n()).done;){var i=o.value;if(l.ContextIdManager.isParentContextId(i,e))return!1}}catch(e){r.e(e)}finally{r.f()}}}catch(e){n.e(e)}finally{n.f()}return!0}}]),e}();n.WorkflowExecutionTracker=f},{172:172,174:174,178:178,188:188,40:40,48:48}],84:[function(e,t,n){"use strict";var o=e(178),r=o(e(172)),i=o(e(174)),a=o(e(177)),s=o(e(185)),u=o(e(176));function c(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=(0,u.default)(e);if(t){var r=(0,u.default)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return(0,s.default)(this,n)}}Object.defineProperty(n,"__esModule",{value:!0}),n.EmptySessionManager=void 0;var l=e(40),f=function(e){(0,a.default)(n,e);var t=c(n);function n(){return(0,r.default)(this,n),t.apply(this,arguments)}return(0,i.default)(n,[{key:"init",value:function(){return Promise.resolve()}},{key:"sendMessage",value:function(e,t,n){}},{key:"onMessage",value:function(e,t){}},{key:"forceReconnect",value:function(){return Promise.resolve()}},{key:"closeSession",value:function(){}},{key:"sendBytes",value:function(e){}},{key:"getCorrelationVector",value:function(){return new l.CorrelationVector}},{key:"setState",value:function(e){}}]),n}(e(198).EventEmitter);n.EmptySessionManager=f},{172:172,174:174,176:176,177:177,178:178,185:185,198:198,40:40}],85:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.createConnectionReliabilityManager=void 0;var o=e(95);n.createConnectionReliabilityManager=function(e,t,n){return new o.WebSocketReliabilityManager(e,t,n)}},{95:95}],86:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},{}],87:[function(e,t,n){"use strict";var o=e(178),r=o(e(174)),i=o(e(172));Object.defineProperty(n,"__esModule",{value:!0}),n.SessionStats=void 0;var a=(0,r.default)((function e(){(0,i.default)(this,e)}));n.SessionStats=a},{172:172,174:174,178:178}],88:[function(e,t,n){"use strict";var o=e(178),r=o(e(172)),i=o(e(174)),a=e("importDefaultHelper");Object.defineProperty(n,"__esModule",{value:!0}),n.MessageQueue=n.ClientSendMessageErrorReason=void 0;var s,u=e(122),c=e(139),l=a(e(197)),f=e(101),d=e(40);!function(e){e.ArrivedBeforeReseeding="Message is dropped from queue since it arrived before reseeding is started",e.DroppedAsOldestInQueue="Message is dropped as oldest in full queue",e.DroppedBecauseClientDisconnected="Message is dropped because client is disconnected from server"}(s=n.ClientSendMessageErrorReason||(n.ClientSendMessageErrorReason={}));var p=function(){function e(t){(0,r.default)(this,e),this.logOp=new d.Operation({operationName:"MessageQueue",success:!0}),this.messageQueueLogCountLimiter=new f.LogCountLimiter("MessageQueue"),this.queue=new l.default(1e3),this.callbacks=t}return(0,i.default)(e,[{key:"clear",value:function(){this.queue.clear()}},{key:"size",value:function(){return this.queue.length}},{key:"push",value:function(e,t,n){var o=this,r=this.queue;if(1e3===r.length){this.messageQueueLogCountLimiter.log((function(){o.logOp.resourceId="QueueFull",o.logOp.durationMs=0,d.Log.warn(508843746,d.LogCategory.CoreDefault,o.logOp)}));var i=r.shift();i.onResponse&&i.onResponse(new u.ErrorResponse({error:s.DroppedAsOldestInQueue}))}r.push({message:e,onResponse:t,timeQueued:f.Utils.getCurrentTimeMs(),attemptNumber:n})}},{key:"sendOnSessionInitialized",value:function(e){var t=this,n=this.queue.length,o=0;if(n>0){for(var r=f.Utils.getCurrentTimeMs()-this.queue.get(0).timeQueued;this.queue.length>0&&this.callbacks.canSendMessage();){var i=this.queue.shift();e&&i.message instanceof u.SyncMessage&&c.SchemaObject.matchesTypesFor(i.message,[u.SyncMessage.getTypeName()])&&(!this.callbacks.dropOnlySequencedSyncsOnReseed||i.message.seq>=0)?(o++,i.onResponse&&i.onResponse(new u.ErrorResponse({error:s.ArrivedBeforeReseeding}))):i.message instanceof Uint8Array?this.callbacks.sendBytes(i.message):this.callbacks.sendMessage(i.message,i.onResponse,i.attemptNumber)}this.messageQueueLogCountLimiter.log((function(){t.logOp.resourceId="SendOnSessionInitialized",t.logOp.resultDescription="Queue size before: ".concat(n,", after: ").concat(t.queue.length,". droppedSyncMessages: ").concat(o),t.logOp.durationMs=r,d.Log.warn(508843745,d.LogCategory.CoreDefault,t.logOp)}))}}}]),e}();n.MessageQueue=p},{101:101,122:122,139:139,172:172,174:174,178:178,197:197,40:40}],89:[function(e,t,n){"use strict";var o=e(178),r=o(e(172)),i=o(e(174));Object.defineProperty(n,"__esModule",{value:!0}),n.NetworkRateController=void 0;var a=e(40),s=e(101),u=e(85),c=function(){function e(t,n){var o,i,u,c,l,f=this;(0,r.default)(this,e),this.logCountLimiter=new s.LogCountLimiter(e.className),this.emptyMessageId=0,this.egressMessageCount=0,this.egressByteCount=0,this.prevSeq=-1,this.pendingQueue=[],this.egressBytesTotal=0,this.egressRateLogOp=new a.Operation({operationName:"NetworkEgressRate",success:!0}),this.egressLogOp=new a.Operation({operationName:"NetworkEgressControl",success:!0}).start(),this.egressedCache=new Map,this.rpsThreshold=null!==(o=null==t?void 0:t.rpsThreshold)&&void 0!==o?o:150,this.bpsThreshold=null!==(i=null==t?void 0:t.bpsThreshold)&&void 0!==i?i:5e8,this.pendingMaxSize=null!==(u=null==t?void 0:t.pendingMaxSize)&&void 0!==u?u:1e4,this.egressedMaxSize=null!==(c=null==t?void 0:t.egressedMaxSize)&&void 0!==c?c:1e4,this.egressedBytesMaxSize=null!==(l=null==t?void 0:t.egressedBytesMaxSize)&&void 0!==l?l:1e7,this.closeWorkerOnReliabilityFailureEnabled=null==n||n,this.initPromise=new Promise((function(e){f.resolveInitPromise=e}))}return(0,i.default)(e,[{key:"init",value:function(e,t,n,o){var r=this;this.worker=e,this.ingress=t,this.clientMetadata=o,this.egressRateControlTimer=setInterval((function(){return r.flush()}),1e3),this.networkMode=n,this.reliabilityManager=(0,u.createConnectionReliabilityManager)(this.worker,this.close.bind(this),this.closeWorkerOnReliabilityFailureEnabled),this.resolveInitPromise()}},{key:"open",value:function(){var e=this;this.initPromise.then((function(){e.reliabilityManager?(e.collectTelemetry(!0,"OnOpen"),e.egressRateControlIntervalStart=Date.now(),e.reliabilityManager.start(),e.flush()):e.collectTelemetry(!1,"OnOpenFailure","Reliability Manager is undefined")})).catch((function(t){e.collectTelemetry(!1,"OnOpenFailure",t)}))}},{key:"ingressFromWorker",value:function(e,t){var n=this;this.reliabilityManager?this.reliabilityManager.isReliabilityResponse(e)?this.reliabilityManager.onResponse(e):this.ingress(e,(function(e){null==t||t(e),n.updateEgressedCache(e)})):this.collectTelemetry(!1,"ingressFromWorkerFailure","Reliability Manager is undefined")}},{key:"close",value:function(){var e;this.collectTelemetry(!0,"OnClose"),null===(e=this.reliabilityManager)||void 0===e||e.close(),this.worker=void 0,this.prevSeq=-1,this.clearEgressControlTimeout(),this.reliabilityManager=void 0}},{key:"clearMessageQueues",value:function(){this.pendingQueue=[],this.egressedCache.clear()}},{key:"egress",value:function(e){var t;if(this.reliabilityManager)if((e.obj instanceof ArrayBuffer||e.isHttpSessionInitMessage)&&this.worker)this.worker.egress(e);else{this.validateSyncMessage(e.messageId,e.seqId);var n=this.egressMessageCount>=this.rpsThreshold||this.egressByteCount>=this.bpsThreshold,o=this.egressBytesTotal>this.egressedBytesMaxSize||this.pendingQueue.length>this.pendingMaxSize||this.egressedCache.size>this.egressedMaxSize,r=this.reliabilityManager.checkConnection(),i=0==this.pendingQueue.length;if(r&&!n&&i&&!o)this.sendToNetworkWorker(e);else{var a="";a+=this.pendingQueue.length>=this.pendingMaxSize?"Pending queue max exceeded. ":i?"":"Pending queue not empty",a+=this.egressedCache.size>=this.egressedMaxSize?"Egressed cache max exceeded. ":"",a+=this.egressBytesTotal>this.egressedBytesMaxSize?"Egressed bytes max exceeded. ":"",a+=this.egressMessageCount>=this.rpsThreshold?"RPS exceeded. ":"",a+=this.egressByteCount>=this.bpsThreshold?"BPS exceeded. ":"",a+=r?"":"Not connected";var s="pendingQueueSize: ".concat(this.pendingQueue.length," | egressedCacheSize: ").concat(this.egressedCache.size," | egressedBytesTotal: ").concat(this.egressBytesTotal," | rpsThreshold: ").concat(this.rpsThreshold," | bpsThreshold: ").concat(this.bpsThreshold);this.collectTelemetry(!0,a,s);var u=null!==(t=e.messageId)&&void 0!==t?t:"id".concat(this.emptyMessageId++);this.pendingQueue.push({obj:e.obj,seqId:null==e?void 0:e.seqId,messageId:u,isHttpSessionInitMessage:null==e?void 0:e.isHttpSessionInitMessage})}}else this.collectTelemetry(!1,"EgressFailure","Reliability Manager is undefined")}},{key:"sendToNetworkWorker",value:function(e){try{if(!this.worker)return void this.collectTelemetry(!1,"SendToNetworkWorkerFailure","NetworkWorker is undefined");if(!this.reliabilityManager)return void this.collectTelemetry(!1,"SendToNetworkWorkerFailure","Reliability Manager is undefined");this.worker.egress(e),this.reliabilityManager.postEgress();var t=e.obj instanceof ArrayBuffer?e.obj.byteLength:e.obj.length;this.logEgressCount(t),e.messageId&&e.messageId.startsWith("c")&&(this.egressBytesTotal+=t,this.egressedCache.set(e.messageId,t))}catch(e){this.collectTelemetry(!1,"sendToWorker",e?e.message:"")}}},{key:"flush",value:function(){if(this.reliabilityManager)for(;this.pendingQueue.length>0&&this.pendingQueue.length<this.pendingMaxSize&&this.egressedCache.size<this.egressedMaxSize&&this.egressMessageCount<this.rpsThreshold&&this.egressByteCount<this.bpsThreshold&&this.egressBytesTotal<this.egressedBytesMaxSize&&this.reliabilityManager.checkConnection();){var e=this.pendingQueue.shift();this.sendToNetworkWorker(e)}else this.collectTelemetry(!1,"FlushFailure","Reliability Manager is undefined")}},{key:"clearEgressControlTimeout",value:function(){this.egressRateControlTimer&&(clearInterval(this.egressRateControlTimer),this.egressRateControlTimer=void 0)}},{key:"validateSyncMessage",value:function(e,t){void 0===t||void 0===e||t<=this.prevSeq||(t&&t!==this.prevSeq+1&&this.collectTelemetry(!0,"abandonedSyncMessage","Gap in sync message",["".concat(this.prevSeq),"".concat(t),"".concat(t-this.prevSeq)]),this.prevSeq=t)}},{key:"updateEgressedCache",value:function(e){e.messageId&&this.egressedCache.has(e.messageId)&&(this.egressBytesTotal-=this.egressedCache.get(e.messageId),this.egressedCache.delete(e.messageId))}},{key:"logEgressCount",value:function(e){var t,n=Date.now();n-this.egressRateControlIntervalStart>1e3&&((this.egressMessageCount>50||this.egressByteCount>1e5)&&(this.egressRateLogOp.start(),this.egressRateLogOp.resultDescription=this.egressMessageCount>50?"rps limit exceeded":"",this.egressRateLogOp.resultDescription=this.egressByteCount>1e5?"bps limit exceeded":"",this.egressRateLogOp.dimension0=(n-this.egressRateControlIntervalStart).toString(),this.egressRateLogOp.dimension1="".concat(this.egressMessageCount),this.egressRateLogOp.dimension2="".concat(this.egressByteCount),this.egressRateLogOp.dimension3="networkMode: ".concat(this.networkMode),a.Log.info(508843792,a.LogCategory.CoreDefault,this.egressRateLogOp.stop())),"Production"!==(null===(t=this.clientMetadata)||void 0===t?void 0:t.releaseAudienceGroup)&&this.collectTelemetry(!0,"networkMode: ".concat(this.networkMode),"egress",["".concat(0===this.pendingQueue.length?"0":this.pendingQueue.length.toString().length),"".concat(0===this.egressedCache.size?"0":this.egressedCache.size.toString().length),"".concat(0===this.egressBytesTotal?"0":this.egressBytesTotal.toString().length),"".concat(this.rpsThreshold," | ").concat(this.bpsThreshold)]),this.egressRateControlIntervalStart=n,this.egressMessageCount=0,this.egressByteCount=0),this.egressMessageCount++,this.egressByteCount+=null!=e?e:0}},{key:"collectTelemetry",value:function(e,t,n,o){var r=new Array(4).fill("");if(o)for(var i=0;i<o.length;i++)r[i]=o[i];r[3]=r[3]?r[3]:"networkMode: ".concat(this.networkMode),s.Utils.collectTelemetry(this.egressLogOp,this.logCountLimiter,e,n,t,r)}}]),e}();n.NetworkRateController=c,c.className="NetworkRateController"},{101:101,172:172,174:174,178:178,40:40,85:85}],90:[function(e,t,n){"use strict";var o=e(178),r=o(e(175)),i=o(e(172)),a=o(e(174)),s=o(e(170)),u=o(e(177)),c=o(e(185)),l=o(e(176));function f(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return d(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return d(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function p(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=(0,l.default)(e);if(t){var r=(0,l.default)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return(0,c.default)(this,n)}}Object.defineProperty(n,"__esModule",{value:!0}),n.NetworkSessionManager=void 0;var h=e(40),g=e(122),y=e(139),m=e(198),v=e(101),k=e(88),T=e(93),S=e(91),b=e(118),w=function(e){(0,u.default)(n,e);var t=p(n);function n(e,o,a,u,c,l,f,d,p){var y,m;return(0,i.default)(this,n),(m=t.call(this)).cvParent=new h.CorrelationVector,m.logOp=new h.Operation({operationName:"SessionState",success:!0}).start(),m.sessionStateChangeLogCountLimiter=new v.LogCountLimiter("SessionState"),m.stats=o,m.allStates=(y={},(0,r.default)(y,T.SessionState.Initing,new T.InitingState((0,s.default)(m))),(0,r.default)(y,T.SessionState.Running,new T.RunningState((0,s.default)(m))),(0,r.default)(y,T.SessionState.Disconnected,new T.DisconnectedState((0,s.default)(m))),(0,r.default)(y,T.SessionState.Closed,new T.ClosedState((0,s.default)(m))),y),m.setState(T.SessionState.Initing),m.improvedWebSocketEnabled=f.improvedWebSocketEnabled,m.messageEndpoint=new g.MessageEndpoint("c"),m.messageEndpoint.setClientMetadata(c),m.messageEndpoint.setEgress(m.egress.bind((0,s.default)(m))),m.messageEndpoint.onMessage(g.SessionCloseMessage.getTypeName(),(function(e,t){m.onSessionCloseMessage(e,t)})),m.networkWorkerManager=new S.NetworkWorkerManager(e,c,a,u,m.ingress.bind((0,s.default)(m)),m.onConnectionClose.bind((0,s.default)(m)),(function(){m.onSessionClose(void 0,"WSNotSupported")}),f,d,p),m.messageQueue=new k.MessageQueue({sendMessage:function(e,t,n,o){return m.state.sendMessage(e,t,n,o)},sendBytes:m.sendBytes.bind((0,s.default)(m)),canSendMessage:function(){return m.state.canSendMessage()},dropOnlySequencedSyncsOnReseed:f.dropOnlySequencedSyncsOnReseedEnabled}),u.on("connect",(function(e,t,n,o,r,i,a){m.setState(T.SessionState.Running,"",{isSessionReseedingStarted:e&&t}),m.emit("connect",e,n,o,r,i,a)})),u.on("reconnect",(function(){return m.emit("reconnect")})),u.on("serverAuthenticationStateChange",(function(e){return m.emit("serverAuthenticationStateChange",e)})),m.resetNextSyncSequenceId=function(){return m.emit("resetNextSyncSequenceId")},m.tokenRefreshManager=l,m}return(0,a.default)(n,[{key:"setState",value:function(e,t,n){var o=this;if(!this.state||e!==this.state.stateName){var r=this.state?T.SessionState[this.state.stateName]:"undefined",i=this.state?this.state.possibleNextStates.indexOf(e)>=0:e===T.SessionState.Initing;this.sessionStateChangeLogCountLimiter.log((function(){o.logOp.stop(),o.logOp.resourceId="New state: ".concat(i?T.SessionState[e]:r),o.logOp.resultDescription="Previous state: ".concat(r),o.logOp.dimension0="Attempted state: ".concat(T.SessionState[e]||"undefined"),o.logOp.resultSignature=t+(o.state&&!i?"Unexpected state change":""),o.logOp.success=i,h.Log.info(508843791,h.LogCategory.CoreDefault,o.logOp)})),i&&(this.state=this.allStates[e],this.logOp.start(),this.state.onEnter(n))}}},{key:"init",value:function(e,t){return this.extensionConfigs=e,this.customInitPromise=t,this.networkWorkerManager.init(this.extensionConfigs,this.customInitPromise,!0)}},{key:"sendMessage",value:function(e,t,o){this.retrySendMessage(e,t,n.maxRetries,o)}},{key:"sendBytes",value:function(e){this.state.sendBytes(e)}},{key:"onMessage",value:function(e,t){this.messageEndpoint.onMessage(e,t)}},{key:"getCorrelationVector",value:function(){return this.cvParent}},{key:"forceReconnect",value:function(e){var t=this;return this.extensionConfigs=e||this.extensionConfigs,this.networkWorkerManager.close(!1),new Promise((function(e){return setTimeout((function(){e(t.networkWorkerManager.init(t.extensionConfigs))}),100)}))}},{key:"closeSession",value:function(){this.sendMessage(new g.SessionCloseMessage),this.networkWorkerManager.close(!0),this.onSessionClose(void 0,"ClientRequested")}},{key:"ingress",value:function(e,t){var n,o=this;try{n=JSON.parse(e)}catch(e){h.Log.error(508843790,h.LogCategory.CoreDefault,new h.SessionHealthEvent({sessionHealthEventName:"ProcessMessage",resourceId:"Unknown",success:!1,resultSignature:"ParseError",resultDescription:e.message,durationMs:0,source:h.SessionHealthSource.ClientRuntime,reason:h.SessionHealthReason.Client,impact:h.SessionHealthImpact.MissingOutput,affectedWorkflows:["All"],message:""}))}if(n){if(this.improvedWebSocketEnabled&&t&&g.Response.typeGuard(n)&&t(n),this.networkWorkerManager.getNetworkMode()===b.NetworkMode.HttpFallback&&g.SessionLongPollResponse.typeGuard(n)){var r=n;if(r.batch){var i,a=f(r.batch);try{for(a.s();!(i=a.n()).done;){var s=i.value;this.messageEndpoint.ingress(s,(function(e,t){return o.egress(e||t,(function(){}))}))}}catch(e){a.e(e)}finally{a.f()}}return}this.messageEndpoint.ingress(n,(function(e,t){return o.egress(e||t,(function(){}))}))}}},{key:"egress",value:function(e,t){e&&this.networkWorkerManager.egress(e).then((function(){return t()})).catch((function(e){return t(e)}))}},{key:"onSessionCloseMessage",value:function(e,t){e.reconnectAllowed?this.networkWorkerManager.close():this.onSessionClose(e,"CloseMessageReceived"),t()}},{key:"onSessionClose",value:function(e,t){this.setState(T.SessionState.Closed,t),this.tokenRefreshManager.clearAllTimeouts(),this.onConnectionClose(void 0),e&&this.emit("sessionClose",e)}},{key:"onConnectionClose",value:function(e){this.state.onConnectionClose(),this.stats.lastConnectionClose=v.Utils.getCurrentTimeMs(),this.emit("disconnect",e)}},{key:"retrySendMessage",value:function(e,t,o,r){var i=this,a=n.maxRetries-o;this.state.sendMessage(e,(function(n,a){n&&o>0&&i.canBeRetried(e)&&i.isTransientError(n)?i.retrySendMessage(e,t,o-1,r):t&&t(n,a)}),a,r)}},{key:"canBeRetried",value:function(e){return!y.SchemaObject.matchesTypesFor(e,[g.SessionInitMessage.getTypeName(),g.MicroSyncMessage.getTypeName()])}},{key:"isTransientError",value:function(e){var t=e.error;return t!==g.SendMessageErrorReason.SyncMessageUnsupportedBatch&&t!==g.SendMessageErrorReason.UnexpectedSeedMessage&&t!==g.SendMessageErrorReason.UnsupportedSyncMessage&&t!==g.SendMessageErrorReason.AnnotationTokenNotFound&&t!==k.ClientSendMessageErrorReason.ArrivedBeforeReseeding&&t!==k.ClientSendMessageErrorReason.DroppedAsOldestInQueue&&t!==k.ClientSendMessageErrorReason.DroppedBecauseClientDisconnected}}]),n}(m.EventEmitter);n.NetworkSessionManager=w,w.maxRetries=2},{101:101,118:118,122:122,139:139,170:170,172:172,174:174,175:175,176:176,177:177,178:178,185:185,198:198,40:40,88:88,91:91,93:93}],91:[function(e,t,n){"use strict";var o=e(178),r=o(e(192)),i=o(e(172)),a=o(e(174));function s(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return u(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}Object.defineProperty(n,"__esModule",{value:!0}),n.NetworkWorkerManager=n.calculateTimeToWaitForNextTry=void 0;var c=e(139),l=e(122),f=e(40),d=e(101),p=e(37),h=e(77),g=e(89),y=e(118);n.calculateTimeToWaitForNextTry=function(e,t){var n=0,o=d.Utils.getCurrentTimeMs()?d.Utils.getCurrentTimeMs()-t:0,r=[1e3,2e3,5e3,1e4,6e4];return n=r[Math.max(0,Math.min(r.length-1,e-1))],n=Math.max(n-o,1e3)};var m=function(){function e(t,n,o,r,a,s,u,c,l,p){var g=this;(0,i.default)(this,e),this.logCountLimiter=new d.LogCountLimiter(e.className),this.isWorkerReady=!1,this.permanentlyClosed=!1,this.currentReconnectAttempt=0,this.lastInitializationAttemptTimeMs=0,this.offlineInterval=void 0,this.alreadyLoggedReconnectAttempt=!1,this.httpTestsLeft=5,this.httpTestsSuccessCount=0,this.wsOpenCount=0,this.testHttpConnection=function(e){var t=d.Utils.convertWebSocketUrlToHttp(g.globalUrl),n=!e,o=null!=e?e:new f.Operation({operationName:"HttpsTest",resourceId:t,success:!1,resultDescription:"",resultSignature:"HttpResponse:"}).start(),r={method:"POST",headers:{"content-type":"application/json","X-CorrelationId":o.cv},body:JSON.stringify(d.Utils.createHealthCheckRequest(g.clientMetadata))};(0,h.internalFetch)(t,r,(function(e,t){e?(o.dimension1="HttpErr",o.resultDescription+="HttpErr: ".concat(e.message)):t&&t.ok?(o.dimension1="HttpOK",g.leaveOfflineMode(),g.httpTestsSuccessCount++,n&&(o.success=!0)):(o.dimension1="HttpNoResp",o.resultDescription+="HttpStatus: ".concat(null==t?void 0:t.status)),n&&o.stop(),g.logCountLimiter.log((function(){f.Log.info(508843780,f.LogCategory.CoreDefault,o)}))}))},this.globalUrl=t,this.clientMetadata=n,this.workerFactory=o,this.sessionInitializer=r,this.ingress=a,this.onConnectionClose=s,this.onDetectedWSBlock=u,this.closeWSBlockedSession=c.closeWSBlockedSessionEnabled,this.sessionOfflineModeEnabled=c.sessionOfflineModeEnabled,this.improvedWebSocketEnabled=c.improvedWebSocketEnabled,this.closeWorkerOnReliabilityFailureEnabled=c.closeWorkerOnReliabilityFailureEnabled,this.networkWorkerLogOp=new f.Operation({operationName:"CreateNetworkWorker",success:!0}),this.networkMode=l||y.NetworkMode.JSWebSockets,this.improvedWebSocketEnabled&&(this.networkRateSettings=p)}return(0,a.default)(e,[{key:"init",value:function(t,n){var o=this,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.permanentlyClosed)return Promise.reject(new Error("permanentlyClosed"));if(this.isWorkerReady||this.pendingInitPromise)return this.pendingInitPromise?this.pendingInitPromise:Promise.resolve();this.extensionConfigs=t||this.extensionConfigs;var i=function(){if(r||!o.alreadyLoggedReconnectAttempt){var t=r?e.initialAttemptTimeout:e.reconnectAttemptTimeout;o.connTimeout=setTimeout((function(){var e=new f.Operation({operationName:"ConnectionFailingOrSlow",dimension0:r?"Initial":"Reconnect",dimension1:t.toString(),dimension2:o.currentReconnectAttempt.toString()});f.Log.info(508843787,f.LogCategory.CoreDefault,e),o.alreadyLoggedReconnectAttempt=!r,o.connTimeout=void 0}),t)}};return n?this.pendingInitPromise=n().catch((function(e){var t=new f.Operation({operationName:"WorkerManagerCustomInit",success:!1,resultDescription:"".concat(e)});f.Log.error(508843786,f.LogCategory.CoreDefault,t)})).then((function(){i(),o.initInternal()})):(this.pendingInitPromise=Promise.resolve(),i(),this.initInternal()),this.pendingInitPromise}},{key:"egress",value:function(e){var t=this;return!this.isWorkerReady&&this.pendingInitPromise?this.pendingInitPromise.then((function(){t.egressInternal(e)})):(this.egressInternal(e),Promise.resolve())}},{key:"egressBytes",value:function(e){var t=this;return!this.isWorkerReady&&this.pendingInitPromise?this.pendingInitPromise.then((function(){t.egressBytesInternal(e)})):(this.egressBytesInternal(e),Promise.resolve())}},{key:"getNetworkMode",value:function(){return this.networkMode}},{key:"close",value:function(e){this.isWorkerReady=!1,this.worker&&(this.worker.close(),this.worker=null),this.improvedWebSocketEnabled&&(this.networkRateController&&this.getNetworkRateController().close(),this.networkRateController=null),this.permanentlyClosed=e||this.permanentlyClosed,this.permanentlyClosed&&(this.leaveOfflineMode(),clearTimeout(this.connTimeout))}},{key:"initInternal",value:function(){var e=this;if(this.isWorkerReady=!1,this.permanentlyClosed||this.isOffline()){var t=new f.Operation({operationName:"WorkerManagerInitOffline",success:!0,resultSignature:this.permanentlyClosed?"PermanentlyClosed":"Offline"});f.Log.info(508843785,f.LogCategory.CoreDefault,t)}else this.currentReconnectAttempt>0?setTimeout((function(){e.tryToConnectAndInitializeSession()}),(0,n.calculateTimeToWaitForNextTry)(this.currentReconnectAttempt,this.lastInitializationAttemptTimeMs)):this.tryToConnectAndInitializeSession()}},{key:"egressInternal",value:function(e){var t;if(this.isWorkerReady||c.SchemaObject.matchesTypesFor(e,[l.SessionInitMessage.getTypeName()]))if(c.SchemaObject.matchesTypesFor(e,[l.MicroSyncMessage.getTypeName()])?(this.castBinaryData(e),t=p.JSOND.serialize(e)):t=JSON.stringify(e),this.improvedWebSocketEnabled){var n;l.SyncMessage.typeGuard(e)&&(n=e.seq);var o=l.SessionInitMessage.typeGuard(e)&&this.getNetworkMode()===y.NetworkMode.HttpFallback;this.getNetworkRateController().egress({obj:t,isHttpSessionInitMessage:o,messageId:e.messageId,seqId:n})}else this.worker.egress({obj:t});else c.SchemaObject.matchesTypesFor(e,[l.Response.getTypeName()])||f.Log.error(508843784,f.LogCategory.CoreDefault,new f.Operation({operationName:"UnexpectedEgressCall",resultDescription:"isWorkerReady: ".concat(this.isWorkerReady)}))}},{key:"egressBytesInternal",value:function(e){this.isWorkerReady?this.improvedWebSocketEnabled?this.getNetworkRateController().egress({obj:e}):this.worker.egress({obj:e}):f.Log.error(508843783,f.LogCategory.CoreDefault,new f.Operation({operationName:"UnexpectedEgressBytesCall",resultDescription:"isWorkerReady: ".concat(this.isWorkerReady)}))}},{key:"tryToConnectAndInitializeSession",value:function(){var e=this;this.currentReconnectAttempt++,this.lastInitializationAttemptTimeMs=d.Utils.getCurrentTimeMs();!function t(n){e.permanentlyClosed||e.isOffline()||(e.connect(e.sliceUrl?e.sliceUrl:e.globalUrl),e.sessionInitializer.initSession({isTokenRefresh:!1,isReconnectOnSameSlice:!!e.sliceUrl,extensionConfigs:e.extensionConfigs,onResponse:function(o,r){if(n.success=!o,n.resultDescription=o?"WS Error: ".concat(o.error):"",n.resourceId=r?r.sliceUrl:"",n.dimension0=n.success?"WSOK":"WSFail",o||!e.worker)return e.sliceUrl=void 0,e.close(),e.httpTestsLeft>0?(e.httpTestsLeft--,e.testHttpConnection(n.stop())):(e.closeWSBlockedSession&&0===e.wsOpenCount&&e.httpTestsSuccessCount>=5?(e.permanentlyClosed=!0,n.dimension1="WSBlocked",e.onDetectedWSBlock()):e.sessionOfflineModeEnabled&&0===e.httpTestsSuccessCount&&(e.startOfflineMode(),n.dimension1="WSOffline"),e.logCountLimiter.log((function(){f.Log.info(508843782,f.LogCategory.CoreDefault,n.stop())}))),void e.initInternal();if(e.logCountLimiter.log((function(){f.Log.info(508843781,f.LogCategory.CoreDefault,n.stop())})),r.forceReconnect){e.close();var i=new f.Operation({operationName:"ForcedReconnect"}).start();i.resultSignature="globalUrl: ".concat(e.globalUrl,". sliceUrl: ").concat(e.sliceUrl),e.sliceUrl=void 0,setTimeout((function(){t(i)}),1e3)}else clearTimeout(e.connTimeout),e.sliceUrl=r.sliceUrl,e.ready();e.resetHttpTestsCounter()}}))}(new f.Operation({operationName:"TryToConnectAndInitializeSession",resultSignature:"Reconnection attempt #".concat(this.currentReconnectAttempt)}).start())}},{key:"getNetworkRateController",value:function(){return this.networkRateController||(this.networkRateController=new g.NetworkRateController(this.networkRateSettings,this.closeWorkerOnReliabilityFailureEnabled)),this.networkRateController}},{key:"connect",value:function(e){var t=this,n=this.getNetworkMode();this.networkWorkerLogOp.start(),this.networkWorkerLogOp.resultDescription=(y.NetworkMode.JSWebSockets,"WebSocket"),this.networkWorkerLogOp.dimension0=n.toString(),this.logCountLimiter.log((function(){return f.Log.info(508372418,f.LogCategory.CoreDefault,t.networkWorkerLogOp.stop())})),this.worker=this.workerFactory(this.getNetworkMode()),this.worker.init(e,this.improvedWebSocketEnabled?this.getNetworkRateController().ingressFromWorker.bind(this.networkRateController):this.ingress,(function(){t.wsOpenCount++,t.improvedWebSocketEnabled&&t.getNetworkRateController().open(),t.leaveOfflineMode()}),(function(e){t.close(),t.onConnectionClose(e)}),this.improvedWebSocketEnabled),this.improvedWebSocketEnabled&&this.getNetworkRateController().init(this.worker,this.ingress,n,this.clientMetadata)}},{key:"ready",value:function(){this.isWorkerReady=!0,this.pendingInitPromise=void 0,this.currentReconnectAttempt=0}},{key:"castBinaryData",value:function(e){if(e){if(Array.isArray(e.__binaryMembers__)){var t,n=s(e.__binaryMembers__);try{for(n.s();!(t=n.n()).done;){var o=t.value;ArrayBuffer.isView(e[o])||(e[o]=new Uint8Array(e[o]))}}catch(e){n.e(e)}finally{n.f()}}for(var i=0,a=Object.keys(e);i<a.length;i++){var u=a[i];"object"===(0,r.default)(e[u])&&null!==e[u]&&this.castBinaryData(e[u])}}}},{key:"isOffline",value:function(){return!!this.offlineInterval}},{key:"startOfflineMode",value:function(){var e=this;this.offlineInterval=setInterval((function(){e.testHttpConnection()}),6e4)}},{key:"leaveOfflineMode",value:function(){this.isOffline()&&(clearInterval(this.offlineInterval),this.offlineInterval=void 0,this.resetHttpTestsCounter(),this.tryToConnectAndInitializeSession())}},{key:"resetHttpTestsCounter",value:function(){this.httpTestsLeft=5,this.httpTestsSuccessCount=0}}]),e}();n.NetworkWorkerManager=m,m.initialAttemptTimeout=1e5,m.reconnectAttemptTimeout=2e4,m.className="NetworkWorkerManager"},{101:101,118:118,122:122,139:139,172:172,174:174,178:178,192:192,37:37,40:40,77:77,89:89}],92:[function(e,t,n){"use strict";var o=e(178),r=o(e(172)),i=o(e(174)),a=o(e(177)),s=o(e(185)),u=o(e(176));function c(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=(0,u.default)(e);if(t){var r=(0,u.default)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return(0,s.default)(this,n)}}Object.defineProperty(n,"__esModule",{value:!0}),n.SessionInitializer=void 0;var l=e(40),f=e(122),d=e(23),p=e(101),h=e(94),g=function(e){(0,a.default)(n,e);var t=c(n);function n(e,o,i,a,s){var u;return(0,r.default)(this,n),(u=t.call(this)).getSessionStats=e,u.clientMetadata=o,u.tokenRefreshManager=i,u.sendMessage=a,u.options=s||{},u.options.overrideSessionInitMessage=u.options.overrideSessionInitMessage||function(e){return e},u}return(0,i.default)(n,[{key:"initSession",value:function(e){var t=this;e.onResponse=e.onResponse||function(){};var n=p.Utils.getCurrentTimeMs(),o=this.getSessionStats().lastConnectionClose&&n-this.getSessionStats().lastConnectionClose,r=this.getSessionStats().lastSyncMessage&&n-this.getSessionStats().lastSyncMessage,i=new l.Operation({operationName:"SessionInit"}).start(),a={sessionKey:this.sessionKey,sessionId:this.clientMetadata.sessionId,timeSinceLastConnectionClose:o,timeSinceLastSyncMessage:r,isTokenRefresh:e.isTokenRefresh,enableRemoteExecutionNotification:this.options.enableRemoteExecutionNotification,error:void 0},s=this.options.overrideSessionInitMessage(new f.SessionInitMessage({protocolVersion:f.currentProtocolVersion,clientMetadata:this.clientMetadata,sessionKey:this.sessionKey,origin:this.origin,authToken:this.anonymousToken,extensionConfigs:e.extensionConfigs,returnWorkflowInputTypes:!0,enableRemoteExecutionNotification:this.options.enableRemoteExecutionNotification}));this.sendMessage(s,(function(n,o){if(i.success=!n,i.resultSignature=t.getSessionStats().lastConnectionClose?"Reconnect":"FirstConnect",i.resourceId=null==o?void 0:o.sliceUrl,i.setClientMetadata(t.clientMetadata),(null==o?void 0:o.sessionKey)&&a.sessionKey!==o.sessionKey&&(a.sessionKey=o.sessionKey),n&&(a.error=n.error),i.resultDescription=JSON.stringify(a),l.Log.info(508843779,l.LogCategory.CoreDefault,i.stop()),e.onResponse(n,o),n)t.emit("serverAuthenticationStateChange",f.ServerAuthenticationState.NotAuthenticated);else if(e.isReconnectOnSameSlice&&o.forceReconnect)t.emit("serverAuthenticationStateChange",f.ServerAuthenticationState.NotAuthenticated);else{if(!o.anonymousToken||!o.tokenExpirationSeconds)return t.emit("serverAuthenticationStateChange",f.ServerAuthenticationState.NotAuthenticated),void l.Log.error(508843778,l.LogCategory.CoreDefault,"AL Anonymous token was not generated for the session");t.anonymousToken=o.anonymousToken,t.onSuccessfulSessionInitOnServerSide(o)}}))}},{key:"onSuccessfulSessionInitOnServerSide",value:function(e){var t=this;this.tokenRefreshManager.scheduleRefresh(h.TokenType.Anonymous,e.tokenExpirationSeconds,this.initSession.bind(this,{isTokenRefresh:!0}),(function(){t.anonymousToken=void 0})),this.initHostAuthToken();var n=!!this.sessionKey,o=this.sessionKey!==e.sessionKey;this.sessionKey=e.sessionKey,this.origin=e.origin,this.emit("connect",o,n,"".concat(e.sessionUrlBase,"/").concat(e.sessionKey),e.origin,this.anonymousToken,e.workflowInputTypes,e.downstreamRuntimeWorkflows),n&&this.emit("reconnect")}},{key:"initHostAuthToken",value:function(){var e=this;if(this.options.getAuthToken){var t=new l.Operation({operationName:"RefreshAuthToken",success:!0}).setClientMetadata(this.clientMetadata).start();this.options.getAuthToken().then((function(n){if(!n)return e.emit("serverAuthenticationStateChange",f.ServerAuthenticationState.NotAuthenticated),t.success=!1,t.resultDescription="Host auth token provision failed",void l.Log.info(508843777,l.LogCategory.CoreDefault,t.stop());l.Log.info(508843776,l.LogCategory.CoreDefault,t.stop()),e.sendTokenProvisionMessage(n)})).catch((function(n){e.emit("serverAuthenticationStateChange",f.ServerAuthenticationState.NotAuthenticated),t.success=!1,t.resultDescription="Error happened while attempting to fetch host token: ".concat(n),l.Log.error(508843747,l.LogCategory.CoreDefault,t.stop())}))}}},{key:"sendTokenProvisionMessage",value:function(e){var t=new f.TokenProvisionMessage({authToken:e});this.emit("serverAuthenticationStateChange",f.ServerAuthenticationState.Pending),this.sendMessage(t,this.onTokenProvisionResponse.bind(this),!0)}},{key:"onTokenProvisionResponse",value:function(e,t){if(!e&&t&&t.tokenExpirationSeconds){var n=t.tokenType&&t.tokenType==d.AuthTokenType.WacUserInfo?f.ServerAuthenticationState.WacUserInfoAuthenticated:f.ServerAuthenticationState.Authenticated;this.emit("serverAuthenticationStateChange",n),this.tokenRefreshManager.scheduleRefresh(h.TokenType.Host,t.tokenExpirationSeconds,this.initHostAuthToken.bind(this))}else this.emit("serverAuthenticationStateChange",f.ServerAuthenticationState.NotAuthenticated)}}]),n}(e(198).EventEmitter);n.SessionInitializer=g},{101:101,122:122,172:172,174:174,176:176,177:177,178:178,185:185,198:198,23:23,40:40,94:94}],93:[function(e,t,n){"use strict";var o=e(178),r=o(e(177)),i=o(e(185)),a=o(e(176)),s=o(e(172)),u=o(e(174));function c(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=(0,a.default)(e);if(t){var r=(0,a.default)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return(0,i.default)(this,n)}}Object.defineProperty(n,"__esModule",{value:!0}),n.ClosedState=n.DisconnectedState=n.RunningState=n.InitingState=n.BaseState=n.queueBytes=n.queueMessage=n.sendMessageNow=n.SessionState=void 0;var l,f=e(122),d=e(40),p=e(139),h=e(88);!function(e){e[e.Initing=0]="Initing",e[e.Running=1]="Running",e[e.Disconnected=2]="Disconnected",e[e.Closed=3]="Closed"}(l=n.SessionState||(n.SessionState={}));n.sendMessageNow=function(e,t,n,o){t&&(t.cv||(t.cv=e.cvParent.newChild().toString()),e.messageEndpoint.sendMessage(t,(function(t,o){t||p.SchemaObject.getTypeNameFor(o)!==f.SyncResponse.getTypeName()||(e.stats.lastSyncMessage=Date.now()),n&&n(t,o)}),void 0,o))};n.queueMessage=function(e,t,n,o){t&&(e.messageQueue.push(t,n,o),e.networkWorkerManager.init(void 0,e.customInitPromise).catch((function(e){var t=new d.Operation({operationName:"WorkerManagerInit",success:!1,resultDescription:"".concat(e)});d.Log.error(508843789,d.LogCategory.CoreDefault,t)})))};n.queueBytes=function(e,t){t&&(e.messageQueue.push(t),e.networkWorkerManager.init(void 0,e.customInitPromise).catch((function(e){d.Log.error(508843788,d.LogCategory.CoreDefault,"Init failed: ".concat(e))})))};var g=function(){function e(t){(0,s.default)(this,e),this.context=t}return(0,u.default)(e,[{key:"onEnter",value:function(e){}},{key:"sendMessage",value:function(e,t,n,o){}},{key:"sendBytes",value:function(e){}},{key:"canSendMessage",value:function(){return!1}},{key:"onConnectionClose",value:function(){}}]),e}();n.BaseState=g;var y=function(e){(0,r.default)(o,e);var t=c(o);function o(){var e;return(0,s.default)(this,o),(e=t.apply(this,arguments)).stateName=l.Initing,e.possibleNextStates=[l.Running,l.Disconnected,l.Closed],e}return(0,u.default)(o,[{key:"sendMessage",value:function(e,t,o){p.SchemaObject.matchesTypesFor(e,[f.SessionInitMessage.getTypeName()])?(0,n.sendMessageNow)(this.context,e,t,o):(0,n.queueMessage)(this.context,e,t)}},{key:"sendBytes",value:function(e){(0,n.queueBytes)(this.context,e)}},{key:"onConnectionClose",value:function(){this.context.setState(l.Disconnected)}}]),o}(g);n.InitingState=y;var m=function(e){(0,r.default)(o,e);var t=c(o);function o(){var e;return(0,s.default)(this,o),(e=t.apply(this,arguments)).stateName=l.Running,e.possibleNextStates=[l.Disconnected,l.Closed],e}return(0,u.default)(o,[{key:"onEnter",value:function(e){e&&e.isSessionReseedingStarted&&this.context.resetNextSyncSequenceId(),this.context.messageQueue.sendOnSessionInitialized(e&&e.isSessionReseedingStarted)}},{key:"sendMessage",value:function(e,t,o,r){(0,n.sendMessageNow)(this.context,e,t,o)}},{key:"sendBytes",value:function(e){e&&this.context.networkWorkerManager.egressBytes(e)}},{key:"canSendMessage",value:function(){return!0}},{key:"onConnectionClose",value:function(){this.context.setState(l.Disconnected)}}]),o}(g);n.RunningState=m;var v=function(e){(0,r.default)(o,e);var t=c(o);function o(){var e;return(0,s.default)(this,o),(e=t.apply(this,arguments)).stateName=l.Disconnected,e.possibleNextStates=[l.Initing,l.Closed],e}return(0,u.default)(o,[{key:"onEnter",value:function(e){this.context.messageEndpoint.cancelPendingResponseCallbacks()}},{key:"sendMessage",value:function(e,t,o,r){if(p.SchemaObject.matchesTypesFor(e,[f.SessionInitMessage.getTypeName()]))this.context.setState(l.Initing),(0,n.sendMessageNow)(this.context,e,t,o);else if(p.SchemaObject.matchesTypesFor(e,[f.SessionCloseMessage.getTypeName()]))this.context.setState(l.Closed);else{if(!r)return void(0,n.queueMessage)(this.context,e,t,o);t&&t(new f.ErrorResponse({messageId:e.messageId,error:h.ClientSendMessageErrorReason.DroppedBecauseClientDisconnected}))}}},{key:"sendBytes",value:function(e){(0,n.queueBytes)(this.context,e)}}]),o}(g);n.DisconnectedState=v;var k=function(e){(0,r.default)(n,e);var t=c(n);function n(){var e;return(0,s.default)(this,n),(e=t.apply(this,arguments)).stateName=l.Closed,e.possibleNextStates=[],e}return(0,u.default)(n,[{key:"onEnter",value:function(e){this.context.messageEndpoint.cancelPendingResponseCallbacks()}}]),n}(g);n.ClosedState=k},{122:122,139:139,172:172,174:174,176:176,177:177,178:178,185:185,40:40,88:88}],94:[function(e,t,n){"use strict";var o=e(178),r=o(e(172)),i=o(e(174));Object.defineProperty(n,"__esModule",{value:!0}),n.TokenRefreshManager=n.TokenType=void 0,function(e){e[e.Anonymous=0]="Anonymous",e[e.Host=1]="Host"}(n.TokenType||(n.TokenType={}));var a=function(){function e(){(0,r.default)(this,e),this.timers=new Map}return(0,i.default)(e,[{key:"scheduleRefresh",value:function(t,n,o,r){var i=this.timers.get(t);i||(i={numberOfAttempts:0},this.timers.set(t,i)),i.refreshTimeoutId&&(clearTimeout(i.refreshTimeoutId),i.refreshTimeoutId=void 0),i.expiredTimeoutId&&(clearTimeout(i.expiredTimeoutId),i.expiredTimeoutId=void 0);var a=1e3*n-e.tokenRefreshBufferMs,s=1e3*n-e.tokenExpirationBufferMs;a>0?i.numberOfAttempts=0:(++i.numberOfAttempts,a=e.tokenRefreshBackoffIntervalMs,s=e.tokenExpirationBufferMs),i.numberOfAttempts<=e.tokenRefreshMaximumAttempts&&(i.refreshTimeoutId=setTimeout((function(){o()}),a)),r&&(i.expiredTimeoutId=setTimeout((function(){r()}),s))}},{key:"clearRefreshTimeouts",value:function(){this.clearTimeouts(!1)}},{key:"clearAllTimeouts",value:function(){this.clearTimeouts(!0)}},{key:"clearTimeouts",value:function(e){var t=this;this.timers.forEach((function(n,o){n.refreshTimeoutId&&(clearTimeout(n.refreshTimeoutId),n.refreshTimeoutId=void 0),e&&n.expiredTimeoutId&&(clearTimeout(n.expiredTimeoutId),n.expiredTimeoutId=void 0),n.expiredTimeoutId||t.timers.delete(o)}))}}]),e}();n.TokenRefreshManager=a,a.tokenRefreshBufferMs=24e4,a.tokenExpirationBufferMs=12e4,a.tokenRefreshBackoffIntervalMs=3e4,a.tokenRefreshMaximumAttempts=3},{172:172,174:174,178:178}],95:[function(e,t,n){"use strict";var o=e(178),r=o(e(172)),i=o(e(174));Object.defineProperty(n,"__esModule",{value:!0}),n.WebSocketReliabilityManager=void 0;var a=e(40),s=e(101),u=function(){function e(t,n,o){(0,r.default)(this,e),this.logCountLimiter=new s.LogCountLimiter(e.className),this.lastPingTime=0,this.lastPongTime=0,this.lastEgressTime=0,this.remainingPingFailures=3,this.isPingPongSuccessful=!1,this.pingPongLogOp=new a.Operation({operationName:"WebSocketReliabilityManager",success:!0}).start(),this.worker=t,this.closeWorkerOnReliabilityFailure=o,this.rateControllerClose=n}return(0,i.default)(e,[{key:"start",value:function(){s.Utils.collectTelemetry(this.pingPongLogOp,this.logCountLimiter,!0,"ping","initial ping"),this.isPingPongSuccessful=!0,this.ping(),this.startInterval()}},{key:"onResponse",value:function(){this.lastPongTime=Date.now()}},{key:"isReliabilityResponse",value:function(t){return t&&1===t.length&&t===e.pingPongMessage}},{key:"close",value:function(){this.lastPingTime=0,this.lastPongTime=0,this.isPingPongSuccessful=!1,this.clearPingInterval(),this.worker=void 0}},{key:"checkConnection",value:function(){return this.isPingPongSuccessful}},{key:"postEgress",value:function(){this.lastEgressTime=Date.now()}},{key:"ping",value:function(){this.lastPingTime=Date.now(),this.worker&&this.worker.egress({obj:e.pingPongMessage})}},{key:"startInterval",value:function(){var e=this;this.pingInterval=setInterval((function(){if(e.isPingPongSuccessful=e.lastPongTime>=e.lastPingTime&&e.lastPongTime-e.lastPingTime<=3e4,!(e.lastPongTime>e.lastEgressTime)){var t=e.lastPongTime-e.lastPingTime;e.isPingPongSuccessful?(e.remainingPingFailures=3,s.Utils.collectTelemetry(e.pingPongLogOp,e.logCountLimiter,!0,"ping","WebSocket channel active",["".concat(t),"".concat(e.remainingPingFailures)]),e.ping()):e.remainingPingFailures>0?(--e.remainingPingFailures,s.Utils.collectTelemetry(e.pingPongLogOp,e.logCountLimiter,!0,"ping","Pong not received within ".concat(3e4," ms"),["".concat(t),"".concat(e.remainingPingFailures)]),e.ping()):(s.Utils.collectTelemetry(e.pingPongLogOp,e.logCountLimiter,!1,"ping","Pong still not received after all retry attempts",["".concat(t),"".concat(e.remainingPingFailures)]),e.closeWorkerOnReliabilityFailure&&e.worker?e.worker.close():e.rateControllerClose())}}),3e4)}},{key:"clearPingInterval",value:function(){this.pingInterval&&(clearInterval(this.pingInterval),this.pingInterval=void 0)}}]),e}();n.WebSocketReliabilityManager=u,u.pingPongMessage="~",u.className="WebSocketReliabilityManager"},{101:101,172:172,174:174,178:178,40:40}],96:[function(e,t,n){"use strict";var o=e(178),r=o(e(172)),i=o(e(174)),a=e("importDefaultHelper");Object.defineProperty(n,"__esModule",{value:!0}),n.WebSocketWorker=void 0;var s=a(e(203)),u=e(40),c=e(101),l=function(){function e(){(0,r.default)(this,e),this.hasBeenOpened=!1,this.hadEgressError=!1,this.lastEgressTime=0,this.lastPongTime=0,this.remainingPingFailures=3,this.egressMessageCount=0,this.egressByteCount=0,this.isClosing=!1,this.pendingEgress=[]}return(0,i.default)(e,[{key:"init",value:function(t,n,o,r,i){var a=this;this.ws=new s.default(t),this.logOp=new u.Operation({operationName:e.className,success:!0}).start(),this.egressTimer=Date.now(),this.egressMessageCountOp=new u.Operation({operationName:"WSEgressMessageCount",success:!0}),this.egressByteCountOp=new u.Operation({operationName:"WSEgressByteOrderOfMagnitude",success:!0}),this.ingressByteCountOp=new u.Operation({operationName:"WSIngressByteOrderOfMagnitude",success:!0}),this.improvedWebSocketEnabled=i;var c=function(e){a.logPingLatencyOp&&(a.logPingLatencyOp.success=e,u.Log.info(508843802,u.LogCategory.CoreDefault,a.logPingLatencyOp.stop()),a.logPingLatencyOp=void 0)};this.ws.addEventListener("open",(function(t){o(),e.logCountLimiter.log((function(){a.logOp.resourceId="OnOpen",a.logOp.resultDescription="",a.logOp.success=!0,a.logOp.dimension0=a.pendingEgress.length.toString(),u.Log.info(508843801,u.LogCategory.CoreDefault,a.logOp.stop())})),a.improvedWebSocketEnabled||(a.hasBeenOpened=!0,a.pendingEgress.forEach((function(e){a.egress({obj:e})})),a.pendingEgress=[],a.pingInterval=setInterval((function(){a.logPingLatencyOp&&(--a.remainingPingFailures,c(!1)),a.remainingPingFailures>0&&a.hasBeenOpened&&a.lastPongTime<a.lastEgressTime&&(a.logPingLatencyOp=new u.Operation({operationName:"Ping",success:!0,dimension0:a.ws.bufferedAmount>=0?a.ws.bufferedAmount.toString().length.toString():void 0}).start(),a.ws.send(e.pingPongMessage,(function(e){e&&(--a.remainingPingFailures,c(!1))})))}),3e4))})),this.ws.addEventListener("message",(function(t){!a.improvedWebSocketEnabled&&a.logPingLatencyOp&&"string"==typeof t.data&&1===t.data.length&&t.data[0]===e.pingPongMessage?(c(!0),a.lastPongTime=Date.now()):(a.logIngressCount(t.data),n(t.data))})),this.ws.addEventListener("error",(function(t){a.errorMessage=t.message,e.logCountLimiter.log((function(){a.logOp.resourceId="OnError",a.logOp.resultDescription=a.errorMessage,a.logOp.success=!1,u.Log.info(508843800,u.LogCategory.CoreDefault,a.logOp.stop())})),a.ws.close()})),this.ws.addEventListener("close",(function(t){e.logCountLimiter.log((function(){a.logOp.resourceId="OnClose",a.logOp.resultDescription=t?"code: ".concat(t.code,". reason: ").concat(t.reason):"",a.logOp.success=!0,u.Log.info(508843799,u.LogCategory.CoreDefault,a.logOp.stop())})),!a.improvedWebSocketEnabled&&a.pingInterval&&(clearInterval(a.pingInterval),a.pingInterval=void 0),r(a.errorMessage),a.isClosing=!1}))}},{key:"egress",value:function(t){var n=this,o=t.obj;this.improvedWebSocketEnabled?this.ws.send(o,(function(t){t&&!n.hadEgressError&&(n.hadEgressError=!0,e.logCountLimiter.log((function(){n.logOp.resourceId="OnEgressError",n.logOp.resultDescription=t.message,n.logOp.success=!1,u.Log.info(508843797,u.LogCategory.CoreDefault,n.logOp.stop())})))})):(this.logEgressCount(o instanceof ArrayBuffer?o.byteLength:o.length),this.lastEgressTime=Date.now(),this.hasBeenOpened?this.ws.send(o,(function(t){t&&!n.hadEgressError&&(n.hadEgressError=!0,e.logCountLimiter.log((function(){n.logOp.resourceId="OnFirstEgressError",n.logOp.resultDescription=t.message,n.logOp.success=!1,u.Log.info(508843798,u.LogCategory.CoreDefault,n.logOp.stop())})))})):this.pendingEgress.push(o))}},{key:"close",value:function(){this.isClosing||(this.isClosing=!0,!this.improvedWebSocketEnabled&&this.pingInterval&&(clearInterval(this.pingInterval),this.pingInterval=void 0),this.ws.close())}},{key:"logEgressCount",value:function(e){var t=Date.now(),n=t-this.egressTimer;n>1e3&&(this.egressMessageCount>50&&(this.egressMessageCountOp.start(),this.egressMessageCountOp.resultDescription="Egress message count: "+this.egressMessageCount.toString()+", Buffered amount: "+(this.ws.bufferedAmount>=0?this.ws.bufferedAmount.toString():"-")+", Time elapsed: "+n.toString(),u.Log.info(508843796,u.LogCategory.CoreDefault,this.egressMessageCountOp.stop())),this.egressByteCount>1e5&&(this.egressByteCountOp.start(),this.egressByteCountOp.dimension2=this.egressByteCount.toString().length.toString(),this.egressMessageCountOp.resultDescription="Buffered amount: "+(this.ws.bufferedAmount>=0?this.ws.bufferedAmount.toString():"-")+", Time elapsed: "+n.toString(),u.Log.info(508843795,u.LogCategory.CoreDefault,this.egressByteCountOp.stop())),this.egressTimer=t,this.egressMessageCount=0,this.egressByteCount=0),this.egressMessageCount++,this.egressByteCount+=null!=e?e:0}},{key:"logIngressCount",value:function(e){var t=e.length;t>1e5&&(this.ingressByteCountOp.start(),this.ingressByteCountOp.dimension2=t.toString().length.toString(),u.Log.info(508843794,u.LogCategory.CoreDefault,this.ingressByteCountOp.stop()))}}]),e}();n.WebSocketWorker=l,l.className="WebSocketWorker",l.logCountLimiter=new c.LogCountLimiter(l.className),l.pingPongMessage="~"},{101:101,172:172,174:174,178:178,203:203,40:40}],97:[function(e,t,n){"use strict";var o=e(178),r=o(e(172)),i=o(e(174));Object.defineProperty(n,"__esModule",{value:!0}),n.createRuntime=n.runtime=n.ClientRuntime=n.getVersion=void 0;var a=e(23),s=e(40),u=e(109),c=e(100),l=e(96),f=e(90),d=e(99),p=e(101),h=e(87),g=e(92),y=e(94),m=e(82),v=e(72),k=e(84),T=e(118),S=e(155),b=e(158);n.getVersion=function(){return e(102).version};var w=function(){function e(t,n,o){var i=this;(0,r.default)(this,e),this.sessionsByDocSessionId=new Map,this.isDeltaGeneratorEnabled=!1,this.disableSyncDeltaSending=!1,this.hasBeenInitialized=!1,this.settings={dropOnlySequencedSyncsOnReseedEnabled:!0,closeWSBlockedSessionEnabled:!0,sessionOfflineModeEnabled:!0,annotationsOrderingEnabled:!0,deltaOperationsEnabled:!1,checkIdbByFeatures:!1,improvedWebSocketEnabled:!1,defaultBatchingEnabled:!0,batchingWith20msIntervalEnabled:!0,onAnnotationsSubmittedEnabled:!1,httpFallbackEnabled:!1,closeWorkerOnReliabilityFailureEnabled:!0},this.isDownloaderCompatible=function(){if(i.settings.checkIdbByFeatures)return"undefined"!=typeof Array&&void 0!==Array.from&&"undefined"!=typeof URL&&void 0!==URL.createObjectURL;if("undefined"!=typeof navigator&&navigator.userAgent){var e=navigator.userAgent;return!(!e.indexOf||e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0)}return!1},this.workerFactory=t||function(e){return new l.WebSocketWorker};var a=this.createDefaultSessionManagerFactory();this.sessionManagerFactory=function(){return(null==n?void 0:n.apply(void 0,arguments))||a.apply(void 0,arguments)},this.sessionFactory=o||function(e){return new d.SessionProxy(e)}}return(0,i.default)(e,[{key:"init",value:function(t,o,r,i){var u,l,f,d,h,g,y,S,w=this,C=new s.Operation({operationName:"InitRuntime",resourceId:t,dimension1:this.hasBeenInitialized.toString()});C.start(),this.hasBeenInitialized=!0,this.hostCallbacks=r,this.shouldAddLogger(C)?(s.Log.addLogger(new c.TelemetryLogger(this.hostCallbacks)),this.addLoggingAggregator(i)):(s.Log.clearLoggers(),s.Log.addLogger(new c.TelemetryLogger(this.hostCallbacks))),e.haveCalledInit=!0,this.annotationResultsProcessor=new v.RoutingAnnotationResultsProcessor((function(){return w.settings.annotationsOrderingEnabled})),this.inferenceServiceFactory=i.inferenceServiceFactory,this.clientMetadata=o,this.clientMetadata&&(this.clientMetadata.runtimeVersion=(0,n.getVersion)()),this.networkRateSettings=i.networkRateSettings,C.dimension2=(0,s.getNumLoggers)(a.LoggingLevel.info).toString();var _=[];t&&(this.defaultServiceUrl=p.Utils.convertServiceUrlToWebSocket(t),this.serviceProtocol=this.defaultServiceUrl.split(":")[0].toLowerCase()),_.push(this.isFeatureEnabled("CheckIdbByFeatures",!1).then((function(e){w.settings.checkIdbByFeatures=e}))),_.push(this.isFeatureEnabled("DropOnlySequencedSyncsOnReseedDisabled").then((function(e){w.settings.dropOnlySequencedSyncsOnReseedEnabled=!e}))),_.push(this.isFeatureEnabled("CloseWSBlockedSessionDisabled").then((function(e){w.settings.closeWSBlockedSessionEnabled=!e}))),_.push(this.isFeatureEnabled("SessionOfflineModeDisabled").then((function(e){w.settings.sessionOfflineModeEnabled=!e}))),_.push(this.isFeatureEnabled("AnnotationsOrderingEnabled",!0).then((function(e){w.settings.annotationsOrderingEnabled=e}))),_.push(this.isFeatureEnabled("ImprovedWebsocketEnabled").then((function(e){var t;(t=w.settings).improvedWebSocketEnabled||(t.improvedWebSocketEnabled=e)}))),_.push(this.isFeatureEnabled("DefaultBatchingDisabled").then((function(e){var t;(t=w.settings).defaultBatchingEnabled&&(t.defaultBatchingEnabled=!e)}))),_.push(this.isFeatureEnabled("HttpFallbackEnabled").then((function(e){var t;(t=w.settings).httpFallbackEnabled||(t.httpFallbackEnabled=e)}))),_.push(this.isFeatureEnabled("CloseWorkerOnReliabilityFailureDisabled").then((function(e){var t;(t=w.settings).closeWorkerOnReliabilityFailureEnabled&&(t.closeWorkerOnReliabilityFailureEnabled=!e)}))),_.push(this.isFeatureEnabled("BatchingWith20msIntervalDisabled").then((function(e){var t;(t=w.settings).batchingWith20msIntervalEnabled&&(t.batchingWith20msIntervalEnabled=!e)}))),_.push(this.isFeatureEnabled("OnAnnotationsSubmittedDisabled").then((function(e){var t;(t=w.settings).onAnnotationsSubmittedEnabled&&(t.onAnnotationsSubmittedEnabled=!e)})));var x={enableDeltas:!1,enableEarlyJoin:!1};_.push(Promise.all([this.isFeatureEnabled("DeltaOperationsEnabled").then((function(e){return x.enableDeltas=e})).catch((function(){return x.enableDeltas=!1})),this.isFeatureEnabled("EarlyJoinCompletionEnabled").then((function(e){return x.enableEarlyJoin=e})).catch((function(){return x.enableEarlyJoin=!1}))]).then((function(){w.localWorkflowManager=new m.LocalWorkflowExecutionManager(i.modelDownloader&&w.isDownloaderCompatible()?i.modelDownloader:void 0,w.inferenceServiceFactory,x)})));var M=(0,b.parseFlights)(null!==(u=o.flights)&&void 0!==u?u:"");return this.isDeltaGeneratorEnabled=M.getBooleanValue("Microsoft.Office.WordOnline.AugloopDeltas",null!==(l=i.isDeltaGeneratorEnabled)&&void 0!==l&&l),this.disableSyncDeltaSending=M.getBooleanValue("Microsoft.Office.WordOnline.DisableSyncDeltaSending",null!==(f=i.disableSyncDeltaSending)&&void 0!==f&&f),this.syncDeltaTimeout=M.getIntValue("Microsoft.Office.WordOnline.SyncDeltaTimeout",i.syncDeltaTimeout),(d=this.settings).improvedWebSocketEnabled||(d.improvedWebSocketEnabled=M.getBooleanValue("Microsoft.Office.WordOnline.Augloop.ImprovedWebsocketEnabled",!1)),(h=this.settings).httpFallbackEnabled||(h.httpFallbackEnabled=M.getBooleanValue("Microsoft.Office.WordOnline.Augloop.HttpFallbackEnabled",!1)),(g=this.settings).closeWorkerOnReliabilityFailureEnabled&&(g.closeWorkerOnReliabilityFailureEnabled=!M.getBooleanValue("Microsoft.Office.WordOnline.Augloop.CloseWorkerOnReliabilityFailureDisabled",!1)),(y=this.settings).defaultBatchingEnabled&&(y.defaultBatchingEnabled=!M.getBooleanValue("Microsoft.Office.WordOnline.Augloop.DefaultBatchingDisabled",!1)),(S=this.settings).batchingWith20msIntervalEnabled&&(S.batchingWith20msIntervalEnabled=!M.getBooleanValue("Microsoft.Office.WordOnline.Augloop.BatchingWith20msIntervalDisabled",!1)),i&&i.networkMode&&(i.networkMode===T.NetworkMode.HttpFallback&&(i.networkMode=this.settings.httpFallbackEnabled&&this.settings.improvedWebSocketEnabled?T.NetworkMode.HttpFallback:T.NetworkMode.JSWebSockets),this.networkMode=i.networkMode,i.networkMode===T.NetworkMode.LocalWorkflowsOnly&&(this.sessionManagerFactory=function(){return new k.EmptySessionManager})),Promise.all(_).then((function(){w.batchOptions=i.batchOptions,!w.batchOptions&&w.settings.defaultBatchingEnabled&&(w.batchOptions={delayMs:1,maxInputSize:1e6,delayMsMax:50},w.settings.batchingWith20msIntervalEnabled&&(w.batchOptions.delayMs=20)),w.batchOptions&&!w.batchOptions.delayMsMax&&(w.batchOptions.delayMsMax=50),C.dimension0=JSON.stringify(w.batchOptions),w.logOperation(C,!0)})).catch((function(e){w.logOperation(C,!1,"Error",e?e.message:"(no error)")}))}},{key:"getServiceProtocol",value:function(){return this.serviceProtocol}},{key:"registerLocalWorkflow",value:function(e){this.localWorkflowManager.registerLocalWorkflow(e)}},{key:"flushTelemetry",value:function(e){s.Log.flushAggregators(e)}},{key:"createSession",value:function(e){var t,n=e&&e.docSessionId?e.docSessionId:(0,S.v4)(),o=this.sessionsByDocSessionId.get(n);if(o&&!1===o.isClosed)throw new Error("docSessionId already exists");var r=e&&null!==(t=e.serviceUrl)&&void 0!==t?t:this.defaultServiceUrl;(r=p.Utils.convertServiceUrlToWebSocket(r))||((e=e||{}).networkMode=T.NetworkMode.LocalWorkflowsOnly),!this.networkMode||e&&e.networkMode||((e=e||{}).networkMode=this.networkMode),e&&e.networkMode===T.NetworkMode.HttpFallback&&(e.networkMode=this.settings.httpFallbackEnabled&&this.settings.improvedWebSocketEnabled?T.NetworkMode.HttpFallback:T.NetworkMode.JSWebSockets);var i=Object.assign({},this.clientMetadata);i.docSessionId=n,e&&e.flights&&(i.flights=i.flights?i.flights+";"+e.flights:e.flights);var a=this.sessionFactory({hostCallbacks:this.hostCallbacks,sessionManager:this.sessionManagerFactory(i,r,e,this.networkRateSettings),batchOptions:this.batchOptions,extensionConfigs:(null==e?void 0:e.extensionConfigs)||[],clientMetadata:i,userContext:e?e.userContext:void 0,localWorkflowManager:e&&e.enableComplexLocalWorkflows?void 0:this.localWorkflowManager,annotationResultsProcessor:this.annotationResultsProcessor,localRegisteredWorkflows:(null==e?void 0:e.localRegisteredWorkflows)||[],enableRemoteExecutionNotification:(null==e?void 0:e.enableRemoteExecutionNotification)||!1,networkMode:null==e?void 0:e.networkMode,egress:e?e.egress:void 0,isDeltaGeneratorEnabled:this.isDeltaGeneratorEnabled,onAnnotationsSubmittedEnabled:this.settings.onAnnotationsSubmittedEnabled,disableSyncDeltaSending:this.disableSyncDeltaSending,syncDeltaTimeout:this.syncDeltaTimeout});return this.sessionsByDocSessionId.set(n,a),e&&e.onSessionConnect&&a.setConnectCallback(e.onSessionConnect),e&&e.onSessionDisconnect&&a.setDisconnectCallback(e.onSessionDisconnect),e&&e.onSessionReconnect&&a.setReconnectCallback(e.onSessionReconnect),e&&e.onSessionClose&&a.setSessionCloseCallback(e.onSessionClose),e&&e.onServerAuthenticationStateChangeCallback&&a.setServerAuthenticationStateChangeCallback(e.onServerAuthenticationStateChangeCallback),a.initialize?a.initialize():Promise.resolve(a)}},{key:"getSessionManagerFactory",value:function(){return this.sessionManagerFactory}},{key:"shouldAddLogger",value:function(t){if(e.haveCalledInit){var n=new Error("Runtime already initialized");return t.dimension3=n.stack,t.dimension2=(0,s.getNumLoggers)(a.LoggingLevel.info).toString(),this.logOperation(t,!1,"Error",n.message),!1}return!0}},{key:"createDefaultSessionManagerFactory",value:function(){var e=this;return function(t,n,o){if(o&&o.enableComplexLocalWorkflows)throw new Error("NYI");if(o&&o.networkMode==T.NetworkMode.LocalWorkflowsOnly)return new k.EmptySessionManager;var r=new y.TokenRefreshManager,i=new h.SessionStats,a=function(){s.Log.error(573321615,s.LogCategory.CoreDefault,"Unexpectedly not set sendMessage")},u=new g.SessionInitializer((function(){return i}),t,r,(function(e,t,n){a(e,t,n)}),{getAuthToken:e.getAuthToken.bind(e,t.docSessionId),overrideSessionInitMessage:e.hostCallbacks.overrideSessionInitMessage,enableRemoteExecutionNotification:(null==o?void 0:o.enableRemoteExecutionNotification)||!1}),c=new f.NetworkSessionManager(p.Utils.convertServiceUrlToWebSocket(n),i,e.workerFactory,u,t,r,e.settings,null==o?void 0:o.networkMode,e.networkRateSettings);return a=c.sendMessage.bind(c),c.on("disconnect",(function(){return r.clearRefreshTimeouts()})),c.on("connect",(function(t,n,o,r){t&&e.hostCallbacks.setSessionData&&e.hostCallbacks.setSessionData(n,o,r)})),c}}},{key:"getAuthToken",value:function(e){var t={Tickets:[],TokenType:u.AuthTokenType.Augloop};return e&&(t.DocSessionId=e),this.hostCallbacks.requestAuthToken(t).then((function(e){if(e)return e.Token})).catch((function(){}))}},{key:"isFeatureEnabled",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"None";return p.Utils.isFeatureEnabled(this.hostCallbacks,e,t,n)}},{key:"logOperation",value:function(e,t,n,o){e.stop(),e.success=t,e.resultSignature=n,e.resultDescription=o,s.Log.info(573321622,s.LogCategory.CoreDefault,e)}},{key:"addLoggingAggregator",value:function(e){var t,n,o;s.Log.addAggregator((0,c.createOperationLoggingAggregator)("Operation","operationName",["ExecuteBatch","ProcessResponse","LocalDeltaUpdate","ApplyFormattedTextTileDeltaForLocalWorkflows","ApplyTextTileDeltaForLocalWorkflows","FindRangeForDelta","RunModelForInferencing","GetResource","CreateTextTileDeltaFromItem","NetworkEgressControl","OnAnnotationResultsEgress"],null!==(t=e.telemetryAggregationIntervalSec)&&void 0!==t?t:30)),s.Log.addAggregator((0,c.createOperationLoggingAggregator)("Operation","operationName",["ExecuteWorkflow","ExecuteLambda","RunLocalWorkflows"],null!==(n=e.telemetryAggregationIntervalSec)&&void 0!==n?n:60)),s.Log.addAggregator((0,c.createOperationLoggingAggregator)("SessionHealth","sessionHealthEventName",["SendMessage","ProcessMessage"],null!==(o=e.telemetryAggregationIntervalSec)&&void 0!==o?o:60))}},{key:"uninitialize",value:function(){this.flushTelemetry(!0),this.hostCallbacks=null,this.hasBeenInitialized=!1,e.haveCalledInit=!1,s.Log.clearAggregators(),s.Log.clearLoggers()}}]),e}();n.ClientRuntime=w,n.runtime=new w;n.createRuntime=function(){return new w}},{100:100,101:101,102:102,109:109,118:118,155:155,158:158,172:172,174:174,178:178,23:23,40:40,72:72,82:82,84:84,87:87,90:90,92:92,94:94,96:96,99:99}],98:[function(e,t,n){"use strict";var o=e(178),r=o(e(188)),i=o(e(172)),a=o(e(174));Object.defineProperty(n,"__esModule",{value:!0}),n.SequentialFetchQueue=void 0;var s=function(){function e(t,n,o){if((0,i.default)(this,e),this.requestInProgress=!1,this.queuedRequests=[],null==t)throw new Error("No request.");this.fetch=t,this.fetchTimeout=n,this.queueTimeout=o}return(0,a.default)(e,[{key:"tryProcessNextRequest",value:function(){if(this.requestInProgress=!1,this.queuedRequests.length>0){var e=this.queuedRequests.shift(),t=(0,r.default)(e,3),n=t[0],o=t[1],i=t[2];clearTimeout(i),this.add(n,o)}}},{key:"add",value:function(e,t){var n=this;if(this.requestInProgress){var o=setTimeout((function(){t(new Error("Timed out waiting in queue"),null),n.queuedRequests.shift()}),this.queueTimeout);this.queuedRequests.push([e,t,o])}else{this.requestInProgress=!0,new Promise((function(t,o){var r=!1,i=setTimeout((function(){r=!0,o(new Error("Fetch timed out"))}),n.fetchTimeout);n.fetch(e).then((function(e){r||(clearTimeout(i),t(e))})).catch((function(e){r||(clearTimeout(i),o(e))}))})).then((function(e){t(null,e),n.tryProcessNextRequest()})).catch((function(e){t(e,null),n.tryProcessNextRequest()}))}}}]),e}();n.SequentialFetchQueue=s},{172:172,174:174,178:178,188:188}],99:[function(e,t,n){"use strict";var o=e(178),r=o(e(189)),i=o(e(188)),a=o(e(172)),s=o(e(174));function u(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}Object.defineProperty(n,"__esModule",{value:!0}),n.SessionProxy=n.LocalWorkflowOrchestrationMode=n.AnnotationSource=n.graphInitDelayMs=void 0;var l=e(122),f=e(118),d=e(139),p=e(109),h=e(196),g=e(68),y=e(74),m=e(23),v=e(101),k=e(37),T=e(40),S=e(160),b=e(116),w=e(48),C=e(105),_=e(15),x=e(150),M=e(155);n.graphInitDelayMs=10;var A;!function(e){e[e.LocalWorkflow=0]="LocalWorkflow",e[e.ServerWorkflow=1]="ServerWorkflow",e[e.Submitted=2]="Submitted"}(A=n.AnnotationSource||(n.AnnotationSource={})),function(e){e[e.Internal=0]="Internal",e[e.External=1]="External"}(n.LocalWorkflowOrchestrationMode||(n.LocalWorkflowOrchestrationMode={}));var O=function(e,t){t?(e.resultDescription=t,e.success=!1,T.Log.error(509203144,T.LogCategory.CoreDefault,e.stop())):T.Log.info(509203143,T.LogCategory.CoreDefault,e.stop())},I=function(e){return!e.items.some((function(e){return e.source&&0===e.source.indexOf("ThirdParty")}))},L=function(){function e(t){var n;(0,a.default)(this,e),this.annotationActivationTrackers=new Map,this.annotationCallbacks=new Map,this.annotationResultStates=new Map,this.tokensByAnnotationType=new Map,this.registeredContextTypes=new Set,this.availableContexts=new Map,this.nextSyncSequenceId=1,this.allowSeed=!0,this.allowGroupSeed=!0,this.seedGroupSize=0,this.hasSessionConnected=!1,this.isSessionClosed=!1,this.serverAuthenticationState=l.ServerAuthenticationState.NotAuthenticated,this.sessionCloseCallbacks=new Map,this.connectCallbacks=new Map,this.reconnectCallbacks=new Map,this.disconnectCallbacks=new Map,this.sessionStateCallbackToken=0,this.workflowGraph=new w.WorkflowGraph,this.workflowDefinitionManager=new w.DynamicWorkflowDefinitionManager,this.contextIdManager=new w.ContextIdManager(C.RuntimeKind.JsClient,this.workflowGraph),this.workflowItemStorage=new w.WorkflowItemStorage(this.workflowDefinitionManager),this.pendingConnectCallbacks=[],this.onAnnotationsSubmittedEnabled=!1,this.hostCallbacks=t.hostCallbacks,this.sessionManager=t.sessionManager,this.operationBatchConfig=t.batchOptions?this.getOperationBatchConfig(t.batchOptions):void 0,this.extensionConfigs=t.extensionConfigs,this.clientMetadata=t.clientMetadata,this.userContext=t.userContext,this.localWorkflowManager=t.localWorkflowManager,this.annotationResultsProcessor=t.annotationResultsProcessor,t.workflowRuntimeFactory&&(this.workflowRuntime=t.workflowRuntimeFactory(this.sessionManager)),this.localRegisteredWorkflows=t.localRegisteredWorkflows||[],this.enableRemoteExecutionNotification=t.enableRemoteExecutionNotification||!1,this.networkMode=t.networkMode,this.egress=t.egress,this.serverAuthenticationStateChangeCallback=[],this.onAnnotationsSubmittedEnabled=t.onAnnotationsSubmittedEnabled||!1,this.sessionManager.on("sessionClose",this.onSessionClose.bind(this)),this.sessionManager.on("reconnect",this.onReconnect.bind(this)),this.sessionManager.on("connect",this.onConnect.bind(this)),this.sessionManager.on("disconnect",this.onDisconnect.bind(this)),this.sessionManager.on("resetNextSyncSequenceId",this.resetNextSyncSequenceId.bind(this)),this.sessionManager.on("serverAuthenticationStateChange",this.onServerAuthenticationStateChange.bind(this)),this.sessionManager.onMessage(l.AnnotationResultsMessage.getTypeName(),this.workflowRuntime?this.onAnnotationResultsFromLocal.bind(this):this.onAnnotationResultsFromServer.bind(this)),this.sessionManager.onMessage(l.AnnotationResultStateMessage.getTypeName(),this.onAnnotationResultStateMessage.bind(this)),this.sessionManager.onMessage(l.WorkflowExecutionCompleteMessage.getTypeName(),this.onWorkflowExecutionCompleteMessage.bind(this)),t.isDeltaGeneratorEnabled&&(this.enableSyncDeltaSending=!t.disableSyncDeltaSending,this.syncDeltaTimeout=null!==(n=t.syncDeltaTimeout)&&void 0!==n?n:700,this.enableDeltaGenerator()),this.setServerAuthenticationStateChangeCallback(this.updateGraphOnAuthStateChange.bind(this))}return(0,s.default)(e,[{key:"tryGetDocSessionId",value:function(){if(this.clientMetadata&&this.clientMetadata.docSessionId)return this.clientMetadata.docSessionId}},{key:"getSessionStateCallbackToken",value:function(e){var t;return e+"-callback-"+(null!==(t=this.tryGetDocSessionId())&&void 0!==t?t:"unknown")+"-"+this.sessionStateCallbackToken++}},{key:"updateGraphOnAuthStateChange",value:function(e){this.tryActivateWorkflows()}},{key:"tryActivateWorkflows",value:function(){var e=this;if(this.enableRemoteExecutionNotification){var t=new T.Operation({operationName:"GraphServerWorkflowActivation",success:!0}).setClientMetadata(this.clientMetadata).start(),n=[];this.workflowGraph.getWorkflowNodes().filter((function(e){return e.location===w.Location.External})).forEach((function(t){e.localWorkflowManager.canActivateWorkflow(t,e)?t.isActivated=!0:(e.localWorkflowManager.deactivateServerWorkflow(t,e),n.push(t.workflow.id))})),t.resultDescription="deactivated workflows: [".concat(n.join(),"]"),T.Log.info(508879493,T.LogCategory.CoreDefault,t.stop())}}},{key:"initialize",value:function(){var e=this;return this.localWorkflowManager&&this.localWorkflowManager.addSession(this),this.registerLocalWorkflowsWithoutGraphInit(this.localRegisteredWorkflows),this.sessionManager.init(this.extensionConfigs,this.hostCallbacks.onInitSession?this.hostCallbacks.onInitSession:void 0,this.egress).then((function(){return e.localWorkflowManager&&e.localWorkflowManager.setTokenCallback(e.getAuthToken.bind(e)),e}))}},{key:"isLocalWorkflowRegistered",value:function(e){return this.getLocalRegisteredWorkflows().some((function(t){return e===t.id}))}},{key:"isConnected",get:function(){return!!this.connectParams}},{key:"hasConnected",get:function(){return this.hasSessionConnected}},{key:"isClosed",get:function(){return this.isSessionClosed}},{key:"getServerAuthenticationState",value:function(){return this.serverAuthenticationState}},{key:"getContextIdManager",value:function(){return this.contextIdManager}},{key:"getWorkflowItemStorage",value:function(){return this.workflowItemStorage}},{key:"getWorkflowDefinition",value:function(e,t){return this.workflowDefinitionManager.getWorkflowDefinition(e,t)}},{key:"registerLocalWorkflows",value:function(e){this.registerLocalWorkflowsWithoutGraphInit(e),this.trySendWorkflowGraphInitMessage()}},{key:"registerLocalWorkflowsWithoutGraphInit",value:function(e){if(e.length){if(this.workflowRuntime){var t,n=u(e);try{for(n.s();!(t=n.n()).done;){var o=t.value;this.workflowRuntime.registerWorkflow(o),this.sendMessageToSession(new f.WorkflowRegistrationMessage({workflowDefinition:o}))}}catch(e){n.e(e)}finally{n.f()}}if(this.localWorkflowManager){var r,i=u(e);try{for(i.s();!(r=i.n()).done;){var a=r.value;this.localWorkflowManager.registerLocalWorkflow(a,this)}}catch(e){i.e(e)}finally{i.f()}}}}},{key:"registerLocalWorkflow",value:function(e){this.registerLocalWorkflows([e]);var t=new T.Operation({operationName:"SessionRegisterLocalWorkflow",resourceId:e.id,success:!0}).setClientMetadata(this.clientMetadata).start();O(t)}},{key:"activateAnnotation",value:function(e,t){var n,o=new g.AnnotationActivationTracker(this.sendMessageToSession.bind(this),e,t);if(t&&t.callback){var r=this.annotationCallbacks.get(e);r||(r=new Map,this.annotationCallbacks.set(e,r)),r.set(o.token,t.callback)}var i=null!==(n=this.tokensByAnnotationType.get(e))&&void 0!==n?n:[];return-1===i.indexOf(o.token)&&i.push(o.token),this.tokensByAnnotationType.set(e,i),this.annotationActivationTrackers.set(o.token,o),this.activateAnnotationForTracker(o,{ignoreExistingAnnotations:!1,sendOnlyIfConnected:!1})}},{key:"activateAnnotationForTracker",value:function(e,t){var n=new T.Operation({operationName:"ActivateAnnotation",resourceId:e.annotationType,success:!0}).setClientMetadata(this.clientMetadata).start();return e.activate(t.ignoreExistingAnnotations,t.sendOnlyIfConnected).then((function(o){return n.resultSignature="Ok",n.resultDescription="Activated annotation ".concat(e.annotationType," with token ").concat(e.token,"; sendOnlyIfConnected: ").concat(t.sendOnlyIfConnected),O(n),o})).catch((function(o){throw O(n,"error on activate annotation type ".concat(e.annotationType,": ").concat(o,"; sendOnlyIfConnected: ").concat(t.sendOnlyIfConnected)),o}))}},{key:"updateAnnotationConfig",value:function(e,t){var n=new l.AnnotationConfigUpdateMessage({token:e,config:t});this.sendMessageToSession(n);var o=this.annotationActivationTrackers.get(e);o&&o.options&&(o.options.config=t)}},{key:"releaseAnnotation",value:function(e){var t=this.annotationActivationTrackers.get(e);if(t){this.annotationActivationTrackers.delete(e);var n=this.annotationCallbacks.get(t.annotationType);return n&&(n.delete(e),0==n.size&&this.annotationCallbacks.delete(t.annotationType)),t.release()}return Promise.resolve(!1)}},{key:"setAnnotationState",value:function(e,t,n){var o={state:n};this.submitOperation(new d.UpdateAnnotationMetaDataOperation({parentPath:e,items:[{id:t}],M_:o}))}},{key:"setAnnotationMetadata",value:function(e,t,n){this.submitOperation(new d.UpdateAnnotationMetaDataOperation({parentPath:e,items:[{id:t}],M_:n}))}},{key:"submitOperation",value:function(e,t){this.submitOperations([e],t)}},{key:"submitOperations",value:function(e,t){if(this.contextIdManager.applyContextIdOnOperations(e),this.updateWorkflowExecutionStates(e),!this.onAnnotationsSubmittedEnabled){var n=this.partitionAnnotationOperations(e),o=(0,i.default)(n,2),a=o[0];o[1];this.executeCallbacksOnAnnotationSubmitted(a)}var s=e.filter(this.filterOperationsForSession.bind(this)).filter(I);if(this.workflowRuntime)if(this.onAnnotationsSubmittedEnabled){var c=this.partitionAnnotationOperations(s),l=(0,i.default)(c,2),f=l[0],p=l[1];this.onAnnotationsSubmitted(f,t),this.submitOperationsToSession(p,t)}else this.submitOperationsToSession(s,t);else{var h=[];if(this.deltaGenerator){var g,y=new T.Operation({operationName:"ExecuteDeltaGenerator",success:!0}).setClientMetadata(this.clientMetadata).start(),m=u(s);try{for(m.s();!(g=m.n()).done;){var v=g.value;if(d.UpdateOperation.typeGuard(v))h.push.apply(h,(0,r.default)(this.createDeltasFromUpdateOperation(v)));else{var k,S=v,b=u(S.items);try{for(b.s();!(k=b.n()).done;){var w=k.value;d.AddOperation.typeGuard(v)?this.deltaGenerator.addItemToLocalMap(w,S.parentPath):d.DeleteOperation.typeGuard(v)&&this.deltaGenerator.deleteItemFromLocalMap(w,S.parentPath)}}catch(e){b.e(e)}finally{b.f()}h.push(v)}}}catch(e){m.e(e)}finally{m.f()}O(y)}if(this.onAnnotationsSubmittedEnabled){var C=this.partitionAnnotationOperations(h.length?h:s),_=(0,i.default)(C,2),x=_[0],M=_[1];this.onAnnotationsSubmitted(x,t),this.submitOperationsToSession(M,t)}else this.submitOperationsToSession(h.length?h:s,t);this.localWorkflowManager&&this.localWorkflowManager.runLocalWorkflows(e,this,!0)}}},{key:"submitSeedOperations",value:function(e,t){if(!this.allowSeed)throw new Error("Cannot submit seed operations more than once per session");if(this.networkMode===f.NetworkMode.LocalWorkflowsOnly&&this.localWorkflowManager)this.localWorkflowManager.runLocalWorkflows(e,this);else{this.allowSeed=!1,this.allowGroupSeed=!1;var n=this.partitionAnnotationOperations(e),o=(0,i.default)(n,2),r=o[0],a=o[1];this.onAnnotationsSubmittedEnabled?this.onAnnotationsSubmitted(r,t):this.executeCallbacksOnAnnotationSubmitted(r),this.operationBatchConfig?this.sendSeedMessagesViaBatchManager(this.onAnnotationsSubmittedEnabled?a:e,!0,t):this.sendMessageToSession(new l.SyncMessage({cv:t,seq:0,ops:this.onAnnotationsSubmittedEnabled?a:e}))}}},{key:"submitSeedGroupOperations",value:function(e,t,n){if(!this.allowGroupSeed)throw new Error("Seed operations are not allowed for this session");if(this.networkMode===f.NetworkMode.LocalWorkflowsOnly&&this.localWorkflowManager)this.localWorkflowManager.runLocalWorkflows(e,this);else{t&&(this.allowGroupSeed=!1),this.allowSeed=!1;var o=this.partitionAnnotationOperations(e),r=(0,i.default)(o,2),a=r[0],s=r[1];this.executeCallbacksOnAnnotationSubmitted(a),this.onAnnotationsSubmittedEnabled?this.onAnnotationsSubmitted(a,n):this.executeCallbacksOnAnnotationSubmitted(a),this.operationBatchConfig?this.sendSeedMessagesViaBatchManager(this.onAnnotationsSubmittedEnabled?s:e,!!t,n):(this.seedGroupSize++,this.sendMessageToSession(new l.SyncMessage({cv:n,seq:0,ops:this.onAnnotationsSubmittedEnabled?s:e,groupId:"Seed",groupSize:t?this.seedGroupSize:void 0,groupComplete:t||void 0})))}}},{key:"submitCustomMessage",value:function(e){var t=this;return new Promise((function(n,o){t.sendMessageToSession(e,(function(e,t){e?o(new Error(e.error)):n(t)}))}))}},{key:"submitLargeBinaryDataMessage",value:function(e){var t=this;return new Promise((function(n,o){t.sendMessageToSessionPostEndpoint(e,(function(e,t){e?o(new Error(e.error)):n(t)}))}))}},{key:"requestBinaryDataForBlob",value:function(e){var t=this;return e.data?Promise.resolve(e.data):e.dataPointer&&e.dataPointer.refType!==d.BlobRefType.None?new Promise((function(n,o){t.requestBinaryDataFromSessionBlobEndpoint(e.dataPointer,(function(e,t){e?o(e):n(t)}))})):Promise.reject(new Error("Blob does not have a data pointer"))}},{key:"requestCacheDump",value:function(e){if(e)throw new Error("NYI");return this.submitCustomMessage(new l.CacheDumpRequestMessage)}},{key:"forceReconnect",value:function(e){return this.extensionConfigs=e,this.sessionManager.forceReconnect(e)}},{key:"close",value:function(){this.isSessionClosed=!0,this.sessionManager.closeSession(),this.workflowRuntime&&this.workflowRuntime.close(),this.localWorkflowManager&&this.localWorkflowManager.closeSession(this),this.graphInitMessageTimer&&(clearTimeout(this.graphInitMessageTimer),this.graphInitMessageTimer=void 0)}},{key:"getClientMetadata",value:function(){return this.clientMetadata}},{key:"getUserContext",value:function(){return this.userContext}},{key:"setSessionCloseCallback",value:function(e){var t=this.getSessionStateCallbackToken("close");return e&&this.sessionCloseCallbacks.set(t,e),t}},{key:"setConnectCallback",value:function(e){var t=this.getSessionStateCallbackToken("connect");return e&&this.connectCallbacks.set(t,e),t}},{key:"setDisconnectCallback",value:function(e){var t=this.getSessionStateCallbackToken("disconnect");return e&&this.disconnectCallbacks.set(t,e),t}},{key:"setReconnectCallback",value:function(e){var t=this.getSessionStateCallbackToken("reconnect");return e&&this.reconnectCallbacks.set(t,e),t}},{key:"removeSessionStateCallback",value:function(e){function t(t){return!!t.has(e)&&(t.delete(e),!0)}return t(this.sessionCloseCallbacks)||t(this.reconnectCallbacks)||t(this.disconnectCallbacks)||t(this.connectCallbacks)}},{key:"setServerAuthenticationStateChangeCallback",value:function(e){this.serverAuthenticationStateChangeCallback.push(e),e(this.serverAuthenticationState)}},{key:"onAnnotationResults",value:function(e,t,n){var o=this;T.Log.info(508916486,T.LogCategory.CoreDefault,new T.Operation({operationName:"OnAnnotationResultsEgress",dimension0:null==e?void 0:e.annotationType,success:!0})),n(void 0,new l.Response),t===A.LocalWorkflow&&this.contextIdManager.applyContextIdOnOperations(e.ops),this.updateWorkflowExecutionStates(e.ops),this.egress&&this.egress(e,(function(){})),this.annotationResultsProcessor.process(e,(function(e,n){o.applyOperationForContext(e,n,t)}),(function(t){o.triggerRegisteredAnnotationCallbacks(t,e.annotationType)}),(function(e){if(t!==A.ServerWorkflow){var n=e.ops.filter(o.filterOperationsForSession.bind(o)).filter(I);o.submitOperationsToSession(n,e.cv)}o.localWorkflowManager&&o.localWorkflowManager.runLocalWorkflows(e.ops,o)}))}},{key:"onAnnotationResultStateMessage",value:function(e,t){var n;t(void 0,new l.Response);var o,r=u(e.updates);try{for(r.s();!(o=r.n()).done;){var i=o.value,a=i.annotationType,s=i.state;if(this.tokensByAnnotationType.has(a)){var c=void 0;c=this.annotationResultStates.has(a)?this.annotationResultStates.get(a):s===l.AnnotationResultState.Idle?l.AnnotationResultState.Pending:l.AnnotationResultState.Idle;var f,d=u(this.tokensByAnnotationType.get(a));try{for(d.s();!(f=d.n()).done;){var p=f.value,h=this.annotationActivationTrackers.get(p);(null===(n=h.options)||void 0===n?void 0:n.stateUpdateCallback)&&h.options.stateUpdateCallback(c,s)}}catch(e){d.e(e)}finally{d.f()}}}}catch(e){r.e(e)}finally{r.f()}}},{key:"submitOperationsToSession",value:function(e,t){var n=this,o=e.filter((function(e){return d.SignalOperation.typeGuard(e)})),r=e.filter((function(e){return!d.SignalOperation.typeGuard(e)}));if(o.length>0&&this.sendMessageToSession(new l.SyncMessage({cv:t,ops:o})),r.length>0)if(this.operationBatchConfig){if(!this.batchedOperationsManager){this.batchedOperationsManager=new y.BatchManager((function(e,t,o){n.sendMessageToSession(new l.SyncMessage({cv:t.cv,seq:n.nextSyncSequenceId++,ops:e}),(function(e){o(e?new Error(e.error):void 0)}))}))}this.batchedOperationsManager.addBatchItem(r,this.operationBatchConfig,{name:"SubmitOperations"},t)}else this.sendMessageToSession(new l.SyncMessage({cv:t,seq:this.nextSyncSequenceId++,ops:r}))}},{key:"sendMessageToSession",value:function(e,t){this.sessionManager.sendMessage(e,t),l.SessionCloseMessage.typeGuard(e)&&this.close()}},{key:"sendMessageToSessionPostEndpoint",value:function(e,t){var n=this;if(this.connectParams)this.sendLargeBinaryDataMessage(this.connectParams,e,t);else{var o=function(o){return n.sendLargeBinaryDataMessage(o,e,t)}.bind(this);this.pendingConnectCallbacks.push(o)}}},{key:"requestBinaryDataFromSessionBlobEndpoint",value:function(e,t){var n=this;if(this.connectParams)this.requestBinaryData(this.connectParams,e,t);else{var o=function(o){return n.requestBinaryData(o,e,t)}.bind(this);this.pendingConnectCallbacks.push(o)}}},{key:"registerContextTypes",value:function(e){var t,n=u(e);try{for(n.s();!(t=n.n()).done;){var o=t.value;this.activateAnnotation(o),this.registeredContextTypes.add(o)}}catch(e){n.e(e)}finally{n.f()}}},{key:"applyOperationForContext",value:function(e,t,n){var o=this,r=d.SchemaObject.getTypeNameFor(e);if(r==d.AddOperation.getTypeName()||r==d.Operation.getTypeName()||r==d.UpdateOperation.getTypeName()||r==d.DeleteOperation.getTypeName()){r==d.Operation.getTypeName()&&(r=d.AddOperation.getTypeName());var i=(0,b.shallowCloneItemWithPath)(this.resolvePlaceholdersInOperationParentPath(e.parentPath),t),a=(0,b.makeItemPathKey)(i.parentPath);if(r==d.AddOperation.getTypeName()||r==d.UpdateOperation.getTypeName()){if(!i.body)return;var s=d.SchemaObject.getTypeNameFor(i.body);if(!this.registeredContextTypes.has(s))return;var u=this.availableContexts.get(s);u||(u=new Map,this.availableContexts.set(s,u));var c=u.get(n);if(c||(c=[],u.set(n,c)),!i.id){if(this.workflowRuntime)throw new Error("Expected item to have id already");this.localWorkflowManager&&(i.id=this.localWorkflowManager.getNextClientAnnotationId())}if(r==d.AddOperation.getTypeName())0==c.filter((function(e){return(0,b.makeItemPathKey)(e.parentPath)==a&&e.id==i.id})).length?c.push(i):T.Log.info(540848911,T.LogCategory.CoreDefault,"AddOperation for (".concat(n,", ").concat(i.id,", ").concat(i.source,") can't be applied as the context item with matching path and ID already exists. Use UpdateOperation instead."));else for(var l=0;l<c.length;l++)if(c[l].id==i.id&&(0,b.makeItemPathKey)(c[l].parentPath)==a){if(c[l].source==i.source){c[l]=i;break}T.Log.warn(540848912,T.LogCategory.CoreDefault,"UpdateOperation for (".concat(n,", ").concat(i.id,", ").concat(i.source,") can't be applied as the context item with provided path and ID has different source: ").concat(c[l].source))}else T.Log.warn(540848913,T.LogCategory.CoreDefault,"UpdateOperation for (".concat(n,", ").concat(i.id,", ").concat(i.source,") can't be applied as the context item with matching path and ID was not found. AddOperation should be used instead"))}else if(r==d.DeleteOperation.getTypeName()){if(!i.id)return;this.availableContexts.forEach((function(e,t){var r=e.get(n);r&&(0==(r=r.filter((function(e){return!((0,b.makeItemPathKey)(e.parentPath)==a&&e.id==i.id)}))).length?e.delete(n):e.set(n,r),0==e.size?o.availableContexts.delete(t):o.availableContexts.set(t,e))}))}}}},{key:"updateWorkflowExecutionStates",value:function(e){if(this.localWorkflowManager){var t,n=this.enableRemoteExecutionNotification?this.workflowGraph.getWorkflowNodes().map((function(e){return e.workflow})):this.localWorkflowManager.getAllRegisteredWorkflowsFromSession(this),o=u(e);try{for(o.s();!(t=o.n()).done;){var r=t.value;if(w.supportedOperationSet.has(d.SchemaObject.getTypeNameFor(r))){var i,a=u(r.items);try{for(a.s();!(i=a.n()).done;){var s,c=i.value,l=u(n||[]);try{for(l.s();!(s=l.n()).done;){var f=s.value;this.localWorkflowManager.preProcessItemToWorkflow(f,c,this)}}catch(e){l.e(e)}finally{l.f()}}}catch(e){a.e(e)}finally{a.f()}}}}catch(e){o.e(e)}finally{o.f()}}}},{key:"resolveRequestedContexts",value:function(e){var t,n=[],o=u((0,S.getContextTypes)(e.requestedContextTypesRules));try{for(o.s();!(t=o.n()).done;){var a=(0,i.default)(t.value,3),s=a[0],c=a[1];a[2];if(this.availableContexts.has(s)){var l=Array.from(this.availableContexts.get(s).values()).reduce((function(e,t){return e.concat(t)}),[]);if(0==l.length)throw new Error("Assert: availableContexts have the entry for ".concat(s," which does not contain any context annotation."));n.push.apply(n,(0,r.default)(l))}else if(c==m.RequestedContextCardinality.Required)return[!1,[]]}}catch(e){o.e(e)}finally{o.f()}return[!0,this.removeDuplicatedContextItems(n)]}},{key:"removeDuplicatedContextItems",value:function(e){return e.filter((function(e,t,n){return n.findIndex((function(t){return v.Utils.deepEquals(t,e)}))===t}))}},{key:"getContextAnnotations",value:function(e,t,n,o){var r,i,a=n?(0,b.makeItemPathKey)(n):void 0;return null===(i=null===(r=this.availableContexts.get(e))||void 0===r?void 0:r.get(t))||void 0===i?void 0:i.filter((function(e){return!(a&&(0,b.makeItemPathKey)(e.parentPath)!=a||o&&e.source!=o)}))}},{key:"onWorkflowDefinitionOverrideMessage",value:function(e){var t=new T.Operation({operationName:"WorkflowDefinitionOverride",success:!0}).setClientMetadata(this.clientMetadata).start(),n=function(e){throw O(t,e),Error("WorkflowDefinitionOverride: ".concat(e))};if(this.localWorkflowManager){var o=this.localWorkflowManager.getWorkflowDefinitionsByName(this),r=o.get(e.sourceWorkflowId);if(r){t.resourceId=r.id;var i=o.get(e.targetWorkflowId);i&&(i.allowDefinitionOverride?r.definitionOverrideTargetWorkflows&&-1!==r.definitionOverrideTargetWorkflows.indexOf(i.id)?(this.workflowDefinitionManager.mergeWorkflowDefinition(i,e.definition,e.contextId),t.resultDescription="Updated config for workflow: ".concat(e.targetWorkflowId,", context id: ").concat(e.contextId),O(t)):n("Workflow '".concat(r.id,"' does not allow workflow definition for workflow '").concat(i.id,"'.")):n("Workflow '".concat(i.id,"' does not allow workflow definition override.")))}else n("Workflow registration for source workflow '".concat(e.targetWorkflowId,"' was not found."))}else n("Not supported by this local SessionProxy instance.")}},{key:"applyContextIdOnOperations",value:function(e){this.contextIdManager.applyContextIdOnOperations(e)}},{key:"attachToWorkflowGraph",value:function(e){this.addToWorkflowGraph(e),this.attachExecutionTrackerToEachWorkflow()}},{key:"triggerRegisteredAnnotationCallbacks",value:function(e,t){if(this.callAnnotationCallbacks(e,t),this.hostCallbacks.onAnnotationResult)try{this.hostCallbacks.onAnnotationResult(e)}catch(e){T.Log.error(540301151,T.LogCategory.CoreDefault,"onAnnotationResult error: ".concat(e))}}},{key:"attachExecutionTrackerToEachWorkflow",value:function(){this.localWorkflowManager&&this.localWorkflowManager.attachExecutionTrackerToEachWorkflow(this.workflowGraph,this,this.onWorkflowExecutionComplete.bind(this))}},{key:"onWorkflowExecutionCompleteMessage",value:function(e,t){t(void 0,new l.Response),this.localWorkflowManager&&this.localWorkflowManager.onExternalWorkflowExecuted(e.contextId,e.workflowId,this)}},{key:"onWorkflowExecutionComplete",value:function(e,t){}},{key:"enableDeltaGenerator",value:function(){var e,t;this.deltaGenerator=null!==(e=this.deltaGenerator)&&void 0!==e?e:new _.DeltaGenerator,this.syncDeltaTimers=null!==(t=this.syncDeltaTimers)&&void 0!==t?t:new Map}},{key:"createDeltasFromUpdateOperation",value:function(e){var t,n,o=[];T.Log.info(523776396,T.LogCategory.CoreDefault,"Calling delta create for UpdateOperation under parent path [".concat(e.parentPath,"] (").concat(null===(t=e.items)||void 0===t?void 0:t.length," item(s), first item id: ").concat((null===(n=e.items)||void 0===n?void 0:n.length)>0?e.items[0].id:"(no items)",")"));var i,a=(0,r.default)(e.parentPath),s=u(e.items);try{for(s.s();!(i=s.n()).done;){var c=i.value,l=[],f=this.deltaGenerator.createTextTileDeltasFromItem(c,e.parentPath);if(null==f?void 0:f.length){var p,h=u(f);try{for(h.s();!(p=h.n()).done;){var g=p.value,y=(0,M.v4)();a=[].concat((0,r.default)(e.parentPath),[c.id]);var m={id:y,revId:c.revId,body:g,contextId:c.contextId,source:c.source};l.push(m)}}catch(e){h.e(e)}finally{h.f()}l.length>0&&(o.push(new d.DeltaUpdateOperation({parentPath:a,items:l})),this.enableSyncDeltaSending&&this.setupSyncDeltaAfterDelay(c,a,l))}else T.Log.info(523329632,T.LogCategory.CoreDefault,"Failed to create delta on item ".concat(c.id))}}catch(e){s.e(e)}finally{s.f()}return o}},{key:"setupSyncDeltaAfterDelay",value:function(e,t,n){var o,r,i,a=this,s=this.syncDeltaTimers.get(e.id);s&&(clearTimeout(s),this.syncDeltaTimers.delete(e.id));var u=n.find((function(e){var t;return(null===(t=e.body)||void 0===t?void 0:t.unit)===x.TextTileDeltaUnit.Chars}));if(u){var c=u.body,l={content:"",deltaType:x.TextTileDeltaType.Update,length:0,position:(null!==(o=null==c?void 0:c.position)&&void 0!==o?o:0)+(null!==(i=null===(r=null==c?void 0:c.content)||void 0===r?void 0:r.length)&&void 0!==i?i:0),unit:x.TextTileDeltaUnit.Sentence},f=x.FormattedTextTile.typeGuard(e.body)?new x.FormattedTextTileDelta(l):new x.TextTileDelta(l),p={id:(0,M.v4)(),revId:e.revId,body:f,contextId:e.contextId,source:e.source},h=new d.DeltaUpdateOperation({parentPath:t,items:[p]}),g=setTimeout((function(e,t){a.submitOperation(e),a.syncDeltaTimers.delete(t)}),this.syncDeltaTimeout,h,e.id);this.syncDeltaTimers.set(e.id,g)}}},{key:"addToWorkflowGraph",value:function(e){this.workflowGraph.addWorkflow((0,w.getWorkflowDefinitionBase)(e))}},{key:"getAuthToken",value:function(e,t){var n={Tickets:[]};this.clientMetadata.docSessionId&&(n.DocSessionId=this.clientMetadata.docSessionId);var o=function(e){if(e===m.AuthTokenType.Substrate)return p.AuthTokenType.Substrate}(e);o&&(n.TokenType=o),this.hostCallbacks.requestAuthToken(n).then((function(n){var o;n?t(void 0,n.Token,{returnedTokenType:e,timeToLiveSec:null===(o=n.TokenProperties)||void 0===o?void 0:o.timeToLiveSec}):t(new Error("Missing AuthTokenResponse from requestAuthToken"))})).catch((function(e){return t(e)}))}},{key:"resetNextSyncSequenceId",value:function(){this.nextSyncSequenceId=1}},{key:"onReconnect",value:function(){var e=this;if(this.annotationActivationTrackers.forEach((function(t){e.activateAnnotationForTracker(t,{ignoreExistingAnnotations:!0,sendOnlyIfConnected:!0}).catch((function(){}))})),this.reconnectCallbacks.forEach((function(e,t){e()})),!this.connectParams)throw new Error("Expected onConnect before onReconnect")}},{key:"onSessionClose",value:function(e){this.isSessionClosed=!0,this.connectParams=void 0,this.sessionCloseCallbacks.forEach((function(t,n){t(e)}))}},{key:"onConnect",value:function(e,t,n,o,r,i){this.hasSessionConnected?e&&(this.allowSeed=!0,this.allowGroupSeed=!0,this.seedGroupSize=0,this.seedBatchedOperationsManager&&(this.seedBatchedOperationsManager.removeAllBatchedItems(),this.seedBatchedOperationsManager=void 0),this.batchedOperationsManager&&(this.batchedOperationsManager.removeAllBatchedItems(),this.batchedOperationsManager=void 0)):this.enableRemoteExecutionNotification&&this.addDownstreamWorkflowsIntoClientGraph(i),this.connectParams={isSeedingRequired:e,sessionUrl:t,origin:n,authToken:o},this.hasSessionConnected=!0,this.tryActivateWorkflows();var a,s=u(this.pendingConnectCallbacks);try{for(s.s();!(a=s.n()).done;){(0,a.value)(this.connectParams)}}catch(e){s.e(e)}finally{s.f()}this.connectCallbacks.forEach((function(r,i){r(e,t,n,o)})),this.serverInputTypes=r}},{key:"onDisconnect",value:function(e){this.connectParams=void 0,this.disconnectCallbacks.forEach((function(t,n){t(e)}))}},{key:"onServerAuthenticationStateChange",value:function(e){if(e!=this.serverAuthenticationState){if(this.serverAuthenticationState==l.ServerAuthenticationState.Authenticated&&e==l.ServerAuthenticationState.Pending)return;this.serverAuthenticationState=e;var t,n=u(this.serverAuthenticationStateChangeCallback);try{for(n.s();!(t=n.n()).done;){(0,t.value)(this.serverAuthenticationState)}}catch(e){n.e(e)}finally{n.f()}}}},{key:"callAnnotationCallbacks",value:function(e,t){if(0!==this.annotationCallbacks.size){var n=this.annotationCallbacks.get(t);n&&n.forEach((function(t){t(e)}))}}},{key:"getOperationBatchConfig",value:function(e){return{delayMs:e.delayMs,delayMsMax:e.delayMsMax,maxInputSize:e.maxInputSize,estimateSize:M.estimateSize,groupingKeyExtractor:function(){return"operations"},multiplex:function(e){return{input:e.filter((function(e){return e.length})).reduce((function(e,t){return e.concat(t)}),[]),demultiplex:function(){return[[]]}}},split:function(e){if(!(e.length<=1))return{inputs:e.reduce((function(e,t){return e.push([t]),e}),[]),join:function(){return[]}}}}}},{key:"sendSeedMessagesViaBatchManager",value:function(e,t,n){var o=this;if(!this.seedBatchedOperationsManager){this.seedBatchedOperationsManager=new y.BatchManager((function(e,t,n){o.seedGroupSize++,o.sendMessageToSession(new l.SyncMessage({cv:t.cv,seq:0,ops:e,groupId:"Seed",groupSize:t.groupComplete?o.seedGroupSize:void 0,groupComplete:t.groupComplete?t.groupComplete:void 0}),(function(e){n(e?new Error(e.error):void 0)}))}))}this.seedBatchedOperationsManager.addBatchItem(e,this.operationBatchConfig,{name:"SubmitSeedOperations"},n,t)}},{key:"onAnnotationResultsFromServer",value:function(e,t){this.onAnnotationResults(e,A.ServerWorkflow,t)}},{key:"onAnnotationResultsFromLocal",value:function(e,t){this.onAnnotationResults(e,A.LocalWorkflow,t)}},{key:"getLocalRegisteredWorkflows",value:function(){return this.workflowRuntime?this.workflowRuntime.getRegisteredWorkflows():this.localWorkflowManager?this.localWorkflowManager.getAllRegisteredWorkflowsFromSession(this).map((function(e){return(0,w.getWorkflowDefinitionBase)(e)})):[]}},{key:"sendWorkflowGraphInitMessage",value:function(){var e=this,t=this.getLocalRegisteredWorkflows(),n=new T.Operation({operationName:"WorkflowGraphInit",success:!0}).setClientMetadata(this.clientMetadata).start(),o=new l.WorkflowGraphInitMessage({upstreamRuntimeWorkflows:t});this.sendMessageToSession(o,(function(o,r){o?O(n,o.error):(n.resultDescription="local workflows: ".concat(t.map((function(e){return e.id})),", remote workflows: ").concat(r.downstreamRuntimeWorkflows.map((function(e){return e.id}))),O(n),e.onWorkflowGraphInitResponse(r))}))}},{key:"trySendWorkflowGraphInitMessage",value:function(){var e=this;!this.graphInitMessageTimer&&this.enableRemoteExecutionNotification&&(this.graphInitMessageTimer=setTimeout((function(){e.graphInitMessageTimer=void 0,e.sendWorkflowGraphInitMessage()}),n.graphInitDelayMs))}},{key:"onWorkflowGraphInitResponse",value:function(e){this.addDownstreamWorkflowsIntoClientGraph(e.downstreamRuntimeWorkflows),this.tryActivateWorkflows()}},{key:"addDownstreamWorkflowsIntoClientGraph",value:function(e){this.workflowGraph.removeWorkflows(!0);var t,n=u(e||[]);try{for(n.s();!(t=n.n()).done;){var o=t.value;this.workflowGraph.addWorkflow(o,!0)}}catch(e){n.e(e)}finally{n.f()}this.workflowRuntime||this.attachExecutionTrackerToEachWorkflow()}},{key:"resolvePlaceholdersInOperationParentPath",value:function(e){var t=e;return 3==t.length&&"session"==t[0]&&"user"==t[1]&&t[2].startsWith("user_")&&(T.Log.info(540848914,T.LogCategory.CoreDefault,"Replacing user context placeholder for: ".concat((0,b.makeItemPathKey)(e),".")),t=["session","#userContext#"]),3==t.length&&"session"==t[0]&&"user"==t[1]&&t[2].startsWith("tenant_")&&(T.Log.info(540848915,T.LogCategory.CoreDefault,"Replacing tenant context placeholder for: ".concat((0,b.makeItemPathKey)(e),".")),t=["session","#tenantContext#"]),t}},{key:"filterOperationsForSession",value:function(e){return!!this.workflowRuntime||(0,v.isServerOp)(e,this.serverInputTypes)}},{key:"makeRequestForConnectParams",value:function(e,t){var n=e.authToken,o=e.origin,r=e.sessionUrl,i=t.body,a=t.cv,s=t.method,u=t.requestUrl;return(0,h.fetch)(u||r,{method:s,headers:{Authorization:"Bearer ".concat(n),"x-origin":o,"x-correlationid":a},body:i}).then((function(e){if(200!==e.status)throw new Error("Unexpected status code: ".concat(e.status));return e}))}},{key:"sendLargeBinaryDataMessage",value:function(e,t,n){var o,r=new T.Operation({operationName:"SendLargeBinaryDataMessage",success:!0,cv:t.cv}).setClientMetadata(this.clientMetadata).start();this.makeRequestForConnectParams(e,{body:k.JSOND.serialize(t),cv:r.cv,method:"POST"}).then((function(e){return e.json()})).catch((function(e){o=new l.ErrorResponse({messageId:t.messageId,error:e.message})})).then((function(e){O(r,o?o.error:void 0),n(o,e)}))}},{key:"requestBinaryData",value:function(e,t,n){var o,r=new T.Operation({operationName:"RequestBinaryData",success:!0,cv:(new T.CorrelationVector).toString()}).setClientMetadata(this.clientMetadata).start(),i=e.sessionUrl;this.makeRequestForConnectParams(e,{cv:r.cv,method:"GET",requestUrl:t.refType===d.BlobRefType.AlCodedLocation?"".concat(i,"/blob/").concat(t.value):t.value}).then((function(e){return e.arrayBuffer()})).then((function(e){return new Uint8Array(e)})).catch((function(e){o=e})).then((function(e){O(r,o?o.message:void 0),n(o,e)}))}},{key:"executeCallbacksOnAnnotationSubmitted",value:function(e){var t=this;this.getAnnotationOperationsByType(e).forEach((function(e,n){Array.from(e).forEach((function(e){return t.triggerRegisteredAnnotationCallbacks(e,n)}))}))}},{key:"partitionAnnotationOperations",value:function(e){return e.reduce((function(e,t){var n=(0,i.default)(e,2),o=n[0],a=n[1];return t.items.some((function(e){return e.body&&d.Annotation.typeGuard(e.body)}))?[[].concat((0,r.default)(o),[t]),a]:[o,[].concat((0,r.default)(a),[t])]}),[[],[]])}},{key:"onAnnotationsSubmitted",value:function(e,t){var n=this;this.getAnnotationOperationsByType(e).forEach((function(e,o){var r=Array.from(e);n.onAnnotationResults(new l.AnnotationResultsMessage({annotationType:o,ops:r,cv:t}),A.Submitted,(function(){}))}))}},{key:"getAnnotationOperationsByType",value:function(e){var t,n=new Map,o=u(e);try{for(o.s();!(t=o.n()).done;){var r,i=t.value,a=u(i.items);try{for(a.s();!(r=a.n()).done;){var s=r.value;if(s.body&&d.Annotation.typeGuard(s.body)){var c=d.SchemaObject.getTypeNameFor(s.body),l=n.get(c)||new Set;l.add(i),n.set(c,l)}}}catch(e){a.e(e)}finally{a.f()}}}catch(e){o.e(e)}finally{o.f()}return n}}]),e}();n.SessionProxy=L},{101:101,105:105,109:109,116:116,118:118,122:122,139:139,15:15,150:150,155:155,160:160,172:172,174:174,178:178,188:188,189:189,196:196,23:23,37:37,40:40,48:48,68:68,74:74}],100:[function(e,t,n){"use strict";var o=e(178),r=o(e(172)),i=o(e(174));Object.defineProperty(n,"__esModule",{value:!0}),n.TelemetryLogger=n.createOperationLoggingAggregator=void 0;var a=e(23),s=e(40);n.createOperationLoggingAggregator=function(e,t,n,o){return new s.LoggingAggregator(e,(function(e){return e.success&&n.indexOf(e[t])>=0}),[t,"resourceId","success","resultSignature","clientDocSessionId","dimension0","dimension1","dimension2","dimension3"],["durationMs"],o)};var u=function(){function e(t){(0,r.default)(this,e),this.level=a.LoggingLevel.info,this.hostCallbacks=t}return(0,i.default)(e,[{key:"log",value:function(t){var n=this;if(null!=this.hostCallbacks&&null!=this.hostCallbacks.sendTelemetryEvent){var o,r,i,s=function(t,o,r,i,s){var u=o.charAt(0).toUpperCase()+o.slice(1),c={DocSessionId:t.clientDocSessionId,ResourceId:t.resourceId,ResultDescription:t.resultDescription,ResultSignature:t.resultSignature,Dimension0:t.dimension0,Dimension1:t.dimension1,Dimension2:t.dimension2,Dimension3:t.dimension3,JoinContextId:t.joinContextId};r&&(c=Object.assign(Object.assign({},c),JSON.parse(r)));var l=i||e.augLoopAriaTenantToken,f=s||l!=e.augLoopAriaTenantToken?s:e.augLoopAriaNamespace;u=u||e.operationNamePlaceholder,n.hostCallbacks.sendTelemetryEvent(l,f?"".concat(f,"_").concat(u):u,c,"Office.System.Activity",{CV:t.cv,Duration:1e3*(t.durationMs||0),Count:t.count,AggMode:2,Success:t.success},!1,a.DataCategories.ProductServiceUsage|a.DataCategories.ProductServicePerformance,a.DiagnosticLevel.RequiredServiceDataEvent)};if("Workflow.MetricsOnly"==t.category);else if("Operation"===t.eventName){var u=t;s(u,u.operationName,u.dataFields)}else if("SessionHealth"===t.eventName){s(t,t.sessionHealthEventName)}else if("WorkflowOperation"===t.eventName){var c=t;s(c,c.operationName,c.dataFields,c.ariaTenant,c.ariaNamespace)}else"Log"===t.eventName&&(o=t.tagId,r=t.traceLevel,i=t.message,n.hostCallbacks.sendDiagnosticTrace&&n.hostCallbacks.sendDiagnosticTrace(o,r,i))}}}]),e}();n.TelemetryLogger=u,u.augLoopAriaTenantToken="3de4087d4de34817b1c376e3d1e6e293-983c4292-5ba9-485a-ab10-9797863c788b-6770",u.augLoopAriaNamespace="Office_AugLoop_Client",u.operationNamePlaceholder="OperationNameNotProvided"},{172:172,174:174,178:178,23:23,40:40}],101:[function(e,t,n){"use strict";var o=e(178),r=o(e(189)),i=o(e(172)),a=o(e(174));function s(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return u(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}var c=e("importDefaultHelper");Object.defineProperty(n,"__esModule",{value:!0}),n.isServerOp=n.getSafeNumber=n.buildArrayOfTypes=n.LogCountLimiter=n.Utils=void 0;var l=e(40),f=e(109),d=e(139),p=c(e(199)),h=function(){function e(){(0,i.default)(this,e)}return(0,a.default)(e,null,[{key:"createHealthCheckRequest",value:function(e){return{payload:{},payloadSchema:{category:f.TypeCategory.Schema,schema:{name:"HealthCheckRequest"}},requestedSchema:{category:f.TypeCategory.Schema,schema:{name:"HealthCheckResponse"}},clientMetadata:e}}},{key:"isFeatureEnabled",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"None";return e&&e.isFeatureEnabled?e.isFeatureEnabled("Microsoft.Office.AugLoop."+t,o).catch((function(){return Promise.resolve(n)})):Promise.resolve(n)}},{key:"convertWebSocketUrlToHttp",value:function(e){return this.convertUrl(e,!1)}},{key:"convertServiceUrlToWebSocket",value:function(e){return this.convertUrl(e,!0)}},{key:"convertUrl",value:function(e,t){if(!e)return e;var n=e.split(":"),o=n[0].toLowerCase();return 0==o.indexOf(t?"http":"ws")?(o=t?o.replace("http","ws"):o.replace("ws","http"),n[0]=o,n.join(":")):e}},{key:"deepEquals",value:function(e,t){return(0,p.default)(e,t)}},{key:"collectTelemetry",value:function(e,t,n,o,r,i){var a,s,u,c;e.start(),e.resultSignature=null!=o?o:"",e.resultDescription=null!=r?r:"",e.success=n,i?(e.dimension0=null!==(a=i[0])&&void 0!==a?a:"",e.dimension1=null!==(s=i[1])&&void 0!==s?s:"",e.dimension2=null!==(u=i[2])&&void 0!==u?u:"",e.dimension3=null!==(c=i[3])&&void 0!==c?c:""):(e.dimension0="",e.dimension1="",e.dimension2="",e.dimension3=""),t.log((function(){return l.Log.info(508367457,l.LogCategory.CoreDefault,e.stop())}))}}]),e}();n.Utils=h,h.getCurrentTimeMs=function(){return Date.now?Date.now():(new Date).getTime()};var g=function(){function e(t){(0,i.default)(this,e),this.maxNumberOfLogs=40,this.numberOfLogs=0,this.id=t}return(0,a.default)(e,[{key:"log",value:function(e){if(this.numberOfLogs<this.maxNumberOfLogs&&(this.numberOfLogs++,e(),this.numberOfLogs===this.maxNumberOfLogs)){var t=new l.Operation({operationName:"OnLastLog",success:!0,resourceId:this.id,resultDescription:"Limit for number of logs for id: ".concat(this.id," reached - all next logs will be dropped")});l.Log.warn(572838107,l.LogCategory.CoreDefault,t)}}}]),e}();n.LogCountLimiter=g;var y=[d.SchemaObject.getTypeName(),d.Annotation.getTypeName(),d.Signal.getTypeName()];n.buildArrayOfTypes=function(e){var t,n=new Set,o=s(e);try{for(o.s();!(t=o.n()).done;){var i=t.value;if("string"==typeof i)-1===y.indexOf(i)&&n.add(i);else for(var a=0,u=[i.getTypeName()].concat((0,r.default)(i.getBaseTypes()));a<u.length;a++){var c=u[a];-1===y.indexOf(c)&&n.add(c)}}}catch(e){o.e(e)}finally{o.f()}return Array.from(n)};n.getSafeNumber=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Number.isFinite(e)?e:t};n.isServerOp=function(e,t){if(!Array.isArray(t)||0===t.length)return!0;if(d.DeltaUpdateOperation.typeGuard(e)||d.UpdateAnnotationMetaDataOperation.typeGuard(e))return!0;var n,o=s(e.items);try{for(o.s();!(n=o.n()).done;){var r=n.value;if(!r.body||d.SchemaObject.matchesTypesFor(r.body,t))return!0}}catch(e){o.e(e)}finally{o.f()}return!1}},{109:109,139:139,172:172,174:174,178:178,189:189,199:199,40:40}],102:[function(e,t,n){t.exports={version:"2.35.46"}},{}],103:[function(e,t,n){"use strict";var o=e(178),r=o(e(172)),i=o(e(174));Object.defineProperty(n,"__esModule",{value:!0}),n.SingleItemWorkflow=void 0;var a=e(23),s=e(101),u=function(){function e(t,n){var o,i,s,u,c,l;(0,r.default)(this,e),this.kind=a.WorkflowKind.SingleItem,this.isStateful=!1,this.id=t,n&&(this.inputTypes=null!==(o=n.inputTypes)&&void 0!==o?o:this.inputTypes,this.outputTypes=null!==(i=n.outputTypes)&&void 0!==i?i:this.outputTypes,this.isStateful=null!==(s=n.isStateful)&&void 0!==s?s:this.isStateful,this.requestedContextTypesRules=null!==(u=n.requestedContextTypesRules)&&void 0!==u?u:this.requestedContextTypesRules,this.definitionOverrideTargetWorkflows=null!==(c=n.definitionOverrideTargetWorkflows)&&void 0!==c?c:this.definitionOverrideTargetWorkflows,this.correlatedSignals=0!==(null===(l=n.correlatedSignals)||void 0===l?void 0:l.length)?n.correlatedSignals:this.correlatedSignals)}return(0,i.default)(e,[{key:"setInputTypes",value:function(e){return this.inputTypes=(0,s.buildArrayOfTypes)(e),this}},{key:"setOutputTypes",value:function(e){return this.outputTypes=(0,s.buildArrayOfTypes)(e),this}},{key:"setStateful",value:function(){return this.isStateful=!0,this}},{key:"setRequestedContexts",value:function(e){var t;return this.requestedContextTypesRules=(null!==(t=this.requestedContextTypesRules)&&void 0!==t?t:this.requestedContextTypesRules=[]).concat(e),this}},{key:"setLambdaType",value:function(e){return this.factory=e,this}},{key:"setDefinitionOverrideTargetWorkflows",value:function(e){return this.definitionOverrideTargetWorkflows=e,this}},{key:"setCorrelatedSignals",value:function(e){return 0!==e.length&&(this.correlatedSignals=e),this}},{key:"setLambda",value:function(e,t){return this.factory=function(){return{init:t||function(e){return Promise.resolve()},execute:e,dispose:function(){}}},this}},{key:"validateOptions",value:function(){return{isValid:!0}}}],[{key:"create",value:function(t){return new e(t)}}]),e}();n.SingleItemWorkflow=u},{101:101,172:172,174:174,178:178,23:23}],104:[function(e,t,n){"use strict";var o=e(178),r=o(e(189)),i=o(e(172)),a=o(e(174));Object.defineProperty(n,"__esModule",{value:!0}),n.WorkflowModel=void 0;var s=e(116),u=e(139),c=function(){function e(t){(0,i.default)(this,e),this.item=t,this.operation=t.op,this.delta=t.delta,this.deltas=t.deltas,this.id=(0,s.makeItemPathKey)(this.itemPath),this.revId=t.revId}return(0,a.default)(e,[{key:"itemPath",get:function(){return[].concat((0,r.default)(this.item.parentPath),[this.item.id])}},{key:"getModelIterator",value:function(){throw new Error("Method not implemented.")}},{key:"getBody",value:function(){return this.item.body}},{key:"getItemReference",value:function(){throw new Error("Method not implemented.")}},{key:"getParentItem",value:function(e){throw new Error("Method not implemented.")}},{key:"getParentItemBody",value:function(e){throw new Error("Method not implemented.")}},{key:"getPrevItem",value:function(e,t){throw new Error("Method not implemented.")}},{key:"getPrevItemBody",value:function(e,t){throw new Error("Method not implemented.")}},{key:"getNextItem",value:function(e,t){throw new Error("Method not implemented.")}},{key:"getNextItemBody",value:function(e,t){throw new Error("Method not implemented.")}},{key:"getChildItem",value:function(e){throw new Error("Method not implemented.")}},{key:"getChildItemBody",value:function(e){throw new Error("Method not implemented.")}},{key:"getChildItems",value:function(e){throw new Error("Method not implemented.")}},{key:"getChildItemBodies",value:function(e){throw new Error("Method not implemented.")}},{key:"getSubtreeItem",value:function(e){throw new Error("Method not implemented.")}},{key:"getSubtreeItemBody",value:function(e){throw new Error("Method not implemented.")}},{key:"getSubtreeItems",value:function(e){throw new Error("Method not implemented.")}},{key:"getSubtreeItemBodies",value:function(e){throw new Error("Method not implemented.")}},{key:"getContextItem",value:function(e){throw new Error("Method not implemented.")}},{key:"getContextItemBody",value:function(e){throw new Error("Method not implemented.")}},{key:"getContextItems",value:function(e){throw new Error("Method not implemented.")}},{key:"getContextItemBodies",value:function(e){throw new Error("Method not implemented.")}},{key:"addAnnotation",value:function(e,t){throw new Error("Method not implemented.")}},{key:"updateAnnotation",value:function(e,t){throw new Error("Method not implemented.")}},{key:"deleteAnnotation",value:function(e){throw new Error("Method not implemented.")}},{key:"loadSubtree",value:function(e){throw new Error("Method not implemented.")}},{key:"getSourceTimestamp",value:function(){return this.item.sourceTimestamp}},{key:"getContextId",value:function(){return this.item.contextId}}]),e}(),l=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];(0,i.default)(this,e),this.scopeItem=void 0,this.rootItem=void 0,this.normalizeFilter=function(e){if(!e)return function(e){return void 0!==e};if("function"==typeof e)throw new Error("Not implemented yet");if((e.id?1:0)+(e.ids?1:0)+(e.itemType?1:0)+(e.itemTypes?1:0)!=1)throw new Error("Exactly one condition expected on IItemFilter");if(e.itemType)return function(t){return t&&u.SchemaObject.matchesTypesFor(t.body,[e.itemType])};if(e.itemTypes)return function(t){return t&&u.SchemaObject.matchesTypesFor(t.body,e.itemTypes)};throw new Error("Not implemented yet")},this.items=[].concat((0,r.default)(n),[t]),this.scopeItem=new c(t)}return(0,a.default)(e,[{key:"getItem",value:function(e){throw new Error("Method not implemented.")}},{key:"getItems",value:function(e){throw new Error("Method not implemented.")}},{key:"getItemBody",value:function(e){return this.getItemBodies(e)[0]}},{key:"getItemBodies",value:function(e){var t=this.normalizeFilter(e);return this.items.filter(t).map((function(e){return e.body}))}},{key:"getItemByReference",value:function(e){throw new Error("Method not implemented.")}},{key:"getItemBodyByReference",value:function(e){throw new Error("Method not implemented.")}}]),e}();n.WorkflowModel=l},{116:116,139:139,172:172,174:174,178:178,189:189}],105:[function(e,t,n){"use strict";var o=e("exportStarHelper");Object.defineProperty(n,"__esModule",{value:!0}),o(e(106),n),o(e(107),n)},{106:106,107:107}],106:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.RuntimeKind=void 0,function(e){e.JsClient="C",e.Server="S"}(n.RuntimeKind||(n.RuntimeKind={}))},{}],107:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},{}],108:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AuthTokenType=n.IdentityProvider=void 0,function(e){e[e.Unknown=0]="Unknown",e[e.LiveId=1]="LiveId",e[e.OrgId=2]="OrgId",e[e.ActiveDirectory=3]="ActiveDirectory",e[e.ADAL=4]="ADAL",e[e.SSPI=5]="SSPI",e[e.OAuth2=6]="OAuth2",e[e.Badger=7]="Badger"}(n.IdentityProvider||(n.IdentityProvider={})),function(e){e[e.Augloop=0]="Augloop",e[e.Substrate=1]="Substrate"}(n.AuthTokenType||(n.AuthTokenType={}))},{}],109:[function(e,t,n){"use strict";var o=e("exportStarHelper");Object.defineProperty(n,"__esModule",{value:!0}),o(e(108),n),o(e(110),n),o(e(111),n),o(e(112),n),o(e(113),n),o(e(114),n),o(e(115),n)},{108:108,110:110,111:111,112:112,113:113,114:114,115:115}],110:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},{}],111:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ExceptionType=n.MessageType=void 0,function(e){e[e.Input=0]="Input",e[e.Exception=1]="Exception",e[e.WaitOn=2]="WaitOn",e[e.StopAndFilterWorkflow=3]="StopAndFilterWorkflow"}(n.MessageType||(n.MessageType={})),function(e){e[e.Unknown=0]="Unknown",e[e.NoOutput=1]="NoOutput",e[e.Authentication=2]="Authentication",e[e.JoinTimedOut=3]="JoinTimedOut",e[e.LambdaThrow=4]="LambdaThrow",e[e.LambdaErrorCallback=5]="LambdaErrorCallback"}(n.ExceptionType||(n.ExceptionType={}))},{}],112:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Ppt=void 0,function(e){!function(e){e[e.Undefined=0]="Undefined",e[e.Delete=1]="Delete",e[e.Add=2]="Add",e[e.Change=3]="Change",e[e.Refresh=4]="Refresh"}(e.SlideTileEventType||(e.SlideTileEventType={}))}(n.Ppt||(n.Ppt={}))},{}],113:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},{}],114:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Tiling=void 0,function(e){!function(e){e[e.Unknown=0]="Unknown",e[e.Text=1]="Text",e[e.Slide=2]="Slide"}(e.TileType||(e.TileType={})),function(e){e[e.Generic=0]="Generic",e[e.Title=1]="Title",e[e.SmartArt=2]="SmartArt",e[e.TableCell=3]="TableCell",e[e.TextBox=4]="TextBox",e[e.Notes=5]="Notes"}(e.TextTileType||(e.TextTileType={})),function(e){e[e.Undefined=0]="Undefined",e[e.Word=1]="Word",e[e.Phrase=2]="Phrase",e[e.Sentence=3]="Sentence",e[e.Paragraph=4]="Paragraph"}(e.TextTileElementUnit||(e.TextTileElementUnit={})),function(e){e[e.Undefined=0]="Undefined",e[e.Bullet=1]="Bullet",e[e.Numbered=2]="Numbered"}(e.ListType||(e.ListType={})),function(e){e[e.Undefined=0]="Undefined",e[e.AlphaLcParenBoth=1]="AlphaLcParenBoth",e[e.AlphaUcParenBoth=2]="AlphaUcParenBoth",e[e.AlphaLcParenR=3]="AlphaLcParenR",e[e.AlphaUcParenR=4]="AlphaUcParenR",e[e.AlphaLcPeriod=5]="AlphaLcPeriod",e[e.AlphaUcPeriod=6]="AlphaUcPeriod",e[e.ArabicParenBoth=7]="ArabicParenBoth",e[e.ArabicParenR=8]="ArabicParenR",e[e.ArabicPeriod=9]="ArabicPeriod",e[e.ArabicPlain=10]="ArabicPlain",e[e.RomanLcParenBoth=11]="RomanLcParenBoth",e[e.RomanUcParenBoth=12]="RomanUcParenBoth",e[e.RomanLcParenR=13]="RomanLcParenR",e[e.RomanUcParenR=14]="RomanUcParenR",e[e.RomanLcPeriod=15]="RomanLcPeriod",e[e.RomanUcPeriod=16]="RomanUcPeriod",e[e.CircleNumDbPlain=17]="CircleNumDbPlain",e[e.CircleNumWdBlackPlain=18]="CircleNumWdBlackPlain",e[e.CircleNumWdWhitePlain=19]="CircleNumWdWhitePlain",e[e.ArabicDbPeriod=20]="ArabicDbPeriod",e[e.ArabicDbPlain=21]="ArabicDbPlain",e[e.Ea1ChsPeriod=22]="Ea1ChsPeriod",e[e.Ea1ChsPlain=23]="Ea1ChsPlain",e[e.Ea1ChtPeriod=24]="Ea1ChtPeriod",e[e.Ea1ChtPlain=25]="Ea1ChtPlain",e[e.Ea1JpnChsDbPeriod=26]="Ea1JpnChsDbPeriod",e[e.Ea1JpnKorPlain=27]="Ea1JpnKorPlain",e[e.Ea1JpnKorPeriod=28]="Ea1JpnKorPeriod",e[e.Arabic1Minus=29]="Arabic1Minus",e[e.Arabic2Minus=30]="Arabic2Minus",e[e.Hebrew2Minus=31]="Hebrew2Minus",e[e.ThaiAlphaPeriod=32]="ThaiAlphaPeriod",e[e.ThaiAlphaParenR=33]="ThaiAlphaParenR",e[e.ThaiAlphaParenBoth=34]="ThaiAlphaParenBoth",e[e.ThaiNumPeriod=35]="ThaiNumPeriod",e[e.ThaiNumParenR=36]="ThaiNumParenR",e[e.ThaiNumParenBoth=37]="ThaiNumParenBoth",e[e.HindiAlphaPeriod=38]="HindiAlphaPeriod",e[e.HindiNumPeriod=39]="HindiNumPeriod",e[e.HindiNumParenR=40]="HindiNumParenR",e[e.HindiAlpha1Period=41]="HindiAlpha1Period"}(e.ListNumeration||(e.ListNumeration={})),function(e){e[e.Undefined=0]="Undefined",e[e.Delete=1]="Delete",e[e.Add=2]="Add",e[e.Change=3]="Change",e[e.Refresh=4]="Refresh"}(e.TextTileEventType||(e.TextTileEventType={}))}(n.Tiling||(n.Tiling={}))},{}],115:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.TypeCategory=void 0,function(e){e[e.Undefined=0]="Undefined",e[e.Schema=1]="Schema",e[e.Boolean=2]="Boolean",e[e.Number=3]="Number",e[e.String=4]="String",e[e.Buffer=5]="Buffer",e[e.Function=6]="Function"}(n.TypeCategory||(n.TypeCategory={}))},{}],116:[function(e,t,n){"use strict";var o=e("exportStarHelper");Object.defineProperty(n,"__esModule",{value:!0}),o(e(117),n)},{117:117}],117:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.isAncestorOrEqualTo=n.getSafeNumber=n.isValidItemId=n.splitItemPathKey=n.makeItemPathKey=n.shallowCloneItemWithPath=void 0;n.shallowCloneItemWithPath=function(e,t){return Object.assign(Object.assign({},t),{parentPath:e})};n.makeItemPathKey=function(e){return Array.isArray(e)?5===e.length?"".concat(e[0]).concat("\\").concat(e[1]).concat("\\").concat(e[2]).concat("\\").concat(e[3]).concat("\\").concat(e[4]):4===e.length?"".concat(e[0]).concat("\\").concat(e[1]).concat("\\").concat(e[2]).concat("\\").concat(e[3]):3===e.length?"".concat(e[0]).concat("\\").concat(e[1]).concat("\\").concat(e[2]):2===e.length?"".concat(e[0]).concat("\\").concat(e[1]):1===e.length?e[0]:e.join("\\"):"(malformed path)"};n.splitItemPathKey=function(e){return e.split("\\")};n.isValidItemId=function(e){return e&&e.length>0&&e.length<100&&e.indexOf("\\")<0};n.getSafeNumber=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Number.isFinite(e)?e:t};n.isAncestorOrEqualTo=function(e,t){if(e.length>t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}},{}],118:[function(e,t,n){"use strict";var o=e("exportStarHelper");Object.defineProperty(n,"__esModule",{value:!0}),o(e(119),n),o(e(120),n)},{119:119,120:120}],119:[function(e,t,n){"use strict";var o=e(178),r=o(e(172)),i=o(e(174));Object.defineProperty(n,"__esModule",{value:!0}),n.GetAnnotationsResponseMessage=n.GetAnnotationsRequestMessage=n.WorkflowDefinitionOverrideMessage=n.SessionCloseResponse=n.TelemetryFlushMessage=n.TelemetryMessage=n.DiagnosticTraceMessage=n.RuntimeInitMessage=n.WorkflowExecutionResponse=n.WorkflowExecutionRequest=n.WorkflowRegistrationMessage=void 0;var a=e(139),s=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_Internal_WorkflowRegistrationMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.WorkflowRegistrationMessage=s,s.H_={T_:s.getTypeName(),B_:s.getBaseTypes()};var u=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_WorkflowExecutionRequest"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.WorkflowExecutionRequest=u,u.H_={T_:u.getTypeName(),B_:u.getBaseTypes()};var c=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_WorkflowExecutionResponse"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Response"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.WorkflowExecutionResponse=c,c.H_={T_:c.getTypeName(),B_:c.getBaseTypes()};var l=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_Internal_RuntimeInitMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.RuntimeInitMessage=l,l.H_={T_:l.getTypeName(),B_:l.getBaseTypes()};var f=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_Internal_DiagnosticTraceMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.DiagnosticTraceMessage=f,f.H_={T_:f.getTypeName(),B_:f.getBaseTypes()};var d=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_Internal_TelemetryMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.TelemetryMessage=d,d.H_={T_:d.getTypeName(),B_:d.getBaseTypes()};var p=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_Internal_TelemetryFlushMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.TelemetryFlushMessage=p,p.H_={T_:p.getTypeName(),B_:p.getBaseTypes()};var h=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_Internal_SessionCloseResponse"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Response"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.SessionCloseResponse=h,h.H_={T_:h.getTypeName(),B_:h.getBaseTypes()};var g=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_Internal_WorkflowDefinitionOverrideMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.WorkflowDefinitionOverrideMessage=g,g.H_={T_:g.getTypeName(),B_:g.getBaseTypes()};var y=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_Internal_GetAnnotationsRequestMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.GetAnnotationsRequestMessage=y,y.H_={T_:y.getTypeName(),B_:y.getBaseTypes()};var m=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_Internal_GetAnnotationsResponseMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Response"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.GetAnnotationsResponseMessage=m,m.H_={T_:m.getTypeName(),B_:m.getBaseTypes()}},{139:139,172:172,174:174,178:178}],120:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.NetworkMode=n.EXTENSIBLE_WORKFLOW_CONTEXT=void 0,n.EXTENSIBLE_WORKFLOW_CONTEXT="sessionWorkflowContext",function(e){e[e.JSWebSockets=0]="JSWebSockets",e[e.LocalWorkflowsOnly=1]="LocalWorkflowsOnly",e[e.HostWebSockets=2]="HostWebSockets",e[e.HttpFallback=3]="HttpFallback"}(n.NetworkMode||(n.NetworkMode={}))},{}],121:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ServerAuthenticationState=void 0,function(e){e[e.NotAuthenticated=0]="NotAuthenticated",e[e.Pending=1]="Pending",e[e.Authenticated=2]="Authenticated",e[e.WacUserInfoAuthenticated=3]="WacUserInfoAuthenticated"}(n.ServerAuthenticationState||(n.ServerAuthenticationState={}))},{}],122:[function(e,t,n){"use strict";var o=e("exportStarHelper");Object.defineProperty(n,"__esModule",{value:!0}),o(e(121),n),o(e(123),n),o(e(124),n),o(e(125),n),o(e(126),n)},{121:121,123:123,124:124,125:125,126:126}],123:[function(e,t,n){"use strict";var o=e(178),r=o(e(172)),i=o(e(174));Object.defineProperty(n,"__esModule",{value:!0}),n.ServerAuthenticationStateChangeMessage=n.SubmittedCustomMessage=n.SessionReconnectMessage=n.SessionDisconnectMessage=n.SessionConnectMessage=n.BridgeMessage=n.OAuth2CallbackMessage=n.OAuth2InitResponse=n.OAuth2InitMessage=n.OAuth2InitV2Response=n.OAuth2InitV2Message=n.WorkflowExecutionCompleteMessage=n.WorkflowGraphInitResponse=n.WorkflowGraphInitMessage=n.KeepAlive=n.TokenProvisionResponse=n.TokenProvisionMessage=n.AnnotationResultsMessage=n.SessionDeleteMessage=n.SyncResponse=n.MicroSyncMessage=n.SyncMessage=n.AnnotationConfigUpdateResponse=n.AnnotationConfigUpdateMessage=n.AnnotationReleaseResponse=n.AnnotationReleaseMessage=n.AnnotationResultStateMessage=n.AnnotationActivationResponse=n.AnnotationActivationMessage=n.CacheDumpRequestResponse=n.CacheDumpRequestMessage=n.SessionCloseMessage=n.SessionSwapOnClose=n.SessionCloseReason=n.SessionLongPollResponse=n.SessionLongPollMessage=n.SessionInitResponse=n.SessionInitMessage=n.TimeoutErrorResponse=n.ErrorResponse=n.Response=n.Message=void 0;var a=e(139),s=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_Message"}},{key:"getBaseTypes",value:function(){return[]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.Message=s,s.H_={T_:s.getTypeName(),B_:s.getBaseTypes()};var u=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_Response"}},{key:"getBaseTypes",value:function(){return[]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.Response=u,u.H_={T_:u.getTypeName(),B_:u.getBaseTypes()};var c=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_ErrorResponse"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Response"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.ErrorResponse=c,c.H_={T_:c.getTypeName(),B_:c.getBaseTypes()};var l=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_TimeoutErrorResponse"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_ErrorResponse","AugLoop_Session_Protocol_Response"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.TimeoutErrorResponse=l,l.H_={T_:l.getTypeName(),B_:l.getBaseTypes()};var f=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_SessionInitMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.SessionInitMessage=f,f.H_={T_:f.getTypeName(),B_:f.getBaseTypes()};var d=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_SessionInitResponse"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Response"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.SessionInitResponse=d,d.H_={T_:d.getTypeName(),B_:d.getBaseTypes()};var p=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_SessionLongPollMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.SessionLongPollMessage=p,p.H_={T_:p.getTypeName(),B_:p.getBaseTypes()};var h=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_SessionLongPollResponse"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Response"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.SessionLongPollResponse=h,h.H_={T_:h.getTypeName(),B_:h.getBaseTypes()};var g=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_SessionCloseReason"}},{key:"getBaseTypes",value:function(){return[]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.SessionCloseReason=g,g.H_={T_:g.getTypeName(),B_:g.getBaseTypes()};var y=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_SessionSwapOnClose"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_SessionCloseReason"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.SessionSwapOnClose=y,y.H_={T_:y.getTypeName(),B_:y.getBaseTypes()};var m=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_SessionCloseMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.SessionCloseMessage=m,m.H_={T_:m.getTypeName(),B_:m.getBaseTypes()};var v=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_CacheDumpRequestMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.CacheDumpRequestMessage=v,v.H_={T_:v.getTypeName(),B_:v.getBaseTypes()};var k=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_CacheDumpRequestResponse"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Response"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.CacheDumpRequestResponse=k,k.H_={T_:k.getTypeName(),B_:k.getBaseTypes()};var T=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_AnnotationActivationMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.AnnotationActivationMessage=T,T.H_={T_:T.getTypeName(),B_:T.getBaseTypes()};var S=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_AnnotationActivationResponse"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Response"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.AnnotationActivationResponse=S,S.H_={T_:S.getTypeName(),B_:S.getBaseTypes()};var b=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_AnnotationResultStateMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.AnnotationResultStateMessage=b,b.H_={T_:b.getTypeName(),B_:b.getBaseTypes()};var w=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_AnnotationReleaseMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.AnnotationReleaseMessage=w,w.H_={T_:w.getTypeName(),B_:w.getBaseTypes()};var C=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_AnnotationReleaseResponse"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Response"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.AnnotationReleaseResponse=C,C.H_={T_:C.getTypeName(),B_:C.getBaseTypes()};var _=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_AnnotationConfigUpdateMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.AnnotationConfigUpdateMessage=_,_.H_={T_:_.getTypeName(),B_:_.getBaseTypes()};var x=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_AnnotationConfigUpdateResponse"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Response"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.AnnotationConfigUpdateResponse=x,x.H_={T_:x.getTypeName(),B_:x.getBaseTypes()};var M=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_SyncMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.SyncMessage=M,M.H_={T_:M.getTypeName(),B_:M.getBaseTypes()};var A=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_MicroSyncMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.MicroSyncMessage=A,A.H_={T_:A.getTypeName(),B_:A.getBaseTypes()};var O=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_SyncResponse"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Response"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.SyncResponse=O,O.H_={T_:O.getTypeName(),B_:O.getBaseTypes()};var I=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_SessionDeleteMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.SessionDeleteMessage=I,I.H_={T_:I.getTypeName(),B_:I.getBaseTypes()};var L=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_AnnotationResultsMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_SyncMessage","AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.AnnotationResultsMessage=L,L.H_={T_:L.getTypeName(),B_:L.getBaseTypes()};var D=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_TokenProvisionMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.TokenProvisionMessage=D,D.H_={T_:D.getTypeName(),B_:D.getBaseTypes()};var E=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_TokenProvisionResponse"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Response"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.TokenProvisionResponse=E,E.H_={T_:E.getTypeName(),B_:E.getBaseTypes()};var P=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_KeepAlive"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.KeepAlive=P,P.H_={T_:P.getTypeName(),B_:P.getBaseTypes()};var R=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_WorkflowGraphInitMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.WorkflowGraphInitMessage=R,R.H_={T_:R.getTypeName(),B_:R.getBaseTypes()};var N=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_WorkflowGraphInitResponse"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Response"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.WorkflowGraphInitResponse=N,N.H_={T_:N.getTypeName(),B_:N.getBaseTypes()};var W=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_WorkflowExecutionCompleteMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_SyncMessage","AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.WorkflowExecutionCompleteMessage=W,W.H_={T_:W.getTypeName(),B_:W.getBaseTypes()};var B=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_OAuth2InitV2Message"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.OAuth2InitV2Message=B,B.H_={T_:B.getTypeName(),B_:B.getBaseTypes()};var j=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_OAuth2InitV2Response"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Response"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.OAuth2InitV2Response=j,j.H_={T_:j.getTypeName(),B_:j.getBaseTypes()};var F=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_OAuth2InitMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.OAuth2InitMessage=F,F.H_={T_:F.getTypeName(),B_:F.getBaseTypes()};var U=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_OAuth2InitResponse"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Response"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.OAuth2InitResponse=U,U.H_={T_:U.getTypeName(),B_:U.getBaseTypes()};var H=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_OAuth2CallbackMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.OAuth2CallbackMessage=H,H.H_={T_:H.getTypeName(),B_:H.getBaseTypes()};var G=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_BridgeMessage"}},{key:"getBaseTypes",value:function(){return[]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.BridgeMessage=G,G.H_={T_:G.getTypeName(),B_:G.getBaseTypes()};var q=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_SessionConnectMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.SessionConnectMessage=q,q.H_={T_:q.getTypeName(),B_:q.getBaseTypes()};var V=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_SessionDisconnectMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.SessionDisconnectMessage=V,V.H_={T_:V.getTypeName(),B_:V.getBaseTypes()};var z=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_SessionReconnectMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.SessionReconnectMessage=z,z.H_={T_:z.getTypeName(),B_:z.getBaseTypes()};var K=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_SubmittedCustomMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.SubmittedCustomMessage=K,K.H_={T_:K.getTypeName(),B_:K.getBaseTypes()};var J=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Session_Protocol_ServerAuthenticationStateChangeMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Session_Protocol_Message"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.ServerAuthenticationStateChangeMessage=J,J.H_={T_:J.getTypeName(),B_:J.getBaseTypes()}},{139:139,172:172,174:174,178:178}],124:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},{}],125:[function(e,t,n){"use strict";var o=e(178),r=o(e(172)),i=o(e(174));Object.defineProperty(n,"__esModule",{value:!0}),n.MessageEndpoint=n.extractMessageNameFromTypeName=n.ProcessMessageErrorReason=n.SendMessageErrorReason=void 0;var a,s,u=e(40),c=e(139),l=e(123),f=e(128);function d(e){for(var t,n=0,o=["AugLoop_Excel_Session_Protocol_","AugLoop_Powerpoint_Session_Protocol_","AugLoop_Session_Protocol_"];n<o.length;n++){var r=o[n];if(0===e.indexOf(r)){t=r;break}}if(!t)return"MalformedMessageName";var i=e.indexOf("Message",e.length-"Message".length)===e.length-"Message".length;return e.slice(t.length,i?-"Message".length:void 0)}!function(e){e.ClientDisconnected="Client disconnected.",e.UnsupportedSyncMessage="SyncMessages with seq = -1 are not supported anymore.",e.UnexpectedSeedMessage="Unexpected seed message",e.SyncMessageUnsupportedBatch="SyncMessage with unsupported batching.",e.AnnotationTokenNotFound="Token not found"}(a=n.SendMessageErrorReason||(n.SendMessageErrorReason={})),function(e){e.ProvisionTokenValidationError="Token provision message didn't pass token validation.",e.ProvisionTokenDecryptAndTransformError="Token provision message didn't pass token decrypt and transform."}(s=n.ProcessMessageErrorReason||(n.ProcessMessageErrorReason={})),n.extractMessageNameFromTypeName=d;var p=function(){function e(t){(0,r.default)(this,e),this.nextMessageId=1,this.pendingResponseCallbacks=new f.Cache({sweepInterval:5e3}),this.pendingMessageCallbacks=new f.Cache({sweepInterval:5e3}),this.messageCallbacks=new Map,this.messageIdPrefix=t,this.source="c"===t?u.SessionHealthSource.ClientRuntime:u.SessionHealthSource.Core,this.stats={sendMessageCount:0,sendMessageClientDisconnectedErrors:0,sendMessageErrors:0,sendMessageDurationMsMax:0,processMessageCount:0,processMessageProvisionTokenErrors:0,processMessageErrors:0,processMessageDurationMsMax:0}}return(0,i.default)(e,[{key:"setClientMetadata",value:function(e){this.clientMetadata=e}},{key:"setEgress",value:function(e){this.egress=e}},{key:"ingress",value:function(e,t){var n=c.SchemaObject.getBaseTypesFor(e),o=c.SchemaObject.getTypeNameFor(e);o===l.Response.getTypeName()||n&&n.indexOf(l.Response.getTypeName())>=0?(this.processResponse(e),t()):this.processMessage(e,t),o!==l.SessionCloseMessage.getTypeName()||e.reconnectAllowed||this.clearAllPendingResponses()}},{key:"sendMessage",value:function(e,t,n){var o=this,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=new u.SessionHealthEvent({sessionHealthEventName:"SendMessage",source:this.source,reason:u.SessionHealthReason.Client,impact:this.source===u.SessionHealthSource.ClientRuntime?u.SessionHealthImpact.MissingInput:u.SessionHealthImpact.MissingOutput,success:!0,message:"",affectedWorkflows:["All"],cv:e.cv,resourceId:d(c.SchemaObject.getTypeNameFor(e)),dimension0:r.toString()}).start(),a=function(){if(i.setClientMetadata(o.clientMetadata),i.success)u.Log.info(572836e3,u.LogCategory.CoreDefault,i.stop());else{var e="ErrorWithoutPendingResponse"===i.resultSignature||"ResponseCallbackException"===i.resultSignature||"We called into done callback"!==i.message;i.message=JSON.stringify({errorNotPropagatedToDoneCallback:e}),u.Log.error(572836001,u.LogCategory.CoreDefault,i.stop())}};e.messageId="".concat(this.messageIdPrefix).concat(this.nextMessageId++);var s=c.SchemaObject.getTypeNameFor(e)===l.SessionCloseMessage.getTypeName(),f=!n&&!s;if(f){var p=function(n,r){var s;if(n?(i.success=!1,i.resultSignature=n.error,i.resultDescription="Error for ".concat(c.SchemaObject.getTypeNameFor(e)," message ").concat(e.messageId,": ").concat(n.error)):i.resultSignature="Success",t)try{i.message="We called into done callback",t(n,r)}catch(e){i.success=!1,i.resultSignature="ResponseCallbackException",i.resultDescription="Web"===(null===(s=o.clientMetadata)||void 0===s?void 0:s.appPlatform)?JSON.stringify({message:e.message,stack:e.stack}):JSON.stringify({message:e.message})}o.pendingMessageCallbacks.del(e.messageId),a(),o.updateSendMessageStats(i.success,i.durationMs,n?new Error(n.error):void 0)},h=function(){p(new l.TimeoutErrorResponse({error:"Timeout waiting for response"}),void 0)},g=3e4;if(l.SessionLongPollMessage.typeGuard(e)){var y=e;g=y.longPollTimeoutHint>=15e3&&y.longPollTimeoutHint<=3e5?y.longPollTimeoutHint+5e3:12e4}this.pendingResponseCallbacks.put(e.messageId,p,g,h)}this.egress(e,(function(t){var n,r;if(t){var u=o.pendingResponseCallbacks.get(e.messageId);u?(o.pendingResponseCallbacks.del(e.messageId),u(new l.ErrorResponse({messageId:e.messageId,error:t.message}))):s?(i.success=null!==(r=null===(n=t.message)||void 0===n?void 0:n.endsWith("Client disconnected."))&&void 0!==r&&r,i.resultSignature="ErrorSendingSessionCloseMessage",i.resultDescription="Error for ".concat(c.SchemaObject.getTypeNameFor(e)," message ").concat(e.messageId,": ").concat(t.message),a()):(i.success=!1,i.resultSignature="ErrorWithoutPendingResponse",i.resultDescription="Error for ".concat(c.SchemaObject.getTypeNameFor(e)," message ").concat(e.messageId,": ").concat(t.message),a())}}))}},{key:"onMessage",value:function(e,t){this.messageCallbacks.set(e,t)}},{key:"getStats",value:function(){return this.stats}},{key:"hasMessageCallback",value:function(e){return this.messageCallbacks.has(e)}},{key:"cancelPendingResponseCallbacks",value:function(){var e=this;this.pendingResponseCallbacks.forEach((function(t,n){t&&(e.pendingResponseCallbacks.del(n),t(new l.ErrorResponse({messageId:n,error:"Cancelled"})))}))}},{key:"clearAllPendingResponses",value:function(){if(0!=this.pendingResponseCallbacks.size()){var e=new u.Operation({operationName:"PurgePendingResponses",resultDescription:this.pendingResponseCallbacks.size().toString(),success:!0});u.Log.info(572836002,u.LogCategory.CoreDefault,e),this.pendingResponseCallbacks.clear()}}},{key:"processMessage",value:function(e,t){var n,o=this,r=new u.SessionHealthEvent({sessionHealthEventName:"ProcessMessage",source:this.source,reason:u.SessionHealthReason.Client,impact:this.source===u.SessionHealthSource.ClientRuntime?u.SessionHealthImpact.MissingOutput:u.SessionHealthImpact.MissingInput,success:!0,message:"",affectedWorkflows:["All"],cv:e.cv}).start(),i=function(){if(r.setClientMetadata(o.clientMetadata),r.success)u.Log.info(572836003,u.LogCategory.CoreDefault,r.stop());else{var e="UnsupportedMessage"===r.resourceId||"Timeout"===r.resultSignature||"OnResponseInvokedMoreThanOnce"===r.resultSignature||"MessageCallbackException"===r.resultSignature||"We called into messageCallback"!==r.message;r.message=JSON.stringify({errorHappenedOutsideRegisteredMessageCallback:e}),u.Log.error(572836032,u.LogCategory.CoreDefault,r.stop())}},a=this.messageCallbacks.get(c.SchemaObject.getTypeNameFor(e));a?r.resourceId=d(c.SchemaObject.getTypeNameFor(e)):a=function(e,t){r.resourceId=d(c.SchemaObject.getTypeNameFor(e)),"MalformedMessageName"!==r.resourceId&&(r.resourceId="UnsupportedMessage"),t(new l.ErrorResponse({messageId:e.messageId,error:"Message type ".concat(c.SchemaObject.getTypeNameFor(e)," is not supported")}))};var s=1e4;if(l.SessionLongPollMessage.typeGuard(e)){var f=e;s=f.longPollTimeoutHint>=15e3&&f.longPollTimeoutHint<=3e5?f.longPollTimeoutHint+5e3:12e4}this.pendingMessageCallbacks.put(e.messageId,void 0,s,(function(){r.success=!1,r.resultSignature="Timeout",r.resultDescription="Timeout processing message callback",i(),u.Log.error(572836033,u.LogCategory.CoreDefault,"Timeout processing ".concat(r.resourceId)),o.updateProcessMessageStats(!1,r.durationMs,new Error("timeout"))}));var p=!1;try{r.message="We called into messageCallback",a(e,(function(n,a){o.pendingMessageCallbacks.del(e.messageId),p?(r.success=!1,r.resultSignature="OnResponseInvokedMoreThanOnce",r.resultDescription="Invoked onResponse for ".concat(c.SchemaObject.getTypeNameFor(e)," message ").concat(e.messageId," more than once")):n?(r.success=!1,r.resultSignature=n.error,r.resultDescription="Error for ".concat(c.SchemaObject.getTypeNameFor(e)," message ").concat(e.messageId,": ").concat(n.error)):r.resultSignature="Success",p=!0,i(),n&&!c.SchemaObject.matchesTypesFor(n,[l.ErrorResponse.getTypeName()])&&(n=new l.ErrorResponse({error:"Internal Server Error"})),o.updateProcessMessageStats(r.success,r.durationMs,n?new Error(n.error):void 0),n?(n.messageId=e.messageId,t(n)):a?(a.messageId=e.messageId,t(void 0,a)):t()}))}catch(o){this.pendingMessageCallbacks.del(e.messageId),r.success=!1,r.resultSignature="MessageCallbackException",r.resultDescription="Web"===(null===(n=this.clientMetadata)||void 0===n?void 0:n.appPlatform)?JSON.stringify({message:o.message,stack:o.stack}):JSON.stringify({message:o.message}),i(),this.updateProcessMessageStats(!1,r.durationMs,o),t()}}},{key:"processResponse",value:function(e){var t,n=new u.Operation({operationName:"ProcessResponse"});if(n.success=!0,n.setClientMetadata(this.clientMetadata),n.start(),e.messageId){var o=this.pendingResponseCallbacks.get(e.messageId);o?(this.pendingResponseCallbacks.del(e.messageId),c.SchemaObject.matchesTypesFor(e,[l.ErrorResponse.getTypeName()])?o(e):o(void 0,e)):(n.resultSignature="NoPendingMessage",n.resultDescription="".concat(e.messageId),n.success=!1)}else n.resultSignature="NoMessageIdSetInResponse",l.ErrorResponse.typeGuard(e)?n.resultDescription=e.error:n.resultDescription="MessageId is not available",n.success=!1;"Production"!==(null===(t=this.clientMetadata)||void 0===t?void 0:t.releaseAudienceGroup)&&(n.resourceId=d(c.SchemaObject.getTypeNameFor(e)),u.Log.info(572836034,u.LogCategory.CoreDefault,n.stop()))}},{key:"updateSendMessageStats",value:function(e,t,n){this.stats.sendMessageCount++,this.stats.sendMessageDurationMsMax=Math.max(t,this.stats.sendMessageDurationMsMax),e||n?e&&n&&u.Log.warn(572836036,u.LogCategory.CoreDefault,"Succeeded send message provided error object."):u.Log.warn(572836035,u.LogCategory.CoreDefault,"Failed send message did not provide error object."),e||(n&&n.message===a.ClientDisconnected?this.stats.sendMessageClientDisconnectedErrors++:this.stats.sendMessageErrors++)}},{key:"updateProcessMessageStats",value:function(e,t,n){this.stats.processMessageCount++,this.stats.processMessageDurationMsMax=Math.max(t,this.stats.processMessageDurationMsMax),e||n?e&&n&&u.Log.warn(572836038,u.LogCategory.CoreDefault,"Succeeded process message provided error object."):u.Log.warn(572836037,u.LogCategory.CoreDefault,"Failed process message did not provide error object."),e||(n&&n.message===s.ProvisionTokenValidationError?this.stats.processMessageProvisionTokenErrors++:this.stats.processMessageErrors++)}}]),e}();n.MessageEndpoint=p},{123:123,128:128,139:139,172:172,174:174,178:178,40:40}],126:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AnnotationResultState=n.SessionSwapReason=n.currentProtocolVersion=void 0,n.currentProtocolVersion=2,function(e){e[e.IdentityChange=0]="IdentityChange"}(n.SessionSwapReason||(n.SessionSwapReason={})),function(e){e[e.Idle=0]="Idle",e[e.Pending=1]="Pending"}(n.AnnotationResultState||(n.AnnotationResultState={}))},{}],127:[function(e,t,n){"use strict";var o=e(178),r=o(e(172)),i=o(e(174));Object.defineProperty(n,"__esModule",{value:!0}),n.Cache=void 0;var a=function(){function e(t){if((0,r.default)(this,e),this.cache=new Map,this.options=t||{sweepInterval:100},null!=this.options.idleDurationMs&&this.options.idleDurationMs<=0)throw new Error("Idle duration must be positive");if(this.interval=this.options.sweepInterval||100,this.interval<=0)throw new Error("Sweep interval must be a positive number")}return(0,i.default)(e,[{key:"put",value:function(e,t,n,o,r,i,a){if(null==n||n<=0)throw new Error("Cache timeout must be a positive number");(null==r||r<=0)&&(r=this.options.idleDurationMs);var s={value:t,lastUsed:r?Date.now():void 0,expire:n+Date.now(),idleDurationMs:r,expireCallback:o,expiringTriggerTime:i+Date.now(),expiringCallback:a};return this.cache.set(e,s),this.timeout||(this.timeout=setInterval(this.onInterval.bind(this),this.interval),this.timeout.unref&&this.timeout.unref()),t}},{key:"del",value:function(e){if(this.options.delCallback){var t=this.cache.get(e);t&&this.options.delCallback(e,t.value)}var n=this.cache.delete(e);return 0===this.size()&&this.clear(),n}},{key:"clear",value:function(){this.timeout&&(clearInterval(this.timeout),this.timeout=void 0),this.cache.clear()}},{key:"get",value:function(e){var t=this.cache.get(e);if(t)return this.options.idleDurationMs&&(t.lastUsed=Date.now()),t.value}},{key:"keys",value:function(){return this.cache.keys()}},{key:"forEach",value:function(e){this.cache.forEach((function(t,n){e(t.value,n)}))}},{key:"size",value:function(){return this.cache.size}},{key:"updateExpireTime",value:function(e,t){return!!(this.cache.has(e)&&t>=0)&&(this.cache.get(e).expire=t+Date.now(),!0)}},{key:"onInterval",value:function(){var e=this,t=Date.now();this.cache.forEach((function(n,o){if(n.idleDurationMs&&n.lastUsed<t-n.idleDurationMs)return e.del(o),void(e.options.idleCallback&&e.options.idleCallback(o,n.value));n.expire<t&&(e.del(o),n.expireCallback&&n.expireCallback(o,n.value)),n.expiringTriggerTime<t&&n.expiringCallback&&(n.expiringCallback(o,n.value),n.expiringCallback=void 0)}))}}]),e}();n.Cache=a},{172:172,174:174,178:178}],128:[function(e,t,n){"use strict";var o=e("exportStarHelper");Object.defineProperty(n,"__esModule",{value:!0}),o(e(127),n)},{127:127}],129:[function(e,t,n){"use strict";var o={util:{},roots:{default:{}}},r=(o.util,o.roots.default||(o.roots.default={}));r.AnnotationMetaDataChangeEvent=function(){function e(e){if(e)for(var t in e)null!=e[t]&&(this[t]=e[t])}return e.prototype.sessionKey="",e.prototype.annotationType="",e.prototype.annotationState=0,e.prototype.workflowId="",e}(),t.exports=r},{}],130:[function(e,t,n){"use strict";var o=e("exportStarHelper");Object.defineProperty(n,"__esModule",{value:!0}),o(e(129),n),o(e(131),n),o(e(132),n),o(e(133),n)},{129:129,131:131,132:132,133:133}],131:[function(e,t,n){"use strict";var o={util:{},roots:{default:{}}},r=(o.util,o.roots.default||(o.roots.default={}));r.OperationEvent=function(){function e(e){if(e)for(var t in e)null!=e[t]&&(this[t]=e[t])}return e.prototype.count=0,e.prototype.cv="",e.prototype.serviceName="",e.prototype.sessionKey="",e.prototype.durationMs=0,e.prototype.success=!1,e.prototype.resultDescription="",e.prototype.resultJSON="",e.prototype.resultSignature="",e.prototype.operationName="",e.prototype.resourceId="",e.prototype.dimension0="",e.prototype.dimension1="",e.prototype.dimension2="",e.prototype.dimension3="",e.prototype.clientAppName="",e.prototype.clientAppPlatform="",e.prototype.clientRuntimeVersion="",e.prototype.clientAppVersion="",e.prototype.clientReleaseAudienceGroup="",e.prototype.clientReleaseChannel="",e.prototype.clientReleaseFork="",e.prototype.clientSessionId="",e.prototype.clientFlights="",e.prototype.clientIPRange="",e.prototype.clientDocSessionId="",e.prototype.clientDeviceId="",e.prototype.clientUserAgent="",e.prototype.userType="",e.prototype.userId="",e.prototype.userTenantId="",e.prototype.joinContextId="",e.prototype.ariaTenant="",e.prototype.ariaNamespace="",e.prototype.dataFields="",e}(),t.exports=r},{}],132:[function(e,t,n){"use strict";var o={util:{},roots:{default:{}}},r=(o.util,o.roots.default||(o.roots.default={}));r.SessionHealthEvent=function(){function e(e){if(e)for(var t in e)null!=e[t]&&(this[t]=e[t])}return e.prototype.cv="",e.prototype.serviceName="",e.prototype.sessionKey="",e.prototype.clientAppName="",e.prototype.clientAppPlatform="",e.prototype.clientRuntimeVersion="",e.prototype.clientAppVersion="",e.prototype.clientReleaseAudienceGroup="",e.prototype.clientReleaseChannel="",e.prototype.clientReleaseFork="",e.prototype.clientSessionId="",e.prototype.clientFlights="",e.prototype.clientIPRange="",e.prototype.clientDocSessionId="",e.prototype.clientDeviceId="",e.prototype.clientUserAgent="",e.prototype.userType="",e.prototype.userId="",e.prototype.sessionHealthEventName="",e.prototype.source="",e.prototype.reason="",e.prototype.reasonDependency="",e.prototype.subReason="",e.prototype.impact="",e.prototype.success=!1,e.prototype.durationMs=0,e.prototype.count=0,e.prototype.message="",e.prototype.affectedWorkflows="",e.prototype.resourceId="",e.prototype.dimension0="",e.prototype.dimension1="",e.prototype.dimension2="",e.prototype.dimension3="",e.prototype.resultDescription="",e.prototype.resultSignature="",e.prototype.joinContextId="",e}(),t.exports=r},{}],133:[function(e,t,n){"use strict";var o={util:{},roots:{default:{}}},r=(o.util,o.roots.default||(o.roots.default={}));r.WorkflowOperationEvent=function(){function e(e){if(e)for(var t in e)null!=e[t]&&(this[t]=e[t])}return e.prototype.count=0,e.prototype.cv="",e.prototype.serviceName="",e.prototype.sessionKey="",e.prototype.durationMs=0,e.prototype.success=!1,e.prototype.resultDescription="",e.prototype.resultSignature="",e.prototype.operationName="",e.prototype.resourceId="",e.prototype.dimension0="",e.prototype.dimension1="",e.prototype.dimension2="",e.prototype.dimension3="",e.prototype.clientAppName="",e.prototype.clientAppPlatform="",e.prototype.clientRuntimeVersion="",e.prototype.clientAppVersion="",e.prototype.clientReleaseAudienceGroup="",e.prototype.clientReleaseChannel="",e.prototype.clientReleaseFork="",e.prototype.clientSessionId="",e.prototype.clientFlights="",e.prototype.clientIPRange="",e.prototype.clientDocSessionId="",e.prototype.clientDeviceId="",e.prototype.clientUserAgent="",e.prototype.userType="",e.prototype.userId="",e.prototype.userTenantId="",e.prototype.joinContextId="",e.prototype.ariaTenant="",e.prototype.ariaNamespace="",e.prototype.dataFields="",e}(),t.exports=r},{}],134:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},{}],135:[function(e,t,n){"use strict";var o=e("exportStarHelper");Object.defineProperty(n,"__esModule",{value:!0}),o(e(134),n),o(e(136),n),o(e(137),n)},{134:134,136:136,137:137}],136:[function(e,t,n){"use strict";var o=e(178),r=o(e(172)),i=o(e(174));Object.defineProperty(n,"__esModule",{value:!0}),n.TextChatMessage=n.ChatMessage=n.MessagesHolder=n.Chat=n.ChatsHolder=void 0;var a=e(139),s=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Chat_ChatsHolder"}},{key:"getBaseTypes",value:function(){return["AugLoop_Core_TileGroup"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.ChatsHolder=s,s.H_={T_:s.getTypeName(),B_:s.getBaseTypes()};var u=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Chat_Chat"}},{key:"getBaseTypes",value:function(){return[]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.Chat=u,u.H_={T_:u.getTypeName(),B_:u.getBaseTypes()};var c=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Chat_MessagesHolder"}},{key:"getBaseTypes",value:function(){return["AugLoop_Core_TileGroup"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.MessagesHolder=c,c.H_={T_:c.getTypeName(),B_:c.getBaseTypes()};var l=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Chat_ChatMessage"}},{key:"getBaseTypes",value:function(){return[]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.ChatMessage=l,l.H_={T_:l.getTypeName(),B_:l.getBaseTypes()};var f=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Chat_TextChatMessage"}},{key:"getBaseTypes",value:function(){return["AugLoop_Chat_ChatMessage"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.TextChatMessage=f,f.H_={T_:f.getTypeName(),B_:f.getBaseTypes()}},{139:139,172:172,174:174,178:178}],137:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},{}],138:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AnnotationState=void 0,function(e){e[e.Undefined=0]="Undefined",e[e.Created=10]="Created",e[e.Sent=20]="Sent",e[e.Duplicated=30]="Duplicated",e[e.Seen=40]="Seen",e[e.Tried=50]="Tried",e[e.Kept=60]="Kept",e[e.Rejected=70]="Rejected"}(n.AnnotationState||(n.AnnotationState={}))},{}],139:[function(e,t,n){"use strict";var o=e("exportStarHelper");Object.defineProperty(n,"__esModule",{value:!0}),o(e(138),n),o(e(140),n),o(e(141),n),o(e(142),n),o(e(143),n),o(e(144),n),o(e(145),n),o(e(147),n),o(e(146),n),o(e(148),n),o(e(149),n)},{138:138,140:140,141:141,142:142,143:143,144:144,145:145,146:146,147:147,148:148,149:149}],140:[function(e,t,n){"use strict";var o=e(178),r=o(e(172)),i=o(e(174));Object.defineProperty(n,"__esModule",{value:!0}),n.BinaryClassificationAnnotation=n.Annotation=void 0;var a=e(142),s=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,[{key:"metadata",get:function(){return this.M_},set:function(e){this.M_=e}}],[{key:"getTypeName",value:function(){return"AugLoop_Core_Annotation"}},{key:"getBaseTypes",value:function(){return[]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.Annotation=s,s.H_={T_:s.getTypeName(),B_:s.getBaseTypes()};var u=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,[{key:"metadata",get:function(){return this.M_},set:function(e){this.M_=e}}],[{key:"getTypeName",value:function(){return"AugLoop_Core_BinaryClassificationAnnotation"}},{key:"getBaseTypes",value:function(){return["AugLoop_Core_Annotation"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.BinaryClassificationAnnotation=u,u.H_={T_:u.getTypeName(),B_:u.getBaseTypes()}},{142:142,172:172,174:174,178:178}],141:[function(e,t,n){"use strict";var o=e(178),r=o(e(172)),i=o(e(174));Object.defineProperty(n,"__esModule",{value:!0}),n.SignalOperation=n.MicroSyncOperation=n.DeltaUpdateOperation=n.VisibilityOperation=n.FocusOperation=n.PurgeOperation=n.DeleteOperation=n.UpdateOperation=n.UpdateAnnotationMetaDataOperation=n.MoveOperation=n.AddOperation=n.OperationWithSiblingContext=n.Operation=n.ItemChangesDelta=n.ItemDelta=void 0;var a=e(142),s=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_ItemDelta"}},{key:"getBaseTypes",value:function(){return[]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.ItemDelta=s,s.H_={T_:s.getTypeName(),B_:s.getBaseTypes()};var u=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_ItemChangesDelta"}},{key:"getBaseTypes",value:function(){return["AugLoop_Core_ItemDelta"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.ItemChangesDelta=u,u.H_={T_:u.getTypeName(),B_:u.getBaseTypes()};var c=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_Operation"}},{key:"getBaseTypes",value:function(){return[]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.Operation=c,c.H_={T_:c.getTypeName(),B_:c.getBaseTypes()};var l=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_OperationWithSiblingContext"}},{key:"getBaseTypes",value:function(){return["AugLoop_Core_Operation"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.OperationWithSiblingContext=l,l.H_={T_:l.getTypeName(),B_:l.getBaseTypes()};var f=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_AddOperation"}},{key:"getBaseTypes",value:function(){return["AugLoop_Core_OperationWithSiblingContext","AugLoop_Core_Operation"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.AddOperation=f,f.H_={T_:f.getTypeName(),B_:f.getBaseTypes()};var d=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_MoveOperation"}},{key:"getBaseTypes",value:function(){return["AugLoop_Core_OperationWithSiblingContext","AugLoop_Core_Operation"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.MoveOperation=d,d.H_={T_:d.getTypeName(),B_:d.getBaseTypes()};var p=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_UpdateAnnotationMetaDataOperation"}},{key:"getBaseTypes",value:function(){return["AugLoop_Core_Operation"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.UpdateAnnotationMetaDataOperation=p,p.H_={T_:p.getTypeName(),B_:p.getBaseTypes()};var h=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_UpdateOperation"}},{key:"getBaseTypes",value:function(){return["AugLoop_Core_Operation"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.UpdateOperation=h,h.H_={T_:h.getTypeName(),B_:h.getBaseTypes()};var g=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_DeleteOperation"}},{key:"getBaseTypes",value:function(){return["AugLoop_Core_Operation"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.DeleteOperation=g,g.H_={T_:g.getTypeName(),B_:g.getBaseTypes()};var y=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_PurgeOperation"}},{key:"getBaseTypes",value:function(){return["AugLoop_Core_Operation"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.PurgeOperation=y,y.H_={T_:y.getTypeName(),B_:y.getBaseTypes()};var m=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_FocusOperation"}},{key:"getBaseTypes",value:function(){return["AugLoop_Core_Operation"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.FocusOperation=m,m.H_={T_:m.getTypeName(),B_:m.getBaseTypes()};var v=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_VisibilityOperation"}},{key:"getBaseTypes",value:function(){return["AugLoop_Core_Operation"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.VisibilityOperation=v,v.H_={T_:v.getTypeName(),B_:v.getBaseTypes()};var k=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_DeltaUpdateOperation"}},{key:"getBaseTypes",value:function(){return["AugLoop_Core_Operation"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.DeltaUpdateOperation=k,k.H_={T_:k.getTypeName(),B_:k.getBaseTypes()};var T=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_MicroSyncOperation"}},{key:"getBaseTypes",value:function(){return["AugLoop_Core_Operation"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.MicroSyncOperation=T,T.H_={T_:T.getTypeName(),B_:T.getBaseTypes()};var S=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Signals_SignalOperation"}},{key:"getBaseTypes",value:function(){return["AugLoop_Core_Operation"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.SignalOperation=S,S.H_={T_:S.getTypeName(),B_:S.getBaseTypes()}},{142:142,172:172,174:174,178:178}],142:[function(e,t,n){"use strict";var o=e(178),r=o(e(189)),i=o(e(172)),a=o(e(174));function s(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return u(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}Object.defineProperty(n,"__esModule",{value:!0}),n.SchemaObject=void 0;var c=function(){function e(t){(0,i.default)(this,e),e.assign(e,this,t)}return(0,a.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_SchemaObject"}},{key:"getBaseTypes",value:function(){return[]}},{key:"getTypeNameFor",value:function(e){return e&&e.H_?e.H_.T_:void 0}},{key:"getBaseTypesFor",value:function(e){return e&&e.H_&&e.H_.B_?e.H_.B_:[]}},{key:"getAllTypesFor",value:function(t){var n=e.getTypeNameFor(t);return n?[n].concat((0,r.default)(e.getBaseTypesFor(t))):[]}},{key:"matchesTypesFor",value:function(t,n){if(!Array.isArray(n)||0===n.length)return!0;var o,r=e.getTypeNameFor(t),i=e.getBaseTypesFor(t),a=s(n);try{for(a.s();!(o=a.n()).done;){var u=o.value;if(u===r)return!0;if(i.indexOf(u)>=0)return!0}}catch(e){a.e(e)}finally{a.f()}return!1}},{key:"assign",value:function(e,t,n){if(n)for(var o=0,r=Object.keys(n);o<r.length;o++){var i=r[o];t[i]=n[i]}return t.H_=e.H_,t}}]),e}();n.SchemaObject=c,c.H_={T_:c.getTypeName(),B_:c.getBaseTypes()}},{172:172,174:174,178:178,189:189}],143:[function(e,t,n){"use strict";var o=e(178),r=o(e(172)),i=o(e(174));Object.defineProperty(n,"__esModule",{value:!0}),n.DirtyAreaSignal=n.Signal=void 0;var a=e(142),s=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Signals_Signal"}},{key:"getBaseTypes",value:function(){return[]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.Signal=s,s.H_={T_:s.getTypeName(),B_:s.getBaseTypes()};var u=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_DirtyAreaSignal"}},{key:"getBaseTypes",value:function(){return["AugLoop_Signals_Signal"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.DirtyAreaSignal=u,u.H_={T_:u.getTypeName(),B_:u.getBaseTypes()}},{142:142,172:172,174:174,178:178}],144:[function(e,t,n){"use strict";var o=e(178),r=o(e(172)),i=o(e(174));Object.defineProperty(n,"__esModule",{value:!0}),n.UserCommandsHolder=n.EventsHolder=n.TenantContextHolder=n.UserContextHolder=n.ContextHolder=n.DynamicContext=n.ItemFilter=n.GridNeighborhoodContext=n.GridCell=n.SubDocument=n.Document=n.Session=n.TileGroup=n.Binary=n.Blob=void 0;var a=e(142),s=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_Blob"}},{key:"getBaseTypes",value:function(){return[]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.Blob=s,s.H_={T_:s.getTypeName(),B_:s.getBaseTypes()};var u=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_Binary"}},{key:"getBaseTypes",value:function(){return[]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.Binary=u,u.H_={T_:u.getTypeName(),B_:u.getBaseTypes()};var c=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_TileGroup"}},{key:"getBaseTypes",value:function(){return[]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.TileGroup=c,c.H_={T_:c.getTypeName(),B_:c.getBaseTypes()};var l=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_Session"}},{key:"getBaseTypes",value:function(){return["AugLoop_Core_TileGroup"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.Session=l,l.H_={T_:l.getTypeName(),B_:l.getBaseTypes()};var f=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_Document"}},{key:"getBaseTypes",value:function(){return["AugLoop_Core_TileGroup"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.Document=f,f.H_={T_:f.getTypeName(),B_:f.getBaseTypes()};var d=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_SubDocument"}},{key:"getBaseTypes",value:function(){return[]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.SubDocument=d,d.H_={T_:d.getTypeName(),B_:d.getBaseTypes()};var p=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_GridCell"}},{key:"getBaseTypes",value:function(){return[]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.GridCell=p,p.H_={T_:p.getTypeName(),B_:p.getBaseTypes()};var h=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_GridNeighborhoodContext"}},{key:"getBaseTypes",value:function(){return[]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.GridNeighborhoodContext=h,h.H_={T_:h.getTypeName(),B_:h.getBaseTypes()};var g=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_ItemFilter"}},{key:"getBaseTypes",value:function(){return[]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.ItemFilter=g,g.H_={T_:g.getTypeName(),B_:g.getBaseTypes()};var y=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_DynamicContext"}},{key:"getBaseTypes",value:function(){return[]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.DynamicContext=y,y.H_={T_:y.getTypeName(),B_:y.getBaseTypes()};var m=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_ContextHolder"}},{key:"getBaseTypes",value:function(){return[]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.ContextHolder=m,m.H_={T_:m.getTypeName(),B_:m.getBaseTypes()};var v=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_UserContextHolder"}},{key:"getBaseTypes",value:function(){return["AugLoop_Core_ContextHolder"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.UserContextHolder=v,v.H_={T_:v.getTypeName(),B_:v.getBaseTypes()};var k=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_TenantContextHolder"}},{key:"getBaseTypes",value:function(){return["AugLoop_Core_ContextHolder"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.TenantContextHolder=k,k.H_={T_:k.getTypeName(),B_:k.getBaseTypes()};var T=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_EventsHolder"}},{key:"getBaseTypes",value:function(){return[]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.EventsHolder=T,T.H_={T_:T.getTypeName(),B_:T.getBaseTypes()};var S=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Core_UserCommandsHolder"}},{key:"getBaseTypes",value:function(){return["AugLoop_Core_EventsHolder"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.UserCommandsHolder=S,S.H_={T_:S.getTypeName(),B_:S.getBaseTypes()}},{142:142,172:172,174:174,178:178}],145:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.OperationErrorCode=n.ItemChanges=n.ItemOperation=void 0,function(e){e[e.None=0]="None",e[e.Added=1]="Added",e[e.Updated=2]="Updated",e[e.Deleted=3]="Deleted"}(n.ItemOperation||(n.ItemOperation={})),function(e){e[e.ContentChanged=0]="ContentChanged",e[e.ContentWasEmpty=1]="ContentWasEmpty",e[e.FormattingChanged=2]="FormattingChanged",e[e.ContentWasInsideOfTheTable=3]="ContentWasInsideOfTheTable"}(n.ItemChanges||(n.ItemChanges={})),function(e){e[e.AddOfZeroElements=0]="AddOfZeroElements",e[e.AddOfItemsWithExtraOrMissingIds=1]="AddOfItemsWithExtraOrMissingIds",e[e.AddOfItemWithUndefinedId=2]="AddOfItemWithUndefinedId",e[e.AddOfUndefinedItem=3]="AddOfUndefinedItem",e[e.AddOfItemsWithDuplicateIds=4]="AddOfItemsWithDuplicateIds",e[e.SetHeadToNonExistingItem=5]="SetHeadToNonExistingItem",e[e.DeleteOfNonExistingItem=6]="DeleteOfNonExistingItem",e[e.UpdateOfNonExistentItem=7]="UpdateOfNonExistentItem",e[e.UpdateOfStubbedItem=8]="UpdateOfStubbedItem",e[e.MoveOfNonExistentItem=9]="MoveOfNonExistentItem",e[e.UpdateMetaDataOfNonAnnotationType=10]="UpdateMetaDataOfNonAnnotationType",e[e.SequentialyInvertedUpdate=11]="SequentialyInvertedUpdate",e[e.DeltaOfNonExistingItem=100]="DeltaOfNonExistingItem"}(n.OperationErrorCode||(n.OperationErrorCode={}))},{}],146:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},{}],147:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},{}],148:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},{}],149:[function(e,t,n){"use strict";var o=e(178),r=o(e(174)),i=o(e(172));Object.defineProperty(n,"__esModule",{value:!0}),n.GridConstants=n.OpenType=n.BlobRefType=n.ecsMetadataBlockWidth=n.ecsMetadataBlockHeight=void 0,n.ecsMetadataBlockHeight=512,n.ecsMetadataBlockWidth=32,function(e){e[e.None=0]="None",e[e.HttpsGetDownloadUrl=1]="HttpsGetDownloadUrl",e[e.AlCodedLocation=2]="AlCodedLocation"}(n.BlobRefType||(n.BlobRefType={})),function(e){e[e.NewDocument=0]="NewDocument",e[e.EditDocument=1]="EditDocument",e[e.ViewOnlyDocument=2]="ViewOnlyDocument"}(n.OpenType||(n.OpenType={}));var a=(0,r.default)((function e(){(0,i.default)(this,e)}));n.GridConstants=a,a.lowerIndexBound=1,a.maxNumberOfRows=1048576,a.maxNumberOfColumns=16384,a.firstColumnName="A",a.lastColumnName="XFD"},{172:172,174:174,178:178}],150:[function(e,t,n){"use strict";var o=e("exportStarHelper");Object.defineProperty(n,"__esModule",{value:!0}),o(e(151),n),o(e(152),n),o(e(153),n),o(e(154),n)},{151:151,152:152,153:153,154:154}],151:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.TextTileDeltaUnit=n.TextTileDeltaType=void 0,function(e){e[e.Add=0]="Add",e[e.Delete=1]="Delete",e[e.Update=2]="Update",e[e.CursorUpdate=3]="CursorUpdate",e[e.FormattingUpdate=4]="FormattingUpdate",e[e.OtherNonContentUpdate=5]="OtherNonContentUpdate"}(n.TextTileDeltaType||(n.TextTileDeltaType={})),function(e){e[e.Chars=0]="Chars",e[e.Word=1]="Word",e[e.PartialSentence=2]="PartialSentence",e[e.Sentence=3]="Sentence",e[e.Paragraph=4]="Paragraph"}(n.TextTileDeltaUnit||(n.TextTileDeltaUnit={}))},{}],152:[function(e,t,n){"use strict";var o=e(178),r=o(e(172)),i=o(e(174));Object.defineProperty(n,"__esModule",{value:!0}),n.FormattedTextTileDelta=n.TextTileDelta=void 0;var a=e(139),s=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Text_TextTileDelta"}},{key:"getBaseTypes",value:function(){return["AugLoop_Core_ItemDelta"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.TextTileDelta=s,s.H_={T_:s.getTypeName(),B_:s.getBaseTypes()};var u=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Text_FormattedTextTileDelta"}},{key:"getBaseTypes",value:function(){return["AugLoop_Text_TextTileDelta","AugLoop_Core_ItemDelta"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.FormattedTextTileDelta=u,u.H_={T_:u.getTypeName(),B_:u.getBaseTypes()}},{139:139,172:172,174:174,178:178}],153:[function(e,t,n){"use strict";var o=e(178),r=o(e(172)),i=o(e(174));Object.defineProperty(n,"__esModule",{value:!0}),n.LinkTile=n.DateTile=n.PersonTile=n.TaskTile=n.DynamicTextContext=n.FormattedTextTile=n.TextTile=void 0;var a=e(139),s=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Text_TextTile"}},{key:"getBaseTypes",value:function(){return[]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.TextTile=s,s.H_={T_:s.getTypeName(),B_:s.getBaseTypes()};var u=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Text_FormattedTextTile"}},{key:"getBaseTypes",value:function(){return["AugLoop_Text_TextTile"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.FormattedTextTile=u,u.H_={T_:u.getTypeName(),B_:u.getBaseTypes()};var c=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Text_DynamicTextContext"}},{key:"getBaseTypes",value:function(){return["AugLoop_Core_DynamicContext"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.DynamicTextContext=c,c.H_={T_:c.getTypeName(),B_:c.getBaseTypes()};var l=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Text_TaskTile"}},{key:"getBaseTypes",value:function(){return["AugLoop_Text_FormattedTextTile","AugLoop_Text_TextTile"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.TaskTile=l,l.H_={T_:l.getTypeName(),B_:l.getBaseTypes()};var f=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Text_PersonTile"}},{key:"getBaseTypes",value:function(){return["AugLoop_Text_TextTile"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.PersonTile=f,f.H_={T_:f.getTypeName(),B_:f.getBaseTypes()};var d=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Text_DateTile"}},{key:"getBaseTypes",value:function(){return["AugLoop_Text_TextTile"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.DateTile=d,d.H_={T_:d.getTypeName(),B_:d.getBaseTypes()};var p=function(){function e(t){(0,r.default)(this,e),a.SchemaObject.assign(e,this,t)}return(0,i.default)(e,null,[{key:"getTypeName",value:function(){return"AugLoop_Text_LinkTile"}},{key:"getBaseTypes",value:function(){return["AugLoop_Text_TextTile"]}},{key:"typeGuard",value:function(t){return a.SchemaObject.matchesTypesFor(t,[e.getTypeName()])}}]),e}();n.LinkTile=p,p.H_={T_:p.getTypeName(),B_:p.getBaseTypes()}},{139:139,172:172,174:174,178:178}],154:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SpecialIndentType=n.ObjectType=n.Alignment=n.UnderlineType=n.CapsType=n.FontWeight=n.ListType=n.AnchorMode=void 0,function(e){e[e.Unspecified=0]="Unspecified",e[e.Inline=1]="Inline",e[e.Floating=2]="Floating"}(n.AnchorMode||(n.AnchorMode={})),function(e){e[e.Undefined=0]="Undefined",e[e.Bullet=1]="Bullet",e[e.Numbered=2]="Numbered",e[e.Lim=3]="Lim",e[e.Nil=4]="Nil",e[e.Any=5]="Any",e[e.NoList=6]="NoList",e[e.Invalid=7]="Invalid"}(n.ListType||(n.ListType={})),function(e){e[e.DontCare=1]="DontCare",e[e.Thin=2]="Thin",e[e.ExtraLight=3]="ExtraLight",e[e.Light=4]="Light",e[e.Normal=5]="Normal",e[e.Medium=6]="Medium",e[e.SemiBold=7]="SemiBold",e[e.Bold=8]="Bold",e[e.ExtraBold=9]="ExtraBold",e[e.Heavy=10]="Heavy"}(n.FontWeight||(n.FontWeight={})),function(e){e[e.NoCaps=0]="NoCaps",e[e.SmallCaps=1]="SmallCaps",e[e.AllCaps=2]="AllCaps",e[e.AllPetiteCaps=3]="AllPetiteCaps",e[e.PetiteCaps=4]="PetiteCaps",e[e.Unicase=5]="Unicase",e[e.Titling=6]="Titling",e[e.Other=7]="Other"}(n.CapsType||(n.CapsType={})),function(e){e[e.None=0]="None",e[e.Words=1]="Words",e[e.SingleLine=2]="SingleLine",e[e.DoubleLine=3]="DoubleLine",e[e.HeavyLine=4]="HeavyLine",e[e.DottedLine=5]="DottedLine",e[e.DottedHeavyLine=6]="DottedHeavyLine",e[e.DashLine=7]="DashLine",e[e.DashHeavyLine=8]="DashHeavyLine",e[e.DashLongLine=9]="DashLongLine",e[e.DashLongHeavyLine=10]="DashLongHeavyLine",e[e.DotDashLine=11]="DotDashLine",e[e.DotDashHeavyLine=12]="DotDashHeavyLine",e[e.DotDotDashLine=13]="DotDotDashLine",e[e.DotDotDashHeavyLine=14]="DotDotDashHeavyLine",e[e.WavyLine=15]="WavyLine",e[e.WavyHeavyLine=16]="WavyHeavyLine",e[e.WavyDoubleLine=17]="WavyDoubleLine"}(n.UnderlineType||(n.UnderlineType={})),function(e){e[e.Left=0]="Left",e[e.Right=1]="Right",e[e.Center=2]="Center",e[e.Justified=3]="Justified",e[e.Other=4]="Other",e[e.None=5]="None",e[e.JustifyLow=6]="JustifyLow",e[e.Distributed=7]="Distributed",e[e.ThaiDistributed=8]="ThaiDistributed"}(n.Alignment||(n.Alignment={})),function(e){e[e.Image=0]="Image",e[e.TextBox=1]="TextBox",e[e.Chart=2]="Chart",e[e.SmartArt=3]="SmartArt",e[e.Drawing=4]="Drawing",e[e.EquationObject=5]="EquationObject",e[e.Ink=6]="Ink",e[e.InkSpace=7]="InkSpace",e[e.InkEndOfLine=8]="InkEndOfLine",e[e.LineBreak=9]="LineBreak",e[e.PageBreak=10]="PageBreak",e[e.PageNumbers=11]="PageNumbers",e[e.FootnoteEndnote=12]="FootnoteEndnote",e[e.FootnoteEndnoteReferenceMark=13]="FootnoteEndnoteReferenceMark",e[e.Tab=14]="Tab",e[e.UnsupportedObject=15]="UnsupportedObject",e[e.Other=16]="Other"}(n.ObjectType||(n.ObjectType={})),function(e){e[e.Initial=0]="Initial",e[e.FirstLine=1]="FirstLine",e[e.Hanging=2]="Hanging"}(n.SpecialIndentType||(n.SpecialIndentType={}))},{}],155:[function(e,t,n){"use strict";var o=e("exportStarHelper");Object.defineProperty(n,"__esModule",{value:!0}),o(e(156),n),o(e(157),n)},{156:156,157:157}],156:[function(e,t,n){"use strict";var o=e(178)(e(192));Object.defineProperty(n,"__esModule",{value:!0}),n.isLargerThan=n.estimateSize=void 0;n.estimateSize=function(e){return r(e,Number.POSITIVE_INFINITY)};n.isLargerThan=function(e,t){return r(e,t)>t};var r=function(e,t){for(var n=0,r=[],i=[e];i.length>0;){var a=i.pop(),s=(0,o.default)(a);if("boolean"===s)n+=4;else if("string"===s)n+=2*a.length;else if("number"===s)n+=8;else if("object"===s&&a&&-1===r.indexOf(a))if(a instanceof Uint8Array)n+=a.length;else for(var u in r.push(a),a)i.push(a[u]);if(n>t)return n}return n}},{178:178,192:192}],157:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.v4=void 0,n.v4=function(){return"xxxxxxxx-xxxx-xxxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}},{}],158:[function(e,t,n){"use strict";var o=e("exportStarHelper");Object.defineProperty(n,"__esModule",{value:!0}),o(e(159),n)},{159:159}],159:[function(e,t,n){"use strict";var o=e(178),r=o(e(172)),i=o(e(174)),a=o(e(188));function s(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return u(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}Object.defineProperty(n,"__esModule",{value:!0}),n.WorkflowFlights=n.parseFlights=void 0;n.parseFlights=function(e){if(!e)return new c([],new Set,new Map);var t,n=e.split(";"),o=new Set,r=new Map,i=s(n);try{for(i.s();!(t=i.n()).done;){var u=t.value.trim();if(""!==u){o.add(c.normalizeName(u));var l=u.split(":"),f=(0,a.default)(l,2),d=f[0],p=f[1],h=c.normalizeName(d);h&&r.set(h,p)}}}catch(e){i.e(e)}finally{i.f()}return new c(n,o,r)};var c=function(){function e(t,n,o){(0,r.default)(this,e),this.originalFlights=t,this.normalizedFlights=n,this.keyValueFlightsMap=o}return(0,i.default)(e,[{key:"hasFlight",value:function(t){var n=e.normalizeName(t),o=this.normalizedFlights.has(n),r=this.keyValueFlightsMap.has(n);return o||r}},{key:"getBooleanValue",value:function(e,t){var n;switch(null===(n=this.getStringValue(e))||void 0===n?void 0:n.toLowerCase()){case"true":return!0;case"false":return!1;default:return t}}},{key:"getIntValue",value:function(e,t){var n=this.getStringValue(e),o=Number.parseInt(n,10);return Number.isNaN(o)?t:o}},{key:"getStringValue",value:function(t,n){var o;return null!==(o=this.keyValueFlightsMap.get(e.normalizeName(t)))&&void 0!==o?o:n}},{key:"getAll",value:function(){return this.originalFlights}},{key:"getAllParsed",value:function(){var e=[];return this.keyValueFlightsMap.forEach((function(t,n){var o=null==t?void 0:t.toLowerCase();switch(o){case"true":e.push({name:n,value:!0});break;case"false":e.push({name:n,value:!1});break;default:var r=Number.parseInt(o,10);Number.isNaN(r)?e.push({name:n,value:t}):e.push({name:n,value:r})}})),e}}],[{key:"normalizeName",value:function(e){return null==e?void 0:e.toLowerCase()}}]),e}();n.WorkflowFlights=c},{172:172,174:174,178:178,188:188}],160:[function(e,t,n){"use strict";var o=e("exportStarHelper");Object.defineProperty(n,"__esModule",{value:!0}),o(e(161),n)},{161:161}],161:[function(e,t,n){"use strict";function o(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return r(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,i=function(){};return{s:i,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){u=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(u)throw a}}}}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}Object.defineProperty(n,"__esModule",{value:!0}),n.getWaitedContextTypes=n.getContextTypes=void 0;var i=e(23);n.getContextTypes=function(e,t){var n,r=[],i=o(null!=e?e:[]);try{for(i.s();!(n=i.n()).done;){var a=n.value;if(void 0===t||t===a.cardinality){var s,u=o(a.contextTypes);try{for(u.s();!(s=u.n()).done;){var c=s.value;r.push([c,a.cardinality,a.producerWaitPolicy])}}catch(e){u.e(e)}finally{u.f()}}}}catch(e){i.e(e)}finally{i.f()}return r};n.getWaitedContextTypes=function(e){var t,n=[],r=o(null!=e?e:[]);try{for(r.s();!(t=r.n()).done;){var a=t.value;a.cardinality!==i.RequestedContextCardinality.Required&&a.producerWaitPolicy!==i.ProducerWaitPolicy.Always||(n=n.concat(a.contextTypes))}}catch(e){r.e(e)}finally{r.f()}return n}},{23:23}],162:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ConsoleLogger=void 0;var o=e(165),r=e(164),i=function(){function e(){}return e.tagIntToString=function(t){return t<=e.maxNumericTag?t.toString():t>>24>=this.minOldSchemeHighByteValue?String.fromCharCode(t>>24&255,t>>16&255,t>>8&255,255&t):e.map.charAt(t>>24&63)+e.map.charAt(t>>18&63)+e.map.charAt(t>>12&63)+e.map.charAt(t>>6&63)+e.map.charAt(63&t)},e.getLogMessage=function(t,n,o){return"tag_"+e.tagIntToString(t)+" ["+r.LogCategory[n]+"] "+o},e.prototype.sendTraceTag=function(t,n,r,i){var a=this.logMessage;switch(r){case o.TraceLevel.Error:a=this.logError;break;case o.TraceLevel.Warning:a=this.logWarning;break;case o.TraceLevel.Info:a=this.logInfo;break;case o.TraceLevel.Verbose:a=this.logVerbose;break;case o.TraceLevel.Spam:default:a=this.logMessage}try{a(e.getLogMessage(t,n,i))}catch(e){var s="undefined"!=typeof navigator?navigator:void 0;if(s&&!/rv:11.0/i.test(s.userAgent))throw e}},e.prototype.shipAssertTag=function(t,n,o,r){console.assert(o,e.getLogMessage(t,n,r))},e.prototype.debugAssertTag=function(e,t,n,o){this.shipAssertTag(e,t,n,o)},e.prototype.logMessage=function(e){"log"in console&&console.log(e)},e.prototype.logError=function(e){"error"in console&&console.error(e)},e.prototype.logWarning=function(e){"warn"in console&&console.warn(e)},e.prototype.logInfo=function(e){"info"in console&&console.info(e)},e.prototype.logVerbose=function(e){"debug"in console&&console.debug(e)},e.maxNumericTag=65535,e.minOldSchemeHighByteValue=36,e.map="abcdefghijklmnopqrstuvwxyz0123456789",e}();n.ConsoleLogger=i},{164:164,165:165}],163:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.NoopLogger=void 0;var o=function(){function e(){}return e.prototype.sendTraceTag=function(){},e.prototype.shipAssertTag=function(){},e.prototype.debugAssertTag=function(){},e}();n.NoopLogger=o},{}],164:[function(e,t,n){"use strict";var o;Object.defineProperty(n,"__esModule",{value:!0}),n.LogCategory=void 0,n.LogCategory=o,function(e){e[e.msoulscat_ES_EWAJS=0]="msoulscat_ES_EWAJS",e[e.msoulscat_ES_EWAJSGrid=1]="msoulscat_ES_EWAJSGrid",e[e.msoulscat_ES_EWAJSChart=6]="msoulscat_ES_EWAJSChart",e[e.msoulscat_MSOSP_FileMenuCommands=202]="msoulscat_MSOSP_FileMenuCommands",e[e.msoulscat_MSOSP_OTelJS=225]="msoulscat_MSOSP_OTelJS",e[e.msoulscat_MSOSP_OTelJSInWebWoker=227]="msoulscat_MSOSP_OTelJSInWebWoker",e[e.msoulscat_MSOSP_OTelJSWebWorkerPrototype=228]="msoulscat_MSOSP_OTelJSWebWorkerPrototype",e[e.msoulscat_Wac_WordViewer=301]="msoulscat_Wac_WordViewer",e[e.msoulscat_Wac_BrowserGeneral=306]="msoulscat_Wac_BrowserGeneral",e[e.msoulscat_Wac_TaskPane=320]="msoulscat_Wac_TaskPane",e[e.msoulscat_Wac_OneNoteGeneral=339]="msoulscat_Wac_OneNoteGeneral",e[e.msoulscat_Wac_Ribbon=340]="msoulscat_Wac_Ribbon",e[e.msoulscat_Wac_WopiPendingApplication=379]="msoulscat_Wac_WopiPendingApplication",e[e.msoulscat_Wac_Telemetry=383]="msoulscat_Wac_Telemetry",e[e.msoulscat_Wac_WacCatchUpActivities=391]="msoulscat_Wac_WacCatchUpActivities",e[e.msoulscat_Wac_Dictation=394]="msoulscat_Wac_Dictation",e[e.msoulscat_Wac_OneNoteSync=395]="msoulscat_Wac_OneNoteSync",e[e.msoulscat_Wac_VisioApp=700]="msoulscat_Wac_VisioApp",e[e.msoulscat_OneNoteOnline_EditableCache=1601]="msoulscat_OneNoteOnline_EditableCache",e[e.msoulscat_Wac_PptAnimation=800]="msoulscat_Wac_PptAnimation",e[e.msoulscat_Wac_PptLive=833]="msoulscat_Wac_PptLive",e[e.msoulscat_Wac_PptMWeb=834]="msoulscat_Wac_PptMWeb",e[e.msoulscat_Wac_PptShape=815]="msoulscat_Wac_PptShape",e[e.msoulscat_Wac_PptSession=817]="msoulscat_Wac_PptSession",e[e.msoulscat_Wac_PptSlideshow=830]="msoulscat_Wac_PptSlideshow",e[e.msoulscat_Wac_PptView=822]="msoulscat_Wac_PptView",e[e.msoulscat_Wac_VersionHistory=2300]="msoulscat_Wac_VersionHistory",e[e.msoulscat_Wac_WordPresence=302]="msoulscat_Wac_WordPresence",e[e.msoulscat_Wac_WordVersionHistory=3005]="msoulscat_Wac_WordVersionHistory",e[e.msoulscat_Wac_LivePersonaCard=3006]="msoulscat_Wac_LivePersonaCard",e[e.msoulscat_Wac_CatchUpFlyout=3012]="msoulscat_Wac_CatchUpFlyout",e[e.msoulscat_Wac_WordDesigner=3016]="msoulscat_Wac_WordDesigner",e[e.msoulscat_Wac_ModernFontPicker=3021]="msoulscat_Wac_ModernFontPicker",e[e.msoulscat_Wac_UnifiedUiHost=3027]="msoulscat_Wac_UnifiedUiHost",e[e.msoulscat_Wac_EquationTools=3033]="msoulscat_Wac_EquationTools"}(o||(n.LogCategory=o={}))},{}],165:[function(e,t,n){"use strict";var o;Object.defineProperty(n,"__esModule",{value:!0}),n.TraceLevel=void 0,n.TraceLevel=o,function(e){e[e.Error=10]="Error",e[e.Warning=15]="Warning",e[e.Info=50]="Info",e[e.Verbose=100]="Verbose",e[e.Spam=200]="Spam"}(o||(n.TraceLevel=o={}))},{}],166:[function(e,t,n){(function(t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.UlsLoggerWrapper=n.ULS=void 0,n.initializeLogger=function(e){if(!e)throw new Error("The 'logger' argument is missing");a.setLogger(e)};var o=e(163),r=e(162),i=function(){function e(){this.externalLogger="production"!==t.env.NODE_ENV?new r.ConsoleLogger:new o.NoopLogger}return e.prototype.setLogger=function(e){this.externalLogger=e},e.prototype.sendTraceTag=function(e,t,n,o){this.externalLogger.sendTraceTag(e,t,n,o)},e.prototype.debugAssertTag=function(e,t,n,o){this.externalLogger.debugAssertTag(e,t,n,o)},e.prototype.shipAssertTag=function(e,t,n,o){this.externalLogger.shipAssertTag(e,t,n,o)},e}();n.UlsLoggerWrapper=i;var a=new i;n.ULS=a}).call(this,{env:{NODE_ENV:"production"}})},{162:162,163:163}],167:[function(e,t,n){t.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o},t.exports.__esModule=!0,t.exports.default=t.exports},{}],168:[function(e,t,n){t.exports=function(e){if(Array.isArray(e))return e},t.exports.__esModule=!0,t.exports.default=t.exports},{}],169:[function(e,t,n){var o=e(167);t.exports=function(e){if(Array.isArray(e))return o(e)},t.exports.__esModule=!0,t.exports.default=t.exports},{167:167}],170:[function(e,t,n){t.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e},t.exports.__esModule=!0,t.exports.default=t.exports},{}],171:[function(e,t,n){function o(e,t,n,o,r,i,a){try{var s=e[i](a),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(o,r)}t.exports=function(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function s(e){o(a,r,i,s,u,"next",e)}function u(e){o(a,r,i,s,u,"throw",e)}s(void 0)}))}},t.exports.__esModule=!0,t.exports.default=t.exports},{}],172:[function(e,t,n){t.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},t.exports.__esModule=!0,t.exports.default=t.exports},{}],173:[function(e,t,n){var o=e(187),r=e(180);function i(e,n,a){return r()?(t.exports=i=Reflect.construct.bind(),t.exports.__esModule=!0,t.exports.default=t.exports):(t.exports=i=function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&o(i,n.prototype),i},t.exports.__esModule=!0,t.exports.default=t.exports),i.apply(null,arguments)}t.exports=i,t.exports.__esModule=!0,t.exports.default=t.exports},{180:180,187:187}],174:[function(e,t,n){var o=e(191);function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,o(r.key),r)}}t.exports=function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e},t.exports.__esModule=!0,t.exports.default=t.exports},{191:191}],175:[function(e,t,n){var o=e(191);t.exports=function(e,t,n){return(t=o(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},t.exports.__esModule=!0,t.exports.default=t.exports},{191:191}],176:[function(e,t,n){function o(e){return t.exports=o=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},t.exports.__esModule=!0,t.exports.default=t.exports,o(e)}t.exports=o,t.exports.__esModule=!0,t.exports.default=t.exports},{}],177:[function(e,t,n){var o=e(187);t.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&o(e,t)},t.exports.__esModule=!0,t.exports.default=t.exports},{187:187}],178:[function(e,t,n){t.exports=function(e){return e&&e.__esModule?e:{default:e}},t.exports.__esModule=!0,t.exports.default=t.exports},{}],179:[function(e,t,n){t.exports=function(e){return-1!==Function.toString.call(e).indexOf("[native code]")},t.exports.__esModule=!0,t.exports.default=t.exports},{}],180:[function(e,t,n){t.exports=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}},t.exports.__esModule=!0,t.exports.default=t.exports},{}],181:[function(e,t,n){t.exports=function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)},t.exports.__esModule=!0,t.exports.default=t.exports},{}],182:[function(e,t,n){t.exports=function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,r,i,a,s=[],u=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(o=i.call(n)).done)&&(s.push(o.value),s.length!==t);u=!0);}catch(e){c=!0,r=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw r}}return s}},t.exports.__esModule=!0,t.exports.default=t.exports},{}],183:[function(e,t,n){t.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},t.exports.__esModule=!0,t.exports.default=t.exports},{}],184:[function(e,t,n){t.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},t.exports.__esModule=!0,t.exports.default=t.exports},{}],185:[function(e,t,n){var o=e(192).default,r=e(170);t.exports=function(e,t){if(t&&("object"===o(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return r(e)},t.exports.__esModule=!0,t.exports.default=t.exports},{170:170,192:192}],186:[function(e,t,n){var o=e(192).default;function r(){"use strict";/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */t.exports=r=function(){return e},t.exports.__esModule=!0,t.exports.default=t.exports;var e={},n=Object.prototype,i=n.hasOwnProperty,a=Object.defineProperty||function(e,t,n){e[t]=n.value},s="function"==typeof Symbol?Symbol:{},u=s.iterator||"@@iterator",c=s.asyncIterator||"@@asyncIterator",l=s.toStringTag||"@@toStringTag";function f(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{f({},"")}catch(e){f=function(e,t,n){return e[t]=n}}function d(e,t,n,o){var r=t&&t.prototype instanceof g?t:g,i=Object.create(r.prototype),s=new A(o||[]);return a(i,"_invoke",{value:C(e,n,s)}),i}function p(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=d;var h={};function g(){}function y(){}function m(){}var v={};f(v,u,(function(){return this}));var k=Object.getPrototypeOf,T=k&&k(k(O([])));T&&T!==n&&i.call(T,u)&&(v=T);var S=m.prototype=g.prototype=Object.create(v);function b(e){["next","throw","return"].forEach((function(t){f(e,t,(function(e){return this._invoke(t,e)}))}))}function w(e,t){var n;a(this,"_invoke",{value:function(r,a){function s(){return new t((function(n,s){!function n(r,a,s,u){var c=p(e[r],e,a);if("throw"!==c.type){var l=c.arg,f=l.value;return f&&"object"==o(f)&&i.call(f,"__await")?t.resolve(f.__await).then((function(e){n("next",e,s,u)}),(function(e){n("throw",e,s,u)})):t.resolve(f).then((function(e){l.value=e,s(l)}),(function(e){return n("throw",e,s,u)}))}u(c.arg)}(r,a,n,s)}))}return n=n?n.then(s,s):s()}})}function C(e,t,n){var o="suspendedStart";return function(r,i){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===r)throw i;return I()}for(n.method=r,n.arg=i;;){var a=n.delegate;if(a){var s=_(a,n);if(s){if(s===h)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===o)throw o="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o="executing";var u=p(e,t,n);if("normal"===u.type){if(o=n.done?"completed":"suspendedYield",u.arg===h)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o="completed",n.method="throw",n.arg=u.arg)}}}function _(e,t){var n=t.method,o=e.iterator[n];if(void 0===o)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,_(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var r=p(o,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,h;var i=r.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,h):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,h)}function x(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function M(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(x,this),this.reset(!0)}function O(e){if(e){var t=e[u];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function t(){for(;++n<e.length;)if(i.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:I}}function I(){return{value:void 0,done:!0}}return y.prototype=m,a(S,"constructor",{value:m,configurable:!0}),a(m,"constructor",{value:y,configurable:!0}),y.displayName=f(m,l,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,f(e,l,"GeneratorFunction")),e.prototype=Object.create(S),e},e.awrap=function(e){return{__await:e}},b(w.prototype),f(w.prototype,c,(function(){return this})),e.AsyncIterator=w,e.async=function(t,n,o,r,i){void 0===i&&(i=Promise);var a=new w(d(t,n,o,r),i);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},b(S),f(S,l,"Generator"),f(S,u,(function(){return this})),f(S,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var o in t)n.push(o);return n.reverse(),function e(){for(;n.length;){var o=n.pop();if(o in t)return e.value=o,e.done=!1,e}return e.done=!0,e}},e.values=O,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(M),!e)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,o){return a.type="throw",a.arg=e,t.next=n,o&&(t.method="next",t.arg=void 0),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var r=this.tryEntries[o],a=r.completion;if("root"===r.tryLoc)return n("end");if(r.tryLoc<=this.prev){var s=i.call(r,"catchLoc"),u=i.call(r,"finallyLoc");if(s&&u){if(this.prev<r.catchLoc)return n(r.catchLoc,!0);if(this.prev<r.finallyLoc)return n(r.finallyLoc)}else if(s){if(this.prev<r.catchLoc)return n(r.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return n(r.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&i.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var r=o;break}}r&&("break"===e||"continue"===e)&&r.tryLoc<=t&&t<=r.finallyLoc&&(r=null);var a=r?r.completion:{};return a.type=e,a.arg=t,r?(this.method="next",this.next=r.finallyLoc,h):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),M(n),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var o=n.completion;if("throw"===o.type){var r=o.arg;M(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:O(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),h}},e}t.exports=r,t.exports.__esModule=!0,t.exports.default=t.exports},{192:192}],187:[function(e,t,n){function o(e,n){return t.exports=o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},t.exports.__esModule=!0,t.exports.default=t.exports,o(e,n)}t.exports=o,t.exports.__esModule=!0,t.exports.default=t.exports},{}],188:[function(e,t,n){var o=e(168),r=e(182),i=e(193),a=e(183);t.exports=function(e,t){return o(e)||r(e,t)||i(e,t)||a()},t.exports.__esModule=!0,t.exports.default=t.exports},{168:168,182:182,183:183,193:193}],189:[function(e,t,n){var o=e(169),r=e(181),i=e(193),a=e(184);t.exports=function(e){return o(e)||r(e)||i(e)||a()},t.exports.__esModule=!0,t.exports.default=t.exports},{169:169,181:181,184:184,193:193}],190:[function(e,t,n){var o=e(192).default;t.exports=function(e,t){if("object"!==o(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==o(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)},t.exports.__esModule=!0,t.exports.default=t.exports},{192:192}],191:[function(e,t,n){var o=e(192).default,r=e(190);t.exports=function(e){var t=r(e,"string");return"symbol"===o(t)?t:String(t)},t.exports.__esModule=!0,t.exports.default=t.exports},{190:190,192:192}],192:[function(e,t,n){function o(e){return t.exports=o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t.exports.__esModule=!0,t.exports.default=t.exports,o(e)}t.exports=o,t.exports.__esModule=!0,t.exports.default=t.exports},{}],193:[function(e,t,n){var o=e(167);t.exports=function(e,t){if(e){if("string"==typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(e,t):void 0}},t.exports.__esModule=!0,t.exports.default=t.exports},{167:167}],194:[function(e,t,n){var o=e(176),r=e(187),i=e(179),a=e(173);function s(e){var n="function"==typeof Map?new Map:void 0;return t.exports=s=function(e){if(null===e||!i(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(e))return n.get(e);n.set(e,t)}function t(){return a(e,arguments,o(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r(t,e)},t.exports.__esModule=!0,t.exports.default=t.exports,s(e)}t.exports=s,t.exports.__esModule=!0,t.exports.default=t.exports},{173:173,176:176,179:179,187:187}],195:[function(e,t,n){var o=e(186)();t.exports=o;try{regeneratorRuntime=o}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=o:Function("r","regeneratorRuntime = r")(o)}},{186:186}],196:[function(e,t,n){var o="undefined"!=typeof self?self:this,r=function(){function e(){this.fetch=!1,this.DOMException=o.DOMException}return e.prototype=o,new e}();!function(e){!function(t){var n="URLSearchParams"in e,o="Symbol"in e&&"iterator"in Symbol,r="FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),i="FormData"in e,a="ArrayBuffer"in e;if(a)var s=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],u=ArrayBuffer.isView||function(e){return e&&s.indexOf(Object.prototype.toString.call(e))>-1};function c(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function l(e){return"string"!=typeof e&&(e=String(e)),e}function f(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return o&&(t[Symbol.iterator]=function(){return t}),t}function d(e){this.map={},e instanceof d?e.forEach((function(e,t){this.append(t,e)}),this):Array.isArray(e)?e.forEach((function(e){this.append(e[0],e[1])}),this):e&&Object.getOwnPropertyNames(e).forEach((function(t){this.append(t,e[t])}),this)}function p(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function h(e){return new Promise((function(t,n){e.onload=function(){t(e.result)},e.onerror=function(){n(e.error)}}))}function g(e){var t=new FileReader,n=h(t);return t.readAsArrayBuffer(e),n}function y(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function m(){return this.bodyUsed=!1,this._initBody=function(e){var t;this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:r&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:i&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:n&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():a&&r&&((t=e)&&DataView.prototype.isPrototypeOf(t))?(this._bodyArrayBuffer=y(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):a&&(ArrayBuffer.prototype.isPrototypeOf(e)||u(e))?this._bodyArrayBuffer=y(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):n&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},r&&(this.blob=function(){var e=p(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?p(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(g)}),this.text=function(){var e,t,n,o=p(this);if(o)return o;if(this._bodyBlob)return e=this._bodyBlob,t=new FileReader,n=h(t),t.readAsText(e),n;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),n=new Array(t.length),o=0;o<t.length;o++)n[o]=String.fromCharCode(t[o]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},i&&(this.formData=function(){return this.text().then(T)}),this.json=function(){return this.text().then(JSON.parse)},this}d.prototype.append=function(e,t){e=c(e),t=l(t);var n=this.map[e];this.map[e]=n?n+", "+t:t},d.prototype.delete=function(e){delete this.map[c(e)]},d.prototype.get=function(e){return e=c(e),this.has(e)?this.map[e]:null},d.prototype.has=function(e){return this.map.hasOwnProperty(c(e))},d.prototype.set=function(e,t){this.map[c(e)]=l(t)},d.prototype.forEach=function(e,t){for(var n in this.map)this.map.hasOwnProperty(n)&&e.call(t,this.map[n],n,this)},d.prototype.keys=function(){var e=[];return this.forEach((function(t,n){e.push(n)})),f(e)},d.prototype.values=function(){var e=[];return this.forEach((function(t){e.push(t)})),f(e)},d.prototype.entries=function(){var e=[];return this.forEach((function(t,n){e.push([n,t])})),f(e)},o&&(d.prototype[Symbol.iterator]=d.prototype.entries);var v=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function k(e,t){var n,o,r=(t=t||{}).body;if(e instanceof k){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new d(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,r||null==e._bodyInit||(r=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new d(t.headers)),this.method=(n=t.method||this.method||"GET",o=n.toUpperCase(),v.indexOf(o)>-1?o:n),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&r)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(r)}function T(e){var t=new FormData;return e.trim().split("&").forEach((function(e){if(e){var n=e.split("="),o=n.shift().replace(/\+/g," "),r=n.join("=").replace(/\+/g," ");t.append(decodeURIComponent(o),decodeURIComponent(r))}})),t}function S(e,t){t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new d(t.headers),this.url=t.url||"",this._initBody(e)}k.prototype.clone=function(){return new k(this,{body:this._bodyInit})},m.call(k.prototype),m.call(S.prototype),S.prototype.clone=function(){return new S(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new d(this.headers),url:this.url})},S.error=function(){var e=new S(null,{status:0,statusText:""});return e.type="error",e};var b=[301,302,303,307,308];S.redirect=function(e,t){if(-1===b.indexOf(t))throw new RangeError("Invalid status code");return new S(null,{status:t,headers:{location:e}})},t.DOMException=e.DOMException;try{new t.DOMException}catch(e){t.DOMException=function(e,t){this.message=e,this.name=t;var n=Error(e);this.stack=n.stack},t.DOMException.prototype=Object.create(Error.prototype),t.DOMException.prototype.constructor=t.DOMException}function w(e,n){return new Promise((function(o,i){var a=new k(e,n);if(a.signal&&a.signal.aborted)return i(new t.DOMException("Aborted","AbortError"));var s=new XMLHttpRequest;function u(){s.abort()}s.onload=function(){var e,t,n={status:s.status,statusText:s.statusText,headers:(e=s.getAllResponseHeaders()||"",t=new d,e.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach((function(e){var n=e.split(":"),o=n.shift().trim();if(o){var r=n.join(":").trim();t.append(o,r)}})),t)};n.url="responseURL"in s?s.responseURL:n.headers.get("X-Request-URL");var r="response"in s?s.response:s.responseText;o(new S(r,n))},s.onerror=function(){i(new TypeError("Network request failed"))},s.ontimeout=function(){i(new TypeError("Network request failed"))},s.onabort=function(){i(new t.DOMException("Aborted","AbortError"))},s.open(a.method,a.url,!0),"include"===a.credentials?s.withCredentials=!0:"omit"===a.credentials&&(s.withCredentials=!1),"responseType"in s&&r&&(s.responseType="blob"),a.headers.forEach((function(e,t){s.setRequestHeader(t,e)})),a.signal&&(a.signal.addEventListener("abort",u),s.onreadystatechange=function(){4===s.readyState&&a.signal.removeEventListener("abort",u)}),s.send(void 0===a._bodyInit?null:a._bodyInit)}))}w.polyfill=!0,e.fetch||(e.fetch=w,e.Headers=d,e.Request=k,e.Response=S),t.Headers=d,t.Request=k,t.Response=S,t.fetch=w,Object.defineProperty(t,"__esModule",{value:!0})}({})}(r),r.fetch.ponyfill=!0,delete r.fetch.polyfill;var i=r;(n=i.fetch).default=i.fetch,n.fetch=i.fetch,n.Headers=i.Headers,n.Request=i.Request,n.Response=i.Response,t.exports=n},{}],197:[function(e,t,n){"use strict";function o(e){if(this._capacity=i(e),this._length=0,this._front=0,r(e)){for(var t=e.length,n=0;n<t;++n)this[n]=e[n];this._length=t}}o.prototype.toArray=function(){for(var e=this._length,t=new Array(e),n=this._front,o=this._capacity,r=0;r<e;++r)t[r]=this[n+r&o-1];return t},o.prototype.push=function(e){var t=arguments.length,n=this._length;if(t>1){var o=this._capacity;if(n+t>o){for(var r=0;r<t;++r){this._checkCapacity(n+1),this[i=this._front+n&this._capacity-1]=arguments[r],n++,this._length=n}return n}for(var i=this._front,r=0;r<t;++r)this[i+n&o-1]=arguments[r],i++;return this._length=n+t,n+t}return 0===t?n:(this._checkCapacity(n+1),this[r=this._front+n&this._capacity-1]=e,this._length=n+1,n+1)},o.prototype.pop=function(){var e=this._length;if(0!==e){var t=this._front+e-1&this._capacity-1,n=this[t];return this[t]=void 0,this._length=e-1,n}},o.prototype.shift=function(){var e=this._length;if(0!==e){var t=this._front,n=this[t];return this[t]=void 0,this._front=t+1&this._capacity-1,this._length=e-1,n}},o.prototype.unshift=function(e){var t=this._length,n=arguments.length;if(n>1){if(t+n>(r=this._capacity)){for(var o=n-1;o>=0;o--){this._checkCapacity(t+1);var r=this._capacity;this[a=(this._front-1&r-1^r)-r]=arguments[o],t++,this._length=t,this._front=a}return t}var i=this._front;for(o=n-1;o>=0;o--){var a;this[a=(i-1&r-1^r)-r]=arguments[o],i=a}return this._front=i,this._length=t+n,t+n}if(0===n)return t;this._checkCapacity(t+1);r=this._capacity;return this[o=(this._front-1&r-1^r)-r]=e,this._length=t+1,this._front=o,t+1},o.prototype.peekBack=function(){var e=this._length;if(0!==e)return this[this._front+e-1&this._capacity-1]},o.prototype.peekFront=function(){if(0!==this._length)return this[this._front]},o.prototype.get=function(e){var t=e;if(t===(0|t)){var n=this._length;if(t<0&&(t+=n),!(t<0||t>=n))return this[this._front+t&this._capacity-1]}},o.prototype.isEmpty=function(){return 0===this._length},o.prototype.clear=function(){for(var e=this._length,t=this._front,n=this._capacity,o=0;o<e;++o)this[t+o&n-1]=void 0;this._length=0,this._front=0},o.prototype.toString=function(){return this.toArray().toString()},o.prototype.valueOf=o.prototype.toString,o.prototype.removeFront=o.prototype.shift,o.prototype.removeBack=o.prototype.pop,o.prototype.insertFront=o.prototype.unshift,o.prototype.insertBack=o.prototype.push,o.prototype.enqueue=o.prototype.push,o.prototype.dequeue=o.prototype.shift,o.prototype.toJSON=o.prototype.toArray,Object.defineProperty(o.prototype,"length",{get:function(){return this._length},set:function(){throw new RangeError("")}}),o.prototype._checkCapacity=function(e){this._capacity<e&&this._resizeTo(i(1.5*this._capacity+16))},o.prototype._resizeTo=function(e){var t=this._capacity;this._capacity=e;var n=this._front,o=this._length;n+o>t&&function(e,t,n,o,r){for(var i=0;i<r;++i)n[i+o]=e[i+t],e[i+t]=void 0}(this,0,this,t,n+o&t-1)};var r=Array.isArray;function i(e){if("number"!=typeof e){if(!r(e))return 16;e=e.length}return t=Math.min(Math.max(16,e),1073741824),t>>>=0,t-=1,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,1+(t|=t>>16);var t}t.exports=o},{}],198:[function(e,t,n){"use strict";var o=Object.prototype.hasOwnProperty,r="~";function i(){}function a(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function s(e,t,n,o,i){if("function"!=typeof n)throw new TypeError("The listener must be a function");var s=new a(n,o||e,i),u=r?r+t:t;return e._events[u]?e._events[u].fn?e._events[u]=[e._events[u],s]:e._events[u].push(s):(e._events[u]=s,e._eventsCount++),e}function u(e,t){0==--e._eventsCount?e._events=new i:delete e._events[t]}function c(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(r=!1)),c.prototype.eventNames=function(){var e,t,n=[];if(0===this._eventsCount)return n;for(t in e=this._events)o.call(e,t)&&n.push(r?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},c.prototype.listeners=function(e){var t=r?r+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var o=0,i=n.length,a=new Array(i);o<i;o++)a[o]=n[o].fn;return a},c.prototype.listenerCount=function(e){var t=r?r+e:e,n=this._events[t];return n?n.fn?1:n.length:0},c.prototype.emit=function(e,t,n,o,i,a){var s=r?r+e:e;if(!this._events[s])return!1;var u,c,l=this._events[s],f=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),f){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,n),!0;case 4:return l.fn.call(l.context,t,n,o),!0;case 5:return l.fn.call(l.context,t,n,o,i),!0;case 6:return l.fn.call(l.context,t,n,o,i,a),!0}for(c=1,u=new Array(f-1);c<f;c++)u[c-1]=arguments[c];l.fn.apply(l.context,u)}else{var d,p=l.length;for(c=0;c<p;c++)switch(l[c].once&&this.removeListener(e,l[c].fn,void 0,!0),f){case 1:l[c].fn.call(l[c].context);break;case 2:l[c].fn.call(l[c].context,t);break;case 3:l[c].fn.call(l[c].context,t,n);break;case 4:l[c].fn.call(l[c].context,t,n,o);break;default:if(!u)for(d=1,u=new Array(f-1);d<f;d++)u[d-1]=arguments[d];l[c].fn.apply(l[c].context,u)}}return!0},c.prototype.on=function(e,t,n){return s(this,e,t,n,!1)},c.prototype.once=function(e,t,n){return s(this,e,t,n,!0)},c.prototype.removeListener=function(e,t,n,o){var i=r?r+e:e;if(!this._events[i])return this;if(!t)return u(this,i),this;var a=this._events[i];if(a.fn)a.fn!==t||o&&!a.once||n&&a.context!==n||u(this,i);else{for(var s=0,c=[],l=a.length;s<l;s++)(a[s].fn!==t||o&&!a[s].once||n&&a[s].context!==n)&&c.push(a[s]);c.length?this._events[i]=1===c.length?c[0]:c:u(this,i)}return this},c.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&u(this,t)):(this._events=new i,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=r,c.EventEmitter=c,void 0!==t&&(t.exports=c)},{}],199:[function(e,t,n){"use strict";t.exports=function e(t,n){if(t===n)return!0;if(t&&n&&"object"==typeof t&&"object"==typeof n){if(t.constructor!==n.constructor)return!1;var o,r,i;if(Array.isArray(t)){if((o=t.length)!=n.length)return!1;for(r=o;0!=r--;)if(!e(t[r],n[r]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if((o=(i=Object.keys(t)).length)!==Object.keys(n).length)return!1;for(r=o;0!=r--;)if(!Object.prototype.hasOwnProperty.call(n,i[r]))return!1;for(r=o;0!=r--;){var a=i[r];if(!e(t[a],n[a]))return!1}return!0}return t!=t&&n!=n}},{}],200:[function(e,t,n){(function(e){!function(e){function t(){}function n(e,t){if(e=void 0===e?"utf-8":e,t=void 0===t?{fatal:!1}:t,-1===r.indexOf(e.toLowerCase()))throw new RangeError("Failed to construct 'TextDecoder': The encoding label provided ('"+e+"') is invalid.");if(t.fatal)throw Error("Failed to construct 'TextDecoder': the 'fatal' option is unsupported.")}function o(e){for(var t=0,n=Math.min(65536,e.length+1),o=new Uint16Array(n),r=[],i=0;;){var a=t<e.length;if(!a||i>=n-1){if(r.push(String.fromCharCode.apply(null,o.subarray(0,i))),!a)return r.join("");e=e.subarray(t),i=t=0}if(0==(128&(a=e[t++])))o[i++]=a;else if(192==(224&a)){var s=63&e[t++];o[i++]=(31&a)<<6|s}else if(224==(240&a)){s=63&e[t++];var u=63&e[t++];o[i++]=(31&a)<<12|s<<6|u}else if(240==(248&a)){65535<(a=(7&a)<<18|(s=63&e[t++])<<12|(u=63&e[t++])<<6|63&e[t++])&&(a-=65536,o[i++]=a>>>10&1023|55296,a=56320|1023&a),o[i++]=a}}}if(e.TextEncoder&&e.TextDecoder)return!1;var r=["utf-8","utf8","unicode-1-1-utf-8"];Object.defineProperty(t.prototype,"encoding",{value:"utf-8"}),t.prototype.encode=function(e,t){if((t=void 0===t?{stream:!1}:t).stream)throw Error("Failed to encode: the 'stream' option is unsupported.");t=0;for(var n=e.length,o=0,r=Math.max(32,n+(n>>>1)+7),i=new Uint8Array(r>>>3<<3);t<n;){var a=e.charCodeAt(t++);if(55296<=a&&56319>=a){if(t<n){var s=e.charCodeAt(t);56320==(64512&s)&&(++t,a=((1023&a)<<10)+(1023&s)+65536)}if(55296<=a&&56319>=a)continue}if(o+4>i.length&&(r+=8,r=(r*=1+t/e.length*2)>>>3<<3,(s=new Uint8Array(r)).set(i),i=s),0==(4294967168&a))i[o++]=a;else{if(0==(4294965248&a))i[o++]=a>>>6&31|192;else if(0==(4294901760&a))i[o++]=a>>>12&15|224,i[o++]=a>>>6&63|128;else{if(0!=(4292870144&a))continue;i[o++]=a>>>18&7|240,i[o++]=a>>>12&63|128,i[o++]=a>>>6&63|128}i[o++]=63&a|128}}return i.slice?i.slice(0,o):i.subarray(0,o)},Object.defineProperty(n.prototype,"encoding",{value:"utf-8"}),Object.defineProperty(n.prototype,"fatal",{value:!1}),Object.defineProperty(n.prototype,"ignoreBOM",{value:!1});var i=o;"function"==typeof Buffer&&Buffer.from?i=function(e){return Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("utf-8")}:"function"==typeof Blob&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&(i=function(e){var t=URL.createObjectURL(new Blob([e],{type:"text/plain;charset=UTF-8"}));try{var n=new XMLHttpRequest;return n.open("GET",t,!1),n.send(),n.responseText}catch(t){return o(e)}finally{URL.revokeObjectURL(t)}}),n.prototype.decode=function(e,t){if((t=void 0===t?{stream:!1}:t).stream)throw Error("Failed to decode: the 'stream' option is unsupported.");return e=e instanceof Uint8Array?e:e.buffer instanceof ArrayBuffer?new Uint8Array(e.buffer):new Uint8Array(e),i(e)},e.TextEncoder=t,e.TextDecoder=n}("undefined"!=typeof window?window:void 0!==e?e:this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],201:[function(e,t,n){"use strict";var o=e(178),r=o(e(195)),i=o(e(175)),a=o(e(171));function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){(0,i.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}Object.defineProperty(n,"__esModule",{value:!0});var c=e(202);var l=["get","getKey","getAll","getAllKeys","count"],f=["put","add","delete","clear"],d=new Map;function p(e,t){if(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t){if(d.get(t))return d.get(t);var n=t.replace(/FromIndex$/,""),o=t!==n,i=f.indexOf(n)>=0;if(n in(o?IDBIndex:IDBObjectStore).prototype&&(i||l.indexOf(n)>=0)){var s=function(){var e=(0,a.default)(r.default.mark((function e(t){var a,s,u,c,l,f,d=arguments;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(s=this.transaction(t,i?"readwrite":"readonly"),u=s.store,c=d.length,l=new Array(c>1?c-1:0),f=1;f<c;f++)l[f-1]=d[f];return o&&(u=u.index(l.shift())),e.next=6,Promise.all([(a=u)[n].apply(a,l),i&&s.done]);case 6:return e.abrupt("return",e.sent[0]);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}();return d.set(t,s),s}}}c.replaceTraps((function(e){return u(u({},e),{},{get:function(t,n,o){return p(t,n)||e.get(t,n,o)},has:function(t,n){return!!p(t,n)||e.has(t,n)}})})),n.unwrap=c.unwrap,n.wrap=c.wrap,n.deleteDB=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.blocked,o=indexedDB.deleteDatabase(e);return n&&o.addEventListener("blocked",(function(){return n()})),c.wrap(o).then((function(){}))},n.openDB=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=n.blocked,r=n.upgrade,i=n.blocking,a=n.terminated,s=indexedDB.open(e,t),u=c.wrap(s);return r&&s.addEventListener("upgradeneeded",(function(e){r(c.wrap(s.result),e.oldVersion,e.newVersion,c.wrap(s.transaction))})),o&&s.addEventListener("blocked",(function(){return o()})),u.then((function(e){a&&e.addEventListener("close",(function(){return a()})),i&&e.addEventListener("versionchange",(function(){return i()}))})).catch((function(){})),u}},{171:171,175:175,178:178,195:195,202:202}],202:[function(e,t,n){"use strict";var o,r,i=function(e,t){return t.some((function(t){return e instanceof t}))};var a=new WeakMap,s=new WeakMap,u=new WeakMap,c=new WeakMap,l=new WeakMap;var f={get:function(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return s.get(e);if("objectStoreNames"===t)return e.objectStoreNames||u.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return h(e[t])},set:function(e,t,n){return e[t]=n,!0},has:function(e,t){return e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e}};function d(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(r||(r=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).indexOf(e)>=0?function(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return e.apply(g(this),n),h(a.get(this))}:function(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return h(e.apply(g(this),n))}:function(t){for(var n=arguments.length,o=new Array(n>1?n-1:0),r=1;r<n;r++)o[r-1]=arguments[r];var i=e.call.apply(e,[g(this),t].concat(o));return u.set(i,t.sort?t.sort():[t]),h(i)}}function p(e){return"function"==typeof e?d(e):(e instanceof IDBTransaction&&function(e){if(!s.has(e)){var t=new Promise((function(t,n){var o=function(){e.removeEventListener("complete",r),e.removeEventListener("error",i),e.removeEventListener("abort",i)},r=function(){t(),o()},i=function(){n(e.error||new DOMException("AbortError","AbortError")),o()};e.addEventListener("complete",r),e.addEventListener("error",i),e.addEventListener("abort",i)}));s.set(e,t)}}(e),i(e,o||(o=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,f):e)}function h(e){if(e instanceof IDBRequest)return t=e,(n=new Promise((function(e,n){var o=function(){t.removeEventListener("success",r),t.removeEventListener("error",i)},r=function(){e(h(t.result)),o()},i=function(){n(t.error),o()};t.addEventListener("success",r),t.addEventListener("error",i)}))).then((function(e){e instanceof IDBCursor&&a.set(e,t)})).catch((function(){})),l.set(n,t),n;var t,n;if(c.has(e))return c.get(e);var o=p(e);return o!==e&&(c.set(e,o),l.set(o,e)),o}var g=function(e){return l.get(e)};n.instanceOfAny=i,n.replaceTraps=function(e){f=e(f)},n.reverseTransformCache=l,n.unwrap=g,n.wrap=h},{}],203:[function(e,t,n){(function(e){var n=null;"undefined"!=typeof WebSocket?n=WebSocket:"undefined"!=typeof MozWebSocket?n=MozWebSocket:void 0!==e?n=e.WebSocket||e.MozWebSocket:"undefined"!=typeof window?n=window.WebSocket||window.MozWebSocket:"undefined"!=typeof self&&(n=self.WebSocket||self.MozWebSocket),t.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],awaiterHelper:[function(e,t,n){"use strict";var o=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function a(e){try{u(o.next(e))}catch(e){i(e)}}function s(e){try{u(o.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((o=o.apply(e,t||[])).next())}))};t.exports=o},{}],exportStarHelper:[function(e,t,n){"use strict";var o=Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]},r=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};t.exports=r},{}],importDefaultHelper:[function(e,t,n){"use strict";var o=function(e){return e&&e.__esModule?e:{default:e}};t.exports=o},{}]},{},[57])(57)}));
//# sourceMappingURL=al.min.js.map

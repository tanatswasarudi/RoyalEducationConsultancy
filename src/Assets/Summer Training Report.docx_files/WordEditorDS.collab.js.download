'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[8],{1576:function(G,J,d){d.r(J);d.d(J,"RtcUtils",function(){return l});G=d(0);var m=d(7),f=d(34),a=d(1707);class l{static BLb(w,y=a.a.vVb){let v;try{v=f.c(w)}catch(u){throw w=String.format("Failed to JSON-serialize payload : {0}",u),m.ULS.sendTraceTag(508396173,500,10,w),Error.argument("payload",w);}if(v.length>y)throw w=String.format("Payload exceeds maximum length: {0} > {1}.",v.length,y),m.ULS.sendTraceTag(508396171,
500,10,w),Error.argument("payload",w);return v}static deserialize(w,y,v){if(!w)return null;if(Object.getType(w)!==String){var u=String.format("Failed to deserialize [{0}] - object is not of type [String] and is instead of type [{1}]. ExtraInfo: [{2}].",y,Object.getType(w).getName(),v);m.ULS.sendTraceTag(508396170,500,10,u);return null}u=null;try{u=f.a(w)}catch(x){w=String.format("Failed to deserialize [{0}]. Exception deserializing the object : [{1}]. ExtraInfo: [{2}].",y,x,v),m.ULS.sendTraceTag(508396168,
500,10,w)}return u}static Bma(w){if(!w)return"";if("string"===typeof w)return w.toString();try{return f.c(w)}catch(y){return w.toString()}}static SCf(w){let y,v,u;y=0;u=v=null;if(!w)return{L6c:y,M6c:v,vk:u};try{const x=w.source;x&&Object.getType(x)===String&&(u=x);const z=w.context;z&&(w=z,y=w.status?w.status:0,v=w.statusText?w.statusText:null)}catch(x){}return{L6c:y,M6c:v,vk:u}}}Object(G.a)(l,"RtcUtils",null,[])},1604:function(G,J,d){d.r(J);G=d(0);var m=d(7),f=d(104),a=d(90),l;(function(u){u[u.SendNotification=
0]="SendNotification";u[u.SendPersistentState=1]="SendPersistentState";u[u.FindSession=2]="FindSession";u[u.Last=3]="Last"})(l||(l={}));Object(G.b)("ApiType",l);var w;(function(u){u[u.AttemptCount=0]="AttemptCount";u[u.SuccessCount=1]="SuccessCount";u[u.DropCount=2]="DropCount";u[u.FailedCount=3]="FailedCount";u[u.LatencyOverThresholdCount=4]="LatencyOverThresholdCount";u[u.LatencyUnderThresholdCount=5]="LatencyUnderThresholdCount";u[u.ThrottledCount=6]="ThrottledCount";u[u.Last=7]="Last"})(w||(w=
{}));Object(G.b)("EventCountType",w);var y=d(1706);d.d(J,"FrequentLoggingMetrics",function(){return v});class v{constructor(u){this.zWc=this.O0c=null;this.cdd=this.B1c=0;this.Rk=null;this.iLc=this.DFb=0;this.Af=u;this.AVf();this.qDb=this.JHc=this.OFb=!1;this.B3a=0}get GCf(){return this.qDb}wFg(u){this.iLc=u;window.setInterval(Object(f.a)(this,this.VUb,"logMetricsBatchAndReset"),u);this.DFb=(new Date).getTime()}Zs(u,x){this.YBg(u)&&!this.JHc||this.GCf||!window.navigator.onLine||this.Af.Nta||(this.Rk[u][x]++,
this.OFb=!0)}AVf(){this.Rk=Array(3);for(let u=0;3>u;u++){this.Rk[u]=Array(7);for(let x=0;7>x;x++)this.Rk[u][x]=0}}Emf(){const u={};for(let x=0;3>x;x++)for(let z=0;7>z;z++)this.V1f(x,z)&&(u[l[x]+w[z]]=this.Rk[x][z]);u.FSDomain=this.O0c;u.ConnectionDomain=this.zWc;u.FSRetryInterval=this.B1c;u.MaxPayloadSize=this.cdd;u.LogNumber=this.B3a;1===this.B3a&&(u.FSLatencies=y.a.instance.XJf(),u.ConLatencies=y.a.instance.sIf());return u}V1f(u,x){return 2===u&&3!==x&&0!==x?!1:!0}YBg(u){return 2===u?!1:!0}VUb(){if(this.OFb){this.B3a++;
if((new Date).getTime()-this.DFb<5E3+this.iLc){var u=a.a.toJSON(this.Emf());m.ULS.sendTraceTag(50644352,500,15,u)}this.DFb=(new Date).getTime();for(u=0;3>u;u++)for(let x=0;7>x;x++)this.Rk[u][x]=0;this.OFb=!1}}k8f(){this.JHc=!0}static get instance(){return v._instance}static create(u){v.instance||(v._instance=new v(u));return v.instance}}v._instance=null;Object(G.a)(v,"FrequentLoggingMetrics",null,[1451])},1706:function(G,J,d){d.d(J,"a",function(){return m});G=d(0);class m{constructor(){this.AQc=!1;
this.sHa=null;this.wFc=0;this.zDb=this.eYc(6);this.R1a=this.eYc(6);this.Ada=this.rpa=0;this.Yp=()=>new Date}get xGg(){return this.AQc}eYc(f){f=Array(f);for(let a=0;a<f.length;a++)f[a]=0;return f}XJf(){return this.zDb.toString()}sIf(){return this.R1a.toString()}xFg(){this.sHa=this.Yp()}JNa(f,a,l=!1){this.xGg||(l&&(this.AQc=!0),l=this.Yp(),0===f&&5<this.rpa||1===f&&5<this.Ada||(this.wFc<f?(1===this.rpa%2&&(this.zDb[this.rpa]=-1,this.rpa++),this.wFc=f,1===a&&(this.R1a[this.Ada]=-1,this.Ada++),this.R1a[this.Ada]=
this.c1b(l),this.Ada++):0===f?(this.zDb[this.rpa]=this.c1b(l),this.rpa++):(this.R1a[this.Ada]=this.c1b(l),this.Ada++)))}c1b(f){const a=f.getTime()-this.sHa.getTime();this.sHa=f;return a}static get instance(){m._instance||(m._instance=new m);return m._instance}static set instance(f){m._instance=f}}m._instance=null;Object(G.a)(m,"LatencyMetrics",null,[])},1707:function(G,J,d){d.d(J,"a",function(){return m});G=d(0);class m{}m.ddd=31E3;m.vVb=8E3;Object(G.a)(m,"RealtimeChannelStaticConstants",null,[])},
1742:function(G,J,d){d.r(J);G=d(0);var m=d(7),f=d(104),a=d(356),l=d(951),w=d(95),y=d(2),v=d(1996),u=d(49),x=d(1706);class z{constructor(sa,Ea){this.data=sa;this.timeStamp=Ea}}Object(G.a)(z,"PresenceData",null,[]);class A{constructor(sa){this.s6=!1;this.PHa=0;this.fCb=!1;this.Q6f=()=>{m.ULS.sendTraceTag(4539720,500,50,"Usage statement for the Rtc_ConnectedEver KPI for [{0}]",this.Bk)};this.setTimeout=A.jNb;this.clearTimeout=A.hNb;this.c7f=this.Q6f;this.Bk=sa}Neg(){this.s6||(this.PHa=this.setTimeout(()=>
{this.s6=!1;this.tcd()},8E3),this.s6=!0,this.fCb=!1)}Zeg(){this.QT()}rhg(){this.tcd()}tcd(){this.QT();this.fCb||(this.fCb=!0,this.c7f())}QT(){this.s6&&this.clearTimeout(this.PHa);this.PHa=0;this.s6=!1}static jNb(sa,Ea){return window.setTimeout(sa,Ea)}static hNb(sa){window.clearTimeout(sa)}}Object(G.a)(A,"ConnectedUsageKpiLogger",null,[1470]);class D{constructor(){this.Sjd=this.MYb;this.Vjd=this.PYb;this.Ujd=this.OYb;this.Xjd=this.RYb;this.Wjd=this.QYb;this.WYb=this.XYb;this.gdb=this.UYb;this.aha=
this.SYb;this.gva=this.TYb;this.Tjd=this.NYb;this.$Ca=this.QVb;this.GYa=this.RVb}MYb(){}PYb(){}OYb(){}RYb(){}QYb(){}UYb(){}TYb(){}SYb(){}XYb(){}NYb(){}QVb(){}RVb(){}}Object(G.a)(D,"NoopRealtimeChannelMetrics",null,[1460,300]);class F{}F.HPa="presenceUpdated";F.updateNotification="updateNotification";F.uhd="persistentStateCleared";F.updatePersistentState="persistentStateUpdated";Object(G.a)(F,"RtcClientMethodNames",null,[]);class I{}I.TTf="realtimeChannelHub";I.HPa="UpdatePresence";I.nC="SendUpdateNotification";
I.xPb="GetCompletePersistentStateWithMetadata";I.updatePersistentState="UpdatePersistentState";I.s9="UpdateClientInfo";Object(G.a)(I,"RtcHubMethodNames",null,[]);class H{constructor(sa){this.Wp=sa}Erg(sa){this.Wp.on(F.HPa,sa)}Krg(sa){this.Wp.on(F.updateNotification,sa)}Crg(sa){this.Wp.on(F.updatePersistentState,sa)}Brg(sa){this.Wp.on(F.uhd,sa)}uLg(sa){this.Wp.off(F.HPa,sa)}xLg(sa){this.Wp.off(F.updateNotification,sa)}tLg(sa){this.Wp.off(F.updatePersistentState,sa)}sLg(sa){this.Wp.off(F.uhd,sa)}HPa(sa){return this.Wp.invoke(I.HPa,
sa)}s9(sa){return this.Wp.invoke(I.s9,sa)}nC(sa,Ea){return this.Wp.invoke(I.nC,sa,Ea)}xPb(sa){return this.Wp.invoke(I.xPb,sa)}updatePersistentState(sa,Ea){return this.Wp.invoke(I.updatePersistentState,sa,Ea)}}Object(G.a)(H,"RealtimeChannelProxy",null,[1467,1468,1469]);var N=d(1707);class M{constructor(){this.ABb=this.JDc=!1;this.zBb=0;this.UBb=this.jIb=this.iIb=this.rBb=!1;this.ADb=0;this.XOc=!1;this.WOc=this.VOc=0;this.JHb=!1;this.NHb=this.LHb=this.OHb=this.KHb=0;this.MHb=!1}get vkf(){return this.ABb}get ukf(){return this.zBb}get DRh(){return this.rBb}get sCg(){return this.iIb}get tCg(){return this.jIb}get Epf(){return this.UBb}get A8a(){return this.ADb}get Cwg(){return this.XOc}get Cmd(){return this.VOc}get Bwg(){return this.WOc}get ywg(){return this.JHb}get zwg(){return this.KHb}get Hmd(){return this.OHb}get Dmd(){return this.LHb}get Fmd(){return this.NHb}get Emd(){return this.MHb}static createInstance(sa){return sa?
Object.assign(new M,{JDc:sa.$("AwayStatusManagerIsEnabled"),ABb:sa.$("AwayStatusOneMinuteTimeoutIsEnabled"),zBb:sa.ic("AwayCoauthorThresholdMs",9E5),rBb:sa.$("RtcAllowCrossDomainAccessEnabled"),iIb:sa.$("ShouldLogOnContentNotification"),jIb:sa.$("ShouldLogOnHostSubscriptionNotification"),UBb:sa.$("RtcClientMetricsEnabled"),ADb:sa.ic("RtcFindSessionRequestTimeoutInMS",6E4),XOc:sa.$("RtcJsClientFrequentlyLogsMetrics"),VOc:sa.ic("RtcJsClientFrequentMetricsLatencyThresholdInMS",1E3),WOc:sa.ic("RtcJsClientFrequentMetricsLogIntervalInMS",
3E5),JHb:sa.$("RtcClientMessageTelemetryEnabled"),KHb:sa.ic("RtcClientMessageTelemetrySampleSize",5),OHb:sa.ic("RtcSendTelemetryMessageIntervalInMS",3E5),LHb:sa.ic("RtcLogClientMessageMetricsTimeOutInMs",2E4),NHb:sa.ic("RtcMaxPayloadSizeInCharactersOverride",N.a.vVb),MHb:sa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.RTCLogSignalrHeartBeatMessages",!1)}):Object.assign(new M,{JDc:!1,ABb:!1,zBb:9E5,rBb:!1,iIb:!1,jIb:!0,UBb:!1,ADb:9E4,JHb:!1,KHb:5,OHb:3E5,LHb:2E4,NHb:N.a.vVb,MHb:!1})}}Object(G.a)(M,
"RealtimeChannelSettings",null,[1466]);var U=d(1874),O=d(84),V=d(163);class Y{constructor(sa){this.OHa=null;this.kV=0;this.rfa=!1;this.Ce=sa;this.Ce.b_(Object(f.a)(this,this.JN,"onConnectionStateChanged"))}JN(sa,Ea){this.kV=Ea.newState}Ehg(){m.ULS.sendTraceTag(18637070,500,15,"Too many undelivered messages. Restarting RTC connection.");this.Ce.bdb()}hVf(sa){this.OHa.init(sa)}}Object(G.a)(Y,"ARtcMessageHandler",null,[]);var Q=d(317),S=d(1817),P=d(90);class T{constructor(sa,Ea=""){this.YHb=sa;this.uZ=
Ea}send(){return this.YHb()}get messageId(){return this.uZ}}Object(G.a)(T,"MessageHandler",null,[1474]);var Z=d(1755);class X extends Sys.EventArgs{constructor(sa,Ea,Ja,nb){super();this.AZb=sa;this.reconnectDelay=Ea;this.reason=Ja;this.s_b=nb}}Object(G.a)(X,"RefreshConnectionReconnectArgs",Sys.EventArgs,[]);var aa=d(1813);class ia{constructor(){this.zIb=this.ji=null}get Fi(){return this.ji?this.zIb?this.zIb.getTime()-this.ji.getTime():(new Date).getTime()-this.ji.getTime():0}start(){this.ji=new Date}stop(){this.zIb=
new Date}}Object(G.a)(ia,"SimpleStopwatch",null,[]);var wa=d(1818),ma=d(1998),na=d(821),Fa=d(643),Qa=d(644);class ya extends Y{constructor(sa,Ea,Ja,nb,ub,Yb,yb,Za,Ya,Pa){super(yb);this.Wp=null;this.dLc=this.eLc=!1;this.uZ=0;this.QGb=new V.a;this.UZe=ya.IIf();this.BGb=y.AFrameworkApplication.K.kb("OwningFeatureCrewForRtcNotificationKpis");this.Me=sa;this.oMc=this.nMc=0;this.OHa=Ea;this.OHa.b6a(Object(f.a)(this,this.Ehg,"onTooManyUndeliveredMessages"));this._clientId=Ja;this.K5e=ub;this.Ce.Mgf(Object(f.a)(this,
this.Tfd,"onRefreshProxyRequired"));this.Ce.Kgf(Object(f.a)(this,this.Sfd,"onRefreshAllPersistentStateRequest"));this.Ce.Qgf(Object(f.a)(this,this.nC,"sendUpdateNotification"));this.Ce.ogf(Object(f.a)(this,this.Afd,"onInternalPresenceUpdated"));this.Ce.pgf(Object(f.a)(this,this.Bfd,"onInternalUpdateNotificationReceived"));this.Ce.ngf(Object(f.a)(this,this.zfd,"onInternalPersistentStateUpdated"));this.Ce.mgf(Object(f.a)(this,this.yfd,"onInternalPersistentStateCleared"));this.Ce.Pgf(Object(f.a)(this,
this.qEa,"sendPersistentState"));this.Ce.Vgf(Object(f.a)(this,this.s9,"updateClientInfo"));this.Vd=Yb;this.Bk=nb;this.Rk=Za;this.Xv=Ya;this.VGa=Pa;this.fia=Object(O.a)(String,y.AFrameworkApplication.sessionStartInfoSettings.Application)||""}Tfd(sa,Ea){this.Wp=this.K5e(Ea.hubConnection);this.OHa.reset();this.Wp.Erg(Object(f.a)(this,this.aV,"onPresenceUpdated"));this.Wp.Crg(Object(f.a)(this,this.Oga,"onPersistentStateUpdated"));this.Wp.Brg(Object(f.a)(this,this.YYa,"onPersistentStateCleared"));this.Wp.Krg(Object(f.a)(this,
this.iS,"onUpdateNotificationReceived"))}JN(sa,Ea){this.kV=Ea.newState;2===Ea.newState&&this.gyg()}gyg(){for(const sa of this.QGb)this.nC(null,new aa.a(sa.key,sa.value,!1,new a.a));this.QGb=new V.a}Sfd(sa,Ea){Ea.GLb();for(sa=0;3>sa;++sa)this.ayg(sa,Ea)}ayg(sa,Ea){try{this.Wp.xPb(sa).done(Ja=>{Ea.twa(Ea.DUa,"GetCompletePresenceSuccess")&&(Ea.trf.rhg(),m.ULS.sendTraceTag(3249540,500,50,"Successfully retrieved complete session state for [{0}] of type [{1}]",this.Bk,sa),this.Ce.Ypg(),this.Jgg(sa,Ja),
this.Ce.Lpg(Ja),Ea.b0c.mb(sa)&&this.Ce.Fjd(sa,Ea.b0c.J(sa),new a.a))}).fail(Ja=>{const {RtcUtils:nb}=d(1576);Ea.twa(Ea.DUa,"GetCompletePresenceFail")&&(m.ULS.sendTraceTag(3249541,500,15,"Failed to retrieve complete session state : {0} for [{1}] of type [{2}]",nb.Bma(Ja),this.Bk,sa),this.Ce.bdb())}).always(()=>{Ea.vz&&Ea.vz.stop()})}catch(Ja){m.ULS.sendTraceTag(595132428,500,10,"Exception thrown while calling hub method GetCompletePersistentStateWithMetadata. Promise not even created. Current event token: {0}, Exception message: {1}",
Ea.DUa,Ja.message)}}qEa(sa,Ea){var {RtcUtils:Ja}=d(1576);sa=Ea.MI;let nb;const ub=Ea.$na;this.Xv.Zs(1,0);try{nb=Ja.BLb(sa,this.VGa)}catch(yb){this.Xv.Zs(1,3);m.ULS.sendTraceTag(574407636,500,10,"Exception thrown while trying to serialize presence. Exception message: {0}",yb.message);ub.setException(yb);return}Ja=new w.a;Ja.Z(this._clientId,Object.assign(new S.a,{Presence:sa,TimeStamp:(new Date).getTime()}));this.Ce.Hjd(Ea.type,Ja);if(2!==this.kV)this.Rk.aha(),this.Xv.Zs(1,2),ub.gg(null);else{var Yb=
this.uZ.toString();++this.uZ;sa=new T(()=>this.hyg(Ea.type,nb,Yb),Yb);sa=this.Nrd(0,Ea.type).add(sa);sa.hcb(yb=>{2===yb&&(this.Xv.Zs(1,6),this.dLc||2!==Ea.type||m.ULS.sendTraceTag(508651234,500,15,"First persistent state update of type LiveMeeting for [{0}] was throttled",this.Bk));ub.gg(null)});sa.gcb(()=>{})}}hyg(sa,Ea,Ja){let nb=null;const ub=new ia,Yb=new Z.a;m.ULS.sendTraceTag(3249501,500,50,"Sending presence update for [{0}] of type [{1}]",this.Bk,sa);if(2!==this.kV)return this.Rk.aha(),this.Xv.Zs(1,
2),m.ULS.sendTraceTag(7934171,500,15,"Connection is lost - unable to send the message for [{0}] of type [{1}]",this.Bk,sa),Yb.nVb(),Yb;this.Vd&&20>this.nMc&&(nb=this.Vd.Vf("WebServiceCall","Send Presence Message"),this.nMc++);ub.start();Yb.uMa(1);try{this.Wp.updatePersistentState(sa,Ea).done(()=>{this.Rk.gdb();this.Xv.Zs(1,1);m.ULS.sendTraceTag(3249502,500,50,"Successfully delivered presence update message [{0}] for [{1}] of type [{2}]",Ja,this.Bk,sa);Yb.b8(1);ub&&(ub.stop(),ub.Fi>this.Me.Cmd?this.Xv.Zs(1,
4):this.Xv.Zs(1,5))}).fail(yb=>{const {RtcUtils:Za}=d(1576);this.rfa||(this.Rk.aha(),this.Xv.Zs(1,3),this.dLc||2!==sa||m.ULS.sendTraceTag(508651233,500,15,"First persistent state update of type LiveMeeting for [{0}] failed",this.Bk),m.ULS.sendTraceTag(3249503,500,15,"Server failed to process the presence update message [{0}]: [{1}] for [{2}]",Ja,Za.Bma(yb),this.Bk));Yb.b8(2)}).always(()=>{nb&&nb.stop()})}catch(yb){m.ULS.sendTraceTag(593072906,500,15,"Exception when invoking hub method UpdatePersistentState, error: {1}",
yb.message),this.Xv.Zs(1,3),this.dLc||2!==sa||m.ULS.sendTraceTag(508651232,500,15,"First persistent state update of type LiveMeeting for [{0}] hit an exception",this.Bk),Yb.b8(2)}return Yb}s9(sa,Ea){({RtcUtils:sa}=d(1576));const Ja=Ea.D3h,nb=Ea.$na;let ub;try{ub=sa.BLb(Ja,this.VGa)}catch(Yb){m.ULS.sendTraceTag(544318999,500,10,"Exception thrown while trying to serialize clientInfo. Exception message: {0}",Yb.message);nb.setException(Yb);return}try{this.Wp.s9(ub).done(()=>{m.ULS.sendTraceTag(544319E3,
500,50,"Successfully delivered clientInfo.")}).fail(Yb=>{const {RtcUtils:yb}=d(1576);this.rfa||m.ULS.sendTraceTag(544319001,500,15,"Server failed to process udpate clientInfo: {0}.",yb.Bma(Yb));nb.gg(null)})}catch(Yb){m.ULS.sendTraceTag(544319002,500,15,"Exception when invoking hub method UpdateClientInfo: error: {0}",Yb.message),nb.gg(null)}}nC(sa,Ea){({RtcUtils:sa}=d(1576));const Ja=Ea.type,nb=Ea.nA,ub=Ea.axf,Yb=Ea.$na;let yb;this.Xv.Zs(0,0);try{yb=sa.BLb(nb,this.VGa)}catch(Ya){this.Xv.Zs(0,3);
m.ULS.sendTraceTag(574407637,500,10,"Exception thrown while trying to serialize updateHint. Exception message: {0}",Ya.message);Yb.setException(Ya);return}if(2!==this.kV)ub?this.QGb.Z(Ja,nb):(this.Rk.aha(),this.Xv.Zs(0,2)),Yb.gg(null);else{var Za=this.uZ.toString();++this.uZ;Ea=new T(()=>this.zyg(Ja,yb,Za),Za);Ea=this.Nrd(1,Ja).add(Ea);Ea.hcb(Ya=>{2===Ya&&this.Xv.Zs(0,6);Yb.gg(null)});Ea.gcb(()=>{})}}zyg(sa,Ea,Ja){let nb=null;const ub=new ia,Yb=new Z.a;m.ULS.sendTraceTag(3249505,500,50,"Sending update notification for [{0}] of type [{1}]",
this.Bk,sa);if(2!==this.kV)return this.Rk.aha(),this.Xv.Zs(0,2),m.ULS.sendTraceTag(7934172,500,15,"Connection is lost - unable to send the message for [{0}]",this.Bk),Yb.nVb(),Yb;this.Vd&&3===sa&&20>this.oMc&&(nb=this.Vd.Vf("WebServiceCall","Send WetContent Update"),this.oMc++);ub.start();Yb.uMa(1);this.Wp.nC(sa,Ea).done(()=>{this.Rk.gdb();this.Xv.Zs(0,1);m.ULS.sendTraceTag(3249506,500,50,"Successfully delivered update notification message [{0}] for [{1}] of type [{2}]",Ja,this.Bk,sa);Yb.b8(1);ub&&
(ub.stop(),ub.Fi>this.Me.Cmd?this.Xv.Zs(0,4):this.Xv.Zs(0,5))}).fail(yb=>{const {RtcUtils:Za}=d(1576);this.rfa||(this.Rk.aha(),this.Xv.Zs(0,3),m.ULS.sendTraceTag(3249507,500,15,"Server failed to process the update notification message [{0}] : [{1}] for [{2}]",Ja,Za.Bma(yb),this.Bk));Yb.b8(2)}).always(()=>{nb&&nb.stop()});return Yb}IY(){this.Wp.uLg(Object(f.a)(this,this.aV,"onPresenceUpdated"));this.Wp.tLg(Object(f.a)(this,this.Oga,"onPersistentStateUpdated"));this.Wp.sLg(Object(f.a)(this,this.YYa,
"onPersistentStateCleared"));this.Wp.xLg(Object(f.a)(this,this.iS,"onUpdateNotificationReceived"))}uxf(){this.Ce.ntg(Object(f.a)(this,this.Tfd,"onRefreshProxyRequired"));this.Ce.ltg(Object(f.a)(this,this.Sfd,"onRefreshAllPersistentStateRequest"));this.Ce.rtg(Object(f.a)(this,this.nC,"sendUpdateNotification"));this.Ce.atg(Object(f.a)(this,this.Afd,"onInternalPresenceUpdated"));this.Ce.btg(Object(f.a)(this,this.Bfd,"onInternalUpdateNotificationReceived"));this.Ce.$sg(Object(f.a)(this,this.zfd,"onInternalPersistentStateUpdated"));
this.Ce.Zsg(Object(f.a)(this,this.yfd,"onInternalPersistentStateCleared"));this.Ce.qtg(Object(f.a)(this,this.qEa,"sendPersistentState"));this.Ce.ttg(Object(f.a)(this,this.s9,"updateClientInfo"))}Afd(sa,Ea){this.aV(Ea.$ha,Ea.qZc)}aV(sa){this.Rk.gva();this.Oga(0,sa)}zfd(sa,Ea){this.Oga(Ea.type,Ea.$ha)}Jgg(sa,Ea){const Ja={};for(const nb in Ea)Ja[nb]=Ea[nb].Presence;this.Mfd(sa,Ja,Ea)}Oga(sa,Ea){this.Rk.gva();this.Mfd(sa,Ea)}Mfd(sa,Ea,Ja=null){var {RtcUtils:nb}=d(1576);if(m.ULS.A4(500,100))for(var ub in Ea);
delete Ea[this._clientId];if(!P.a.isEmpty(Ea)){for(var Yb in Ea)ub=Yb,Ea[ub]=nb.deserialize(Ea[Yb],"Presence",ub,!1,this.VGa);nb=new w.a;Yb=(new Date).getTime();for(const yb in Ea){ub=Ea[yb];const Za=yb;let Ya;Ja?(Ya=Ja[Za],Ya.Presence=ub):Ya=Object.assign(new S.a,{Presence:ub,TimeStamp:Yb});nb.Z(Za,Ya)}this.Ce.Hjd(sa,nb);switch(sa){case 0:this.eLc||(m.ULS.sendTraceTag(4539734,500,50,"Raising first presence update notification for [{0}]",this.Bk),this.eLc=!0,y.AFrameworkApplication.Ug&&y.AFrameworkApplication.Ug.zcj());
this.Ce.Bjd(Ea,[]);break;case 2:this.dLc||(m.ULS.sendTraceTag(508867081,500,50,"Raising first live meeting update notification for [{0}]",this.Bk),this.dLc=!0);this.Ce.ute(sa,Ea);break;default:this.Ce.ute(sa,Ea)}}}yfd(sa,Ea){this.YYa(Ea.KLb)}YYa(sa){this.Rk.gva();if(m.ULS.A4(500,100))for(let Ea=0;Ea<sa.length;++Ea);sa.length&&(this.Ce.aqg(sa),this.Ce.Tpg(sa),this.Ce.Bjd({},sa))}Bfd(sa,Ea){this.iS(Ea.type,Ea.nA)}iS(sa,Ea=null){this.Me.sCg&&0===sa&&m.ULS.sendTraceTag(40128990,500,50,"Received ContentUpdate notification from the server");
if(0===sa&&this.BGb&&0<this.BGb.length){var Ja=Object.assign(new na.a,{topLevelKpiName:"ContentUpdateNotificationReceived",featureName:"RtcNotification",crewAlias:this.BGb,vetoPillar:"RealTimeCoauth"});(Ja=Q.a.getInstance(Ja))&&Ja.logKpiUsage(this.UZe)}this.Me.tCg&&13===sa&&m.ULS.sendTraceTag(575221780,500,50,String.format("Received HostSubscription notification from the server : {0}",Ea||"<none>"));this.Rk.gva();5===sa?(Ea=(sa=this.Xjg(Ea))?String.format("Received client reconnection request from the server. Reason: {0}, Backoff time: {1} ",
sa.reason,sa.reconnectDelay):"Received client reconnection request from the server without params.",m.ULS.sendTraceTag(18637071,500,50,Ea),this.Ce.bdb(sa)):(Ea=d(1576).RtcUtils.deserialize(Ea,String.format("UpdateNotification-{0}",ma.a[sa]),null,!1,this.VGa),this.Ce.$pg(sa,Ea))}Xjg(sa){try{if(!sa||""===sa)return null;const Ea=JSON.parse(sa);return new X(Ea[wa.a.b_b],Ea[wa.a.xwg],Ea[wa.a.Awg],Ea[wa.a.s_b])}catch(Ea){return m.ULS.sendTraceTag(593844380,500,15,"Error when parsing reconnect hint: {0}",
Ea.message),null}}Nrd(sa,Ea){return this.OHa.gPf(this.hPf(sa,Ea))}hPf(sa,Ea){return sa+","+Ea}static IIf(){var sa=new Map;sa.set("SkipAria","True");sa=Object.assign(new Fa.a,{extendedProperties:sa});return Object.assign(new Qa.a,{kpiName:"ContentUpdateNotificationReceived",kpiType:0,optionalProperties:sa,blockFutureEmissionDurationInMs:3E5})}}Object(G.a)(ya,"RtcMessageHandler",Y,[]);class ta{PXc(sa,Ea=""){const {MaxOutstandingThrottler:Ja}=d(1814);return Ja.createInstance(sa,Ea)}cuf(sa,Ea=""){const {MaxRateThrottler:Ja}=
d(1816);return Ja.createInstance(sa,Ea)}}Object(G.a)(ta,"ThrottlerFactory",null,[1462]);var Aa=d(89),oa=d(1819);class za{constructor(sa){this.Me=null;this.ui=!1;this.sa=new Aa.a;this.KFb=new w.a;this.JFb=new w.a;this.UIb=sa;this.xpa=this.UIb.PXc(Ea=>Ea.send(),"GlobalMaxOustandingThrottler");this.xpa.b6a(()=>{this.sa.raiseEvent("TMUDM")})}init(sa){this.ui||(this.Me=sa,this.xpa.init(this.Me.k9,this.Me.kQf),this.ui=!0)}gPf(sa){var {MaxRateThrottler:Ea}=d(1816),{MaxOutstandingThrottler:Ja}=d(1814);this.ui||
this.init(new oa.a(Ea.GYc,Ja.LYc,Ja.JYc,za.z8f));({value:Ea}=this.KFb.Dc(sa)).returnValue||(({value:Ea}=this.JFb.Dc(sa)).returnValue||(Ea="MaxOutstandingThrottler-"+sa,Ea=this.UIb.PXc(Object(f.a)(this.xpa,this.xpa.add,"add"),Ea),Ea.init(this.Me.k9,this.Me.y8f),Ea.b6a(()=>{this.sa.raiseEvent("TMUDM")}),this.JFb.add(sa,Ea)),Ja="MaxRateThrottler-"+sa,Ea=this.UIb.cuf(Object(f.a)(Ea,Ea.add,"add"),Ja),Ea.init(this.Me.e9f),this.KFb.add(sa,Ea));return Ea}reset(){for(const sa of this.KFb)sa.value.VYb();for(const sa of this.JFb)sa.value.VYb(),
sa.value.reset();this.xpa.VYb();this.xpa.reset()}b6a(sa){this.sa.addHandler("TMUDM",sa)}}za.z8f=1E3;Object(G.a)(za,"ThrottlerManager",null,[1461]);var ja=d(1999);const fa=(sa,Ea,Ja,nb,ub,Yb,yb,Za,Ya=null,Pa=null,rb=null,tb=null)=>{const ob=M.createInstance(y.AFrameworkApplication.K),Oa=y.AFrameworkApplication.buildVersion?y.AFrameworkApplication.buildVersion:"1.0",Xa=Ca(sa,Ea,yb,Oa),ab=ob.Epf?d(1997).RealtimeChannelMetrics.createInstance(Xa):new D;var cb=d(1604).FrequentLoggingMetrics.create(ub);
ob.Cwg&&cb.wFg(ob.Bwg);var ib="";ib=Ya&&""!==Ya?Ya:"/rtc2/";cb.O0c=u.a.rU(ib);const Ub=ib+"signalr";Ya=ib+"findsession";const lb=I.TTf;ib=new ta;rb=rb||U.a.getInstance();m.ULS.shipAssertTag(508396228,500,ob.Fmd<=N.a.ddd,"Client attempting to override max payload size beyond absolute limit");const Qb=Math.min(ob.Fmd,N.a.ddd);cb.cdd=Qb;cb=new ya(ob,new za(ib),sa,Xa,fc=>new H(fc.createHubProxy(lb)),Za,rb,ab,cb,Qb);Pa||(Pa=d(2086).FindSessionStrategy.createInstance(Ea,ub,Ya,Za,Oa,yb,sa,Xa,rb,Yb,nb,tb));
Pa.A8a=ob.A8a;Ea=new A(Xa);Ja=Ja?Ja.split(","):null;sa=new (d(1742).RealtimeChannel)(sa,Ja,Xa,Za,()=>$.hubConnection(Ub),Pa,cb,Ea,rb,ab,ob,ub);sa.init();return sa},Ca=(sa,Ea,Ja)=>String.format("ClientID={0}, App={1}, ClientType={2}, SessionId={3}",sa,xa(ja.a[Ja]),xa("browser"),Ea),xa=sa=>sa?sa.charAt(0).toLocaleUpperCase()+sa.substring(1,sa.length):sa;d.d(J,"RealtimeChannel",function(){return ua});class ua{constructor(sa,Ea,Ja,nb,ub,Yb,yb,Za,Ya,Pa,rb,tb){this.yIb=!1;this.xH=null;this.Py=new w.a;this.Rwa=
1;this.oia=null;this.hm=!1;this.I8b=(new Date(0)).getTime();this.glb=0;this.Dqd=()=>{const ob=this.Rwa;this.yIb=!1;this.Rk.Sjd();this.E9.ONf(this.qrf,this.ofd,Object(f.a)(this.U0,this.U0.hVf,"initThrottlerManager"),Object(f.a)(this,this.twa,"verifyConnectionToken"),ob)};this.ofd=(ob=null)=>{this.Rk.Ujd();let Oa=null;!ob||"documentsessiondeleted"!==(Oa=ob.toLowerCase())&&"documentsessionexpired"!==Oa?this.RJa():(m.ULS.sendTraceTag(508396225,500,15,"In RealtimeChannel method OnFailureToConnect: Disconnect was called for [{0}], due to non-retriable RtcErrorCode:{1}",
this.Bk,ob),this.disconnect())};this.RJa=(ob,Oa=null)=>{m.ULS.sendTraceTag(508396224,500,50,"Disconnecting the connection [{0}]",this.xH);ob=(ob=2===this.jk||1===this.jk)&&!this.U0.rfa;let Xa=!0,ab=0;Oa&&Object.getType(Oa)!==Object.getType(Sys.EventArgs.Empty)&&Oa.AZb&&""!==Oa.AZb&&(ob=!0,this.E9.GAg(Oa.AZb),Xa=Oa.s_b,ab=Oa.reconnectDelay);ob&&this.JN(1,this.jk);++this.Rwa;this.U0.IY();this.OFg(Xa);this.E9.Eyf();this.TXc();ob&&window.setTimeout(this.Dqd,Math.min(ab,3E4))};this.qtd=()=>{let ob=null;
const Oa=({correlationId:ob}=this.E9.d3c()).returnValue;this.oia.qs=Oa;m.ULS.sendTraceTag(40768457,500,50,"Connection parameters refresh finished for client [{0}], CorrelationId:{1}",this.Bk,ob)};this.qrf=ob=>{const {FrequentLoggingMetrics:Oa}=d(1604);this.I8b=(new Date).getTime();let Xa=null;this.oia.qs=({correlationId:Xa}=this.E9.d3c()).returnValue;this.Me.DRh&&(this.oia.url=ob,Oa.instance&&(Oa.instance.zWc=u.a.rU(ob)));let ab=null;this.Vd&&(ab=this.Vd.Vf("WebServiceCall","ConnectToServer"));m.ULS.sendTraceTag(3290048,
500,50,"Connecting to server for client [{0}]",this.Bk);ob={};this.lRc&&(ob.transport=1===this.lRc.length?this.lRc[0]:this.lRc);ob.pingInterval=null;x.a.instance.JNa(1,0);ob.waitForPageLoad=!1;this.oia.start(ob,null).done(cb=>{this.Rk.Vjd();x.a.instance.JNa(1,1,!0);m.ULS.sendTraceTag(508396195,500,50,"Successfully connected to server using connection [{0}], CorrelationId:{1}",cb.id,Xa)}).fail(cb=>{m.ULS.sendTraceTag(3457858,500,15,"Failed to connect to server : connection string: {0}, CorrelationId:{1},  ClientDetails: [{2}]",
this.E9.ew,Xa,this.Bk);this.ofd();this.Rk.Tjd(cb);x.a.instance.JNa(1,1,!1);this.Ce.Djd(0,{["CorrelationId"]:Xa,["ErrorDetails"]:cb,["ConnectionState"]:l.a[this.jk]})}).always(()=>{const {FrequentLoggingMetrics:cb}=d(1604);ab&&ab.stop();cb.instance&&(cb.instance.qDb=!1)})};this.dgd=(ob,Oa)=>{for(const Xa of Oa.jNg)this.Py.mb(Xa.key)||this.Py.Z(Xa.key,new V.a),ob=Xa.value,this.Py.J(Xa.key).Z(Oa.type,new z(ob.Presence,new Date(ob.TimeStamp))),Xa.key===this._clientId&&0===Oa.type&&this.Ce.Ppg(ob.Presence)};
this.cgd=(ob,Oa)=>{for(const Xa of Oa.KLb)this.Py.remove(Xa)};this.GLb=()=>{let ob;const Oa=[];({value:ob}=this.Py.Dc(this._clientId)).returnValue&&this.Py.remove(this._clientId);for(const Xa of this.Py.keys)Array.add(Oa,Xa);for(const Xa of Oa)this.Py.remove(Xa);ob&&this.Py.Z(this._clientId,ob);this.Ce.Npg(Oa)};this._clientId=sa;this.lRc=Ea;this.jk=0;this.Vd=nb;this.eCb=Za;this.B7e=yb;this.EJe=Ya;this.iOe=ub;this.E9=Yb;this.Bk=Ja;this.Rk=Pa;this.Me=rb;this.Af=tb;this.$Pc=1>100*Math.random()}get Vba(){return this.E9.Vba}set Vba(sa){this.E9.Vba=
sa}get U0(){return this.B7e}get Ce(){return this.EJe}init(){this.Ce.Lgf(this.RJa);this.Ce.Xgf(this.dgd);this.Ce.Wgf(this.cgd);this.Af.V5a(this.Rk);y.AFrameworkApplication.aJ(()=>{const {FrequentLoggingMetrics:sa}=d(1604);this.Rk.WYb();sa.instance&&sa.instance.VUb()});this.TXc();this.nUl();this.Ce.Rgf(this.qtd)}nUl(){try{const Ja=$.signalR;if(!Ja)throw Error.invalidOperation("Failed to retrieve Signalr object");const nb=Ja.version;if(!nb)throw Error.invalidOperation("Signalr object is missing version information");
if("2.1.1"===nb){var sa=Ja.transports;if(!sa)throw Error.invalidOperation("Failed to retrieve transports object");var Ea=sa.longPolling;if(!Ea)throw Error.invalidOperation("Failed to retrieve longPolling object");if(!Ea.supportsKeepAlive)throw Error.invalidOperation("LongPolling object does not have a field called supportsKeepAlive");Ea.supportsKeepAlive=this.TJl()}}catch(Ja){m.ULS.sendTraceTag(508396227,500,15,"Failed to disable longPolling KeepAlives: {0}",Ja.message)}}TJl(){return()=>!1}TXc(){const sa=
++this.Rwa;this.I8b=(new Date(0)).getTime();this.oia=this.iOe();this.Ce.Xpg(this.oia);this.oia.stateChanged(Ea=>{this.Oeg(Ea,sa)});this.oia.connectionSlow(Object(f.a)(this,this.joe,"onSlowConnection"));this.oia.error(Object(f.a)(this,this.hoe,"onSignalRError"));this.oia.log=Object(f.a)(this,this.ioe,"onSignalRLog")}twa(sa,Ea){return sa!==this.Rwa?(m.ULS.sendTraceTag(508396226,500,50,"ConnectionToken verification failed for {0}",Ea),!1):!0}connect(){2!==this.jk&&1!==this.jk&&(m.ULS.sendTraceTag(4539721,
500,50,"Starting a new RTC connection for client [{0}]",this.Bk),this.eCb.Neg(),x.a.instance.xFg(),this.JN(1,this.jk),this.Dqd())}disconnect(){const {FrequentLoggingMetrics:sa}=d(1604);0===this.jk?m.ULS.sendTraceTag(508396194,500,50,"Disconnect for [{0}] was called but the channel is already Disconnected",this.Bk):(this.Rk.Wjd(),sa.instance&&(sa.instance.qDb=!0),m.ULS.sendTraceTag(508396193,500,50,"Starting explicit disconnect for [{0}]",this.Bk),this.U0.rfa=!0,this.eCb.Zeg(),this.JN(0,this.jk),this.RJa(),
this.U0.rfa=!1)}OFg(sa){const Ea=this.snf(),Ja=this.oia,nb=this.xH,ub=()=>{if(this.yIb)m.ULS.sendTraceTag(508396191,500,15,"Stop connection was called twice, possibly on the same connection.");else try{this.yIb=!0,Ja.stop(!0,sa)}catch(Yb){m.ULS.sendTraceTag(508396192,500,15,"Stopping connection failed: {0}",Yb.message)}};0<Ea?(m.ULS.sendTraceTag(508396190,500,50,"Waiting to stop connection [{0}]: [{1}] ms.",nb,Ea),window.setTimeout(ub,Ea)):(m.ULS.sendTraceTag(508396189,500,50,"Stopping connection [{0}].",
nb),ub())}snf(){let sa=0;0===this.oia.state&&(sa=this.I8b+ua.Zak-(new Date).getTime(),0>sa&&(sa=0));return sa}get connectionState(){return this.jk}b_(sa){this.Ce.b_(sa)}ZZa(sa){this.Ce.ZZa(sa)}iyg(sa){this.qEa(0,sa)}qEa(sa,Ea){const Ja=new a.a;this.Ce.Fjd(sa,Ea,Ja);return Ja.task}jza(sa){this.Ce.jza(sa)}$Za(sa){this.Ce.$Za(sa)}gmb(sa){this.Ce.gmb(sa)}jxb(sa){this.Ce.jxb(sa)}gKb(sa){this.Ce.gKb(sa)}xZb(sa){this.Ce.xZb(sa)}Alc(sa){return this.KPf(sa,0)}oqb(){return this.nqb(0)}nqb(sa){const Ea={};for(const Ja of this.Py)Ja.value.mb(sa)&&
(Ea[Ja.key]=Ja.value.J(sa).data);return Ea}KPf(sa,Ea){return this.Py.mb(sa)&&this.Py.J(sa).mb(Ea)?this.Py.J(sa).J(Ea).data:null}$Gf(){const sa=new V.a;if(!this.Py.mb(this._clientId))return sa;for(const Ea of this.Py.J(this._clientId))sa.Z(Ea.key,Ea.value.data);return sa}nC(sa,Ea=null,Ja=!1){const nb=new a.a;this.Ce.HYb(sa,Ea,Ja,nb);return nb.task}JO(sa){this.Ce.JO(sa)}ZDa(sa){this.Ce.ZDa(sa)}pWa(sa){let Ea,Ja;return({value:Ea}=this.Py.Dc(sa)).returnValue&&({value:Ja}=Ea.Dc(0)).returnValue?new v.a(this.LPf(Ja),
Ja.timeStamp):null}tjc(){const sa={};for(const Ea of this.Py)Ea.value.Dc(0).returnValue&&(sa[Ea.key]=this.pWa(Ea.key));return sa}s9(sa){const Ea=new a.a;this.Ce.wte(sa,Ea);return Ea.task}get clientId(){return this._clientId}get qEg(){return this.$Pc}dispose(){var sa;const {FrequentLoggingMetrics:Ea}=d(1604);if(!this.hm){if(null===(sa=y.AFrameworkApplication.K)||void 0===sa?0:sa.$("DetachRtcEventHandlerOnDispose"))this.txf(),this.U0.uxf();this.U0.IY();this.Af.pvc(this.Rk);this.Rk.WYb();Ea.instance&&
Ea.instance.VUb();this.hm=!0}}Oeg(sa,Ea){this.twa(Ea,"StateChangedSignalR")&&this.JN(this.cXc(sa.newState),this.cXc(sa.oldState))}JN(sa,Ea){var {FrequentLoggingMetrics:Ja}=d(1604),{ClientToClientMessageTelemetry:nb}=d(1886);if((1!==this.jk||0!==Ea||1!==sa)&&this.jk!==Ea){const ub=String.format.apply(null,["Unexpected connection state change : Current state is '{0}' while the event indicates ('{1}'->'{2}') transition"].concat([this.jk,Ea,sa]));m.ULS.sendTraceTag(508396188,500,10,ub)}if(this.jk!==sa){switch(sa){case 2:Ja.instance&&
Ja.instance.k8f();this.xH=this.oia.id;m.ULS.sendTraceTag(3249539,500,50,"Established connection [{0}] for client [{1}]",this.xH,this.Bk);this.Z6f(this.oia);m.ULS.sendTraceTag(508396186,500,50,"Retrieving complete session state");Ja=null;this.Vd&&(Ja=this.Vd.Vf("WebServiceCall","Receive First Presence"));nb=this.Rwa;this.Ce.Wpg(Object(f.a)(this,this.twa,"verifyConnectionToken"),nb,this.eCb,this.GLb,this.$Gf(),Ja);this.Me.ywg&&(Ja=100*Math.random()<=this.Me.zwg,d(1886).ClientToClientMessageTelemetry.Xqb(this.Ce,
this.Me,Ja).start());break;case 1:2===Ea&&m.ULS.sendTraceTag(508396185,500,50,"Lost connection [{0}] to the server ...trying to re-establish it",this.xH);break;case 0:if(nb.instance&&nb.instance.stop(),this.U0.rfa)m.ULS.sendTraceTag(508396182,500,50,"Connection [{0}] has been explicitly closed",this.xH);else{1===Ea&&(m.ULS.sendTraceTag(508396184,500,50,"Signalr detected an unexpected disconnect event while attempting to re-establish connection [{0}]. Kicking off global reconnect logic ...",this.xH),
this.Rk.Xjd());2===Ea&&m.ULS.sendTraceTag(508396183,500,50,"Signalr detected a disconnect event triggered by a period of client inactivity for connection [{0}]. Kicking off global reconnect logic ...",this.xH);this.RJa();return}}this.jk=sa;this.Ce.Gpg(sa,Ea)}}txf(){this.Ce.mtg(this.RJa);this.Ce.vtg(this.dgd);this.Ce.utg(this.cgd);this.Ce.stg(this.qtd)}Z6f(sa){if(sa&&sa.transport&&sa.transport.name){sa=sa.transport.name;var Ea=sa.toLowerCase();"websockets"===Ea?m.ULS.sendTraceTag(4290723,500,50,"Transport name - {0} for [{1}]",
sa,this.Bk):"serversentevents"===Ea?m.ULS.sendTraceTag(4290752,500,50,"Transport name - {0} for [{1}]",sa,this.Bk):"foreverframe"===Ea?m.ULS.sendTraceTag(4290753,500,50,"Transport name - {0} for [{1}]",sa,this.Bk):"longpolling"===Ea?m.ULS.sendTraceTag(4290754,500,50,"Transport name - {0} for [{1}]",sa,this.Bk):"mocktransport"!==Ea&&m.ULS.sendTraceTag(508396180,500,15,"Unknown transport protocol encountered - '{0}'",sa)}else m.ULS.sendTraceTag(508396181,500,10,"Transport protocol name is missing")}joe(){if(this.Me.Emd){const sa=
u.a.HL(this.Vba,"mid");m.ULS.sendTraceTag(508396178,500,15,"Detected that the connection [{0}] is slow for target machine [{1}]",this.xH,sa)}else m.ULS.sendTraceTag(508396177,500,50,"Detected that the connection [{0}] is slow",this.xH)}hoe(){m.ULS.sendTraceTag(508396176,600,15,"SignalR ERROR for connection [{0}];",this.xH)}ioe(sa){sa=d(1576).RtcUtils.Bma(sa);if(this.Me.Emd&&sa.startsWith("Keep alive timed out.")){const Ea=u.a.HL(this.Vba,"mid");m.ULS.sendTraceTag(508396175,500,15,"SignalR lib: {0}. Target Machine: {1}",
sa,Ea)}else this.qEg&&2E3>this.glb&&!sa.startsWith("Invok")&&!sa.startsWith("Trigger")&&(m.ULS.sendTraceTag(508396174,500,50,"SignalR lib: {0}",sa),this.glb++)}cXc(sa){switch(sa){case 0:return 1;case 2:return 1;case 1:return 2;case 4:return 0;default:throw Error.argumentOutOfRange("state",sa,"Unknown SignalR state");}}LPf(sa){return sa&&sa.timeStamp?(new Date).getTime()-sa.timeStamp.getTime()>(this.Me.vkf?6E4:this.Me.ukf)?2:1:1}static createInstance(sa,Ea,Ja,nb,ub,Yb,yb,Za=null,Ya=null,Pa=null,rb=
null,tb=null,ob=null){return fa(sa,Ea,Ja,ob,nb,ub,Yb,yb,Za,Ya,Pa,tb,rb)}}ua.Zak=15E3;Object(G.a)(ua,"RealtimeChannel",null,[1436,1437])},1755:function(G,J,d){G=d(0);class m{constructor(){this.kEc=this.aCb=!1;this.callback=null}zvb(a){this.callback=a;this.Fsd()}Rcd(a){this.aCb||(this.aCb=!0,this.cOe=a,this.Fsd())}Fsd(){this.aCb&&this.callback&&!this.kEc&&(this.kEc=!0,this.callback(this.cOe))}}Object(G.a)(m,"CompletionTask",null,[]);d.d(J,"a",function(){return f});class f{constructor(){this.ILc=new m;
this.GLc=new m}hcb(a){this.ILc.zvb(a)}gcb(a){this.GLc.zvb(a)}uMa(a){this.ILc.Rcd(a)}b8(a){this.GLc.Rcd(a)}nVb(){this.uMa(2);this.b8(2)}}Object(G.a)(f,"MessageStatus",null,[1475])},1813:function(G,J,d){d.d(J,"a",function(){return m});G=d(0);class m extends Sys.EventArgs{constructor(f,a,l,w){super();this.type=f;this.nA=a;this.axf=l;this.$na=w}}Object(G.a)(m,"SendUpdateNotificationEventArgs",Sys.EventArgs,[])},1814:function(G,J,d){d.r(J);d.d(J,"MaxOutstandingThrottler",function(){return a});G=d(0);var m=
d(89);J=d(1815);var f=d(1755);class a extends J.a{constructor(l,w=""){super(l,w);this.uua=this.k9=0;this.sa=new m.a;this.Gpa=!1;this.$1a=this.S1a=this.TIb=0;this.tyg=()=>{this.Gpa=!1;if(this.Mta){const y=this.u5a,v=this.Dqa;this.UIa(!1);this.iOa(y,v)}};this.igg=()=>{++this.$1a;this.$1a>Math.floor(this.uua/2)&&(this.$1a=-1E9,this.sa.raiseEvent("TMUDM"))};this.R3a=0;this.LQ=[];this.clearTimeout=a.hNb}add(l){this.Hpa||this.init(a.LYc,a.JYc);this.vea++;const w=new f.a;this.Mta?this.neb(l,w):this.R3a<
this.uua?this.iOa(l,w):(this.neb(l,w),this.Gpa=!1);return w}iOa(l,w){l=this.APc(l);const y=this.setTimeout(this.igg,this.k9);++this.R3a;Array.add(this.LQ,y);const v=this.S1a;l.hcb(u=>{w.uMa(u)});l.gcb(u=>{this.S1a===v&&(this.hgg(v,y),w.b8(u))})}hgg(l,w){this.S1a===l&&(--this.R3a,this.clearTimeout(w),Array.remove(this.LQ,w),this.Mta&&this.syg())}syg(){this.Mta&&!this.Gpa&&(this.TIb=this.setTimeout(this.tyg,0),this.Gpa=!0)}b6a(l){this.sa.addHandler("TMUDM",l)}reset(){this.vea=this.NHa=this.mGa=this.$1a=
0;++this.S1a;for(const l of this.LQ)this.clearTimeout(l);this.R3a=0;this.LQ=[];this.UIa(!0);this.Gpa&&(this.clearTimeout(this.TIb),this.TIb=0,this.Gpa=!1)}init(l,w){this.Hpa||(this.k9=l,this.uua=w,this.Hpa=!0)}static createInstance(l,w=""){return new a(l,w)}static hNb(l){window.clearTimeout(l)}}a.LYc=15E3;a.JYc=5;Object(G.a)(a,"MaxOutstandingThrottler",J.a,[1471,1472])},1815:function(G,J,d){d.d(J,"a",function(){return f});G=d(0);var m=d(7);class f{constructor(a,l=""){this.mGa=this.NHa=0;this.GEb=
!1;this.Dqa=this.u5a=null;this.Hpa=!1;this.APc=a;this.Ord=l;this.setTimeout=f.jNb;this.vea=this.NHa=this.mGa=0}VYb(){0<this.vea&&0<this.mGa&&m.ULS.sendTraceTag(36545635,500,50,"Throttler [{0}] dropped [{1}] messages out of [{2}]",this.Ord,this.mGa,this.vea);0<this.vea&&0<this.NHa&&m.ULS.sendTraceTag(36545634,500,50,"Throttler [{0}] throttled [{1}] messages out of [{2}]",this.Ord,this.NHa,this.vea)}get Mta(){return this.GEb}neb(a,l){this.NHa++;this.UIa(!0);this.GEb=!0;this.u5a=a;this.Dqa=l}UIa(a){this.GEb=
!1;this.Dqa&&a&&(this.mGa++,this.Dqa.nVb());this.Dqa=this.u5a=null}static jNb(a,l){return window.setTimeout(a,l)}}Object(G.a)(f,"ThrottlerBase",null,[])},1816:function(G,J,d){d.r(J);d.d(J,"MaxRateThrottler",function(){return f});G=d(0);J=d(1815);var m=d(1755);class f extends J.a{constructor(a,l=""){super(a,l);this.zua=0;this.ryg=()=>{if(this.Mta){const w=this.u5a,y=this.Dqa;this.UIa(!1);this.iOa(w,y)}};this.RGa=(new Date(0)).getTime();this.currentTime=()=>(new Date).getTime()}init(a){this.Hpa||(this.zua=
a,this.Hpa=!0)}add(a){this.Hpa||this.init(f.GYc);this.vea++;const l=this.currentTime(),w=new m.a;this.RGa>l&&(this.RGa=l);this.Mta?(this.UIa(!0),this.neb(a,w)):this.RGa+this.zua<=l?this.iOa(a,w):(this.neb(a,w),this.setTimeout(this.ryg,this.RGa+this.zua-l));return w}iOa(a,l){this.RGa=this.currentTime();a=this.APc(a);a.hcb(w=>{l.uMa(w)});a.gcb(w=>{l.b8(w)})}static createInstance(a,l=""){return new f(a,l)}}f.GYc=200;Object(G.a)(f,"MaxRateThrottler",J.a,[1473,1472])},1817:function(G,J,d){d.d(J,"a",function(){return m});
G=d(0);class m{constructor(){this.Presence=null;this.TimeStamp=0}}Object(G.a)(m,"PresenceDataEntryForClients",null,[])},1818:function(G,J,d){d.d(J,"a",function(){return m});G=d(0);class m{}m.b_b="rr";m.Awg="rd";m.xwg="rbp";m.s_b="sa";Object(G.a)(m,"RtcReconnectParams",null,[])},1819:function(G,J,d){d.d(J,"a",function(){return m});G=d(0);class m{constructor(f,a,l,w){this.e9f=f;this.k9=a;this.y8f=l;this.kQf=w}}Object(G.a)(m,"ThrottlerManagerSettings",null,[])},1874:function(G,J,d){G=d(0);var m=d(1990),
f=d(1995),a=d(1991),l=d(1994),w=d(1993),y=d(1989),v=d(1992);class u extends Sys.EventArgs{constructor(){super()}}Object(G.a)(u,"GotCompletePersistentStateWithMetadataEventArgs",Sys.EventArgs,[]);class x extends Sys.EventArgs{constructor(O,V,Y,Q,S,P){super();this.twa=O;this.DUa=V;this.trf=Y;this.b0c=S;this.GLb=Q;this.vz=P}}Object(G.a)(x,"RefreshAllPersistentStateEventArgs",Sys.EventArgs,[]);class z extends Sys.EventArgs{constructor(O){super();this.hubConnection=O}}Object(G.a)(z,"RefreshProxyEventArgs",
Sys.EventArgs,[]);class A extends Sys.EventArgs{constructor(O,V){super();this.tfa=O;this.errorMessage=V}}Object(G.a)(A,"RtcConnectFailedEventArgs",Sys.EventArgs,[]);class D extends Sys.EventArgs{constructor(O,V,Y){super();this.type=O;this.MI=V;this.$na=Y}}Object(G.a)(D,"SendPersistentStateEventArgs",Sys.EventArgs,[]);var F=d(1813);class I extends Sys.EventArgs{constructor(){super()}}Object(G.a)(I,"SessionPropertiesChangedEventArgs",Sys.EventArgs,[]);class H extends Sys.EventArgs{constructor(O){super();
this.KLb=O}}Object(G.a)(H,"UpdatePersistentStateClearedRequestEventArgs",Sys.EventArgs,[]);class N extends Sys.EventArgs{constructor(O,V){super();this.type=O;this.jNg=V}}Object(G.a)(N,"UpdatePersistentStateRequestEventArgs",Sys.EventArgs,[]);var M=d(89);d.d(J,"a",function(){return U});class U{constructor(){this.sa=new M.a}Gpg(O,V){this.sa.raiseEvent("CSC",new m.a(O,V))}Xpg(O){this.sa.raiseEvent("RP",new z(O))}bdb(O){this.sa.raiseEvent("RC",O)}Ypg(){this.sa.raiseEvent("RMID")}Wpg(O,V,Y,Q,S,P){this.sa.raiseEvent("RPS",
new x(O,V,Y,Q,S,P))}Hjd(O,V){this.sa.raiseEvent("UPSR",new N(O,V))}Bjd(O,V){this.sa.raiseEvent("PU",new y.a(O,V))}Ppg(O){this.sa.raiseEvent("MPU",new a.a(O))}HYb(O,V,Y,Q){this.sa.raiseEvent("SUN",new F.a(O,V,Y,Q))}$pg(O,V){this.sa.raiseEvent("UNR",new v.a(O,V))}Fjd(O,V,Y){this.sa.raiseEvent("SP",new D(O,V,Y))}ute(O,V){this.sa.raiseEvent("PSU",new w.a(O,V))}Tpg(O){this.sa.raiseEvent("PSC",new l.a(O))}Npg(O){this.sa.raiseEvent("IPSC",new l.a(O))}aqg(O){this.sa.raiseEvent("UPSC",new H(O))}Zpg(O,V){this.sa.raiseEvent("SPC",
new I(O,V))}Djd(O,V){this.sa.raiseEvent("RCF",new A(O,V))}Lpg(O){this.sa.raiseEvent("CPSWM",new u(O))}wte(O,V){this.sa.raiseEvent("UCI",new f.a(O,V))}b_(O){this.sa.addHandler("CSC",O)}ZZa(O){this.sa.removeHandler("CSC",O)}Mgf(O){this.sa.addHandler("RP",O)}ntg(O){this.sa.removeHandler("RP",O)}Lgf(O){this.sa.addHandler("RC",O)}mtg(O){this.sa.removeHandler("RC",O)}Ngf(O){this.sa.addHandler("RMID",O)}Kgf(O){this.sa.addHandler("RPS",O)}ltg(O){this.sa.removeHandler("RPS",O)}Xgf(O){this.sa.addHandler("UPSR",
O)}vtg(O){this.sa.removeHandler("UPSR",O)}jza(O){this.sa.addHandler("PU",O)}$Za(O){this.sa.removeHandler("PU",O)}ogf(O){this.sa.addHandler("IPU",O)}atg(O){this.sa.removeHandler("IPU",O)}Vgf(O){this.sa.addHandler("UCI",O)}ttg(O){this.sa.removeHandler("UCI",O)}Qgf(O){this.sa.addHandler("SUN",O)}rtg(O){this.sa.removeHandler("SUN",O)}pgf(O){this.sa.addHandler("IUNR",O)}btg(O){this.sa.removeHandler("IUNR",O)}JO(O){this.sa.addHandler("UNR",O)}ZDa(O){this.sa.removeHandler("UNR",O)}gmb(O){this.sa.addHandler("PSU",
O)}jxb(O){this.sa.removeHandler("PSU",O)}ngf(O){this.sa.addHandler("IPSU",O)}$sg(O){this.sa.removeHandler("IPSU",O)}gKb(O){this.sa.addHandler("PSC",O)}xZb(O){this.sa.removeHandler("PSC",O)}mgf(O){this.sa.addHandler("IPSC",O)}Zsg(O){this.sa.removeHandler("IPSC",O)}Wgf(O){this.sa.addHandler("UPSC",O)}utg(O){this.sa.removeHandler("UPSC",O)}Pgf(O){this.sa.addHandler("SP",O)}qtg(O){this.sa.removeHandler("SP",O)}Rgf(O){this.sa.addHandler("SPC",O)}stg(O){this.sa.removeHandler("SPC",O)}static getInstance(){return U._instance||
(U._instance=new U)}}U._instance=null;Object(G.a)(U,"RtcEventHub",null,[1463])},1886:function(G,J,d){d.r(J);G=d(0);var m=d(7),f=d(356),a=d(54),l=d(77);class w{constructor(v){this.messageId=v;this.uyg=(new Date).getTime();this.nUb=new l.a}}Object(G.a)(w,"MessageLatencyDetails",null,[]);d.d(J,"ClientToClientMessageTelemetry",function(){return y});class y{constructor(v,u,x){this.mT=null;this.EFb=this.ZHb=0;this.sendMessage=()=>{if(this.FHa){const z=a.a.create().toString();this.mT=new w(z);this.Ce.HYb(16,
z,!1,new f.a);window.setTimeout(()=>{this.G6f(z)},this.EFb)}};this.tqg=(z,A)=>{16===A.type?this.Ce.HYb(17,A.nA,!1,new f.a):17===A.type&&this.FHa&&A.nA&&this.processMessage(A.nA)};this.Me=u;this.JLc=x;this.FHa=!1;this.Ce=v;this.Ce.JO(this.tqg)}start(){if(this.JLc&&!this.FHa){const v=this.Me.Hmd;this.EFb=this.Me.Dmd;v<=this.EFb?(m.ULS.sendTraceTag(570975114,500,15,"LogMetrics cannot be started because configuration values are incorrect. RtcSendTelemetryMessageIntervalInMS({0}) should be greater than RtcLogClientMessageMetricsTimeOutInMs({1})",
this.Me.Hmd,this.Me.Dmd),this.JLc=!1):(this.FHa=!0,this.ZHb=window.setInterval(this.sendMessage,v))}}G6f(v){this.mT&&this.mT.messageId===v&&(0<this.mT.nUb.count?(v=this.mT.nUb.toArray().join(","),m.ULS.sendTraceTag(571339719,500,15,"ClientMessageLatencies:[{0}]",v)):m.ULS.sendTraceTag(562312150,500,50,"No client message latencies recorded"),this.mT=null)}stop(){this.ZHb&&(window.clearInterval(this.ZHb),this.FHa=!1)}processMessage(v){v&&this.mT&&v.toString()===this.mT.messageId&&(v=(new Date).getTime()-
this.mT.uyg,this.mT.nUb.add(v))}static get instance(){return y._instance}static Xqb(v,u,x){return y.instance||(y._instance=new y(v,u,x))}}y._instance=null;Object(G.a)(y,"ClientToClientMessageTelemetry",null,[])},1989:function(G,J,d){d.d(J,"a",function(){return m});G=d(0);class m extends Sys.EventArgs{constructor(f,a){super();this.$ha=f;this.qZc=a}}Object(G.a)(m,"PresenceUpdatedEventArgs",Sys.EventArgs,[])},1990:function(G,J,d){d.d(J,"a",function(){return m});G=d(0);class m extends Sys.EventArgs{constructor(f,
a){super();this.newState=f;this.oldState=a}}Object(G.a)(m,"ChangedConnectionStateEventArgs",Sys.EventArgs,[])},1991:function(G,J,d){d.d(J,"a",function(){return m});G=d(0);class m extends Sys.EventArgs{constructor(f){super();this.MI=f}}Object(G.a)(m,"MyPresenceUpdatedEventArgs",Sys.EventArgs,[])},1992:function(G,J,d){d.d(J,"a",function(){return m});G=d(0);class m extends Sys.EventArgs{constructor(f,a=null){super();this.Kk=f;this.HRk=a}get type(){return this.Kk}get nA(){return this.HRk}}Object(G.a)(m,
"UpdateNotificationEventArgs",Sys.EventArgs,[])},1993:function(G,J,d){d.d(J,"a",function(){return m});G=d(0);class m extends Sys.EventArgs{constructor(f,a){super();this.type=f;this.$ha=a}}Object(G.a)(m,"PersistentStateUpdateEventArgs",Sys.EventArgs,[])},1994:function(G,J,d){d.d(J,"a",function(){return m});G=d(0);class m extends Sys.EventArgs{constructor(f){super();this.KLb=f}}Object(G.a)(m,"PersistentStateClearedEventArgs",Sys.EventArgs,[])},1995:function(G,J,d){d.d(J,"a",function(){return m});G=
d(0);class m extends Sys.EventArgs{constructor(f,a){super();this.D3h=f;this.$na=a}}Object(G.a)(m,"ClientInfoEventArgs",Sys.EventArgs,[])},1996:function(G,J,d){d.d(J,"a",function(){return m});G=d(0);class m{constructor(f,a){this.status=f;this.sqc=a}}Object(G.a)(m,"UserStatusInfo",null,[])},1997:function(G,J,d){d.r(J);d.d(J,"RealtimeChannelMetrics",function(){return w});G=d(0);var m=d(7),f=d(194),a=d(90),l=d(1576);class w{constructor(){this.tMc=this.uMc=this.vMc=this.qMc=this.pMc=this.rMc=this.cHa=
this.eGb=0;this.Hda=this.mFb=this.SGa=this.gFb=this.Kpa=this.dFb=this.X5=this.PGa=this.Jpa=this.cFb=this.M2a=this.npa=null;this.IFb=this.UGa=this.FPc=this.FEc=0;this.MLc=!1;this.Sjd=this.MYb;this.Vjd=this.PYb;this.Ujd=this.OYb;this.Xjd=this.RYb;this.Wjd=this.QYb;this.WYb=this.XYb;this.gdb=this.UYb;this.aha=this.SYb;this.gva=this.TYb;this.Tjd=this.NYb;this.$Ca=this.QVb;this.GYa=this.RVb}MYb(){this.eGb++;this.cFb=new Date;this.npa||(this.npa=new Date)}PYb(){this.cHa++;this.X5=new Date;this.M2a||(this.M2a=
this.X5);this.SGa=this.X5;this.grf()}OYb(){this.rMc++;this.dFb=new Date}RYb(){this.pMc++;this.Jpa=new Date}QYb(){this.qMc++;this.PGa=new Date}UYb(){this.Kpa=new Date;this.vMc++}TYb(){this.Hda||(this.Hda=new Date);this.uMc++}SYb(){this.gFb=new Date;this.tMc++}XYb(){!this.MLc&&this.eGb&&(m.ULS.sendTraceTag(39321871,500,15,a.a.toJSON(this.jqf())),this.MLc=!0)}NYb(y){const {L6c:v,M6c:u,vk:x}=l.RtcUtils.SCf(y);v&&v!==f.a.zz&&(m.ULS.sendTraceTag(40157596,500,15,a.a.toJSON({["HttpErrorCode"]:v,["HttpErrorStatus"]:u,
["Exception"]:x})),f.a.Cde(v)&&this.FEc++,f.a.lge(v)&&this.FPc++)}QVb(){this.mFb=new Date}RVb(){this.Jpa=this.SGa=new Date}jqf(){return{["numberOfConnectionAttempts"]:this.eGb,["numberOfSuccessfulConnections"]:this.cHa,["numberOfFailedConnections"]:this.rMc,["numberOfDisconnectedConnections"]:this.pMc,["numberOfExplicitDisconnectedConnections"]:this.qMc,["numberOfSentMessages"]:this.vMc,["numberOfReceivedMessages"]:this.uMc,["numberOfLostMessages"]:this.tMc,["firstConnectionAttempt"]:this.npa?this.npa:
null,["firstMessageReceived"]:this.Hda?this.Hda:null,["firstConnectionSuccess"]:this.M2a?this.M2a:null,["lastConnectionAttempt"]:this.cFb?this.cFb:null,["lastConnectionSuccess"]:this.X5?this.X5:null,["lastConnectionFailure"]:this.dFb?this.dFb:null,["lastMessageSent"]:this.Kpa?this.Kpa:null,["lastMessageLost"]:this.gFb?this.gFb:null,["lastDisconnect"]:this.Jpa?this.Jpa:null,["lastExplicitDisconnect"]:this.PGa?this.PGa:null,["lastTimeOnline"]:this.SGa?this.SGa:null,["lastTimeOffline"]:this.mFb?this.mFb:
null,["maxDisconnectedTimeMs"]:this.UGa,["maxExplicitDisconnectedTimeMs"]:this.IFb,["clientConnectionErrors"]:this.FEc,["serverConnectionErrors"]:this.FPc}}grf(){this.npa&&1===this.cHa&&(this.UGa=Math.max(this.UGa,this.X5.getTime()-this.npa.getTime()));this.Jpa&&1<this.cHa&&(this.UGa=Math.max(this.UGa,this.X5.getTime()-this.Jpa.getTime()));this.PGa&&1<this.cHa&&(this.IFb=Math.max(this.IFb,this.X5.getTime()-this.PGa.getTime()))}static createInstance(y){w._instance||(w._instance=new w,m.ULS.sendTraceTag(39321870,
500,50,"RealtimeChannelMetrics initialized for client {0}",y));return w._instance}}w._instance=null;Object(G.a)(w,"RealtimeChannelMetrics",null,[1460,300])},1998:function(G,J,d){d.d(J,"a",function(){return m});G=d(0);var m;(function(f){f[f.O7h=0]="contentUpdate";f[f.MYp=1]="editorsTableUpdate";f[f.xOb=2]="fileNameUpdate";f[f.wFp=3]="wetContentUpdate";f[f.Mfq=4]="persistedContentUpdate";f[f.Isl=5]="clientRtcReconnectRequest";f[f.Lhq=6]="replicationTelemetry";f[f.K6p=7]="lockUpdate";f[f.BVp=8]="collabServiceContentUpdate";
f[f.Ynq=9]="trackChangeSettingUpdate";f[f.ajq=10]="saveTargetUpdate";f[f.cpq=11]="uploadToOcsUpdate";f[f.M5p=12]="labelUpdate";f[f.o1m=13]="hostNotificationSubscriptionStatus";f[f.qmq=14]="subscribeOrExtend";f[f.RYp=15]="elapsedBootTelemetry";f[f.I3h=16]="clientToClientTelemetryMessage";f[f.H3h=17]="clientToClientResponseMessage";f[f.tpq=18]="verifyNotificationPipeline";f[f.j3p=19]="hostNotificationHeartbeat";f[f.Ajq=20]="secondaryMetadataUpdate";f[f.last=21]="last"})(m||(m={}));Object(G.b)("UpdateNotificationType",
m)},1999:function(G,J,d){d.d(J,"a",function(){return m});G=d(0);var m;(function(f){f[f.unspecified=0]="unspecified";f[f.word=1]="word";f[f.ami=2]="excel";f[f.Vlg=3]="powerPoint";f[f.test=4]="test";f[f.wacFrontEnd=5]="wacFrontEnd";f[f.$hg=6]="oneNote";f[f.EEp=7]="visio";f[f.Hdq=8]="officeMobile";f[f.BWp=9]="cosmosDBChangefeed";f[f.last=10]="last"})(m||(m={}));Object(G.b)("RtcClientAppName",m)},2086:function(G,J,d){d.r(J);G=d(0);var m=d(7),f=d(104),a=d(77),l=d(951);class w{}w.zua="throttling_messageDelay";
w.ZLa="enabled";w.k9="throttling_timeToWaitForResponse";w.uua="throttling_maxNumberOfOutstandingMessages";w.g5c="throttling_globalMaxNumberOfOutstandingMessages";w.errorMessage="errorMessage";w.dqd="url";w.OP="queryString";w.ew="connectionString";w.Owc="netcore";Object(G.a)(w,"RtcFindSessionOutputFieldNameConstants",null,[]);var y=d(2),v=d(49),u=d(41),x=d(1429),z=d(90),A=d(19),D=d(123);class F{constructor(){this.h5c=this.$cd=this.bdd=this.edd=0;this.Dab=!1;this.correlationId=this.ew=this.OP=this.ZLb=
this.errorMessage=null}get Zqf(){return this.ZLb+"?"+this.OP}}Object(G.a)(F,"FindSessionResponse",null,[]);var I=d(635);class H{constructor(Z,X,aa,ia,wa,ma){this.c6=null;this.M5e=Z;Z=String.format("{0}={1}",I.a.clientId,A.a.ej(ia));Z=String.format("{0}&{1}={2}",Z,I.a.userSessionId,A.a.ej(wa));Z=String.format("{0}&{1}={2}",Z,I.a.TFe,A.a.ej(aa.toString()));Z=String.format("{0}&{1}={2}",Z,I.a.userType,A.a.ej("1"));Z=String.format("{0}&{1}={2}",Z,I.a.ZFe,A.a.ej(X));Z=String.format("{0}&{1}={2}",Z,I.a.nWd,
A.a.ej(H.Esl));(X=H.e2c(aa,ma))&&(Z=String.format("{0}&{1}",Z,X));this.jOe=Z}fkd(){this.c6=this.M5e()}generate(){this.c6&&""!==this.c6||(this.fkd(),m.ULS.sendTraceTag(575784194,500,this.c6&&""!==this.c6?50:15,"Query signature delegate called for refresh returned: {0} ",this.c6));const Z=String.format("{0}={1}",I.a.$cb,A.a.ej(this.c6));return String.format("{0}&{1}",Z,this.jOe)}static e2c(Z,X){return 4===Z?String.format("{0}={1}",I.a.zle,"1"):X?X.MPf():null}}H.Esl="1.0";Object(G.a)(H,"FindSessionQueryStringGenerator",
null,[]);var N=d(1604),M=d(1706),U=d(1576),O=d(1819);class V{}V.dEf="FSType";Object(G.a)(V,"RtcFindSessionRequestHeaders",null,[]);class Y{}Y.lqg="polling";Object(G.a)(Y,"RtcFindSessionTypes",null,[]);var Q=d(1818);class S{}S.fOg="RTC-TokenProofkey";S.d2f="RTC-IsWacJsBootFsRequest";Object(G.a)(S,"RtcRequestHeaders",null,[]);var P=d(72);d.d(J,"FindSessionStrategy",function(){return T});class T{constructor(Z,X,aa,ia,wa,ma,na,Fa,Qa,ya,ta,Aa,oa=null){this.uKc=(new Date(0)).getTime();this.oLc=0;this.F3a=
!1;this.GPc=null;this.eZb=36E5;this.Woa=T.F7c;this.tGa=0;this.lha=null;this.kV=0;this.wva=this.AWc=null;this.S6e=[w.ZLa,w.errorMessage,w.dqd,w.ew,w.OP,w.g5c,w.uua,w.k9,w.zua];this.R6e=[w.ZLa,w.errorMessage];this.ew=this.Vba=null;this.FHc=new H(ta?ta:()=>y.AFrameworkApplication.jm,wa,ma,na,Z,X);this.QFa=Aa;this.Vd=ia;this.Af=X;this.GHc=aa;this.Bk=Fa;this.Ce=Qa;this.rxa=oa;this.HHc=!1;this.A8a=9E4;ya&&ya.execute(za=>{za.OTa(()=>{m.ULS.sendTraceTag(40768456,500,50,"Connection parameters refresh requested for client [{0}]",
this.Bk);this.FHc.fkd()})});2>=100*Math.random()&&(this.eZb=3E5);N.FrequentLoggingMetrics.instance&&(N.FrequentLoggingMetrics.instance.B1c=this.eZb)}GAg(Z){this.wva=Z}init(){this.Ce.Ngf(Object(f.a)(this,this.Yug,"resetGetMachineIdDelay"));this.Ce.b_(Object(f.a)(this,this.JN,"onConnectionStateChanged"))}JN(Z,X){this.kV=X.newState;2===X.newState&&(this.tGa=0)}d3c(){let Z;Z=this.lha.correlationId;return{returnValue:String.format("{0}&{1}={2}",this.lha.OP,T.rYd,A.a.ej(Z)),correlationId:Z}}ONf(Z,X,aa,
ia,wa){this.$xg(()=>{ia(wa,"GetMachineIdSuccess")&&(m.ULS.sendTraceTag(17956951,500,50,"Successfully retrieved Rtc MachineId [{0}] for [{1}]",this.ew,this.Bk),Z(this.GPc),aa(this.iPf()))},ma=>{ia(wa,"GetMachineIdFailure")&&(m.ULS.sendTraceTag(4060129,500,15,"Failed to retrieve Rtc MachineId for [{0}]",this.Bk),X(ma))},ia,wa)}Eyf(){this.FVc();this.PUf()}$xg(Z,X,aa,ia){m.ULS.sendTraceTag(17956952,500,50,"Retrieving Rtc MachineId from server. Getting from last findsession, connectionString is [{0}]",
this.ew);if(this.ew)Z();else{var wa=this.jnf();window.setTimeout(()=>{this.sendFindSessionRequestToServerInternal(Z,X,aa,ia)},wa)}}sendFindSessionRequestToServerInternal(Z,X,aa,ia){aa(ia,"RequestMachineId")&&(this.uKc=(new Date).getTime(),aa=u.a.Ee(),this.IPb(wa=>{const ma=u.a.Ee();this.ahd(wa);this.O_b();Z();wa=u.a.Ee()-ma;m.ULS.sendTraceTag(577356039,345,50,"SFSRTS Success - TimeElapsed: {0}",wa)},wa=>{const ma=u.a.Ee();this.FVc();N.FrequentLoggingMetrics.instance&&N.FrequentLoggingMetrics.instance.Zs(2,
3);X(wa);wa=u.a.Ee()-ma;m.ULS.sendTraceTag(577356040,345,50,"SFSRTS Failure - TimeElapsed: {0}",wa)},!1),aa=u.a.Ee()-aa,m.ULS.sendTraceTag(577599296,345,50,"SFSRTS - TimeElapsed: {0}",aa))}PUf(){this.Woa+=T.KLf;this.Woa=Math.min(this.Woa,T.v8f)}jnf(){var Z=(new Date).getTime();Z=this.uKc+this.Woa-Z;0>Z&&(Z=0);return Z}ahd(Z){try{this.lha=Z,this.Vba=Z.Zqf,this.ew=Z.ew,this.AWc=Z.OP,this.GPc=Z.ZLb}catch(X){m.ULS.sendTraceTag(17956953,500,10,"FindSession response contains invalid fields. Exception {0}, is thrown",
X.toString())}}FVc(){this.ew=null;this.GVc()}O_b(){this.GVc();this.F3a=!0;this.oLc=window.setTimeout(Object(f.a)(this,this.Xqg,"refreshMachineId"),this.eZb)}GVc(){this.F3a&&(window.clearTimeout(this.oLc),this.F3a=!1)}Xqg(){this.F3a=!1;this.IPb(Z=>{const X=this.AWc!==Z.OP,aa=this.ew!==Z.ew,ia=this.ew;this.ahd(Z);0!==this.kV&&(aa?(m.ULS.sendTraceTag(17956955,500,15,"Recycling RTC connection due to RTC machine id change. old={0}, new={1}",ia||"null",Z.ew),this.Ce.bdb()):(this.Ce.Zpg(X,aa),this.O_b()))},
()=>{N.FrequentLoggingMetrics.instance&&N.FrequentLoggingMetrics.instance.Zs(2,3);this.O_b()},!0)}Yug(){this.Woa=T.F7c}iPf(){return new O.a(this.lha.edd,this.lha.bdd,this.lha.$cd,this.lha.h5c)}hKg(Z){if(Object.getType(Z)!==Object)return null;for(let X in Z);return this.ytf(Z)}ytf(Z){if(!(w.ZLa in Z))return null;const X=Z[w.ZLa];var aa=X?this.S6e:this.R6e;for(const ia of aa)if(!(ia in Z))return null;aa=Object.assign(new F,{Dab:Z[w.ZLa],errorMessage:Z[w.errorMessage],correlationId:D.a.create().toString()});
X&&(aa.ZLb=Z[w.dqd],aa.OP=Z[w.OP],aa.ew=Z[w.ew],aa.h5c=Z[w.g5c],aa.$cd=Z[w.uua],aa.bdd=Z[w.k9],aa.edd=Z[w.zua]);return aa}YJf(Z,X){m.ULS.sendTraceTag(50448152,500,50,"Using FindSessionUtils find session response");this.rxa.H3d.continueWith(()=>{this.rxa.H3d.result?(m.ULS.sendTraceTag(50448153,500,50,"FindSessionUtils find Session resulted in success"),Z(this.rxa.I3d)):(m.ULS.sendTraceTag(50448154,500,15,"FindSessionUtils find Session resulted in error"),X(this.rxa.I3d))})}Jld(Z,X,aa,ia,wa=!1){return ma=>
{M.a.instance.JNa(0,1);Z&&Z.stop();this.QFa=this.wva=null;this.scd(ma.data,!0,X);var na=U.RtcUtils.deserialize(ma.data.De,"FindSession",null);if(na)if(na=this.hKg(na)){if(na.Dab&&na.OP&&na.ew){m.ULS.sendTraceTag(4317446,500,50,"Successfully retrieved MachineId from server for [{0}]",this.Bk);this.m6f(ma.data);aa(na);return}X.FindSessionFailureReason="FindSessionInvalidResponse";X.IsRtcEnabled=na.Dab;X.IsQueryStringEmpty=!na.OP;X.IsConnectionStringEmpty=!na.ew;m.ULS.sendTraceTag(4290720,500,15,"Response did not contain valid MachineId [ConnectionUrl and/or QueryString] for [{0}]; IsRtcEnabled:{1}; IsQueryStringEmpty:{2}; IsConnectionStringEmpty:{3}",
this.Bk,na.Dab,!na.OP,!na.ew)}else X.FindSessionFailureReason="FindSessionTranslateServerResponseFailed",m.ULS.sendTraceTag(8745097,500,15,"Could not translate server response to findSession response for [{0}]",this.Bk);else X.FindSessionFailureReason="FindSessionDeserializeServerResponseFailed",m.ULS.sendTraceTag(7372827,500,10,"Could not deserialize response data for [{0}]",this.Bk);this.Ejd(X,wa);ia(null)}}Gld(Z,X,aa,ia=!1){return wa=>{M.a.instance.JNa(0,1);Z&&Z.stop();this.QFa=this.wva=null;this.scd(wa.data,
!1,X);let ma=null;var na="unknown";let Fa="unknown";wa.data&&((na=wa.data.vi)&&T.$Na in na&&(ma=na[T.$Na].toString()),na=x.a[wa.data.status],Fa=wa.data.He.toString());X.FindSessionFailureReason="FindSessionRequestFailed";X.HttpErrorCode=Fa;X.HttpErrorStatus=na;X[T.$Na]=ma;m.ULS.sendTraceTag(4290721,500,15,"Request for MachineId failed with Status='{0}'; HttpStatus='{1}' for [{2}]; RtcErrorCode='{3}'. Polling: '{4}' '",na,Fa,this.Bk,ma,ia);this.Ejd(X,ia);aa(Fa)}}IPb(Z,X,aa=!1){let ia=null;m.ULS.sendTraceTag(4317445,
500,50,"Getting MachineId from server for [{0}]",this.Bk);const wa={};var ma=this.FHc.generate();wa[P.a.S2]=D.a.create().toString();this.wva&&""!==this.wva?ma=String.format("{0}&{1}={2}",ma,Q.a.b_b,this.wva):this.QFa&&""!==this.QFa&&(ma=String.format("{0}&{1}={2}",ma,Q.a.b_b,this.QFa),wa[S.fOg]="True",wa[S.d2f]="True");ma=this.GHc+"?"+ma;aa&&(wa[V.dEf]=Y.lqg);const na={};na.IsNetworkOfflineBeforeSendRequest=this.Af.Nta;na.HasAvailableConnectionsBeforeSendRequest=this.Af.R5c;na.MaxConnectionsAllowed=
this.Af.uVb;na.IsRefreshMachineId=aa;this.rxa&&!this.HHc?(this.YJf(this.Jld(null,na,Z,X,aa),this.Gld(null,na,X,aa)),this.HHc=!0):(this.Vd&&(ia=this.Vd.Vf("WebServiceCall","GetMachineIdFromTheServer")),N.FrequentLoggingMetrics.instance&&N.FrequentLoggingMetrics.instance.Zs(2,0),0>this.Af.X5a(ma,1,null,wa,[T.k7a,T.$Na,T.LMa,T.a_b,T.Vdd,T.Ked,T.Jed],1,this.Jld(ia,na,Z,X,aa),this.Gld(ia,na,X,aa),null,!1,null,this.A8a,"3",null,!0)&&(5<this.tGa&&200>this.tGa&&m.ULS.sendTraceTag(578166985,500,15,"FindSession request not scheduled due to expired token. Manually triggered failure callback {0} times.",
this.tGa),window.setTimeout(()=>{this.tGa++;X("-1")},1E3)))}scd(Z,X,aa){aa||(aa={});aa.IsNetworkOfflineAfterRequestComplete=this.Af.Nta;aa.IsRequestSucceeded=X;Z&&(aa.EnqueueTime=Z.nsa,aa.InvokedTime=Z.bH,aa.CompletedTime=Z.YO,Z.vi&&(T.k7a in Z.vi&&(aa.CorrelationId=Z.vi[T.k7a]),T.LMa in Z.vi&&(aa[T.LMa]=Z.vi[T.LMa])));m.ULS.sendTraceTag(38633565,500,X?50:15,U.RtcUtils.Bma(aa))}Ejd(Z,X){Z||(Z={});Z.ConnectionState=l.a[this.kV];X||this.Ce.Djd(1,Z)}m6f(Z){try{var X=!1,aa=!1,ia=Z.vi,wa=v.a.rU(Z.request.get_url());
if(ia&&T.a_b in ia){const ya=ia[T.a_b].toString().toLocaleLowerCase();aa="true"===ya;X="false"===ya}ia=!1;const Qa=0<=wa.toLocaleLowerCase().indexOf("collab");aa&&!Qa?ia=!0:X&&Qa&&(ia=!0);if(ia){X={};X.HostName=wa;X.Status=x.a[Z.status];X.HttpStatus=Z.He.toString();var ma=Z.request.get_headers();for(let ya in ma){var na=ma[ya];(wa=ya)&&0<wa.length&&(aa=0,na&&(aa=na.toString().length),X["r_"+wa]=aa)}if(Z.vi){const ya=new a.a;ya.add(T.k7a);ya.add(T.LMa);ya.add(T.$Na);ya.add(T.Ked);ya.add(T.Jed);ya.add(T.Vdd);
T.Cff(X,Z.vi,ya)}T.yff(Z.request.get_url(),X);var Fa=z.a.toJSON(X);m.ULS.sendTraceTag(559437006,500,15,Fa)}}catch(Qa){m.ULS.sendTraceTag(559437007,500,10,"DomainLandingIncorretDC exception[{0}]",Qa.toString())}}static createInstance(Z,X,aa,ia,wa,ma,na,Fa,Qa,ya,ta,Aa=null){return T.Wtf(Z,X,aa,ia,wa,ma,na,Fa,Qa,ya,null,ta,Aa)}static Wtf(Z,X,aa,ia,wa,ma,na,Fa,Qa,ya,ta,Aa,oa=null){Z=Z||D.a.create().toString();Z=new T(Z,X,aa,ia,wa,ma,na,Fa,Qa,ya,ta,Aa,oa);Z.init();return Z}static Cff(Z,X,aa){for(let ia of aa)ia in
X&&(Z[ia]=X[ia])}static yff(Z,X){if(Z){var aa=Z.indexOf("?");if(-1!==aa)for(Z=Z.substr(aa+1).split("&"),aa=0;aa<Z.length;++aa){var ia=Z[aa].split("=");if(2===ia.length){const wa=ia[0];if(wa&&0<wa.length){let ma=0;if(ia=ia[1])ma=ia.length;X["q_"+wa]=ma}}}}}}T.KLf=3E3;T.v8f=3E5;T.F7c=1E3;T.k7a="X-CorrelationId";T.rYd="corrid";T.$Na="RtcErrorCode";T.LMa="X-OfficeCluster";T.a_b="X-NewEnv";T.Vdd="X-MSEdge-Ref";T.Jed="X-OFFICEFD";T.Ked="X-OfficeFE";Object(G.a)(T,"FindSessionStrategy",null,[1459])},2215:function(G,
J,d){d.r(J);var m=d(2),f=d(0);class a{constructor(qa,Jb){this.hya=null;this.Rga=()=>{a.wUh(this.hya.pqb())&&(this.hya.wtg(this.Rga),this.ZIk.IsRealCoauthSession=!0)};this.ENc=qa;this.ZIk=Jb}init(){this.ENc.continueWith(()=>{this.hya=this.ENc.result;this.hya.Scc(this.Rga)})}static wUh(qa){let Jb=null;for(const Rb of qa)if(Rb)if(qa=Rb.isAnonymous||!Rb.email?Rb.clientId:Rb.email.toUpperCase(),!Jb)Jb=qa;else if(Jb!==qa)return!0;return!1}}Object(f.a)(a,"CoauthTelemetry",null,[769]);var l=d(7),w=d(356),
y=d(84),v;(function(qa){qa[qa.OTp=0]="badStatePreventedTelemetry";qa[qa.notImplemented=1]="notImplemented";qa[qa.Bhq=2]="renderHandled";qa[qa.Chq=3]="renderHandledWithVeto"})(v||(v={}));Object(f.b)("CoauthorGalleryTelemetryEndResult",v);var u=d(92),x=d(90),z=d(143);class A{constructor(qa,Jb,Rb,Tc,vd,Td,Ed,lf,Bf){this.Izh=this.Sbh=this.iF=null;this.Koe=()=>{this.Rga()};this.Nfg=()=>{const vf=this.og.dv("AppInitStatus_interactivityReady");l.ULS.shipAssertTag(42259235,325,!!this.NOd);const fd=this.NOd-
vf,Wc={};Wc.InteractiveTime=vf;Wc.ReactRenderComplete=this.NOd;Wc.HadTabSwitch=this.IBb();Wc.IsModernGallery=this.GRc;l.ULS.sendTraceTag(594883104,325,50,x.a.toJSON(Wc));this.GRc?(l.ULS.sendTraceTag(42062997,325,15,fd.toString()),this.vNd.yV(this.$Dp(fd)?3:2)):l.ULS.sendTraceTag(594883103,325,15,fd.toString())};this.z9=qa;this.vNd=new w.a;this.Ga=Rb;this.KNe=Jb;this.n1=Tc;this.og=vd;this.y4e=Td;this.ikb=Ed;this.Znk=lf;this.dlh=this.Ykh=!1;this.NOd=0;this.Qbh=1;this.IBb=Bf;this.GRc=this.Ga.$("PeoplesWellExtraButtonInfoIsEnabled");
this.fia=Object(y.a)(String,m.AFrameworkApplication.sessionStartInfoSettings.Application)||""}get ZXj(){return this.vNd.task}init(){z.Task.WAA.call(null,this.ikb,this.KNe,this.y4e).continueWith(()=>{this.iF=this.ikb.result;this.Sbh=this.KNe.result;this.Izh=this.y4e.result;z.Task.WAA.call(null,this.KNe.result.efc,this.y4e.result.R0j).continueWith(()=>{this.Qbh=this.Sbh.efc.result;this.NOd=this.Izh.R0j.result;this.iF.Scc(this.Koe);this.iF.pqb().length&&this.Rga()})})}Rga(){this.Znk(this.iF.pqb())?(this.iF.wtg(this.Koe),
this.PXn(this.Ykh)):this.vNd.yV(1);this.Ykh=!0}PXn(qa){this.dlh?this.ZXj.continueWith(()=>{l.ULS.sendTraceTag(42062996,325,15,"We already attempted to log a render of coauthor gallery: {0}",v[this.ZXj.result])}):(this.dlh=!0,this.Uho(0===this.Qbh&&!qa))}Uho(qa){qa?this.n1.Lk(4,this.Nfg):this.vNd.yV(1)}$Dp(qa){const Jb=qa>this.Ga.ic("CoauthorGalleryTimeToRenderDurationMs",1E4);var Rb="Word"===this.fia;const Tc="PowerPoint"===this.fia;if(this.IBb())return l.ULS.sendTraceTag(50455714,325,50,Jb.toString()),
!1;Rb&&u.Health.instance.recordKpiUsage("CoauthGalleryExperienceDegraded",0,"wordcollabrel",null);Jb&&(Rb&&u.Health.instance.recordKpiFailure("CoauthGalleryExperienceDegraded","CoauthorGalleryTimeToRenderDurationIsTooLong",!1,!0,null),Rb=m.AFrameworkApplication.K.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.PPTClientCoauthorGalleryRenderLatencyQoSError"),Tc&&Rb&&qa<this.Ga.ic("CoauthorGalleryTimeToRenderCutoffThresholdMs",3E4)&&u.Health.instance.recordQosError("CoauthorGalleryTimeToRenderDurationIsTooLong",
["CoauthGalleryExperienceDegraded"],!1,!0,!0,!1,null),l.ULS.sendTraceTag(42062998,325,15,qa.toString()));return Jb}}Object(f.a)(A,"CoauthorGalleryTelemetry",null,[770]);class D{constructor(qa){this.iF=null;this.oyd={};this.AJd={};this.hJc=null;this.Rga=()=>{this.N8j()};this.ixl=(Jb,Rb)=>Jb.YXa>Rb.YXa?1:Jb.YXa<Rb.YXa?-1:0;this.ikb=qa}T8d(qa){const Jb=new w.a;this.init().continueWith(()=>{qa in this.oyd?Jb.yV(this.oyd[qa]):this.AJd[qa]=Jb});return Jb.task}init(){if(this.hJc)return this.hJc.task;this.hJc=
new w.a;this.ikb.continueWith(()=>{this.iF=this.ikb.result;this.iF.Scc(this.Rga);this.N8j();this.hJc.gg(null)});return this.hJc.task}N8j(){const qa=this.iF.pqb();qa.sort(this.ixl);this.oyd={};for(let Jb=0;Jb<qa.length&&qa[Jb]&&qa[Jb].YXa;Jb++)this.wYk(this.oyd,qa[Jb].clientId,Jb)}wYk(qa,Jb,Rb){qa[Jb]=Rb;Jb in this.AJd&&(this.AJd[Jb].yV(Rb),delete this.AJd[Jb])}}Object(f.a)(D,"CoauthorPositionFinder",null,[768]);var F=d(636),I=d(298),H=d(543),N=d(77),M=d(123);class U{constructor(){this.WHa=null;this.eEc=
Array(32)}xor(qa){if(!qa)throw Error.argumentNull("Guid argument cannot be null");const Jb=new U,Rb=new Sys.StringBuilder;for(let Tc=0;Tc<qa.eEc.length;Tc++){const vd=this.eEc[Tc]^qa.eEc[Tc];Jb.eEc[Tc]=vd;Rb.append(vd.toString(16));7!==Tc&&11!==Tc&&15!==Tc&&19!==Tc||Rb.append("-")}Jb.WHa=M.a.Cf(Rb.toString());return Jb}toString(){return this.WHa.toString()}equals(qa){if(!qa)throw Error.argumentNull("Guid argument cannot be null");return this.WHa.equals(qa.WHa)}static dqb(qa){if(!qa)throw Error.argumentNull("String input cannot be null");
const Jb=new U;Jb.WHa=M.a.Cf(qa);const Rb=Jb.WHa.toString();let Tc=0;for(let Td=0;Td<Rb.length;Td++){var vd=qa.charAt(Td);if(U.dkn(vd))vd=U.V_m(vd,qa.charCodeAt(Td)),Jb.eEc[Tc++]=vd;else if(!U.yjn(vd))throw Error.argument("String contains characters not valid in Guids");}return Jb}static dkn(qa){return"0"<=qa&&"9">=qa||"A"<=qa&&"F">=qa||"a"<=qa&&"f">=qa}static yjn(qa){return"{"===qa||"}"===qa||"-"===qa}static V_m(qa,Jb){if("0"<=qa&&"9">=qa)return Jb-48;if("A"<=qa&&"F">=qa)return Jb-65+10;if("a"<=
qa&&"f">=qa)return Jb-97+10;throw Error.argument("Char is not valid hex digit");}}Object(f.a)(U,"Guid",null,[]);class O{constructor(qa,Jb,Rb,Tc){this.hya=null;this.jeh=this.Kvh=!1;this.Rsh=0;this.Rga=()=>{this.vul(this.hya.pqb())};this.ENc=qa;this.X$e=Jb;this.Ga=Rb;this.t9b=Tc;this.qnk=m.AFrameworkApplication.V2b||m.AFrameworkApplication.iua;this.$th=new F.a(I.a.th())}get Ivf(){return this.Ga.getBooleanFeatureGate("Microsoft.Office.SharedOnline.IsCustomAnonymousNameEnabled",!1)}init(){this.ENc.continueWith(()=>
{this.hya=this.ENc.result;this.hya.Scc(this.Rga)})}vul(qa){var Jb=0;const Rb=new H.a(I.a.th());for(const Tc of qa)if(Tc&&Tc.isAnonymous){m.AFrameworkApplication.Ld("70eb6120;2gfeb930");if(Rb.mb(Tc.userName))Rb.J(Tc.userName).add(Tc.clientId);else{let vd;Rb.add(Tc.userName,(vd=new N.a,vd.add(Tc.clientId),vd))}Tc.clientId!==this.t9b?(Jb++,2<=Jb&&!this.Kvh&&this.rEn()):!this.jeh&&this.Ivf&&"Guest"===Tc.userName&&(l.ULS.sendTraceTag(509726851,302,50,"User was assigned 'Guest' name"),this.jeh=!0)}if(this.Ivf&&
this.Rsh!==Jb){l.ULS.sendTraceTag(512553562,302,50,"Total guests updated to: {0}",Jb+(this.qnk?1:0));this.Rsh=Jb;for(const Tc of Rb.keys)2<=Rb.J(Tc).count&&(qa=this.pqm(Rb.J(Tc)),this.$th.contains(qa)||(Jb={},Jb.guestsWithSameName=Rb.J(Tc).count,Jb.identifier=qa,l.ULS.sendTraceTag(526394833,302,50,"Duplicate guest friendly name detected: {0}",Jb),this.$th.add(qa)))}}rEn(){l.ULS.sendTraceTag(525112603,302,50,"Multiple guests simultaneously coauthoring");this.Kvh=!0;this.Ivf&&this.X$e&&this.X$e.continueWith(()=>
{window.setTimeout(()=>{this.X$e.result.logActivity("MultipleGuestsCoauthoring",null)},15E3)})}pqm(qa){if(!qa||1>=qa.count)return"";let Jb=U.dqb(qa.J(0));for(let Rb=1;Rb<qa.count;Rb++)Jb=Jb.xor(U.dqb(qa.J(Rb)));return Jb.toString()}}Object(f.a)(O,"GuestCoauthTelemetry",null,[]);var V=d(286);class Y{constructor(){this.id=null;this.d=this.tp=this.mp=this.st=this.et=0;this.ct=null;this.vc=!1}}Object(f.a)(Y,"PL",null,[]);var Q=d(34);class S{constructor(){this.ct=this.vt=this.d=0}static dMj(qa,Jb,Rb){const Tc=
new S;Tc.d=qa;Tc.vt=Jb;Tc.ct=Rb;return Q.c(Tc)}}Object(f.a)(S,"VD",null,[]);var P=d(105);class T{constructor(qa,Jb,Rb,Tc,vd,Td,Ed,lf,Bf){this.ji=0;this.AEh=!1;this._id=qa;this.qGh=Jb;this.xt=Rb;this.A1e=Tc;this.Kaf=vd;this.uJb=Td;this.ECb=Ed;this.Cqk=lf;this.IBb=Bf;this.fia=Object(y.a)(String,m.AFrameworkApplication.sessionStartInfoSettings.Application)||""}tGe(qa){z.Task.WAA(this.qGh,this.A1e,this.Kaf).continueWith(()=>{if(this.A1e.result<=this.Kaf.result)qa.yV(!1);else{this.ji=this.qGh.result;var Jb=
this.xt-this.ji,Rb=new Y;Rb.id=this._id;Rb.et=this.xt;Rb.st=this.ji;Rb.d=this.xt-this.ji;Rb.mp=this.A1e.result;Rb.tp=this.Kaf.result;Rb.ct=this.Alm(this.Cqk);Rb.vc=this.IBb();var Tc=Q.c(Rb),vd="Word"===this.fia,Td="PowerPoint"===this.fia;l.ULS.sendTraceTag(42078597,302,15,Tc);if(vd){const Ed=new Map;Ed.set("data",Tc);u.Health.instance.recordKpiUsage("PresenceExperienceDegraded",0,"wordcollabrel",Ed)}Jb>this.uJb.value&&!this.AEh&&!Rb.vc&&(this.AEh=!0,qa.yV(!0),Rb=Object.assign(new P.a,{inStaging:!0,
extendedProperties:new Map}),Rb.extendedProperties.set("data",Tc),vd&&u.Health.instance.recordKpiFailure("PresenceExperienceDegraded","PresenceRenderDurationIsTooLong",!1,!0,Rb),Jb<this.ECb.value&&(l.ULS.sendTraceTag(42078598,302,15,S.dMj(Jb,this.uJb.value,this.ECb.value)),Jb=m.AFrameworkApplication.K.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.PPTClientThumbnailPresenceRenderLatencyQoSError"),Td&&Jb&&(Rb.inStaging=!1,u.Health.instance.recordQosError("PresenceRenderDurationIsTooLong",
["PresenceExperienceDegraded"],!1,!0,!0,!1,Rb))));qa.task.isCompleted||qa.yV(!1)}})}Alm(qa){switch(qa){case 2:return"NonWac";case 0:return"Unknown";case 1:return"Wac";default:return"Unknown"}}}Object(f.a)(T,"PresenceLatencyActivityLogger",null,[]);class Z{constructor(qa,Jb,Rb){this.Cah=this.Obh=this.Wxd=this.nyd=this.l4b=0;this._id=qa;this.uJb=Jb;this.ECb=Rb;this.fia=Object(y.a)(String,m.AFrameworkApplication.sessionStartInfoSettings.Application)||""}get lRh(){return this.l4b}set lRh(qa){this.l4b=
qa;this.Dof()}get l4h(){return this.nyd}set l4h(qa){this.nyd=qa;this.Dof()}get i0h(){return this.Wxd}set i0h(qa){this.Wxd=qa;this.Dof()}get m4h(){return 0!==this.Obh}get j0h(){return 0!==this.Cah}Dof(){!this.m4h&&this.l4b&&this.nyd&&(this.Obh=this.tGe(this.nyd,"CoauthGalleryLightupDurationTooLong"));!this.j0h&&this.l4b&&this.Wxd&&(this.Cah=this.tGe(this.Wxd,"CanvasPresenceLightupDurationTooLong"))}tGe(qa,Jb){const Rb=qa-this.l4b;var Tc=new Y;Tc.id=this._id;Tc.et=qa;Tc.st=this.l4b;Tc.d=Rb;var vd=Q.c(Tc);
qa="Word"===this.fia;Tc="CanvasPresenceLightupDurationTooLong"===Jb?"PresenceExperienceDegraded":"CoauthGalleryExperienceDegraded";"CanvasPresenceLightupDurationTooLong"===Jb?l.ULS.sendTraceTag(572289499,302,15,vd):l.ULS.sendTraceTag(571524118,302,15,vd);if(qa){var Td=new Map;Td.set("data",vd);u.Health.instance.recordKpiUsage(Tc,0,"wordcollabrel",Td)}return Rb>this.uJb.value?(Td=Object.assign(new P.a,{inStaging:!0,extendedProperties:new Map}),Td.extendedProperties.set("data",vd),vd=Rb<this.ECb.value,
Td.extendedProperties.set("cash",vd?"true":"false"),qa&&u.Health.instance.recordKpiFailure(Tc,Jb,!1,!0,Td),l.ULS.sendTraceTag(572289500,302,15,S.dMj(Rb,this.uJb.value,this.ECb.value)),vd?2:1):3}}Object(f.a)(Z,"PresenceLightupLatencyLogger",null,[]);class X{constructor(qa,Jb,Rb,Tc,vd,Td,Ed,lf=null,Bf=null,vf=null){this.LAh={};this.JNe={};this.srh=new N.a;this.Dxd=this.iJc=this.iF=this.Yh=null;this.pGh=this.oGh=0;this.Y1n=(fd,Wc)=>{if(!this.D$g&&2===Wc.newState){var sg=this.OAi();sg.continueWith(()=>
{var Jf=sg.result;Jf=Date.now()-Jf;const Qk={};Qk.clientId=this.pgj;Qk.bootTime=Jf;this.D$g=!0;this.Yh.nC(15,Qk)})}};this.PVn=(fd,Wc)=>{if(15===Wc.type){fd=Date.now();Wc=Wc.nA;var sg=Wc.bootTime;this.sLf(Wc.clientId).lRh=fd-sg}};this.Koe=()=>{this.Rga()};this.uJb=new V.a(()=>lf.j3("PresenceBootLatencyThreshold",1E4));this.ECb=new V.a(()=>lf.j3("PresenceBootLatencyCutoffThreshold",6E4));this.ySk=new V.a(()=>lf.j3("PresenceLightupLatencyThreshold",2E3));this.Isk=new V.a(()=>lf.j3("PresenceLightupLatencyCutoffThreshold",
1E4));this.n1=Tc;this.gJk=vd;this.Rbh=qa;this.pDh=Jb;this.ikb=Rb;this.og=Td;this.t9b=Bf;this.IBb=Ed;this.klh=vf;this.D$g=!1;this.init()}w_c(qa,Jb,Rb=null,Tc=0){Rb&&(l.ULS.shipAssertTag(42274970,302,!this.t9b||this.t9b===Rb,"_myClientId is already set and you are trying to update it to something different"),this.t9b=Rb);const vd=new w.a;this.init().continueWith(()=>{this.G0n(qa);this.r0l(vd,qa,Jb,Tc)})}get pgj(){return this.t9b||"{"+m.AFrameworkApplication.userSessionId+"}"}init(){if(this.iJc)return this.iJc.task;
this.iJc=new w.a;this.IBb()&&l.ULS.sendTraceTag(50951700,302,15,"TabSwitched Session");this.Rbh.continueWith(()=>{const qa=this.Rbh.result,Jb=qa.efc,Rb=qa.xNn;Rb.continueWith(()=>{Jb.continueWith(()=>{this.klh&&this.klh.addQosPillar("RealTimeCoauth");this.EFg(Jb.result,Rb.result);this.iJc.gg(null)})})});this.pDh.continueWith(()=>{this.Yh=this.pDh.result;this.Yh.b_(this.Y1n);this.Yh.JO(this.PVn)});this.ikb.continueWith(()=>{this.iF=this.ikb.result;this.iF.Scc(this.Koe);0<this.iF.pqb().length&&this.Rga()});
return this.iJc.task}OAi(){this.Dxd||(this.Dxd=new w.a,this.n1.Lk(4,()=>{this.Dxd.yV(this.og.dv("AppInitStatus_interactivityReady"))}));return this.Dxd.task}Rga(){const qa=Date.now();var Jb=this.iF.pqb();const Rb=new N.a;for(const Tc of Jb)this.srh.contains(Tc.clientId)||(this.srh.add(Tc.clientId),Rb.add(Tc.clientId));if(0<Rb.count)for(const Tc of Rb)Jb=this.sLf(Tc),Jb.m4h||(Jb.l4h=qa)}G0n(qa){qa=this.sLf(qa);qa.j0h||(qa.i0h=Date.now())}sLf(qa){return qa in this.JNe?this.JNe[qa]:this.JNe[qa]=new Z(qa,
this.ySk,this.Isk)}EFg(qa,Jb=0){this.oGh=qa;this.pGh=Jb?Jb:(new Date).getTime()}r0l(qa,Jb,Rb,Tc){Rb=Rb?Rb.getTime():(new Date).getTime();Jb in this.LAh?qa.hoa():(Tc=new T(Jb,this.ELm(),Rb,this.T8d(this.pgj),this.T8d(Jb),this.uJb,this.ECb,Tc,this.IBb),this.LAh[Jb]=Tc,Tc.tGe(qa))}ELm(){return 1===this.oGh?z.Task.p7(this.pGh):this.OAi()}T8d(qa){return this.gJk.T8d(qa)}}Object(f.a)(X,"PresenceBootTelemetry",null,[767]);var aa=d(140),ia=d(193),wa=d(45),ma=d(180),na=d(168),Fa=d(21),Qa=d(577);class ya{get name(){return"Common.App.CoauthTelemetry"}wc(qa){qa.register(a,
"Common.App.CoauthTelemetry.CoauthTelemetry").as("Common.App.CoauthTelemetry.ICoauthTelemetry").ha().Rd(()=>new a(Qa.a.$p(qa.Qa("Common.IPeopleInfoProvider")),m.AFrameworkApplication.Ug));qa.register(A,"Common.App.CoauthTelemetry.CoauthorGalleryTelemetry").as("Common.ICoauthorGalleryTelemetry").ha().Rd(()=>new A(m.AFrameworkApplication.va,Qa.a.$p(qa.Qa("Common.ICoauthoringTelemeryInfoProvider")),m.AFrameworkApplication.K,aa.a.get_instance(),ma.a.instance,Qa.a.$p(qa.Qa("Common.IPeoplesWell")),Qa.a.$p(qa.Qa("Common.IPeopleInfoProvider")),
a.wUh,()=>this.OXh()));qa.register(X,"Common.App.CoauthTelemetry.PresenceBootTelemetry").as("Common.App.CoauthTelemetry.IPresenceBootTelemetry").ha().Rd(()=>new X(Qa.a.$p(qa.Qa("Common.ICoauthoringTelemeryInfoProvider")),Qa.a.$p(qa.Qa("Common.IRealtimeChannelBasic")),Qa.a.$p(qa.Qa("Common.IPeopleInfoProvider")),aa.a.get_instance(),qa.resolve("Common.App.CoauthTelemetry.ICoauthorPositionFinder"),ma.a.instance,()=>this.OXh(),m.AFrameworkApplication.K,null,u.Health.instance));qa.register(D,"Common.App.CoauthTelemetry.CoauthorPositionFinder").as("Common.App.CoauthTelemetry.ICoauthorPositionFinder").ha().Rd(()=>
new D(Qa.a.$p(qa.Qa("Common.IPeopleInfoProvider"))));qa.register(O,"Common.App.CoauthTelemetry.GuestCoauthTelemetry").ha().Rd(()=>new O(Qa.a.$p(qa.Qa("Common.IPeopleInfoProvider")),Qa.a.$p(qa.Qa("Common.ISystemInitiatedFeedback")),m.AFrameworkApplication.K,"{"+m.AFrameworkApplication.userSessionId+"}"))}init(){m.AFrameworkApplication.K.Rn(()=>{Fa.a.instance.resolve("Common.App.CoauthTelemetry.CoauthTelemetry").init();Fa.a.instance.resolve("Common.App.CoauthTelemetry.GuestCoauthTelemetry").init();
m.AFrameworkApplication.K.$("CoauthorGalleryTelemetryIsEnabled")&&Fa.a.instance.resolve("Common.ICoauthorGalleryTelemetry").init();m.AFrameworkApplication.K.$("CashTelemetryIsEnabled")&&(Fa.a.instance.resolve("Common.App.CoauthTelemetry.IPresenceBootTelemetry"),Fa.a.instance.resolve("Common.App.CoauthTelemetry.ICoauthorPositionFinder"))})}dispose(){}OXh(){return na.a.$Kb&&ma.a.instance.OJ(wa.a.jud)?0<ma.a.instance.dv(wa.a.jud)[wa.a.Pak]:!1}static main(){ia.a.instance.Jc(new ya)}}Object(f.a)(ya,"CoauthTelemetryPackage",
null,[0,1]);class ta extends Sys.EventArgs{constructor(){super()}}Object(f.a)(ta,"RtcHostNotificationEventArgs",Sys.EventArgs,[]);var Aa;(function(qa){qa[qa.edq=0]="notYetStarted";qa[qa.Xfq=1]="polling";qa[qa.rmq=2]="subscribed";qa[qa.wWh=3]="blocked";qa[qa.Lfq=4]="permanentlyStopped"})(Aa||(Aa={}));Object(f.b)("RtcHostNotificationSubscriptionState",Aa);var oa=d(96),za=d(1465),ja=d(89);class fa{constructor(qa,Jb,Rb,Tc,vd,Td,Ed,lf,Bf){this.ii=!1;this.pea=this.w$b=this.qja=this.J4a=null;this.qyg=()=>
{this.J4a=null;if(this.l2i){l.ULS.sendTraceTag(573100181,502,50,"HostNotifications: Send event when connected.  Current state: {0}",Aa[this.Uyc]);let vf=null;this.z7e&&this.z7e.length&&(vf={},vf.etts=this.z7e);this.w$b.nC(14,vf,!0);this.SJj(this.WLk)}else this.llb.event(3)};this.$mp=()=>{this.qja=null;2===this.Uyc&&(this.llb.event(1),l.ULS.shipAssertTag(573100185,502,!!this.J4a,"Missing task to ensure that we re-subscribe."))};this.Jma=()=>{this.pUm()};this.iS=(vf,fd)=>{if(13===fd.type&&(vf=fd.nA,
l.ULS.sendTraceTag(573100183,502,50,"HostNotifications: Subscription status: {0}",{["SerializableHostNotificationSubscription"]:vf,["DurationBeforeExpirationToResubscribeInSec"]:this.LLd}),fd=vf.cts,!this.Xpp(fd))){if(vf.sb){var Wc=2;this.ILo(vf.cts)}else Wc=1,this.yQc=fa.GJe,this.qja&&(this.Gb.vf(this.qja),this.qja=null);this.llb.event(Wc);this.J4a?this.Gb.q4(this.J4a,1E3*fd):this.SJj(fd)}};this.$2n=(vf,fd)=>{vf=fd.newState;const Wc=fd.Fmg,sg={};sg.NewState=Aa[vf];sg.PreviousState=Aa[Wc];sg.PreviousStateHits=
fd.Gmg;sg.PreviousStateTransitionTime=fd.Hmg.toISOString();sg.IsSubscribed=this.L2i;this.yQc!==fa.GJe&&(sg.SubscriptionExpiringTime=this.yQc.toISOString());l.ULS.sendTraceTag(572346515,502,4===vf?15:50,"HostNotificationChanged: {0}",sg);this.sa.raiseEvent("HN",new ta(Wc,vf))};this.yQc=fa.GJe;this.sa=new ja.a;this.llb=new za.a(0);this.llb.Tgf(this.$2n);this.WLk=qa;this.LLd=Jb;this.VLk=Rb;this.z7e=Tc;this.Gb=vd;this.tf=Td;Ed.execute(vf=>{this.ii||(this.w$b=vf,this.w$b.JO(this.iS),this.start())});lf.execute(vf=>
{this.ii||(this.pea=vf,vf.OTa(this.Jma))});this.KOd=Bf}get Uyc(){return this.llb.currentState}get l2i(){return!this.tf||this.tf.NCa}get L2i(){return 2===this.Uyc&&this.KOd()<this.yQc}start(){0!==this.Uyc?l.ULS.sendTraceTag(573100178,502,15,"HostNotifications: Tried starting poll when in state {0}",Aa[this.Uyc]):(this.llb.event(1),this.qyg(null))}SJj(qa){this.J4a=oa.a.Haa(1E3*qa,this.qyg,this.LLd,192,"RtcHostNotificationSubscribe");this.Gb.Zb(this.J4a)}ILo(qa){qa=1E3*(qa+this.VLk);const Jb=this.KOd().getTime()+
qa;this.yQc=new Date(Jb);qa-=this.LLd;this.qja?this.Gb.q4(this.qja,qa):(this.qja=oa.a.Haa(qa,this.$mp,this.LLd/2,194,"RtcHostNotificationTransitionToPolling"),this.Gb.Zb(this.qja))}pUm(){3===this.Uyc&&this.l2i&&(this.llb.event(this.L2i?2:1),this.qyg(null))}Xpp(qa){if(!isNaN(qa)&&isFinite(qa)&&0<qa)return!1;this.nYj(!1);return!0}nYj(qa){this.J4a&&(this.Gb.vf(this.J4a),this.J4a=null);this.qja&&(this.Gb.vf(this.qja),this.qja=null);this.w$b&&(this.w$b.ZDa(this.iS),this.w$b=null);this.pea&&(this.pea.wZb(this.Jma),
this.pea=null);qa||this.llb.event(4)}dispose(){this.ii||(this.ii=!0,this.nYj(!0),this.qja&&(this.Gb.vf(this.qja),this.qja=null))}}fa.GJe=new Date(0);Object(f.a)(fa,"RtcHostNotificationSubscriptionManager",null,[766,13]);var Ca=d(417);class xa{constructor(){this.ui=this.ii=!1}get name(){return"RtcHostNotificationSubscription"}wc(qa){qa.register(fa,"Common.App.RtcHostNotificationSubscription.RtcHostNotificationSubscriptionManager").as("Common.App.RtcHostNotificationSubscription.IRtcHostNotificationSubscriptionManager").ha().Rd(()=>
{const Jb=m.AFrameworkApplication.K;return new fa(Jb.ic("RtcHostNotificationRetryIntervalIdeallyInSeconds",1800),Jb.ic("RtcHostNotificationRetryIntervalBufferInSeconds",120),Jb.ic("RtcHostNotificationSubscriptionLostBufferInSeconds",60),this.mJm(Jb),m.AFrameworkApplication.mc,Ca.SessionStatusManager.instance,qa.Qa("Common.IRealtimeChannelBasic"),qa.Qa("Common.ISessionExpirationManager"),()=>new Date)})}init(){m.AFrameworkApplication.K.Rn(()=>{!this.ii&&m.AFrameworkApplication.K.$("RtcHostNotificationEnabled")&&
(this.ui=!0,Fa.a.instance.resolve("Common.App.RtcHostNotificationSubscription.IRtcHostNotificationSubscriptionManager"))})}dispose(){this.ii||(this.ii=!0,this.ui&&Fa.a.instance.resolve("Common.App.RtcHostNotificationSubscription.RtcHostNotificationSubscriptionManager").dispose())}mJm(qa){return qa.jy("RtcEventTypesToSubscribe")?qa.iD("RtcEventTypesToSubscribe"):null}static main(){ia.a.instance.Jc(new xa)}}Object(f.a)(xa,"RtcHostNotificationSubscriptionPackage",null,[0,1]);var ua=d(507),sa=d(690);
class Ea{constructor(qa,Jb,Rb,Tc,vd,Td,Ed,lf,Bf,vf,fd){this.clientId=qa;this.SkypeChatThreadId=Rb;this.chatThreadDiscoveryUri=Tc;this.inChat=vd;this.localColbaltSessionId=Jb;this.capabilities=Td;this.email=Ed;this.isReadOnly=lf;this.userName=Bf;this.isAnonymous=vf;this.presenceStatus=fd}}Object(f.a)(Ea,"SerializablePresenceUserData",null,[]);class Ja extends ua.a{constructor(qa,Jb,Rb,Tc,vd=null,Td=null,Ed=null,lf=null,Bf=null,vf=!1,fd=!1,Wc=!1,sg=null){super(qa,Jb,Rb,Tc,Td,Ed,lf,Bf,vf,fd,Wc);this.IF=
vd;this.presenceStatus=sg}getData(){return new Ea(this.clientId,this.IF,this.iVc,this.chatThreadDiscoveryUri,this.inChat,this.capabilities.capabilities,this.email,this.isReadOnly,this.userName,this.isAnonymous,this.presenceStatus)}U8d(qa){return(qa=qa.value)?qa.user:null}clone(){return new Ja(this.clientId,this.userName,this.color,this.capabilities.clone(),this.IF,this.iVc,this.email,this.client,this.chatThreadDiscoveryUri,this.isAnonymous,this.inChat,this.isReadOnly,this.presenceStatus)}static vMb(qa){return qa.clientId?
new Ja(qa.clientId,qa.userName,null,new sa.a(void 0===qa.capabilities?0:qa.capabilities),qa.localColbaltSessionId,qa.SkypeChatThreadId,qa.email,null,qa.chatThreadDiscoveryUri,qa.isAnonymous,qa.inChat,qa.isReadOnly,qa.presenceStatus):null}static z$h(qa,Jb,Rb,Tc=null,vd=null,Td=null,Ed=null,lf=null,Bf=!1,vf=!1,fd=!1,Wc=null){return qa?new Ja(qa,Jb,null,new sa.a(void 0===Rb?0:Rb),Tc,vd,Td,Ed,lf,fd,Bf,vf,Wc):null}}Object(f.a)(Ja,"PresenceUser",ua.a,[1767,1768,700]);class nb extends Ja{constructor(){super();
this.ouc=this.R5f=null}FAm(){const qa=m.AFrameworkApplication.userName,Jb=m.AFrameworkApplication.K.kb("UserPrincipalName"),Rb=this.R5f?this.R5f.IF:null,Tc=m.AFrameworkApplication.V2b||m.AFrameworkApplication.iua,vd=this.ouc?this.ouc.getStatus():null;return new Ja(this.clientId,qa,this.color,this.capabilities,Rb,this.iVc,Jb,this.client,this.chatThreadDiscoveryUri,Tc,this.inChat,this.isReadOnly,vd)}}Object(f.a)(nb,"MyPresenceUser",Ja,[1774,700]);var ub=d(23),Yb=d(94),yb=d(255);class Za{constructor(qa,
Jb,Rb,Tc,vd){this.Me=qa;this._clientId=Jb;this.Itk=vd;this.Cxk=Rb||(()=>null);this.Dxk=Tc||(()=>null)}get id(){return this.Me.id}get DQd(){return this.Me.DQd}get HQd(){return this.Me.HQd}get GQd(){return this.Me.GQd}get FQd(){return this.Me.FQd}get EQd(){return this.Me.EQd}get JQd(){return this.Me.JQd}get Zdf(){return this.Me.Zdf}get qyc(){return this.Me.qyc}get BAe(){return this.Me.BAe}get ble(){return this.Me.ble}get clientId(){return this._clientId}get Alc(){return this.Cxk}get pWa(){return this.Dxk}get AVl(){return this.Itk}static createInstance(qa,
Jb,Rb,Tc,vd=!1){return new Za(qa,Jb,Rb,Tc,vd)}}Object(f.a)(Za,"PeoplesWellSettings",null,[]);var Ya=d(104),Pa=d(73),rb=d(184),tb=d(119),ob=d(218),Oa=d(240),Xa=d(439),ab=d(366);class cb extends ob.a{constructor(){super();this.JoinTimeInMS=0;this.IsAnonymous=!1;this.ImageUrl=null;this.CanJump=this.ActiveStatus=!1;this.Upn=null}get ControlType(){return 5}}Object(f.a)(cb,"PeopleButtonProps",ob.a,[]);var ib=d(510),Ub=d(19),lb=d(95);class Qb{constructor(qa){this.kud=new lb.a;this.Hvf=null;this.clientId=
qa}KZo(qa){this.nxo();this.$Ro(qa);for(const Jb of qa)Jb.clientId!==this.clientId&&this.lPh(Jb)}get LNg(){const qa=[];for(const Jb of this.kud.values){const Rb=this.LKj(Jb);Array.add(qa,Rb)}return qa}get svb(){return this.kud.count}agf(qa,Jb){qa=qa.toUpperCase();let Rb;({value:Rb}=this.kud.Dc(qa)).returnValue||(Rb=[],this.kud.Z(qa,Rb));Array.add(Rb,Jb)}nxo(){this.kud=new lb.a}$Ro(qa){for(const Jb of qa)if(Jb.clientId===this.clientId){this.Hvf=Jb;break}}}Object(f.a)(Qb,"UserTracker",null,[1551]);class fc extends Qb{constructor(qa,
Jb){super(qa);this.Exk=Jb}lPh(qa){qa.isAnonymous||!qa.email?this.agf(qa.clientId,qa):this.Hvf&&I.a.th().equals(this.Hvf.email,qa.email)||this.agf(qa.email,qa)}LKj(qa){let Jb=new Date(0),Rb=0<qa.length?qa[0]:null;for(const Tc of qa)(qa=this.Exk(Tc.clientId))&&Jb.getTime()<qa.sqc.getTime()&&(Jb=qa.sqc,Rb=Tc);return Rb}}Object(f.a)(fc,"UniqueUserTracker",Qb,[]);class Fc extends Qb{constructor(qa){super(qa)}lPh(qa){this.agf(qa.clientId,qa)}LKj(qa){return qa[0]}}Object(f.a)(Fc,"UserInstanceTracker",Qb,
[]);const nc=(qa,Jb,Rb)=>Rb?new fc(qa,Jb):new Fc(qa);var zb=d(75),Vb=d(649),rc=d(12);class pb{constructor(qa,Jb=null,Rb=null){this.iF=null;this.Raf=new w.a;this.QVn=(Tc,vd,Td,Ed,lf)=>{this.Raf.yV(lf.RenderTime);return 32};this.Me=qa;this.kqe=Jb;Rb&&Rb.continueWith(()=>{this.iF=Rb.result;this.iF.Scc(Object(Ya.a)(this,this.Rga,"onUsersUpdated"));this.Pte()});new ua.a(this.settings.clientId,"Anonymous user","#cccccc",new sa.a(7));this.nZf=this.aZe=!0;this.IUe=this.x4e=!1;this.mFa=nc(this.settings.clientId,
this.settings.pWa,qa.AVl)}get settings(){return this.Me}get vfn(){return m.AFrameworkApplication.K?m.AFrameworkApplication.K.$("ColorPresenceHashIsEnabled"):!1}get rfn(){return m.AFrameworkApplication.K?m.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled"):!1}vnm(){let qa,Jb,Rb,Tc;var vd=this.wnm();this.mFa.svb?1===this.mFa.svb?(qa=!0,Jb=this.settings.qyc.cluster,Rb=this.settings.qyc.pZd,Tc=this.mFa.LNg[0].color):(qa=!0,Jb=this.settings.ble.cluster,Rb=this.settings.ble.pZd,Tc=""):(qa=
!1,Tc=Rb=Jb="");const Td=vd[0];vd=vd.slice(1);return{q6n:Td,r6n:vd,m6n:qa,bfq:Jb,o6n:Rb,n6n:Tc}}wnm(){if(2<=this.mFa.svb)return[String.format(CommonUIStrings.l_PeoplesWellStateNumberOfOtherPeopleEditingHere,this.mFa.svb)];if(1===this.mFa.svb){const qa=this.mFa.LNg[0],Jb=this.settings.pWa(qa.clientId);return Jb&&2===Jb.status?[CommonUIStrings.l_PeoplesWellStateUserIsInactive,qa.userName]:[qa.isReadOnly?CommonUIStrings.l_PeoplesWellStateUserIsAlsoViewing:CommonUIStrings.l_PeoplesWellStateUserIsAlsoEditing,
qa.userName]}return[CommonUIStrings.l_PeoplesWellStateYouAreAllByYourself]}nQm(qa){return this.oQm(qa)}J_h(qa,Jb,Rb){return Jb?this.fll(Jb)?(qa=this.settings.pWa(qa))&&2===qa.status?!1:!0:(Rb&&l.ULS.sendTraceTag(4482394,325,50,"User has presence data but app can't use it"),!1):(Rb&&l.ULS.sendTraceTag(4482393,325,50,"User does not have any presence data"),!1)}LLm(qa){return qa.isReadOnly?CommonUIStrings.l_PeoplesWellUserStatusIsViewingOffline:CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown}oQm(qa){if(!qa.capabilities.bLa(1))return this.LLm(qa);
const Jb=qa.isReadOnly,Rb=this.settings.pWa(qa.clientId);qa=this.settings.Alc(qa.clientId);if(!Rb)return CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown;switch(Rb.status){case 1:return qa?Jb?CommonUIStrings.l_PeoplesWellUserStatusIsViewingOnline:this.NBl(qa)||CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown:CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown;case 2:return CommonUIStrings.l_PeoplesWellUserStatusIsInactive;default:return CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown}}Vvm(qa){if(this.kqe.Dad)return this.kqe.KMb(qa.email,
"O365",m.AFrameworkApplication.jm,0)}aQm(qa){qa=this.settings.pWa(qa.clientId);return!qa||qa&&1===qa.status?!0:!1}dQm(qa){var Jb=String.format("buttonPeoplesWellUser-{0}",qa.clientId),Rb=qa.clientId,Tc=this.nQm(qa);const vd=qa.userName,Td=qa.color;var Ed=Object,lf=Ed.assign,Bf=new cb,vf=this.settings.JQd.toString(),fd=this.settings.BAe.cluster,Wc=this.settings.BAe.pZd,sg=this.Axi(),Jf=qa.isAnonymous,Qk;if(Qk=[vd],Qk.length){var $e=new Sys.StringBuilder("STRARRY@");for(const Ei of Qk)$e.append(Ei?
Ei.length:0),$e.append(","),$e.append(Ei),$e.append(",");Qk=$e.toString().slice(0,-1)}else Qk=null;Jb=lf.call(Ed,Bf,{Id:Jb,Command:vf,LabelText:"{0}",Image32by32:fd,Image32by32Class:Wc,MenuItemId:Rb,CommandValueId:Rb,Alt:vd,DisplayMode:sg,LabelCss:"display:block; max-width:160px; padding:0px; white-space:normal; word-wrap:break-word",Description:Tc,ImageBackColor:Td,IsAnonymous:Jf,LabelTextUserGeneratedPlaceholderReplacements:Qk,Upn:qa.email});m.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled")&&
this.kqe&&(Rb=this.Vvm(qa),Tc=this.aQm(qa),Jb.ImageUrl=Rb,Jb.ActiveStatus=Tc,Jb.JoinTimeInMS=qa.YXa,qa=this.J_h(qa.clientId,this.settings.Alc(qa.clientId),!1),Jb.CanJump=qa,""===Rb&&l.ULS.sendTraceTag(40969413,302,50,"ImageURL collection failed"));return Jb}dum(){return Object.assign(new ob.a,{Id:"BasicChat",Command:"2288458806",LabelText:CommonUIStrings.l_StartGroupChat,LabelCss:"display:block; max-width:160px; padding:0px; white-space:normal; word-wrap:break-word"})}Axi(){return this.vfn?"Initials":
"Menu32"}eQm(qa){const Jb=[];for(const Rb of qa)qa=this.dQm(Rb),Array.add(Jb,qa);return Jb}Tde(){return 0<this.mFa.svb}hlo(qa){if(!this.aZe)return!0;this.nZf||(qa[Vb.a.Visible]=!0);const {q6n:Jb,r6n:Rb,m6n:Tc,o6n:vd,n6n:Td}=this.vnm();qa[Vb.a.LabelText]=Jb;Rb&&Rb.length&&(qa[Vb.a.LabelTextUserGeneratedPlaceholderReplacements]=Rb);qa[Vb.a.ImageIsVisible]=Tc;qa[Vb.a.Image16by16Class]=vd;qa[Vb.a.ImageBackColor]=Td;this.aZe=!1;return!0}lco(qa){if(0>=this.mFa.svb)return!1;var Jb=this.v$o(this.mFa.LNg),
Rb=this.eQm(Jb);Jb=Object.assign(new Xa.a,{Id:"menuCoauthors",MaxWidth:"220px",MenuSectionList:[]});Rb=Object.assign(new ab.a,{Id:"msCoauthors",ControlsId:"msCoauthorsControls",DisplayMode:this.Axi(),ControlList:Rb});m.AFrameworkApplication.K.$("WordEditorDisplayPeoplesWellLabelIsEnabled")&&this.kqe&&(Rb.Title=CommonUIStrings.l_PeoplesWellFlyoutLabel,Rb.TitleId="menuCoauthorsTitle",Rb.Theme="Light");Array.add(Jb.MenuSectionList,Rb);m.AFrameworkApplication.K.$("DocChatIsEnabled")&&m.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled")&&
m.AFrameworkApplication.ua&&m.AFrameworkApplication.ua.Ib.Hs&&(Rb=[],Array.add(Rb,this.dum()),Rb=Object.assign(new ab.a,{Id:"msGroupChat",ControlsId:"msGroupChatControl",ControlList:Rb}),Array.add(Jb.MenuSectionList,Rb));m.AFrameworkApplication.ua&&m.AFrameworkApplication.ua.Ib.Hs?qa.MenuItems=Jb:qa.PopulationXML=Oa.o(Jb);return!0}JNg(qa){l.ULS.sendTraceTag(4482395,325,50,"PeoplesWell: Received user button click");qa=qa.MenuItemId;if(!qa)return!1;const Jb=this.settings.Alc(qa);if(!this.J_h(qa,Jb,
!0))return!1;this.mvn(Jb);return!0}Mro(){const qa=this.uhm();this.mFa.KZo(qa);this.nZf&&1<=this.mFa.svb&&(l.ULS.sendTraceTag(6092429,325,50,"PeoplesWell: User is no longer forever alone."),this.nZf=!1);this.aZe=!0}Rga(){this.IUe||(window.setTimeout(()=>{this.Pte();this.IUe=!1},3E3),this.IUe=!0)}uhm(){let qa;qa=this.thm()||[];for(const Jb of qa)this.mKo(Jb);return qa}mKo(qa){qa.clientId||(qa.clientId=M.a.create().toString());qa.userName||(qa.userName="Anonymous user");qa.capabilities||(qa.capabilities=
new sa.a);qa.color||(qa.color="#cccccc");qa.YXa||(qa.YXa=0)}v$o(qa){const Jb=[];Array.addRange(Jb,qa);Jb.sort(pb.X5n);return Jb}pvo(){m.AFrameworkApplication.K.$("CoauthorGalleryTelemetryIsEnabled")&&!this.x4e&&(m.AFrameworkApplication.va.d3(rc.a.w4h)&&ib.a.isSharedUxGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.DoNotRegisterCoauthorsRenderedMultiplTimes")||m.AFrameworkApplication.va.fb(rc.a.w4h,zb.a.frame,this.QVn,96));this.qvo();this.x4e=!0;this.Pte()}get R0j(){return this.Raf.task}Pte(){if(!this.x4e&&
(this.Raf.yV((new Date).getTime()),l.ULS.sendTraceTag(42567504,325,50,"We are trying to render the coauthor gallery before we are ready to record the render time"),this.rfn))return;this.Mro();this.Nro()}dispose(){this.iF&&(this.iF.wtg(Object(Ya.a)(this,this.Rga,"onUsersUpdated")),this.iF=null)}static X5n(qa,Jb){return qa.capabilities.bLa(1)&&Jb.capabilities.bLa(1)||!qa.capabilities.bLa(1)&&!Jb.capabilities.bLa(1)?Ub.a.localeCompare(qa.userName,Jb.userName):qa.capabilities.bLa(1)?-1:1}}Object(f.a)(pb,
"APeoplesWell",null,[1494,13]);var bb=d(11);const Pb=()=>!0;class mb extends pb{constructor(qa,Jb,Rb=null,Tc=null){super(qa,Rb,Tc);this.jgn=(vd,Td,Ed,lf,Bf)=>this.Z9a(Ed,Bf,()=>this.Tde(),Pb);this.ilo=(vd,Td,Ed,lf,Bf)=>this.Z9a(Ed,Bf,vf=>this.hlo(vf),Pb);this.mco=(vd,Td,Ed,lf,Bf)=>this.Z9a(Ed,Bf,Pb,vf=>this.lco(vf));this.qvl=(vd,Td,Ed,lf,Bf)=>this.Z9a(Ed,Bf,Pb,Pb);this.pvl=(vd,Td,Ed,lf,Bf)=>this.Z9a(Ed,Bf,Pb,Pb);this.$Bp=(vd,Td,Ed,lf,Bf)=>this.Z9a(Ed,Bf,Pb,vf=>this.JNg(vf));this.V$n=(vd,Td,Ed,lf,
Bf)=>this.Z9a(Ed,Bf,Pb,()=>{this.Pte();return!0});this.ga=Jb}Z9a(qa,Jb,Rb,Tc){let vd=!1;switch(qa){case 1:vd=Rb(Jb);break;case 2:vd=Tc(Jb)}return vd?32:8}qvo(){this.ga.ra(this.settings.DQd,bb.a.application,this.jgn);this.ga.fb(this.settings.HQd,bb.a.application,this.ilo,96);this.ga.fb(this.settings.FQd,bb.a.application,this.qvl,96);this.ga.fb(this.settings.EQd,bb.a.application,this.pvl,96);this.ga.fb(this.settings.GQd,bb.a.application,this.mco,96);this.ga.ra(this.settings.JQd,bb.a.application,this.$Bp);
this.ga.fb(this.settings.Zdf,bb.a.application,this.V$n,96)}}Object(f.a)(mb,"ABox4PeoplesWell",pb,[]);var Ua=d(3),vb=d(22),Ia=d(52),Ma=d(8),qb=d(28),Xb=d(178);class Cc{static isSupported(qa){for(let Jb=0;Jb<Cc.tZj.length;Jb++)if(qa===Cc.tZj[Jb])return!0;return!1}}Cc.tZj=[1];Object(f.a)(Cc,"RTTDataVersion",null,[]);var Ec=d(1705);const Wb=qa=>{if("number"!==typeof qa.RK||"number"!==typeof qa.DK)return!1;let Jb,Rb=!1,Tc=!1,vd=!1;switch(qa.RK){case 0:Tc=Jb=!0;break;case 1:vd=Rb=Tc=Jb=!0;break;case 2:if(null!=
qa.PE&&"number"!==typeof qa.PE)return!1;Jb=!0;break;case 4:Jb=!0;break;case 3:Tc=Jb=!0;break;case 5:Rb=Jb=!0;break;default:return!1}return Jb&&("number"!==typeof qa.PS||"number"!==typeof qa.TS)||Tc&&("object"!==typeof qa.OS||!qa.OS||!Ec.validateVersionedCpData(qa.OS))||Rb&&("number"!==typeof qa.PE||"number"!==typeof qa.TE)||vd&&("object"!==typeof qa.OE||!qa.OE||!Ec.validateVersionedCpData(qa.OE))?!1:!0},Hb=qa=>{let Jb="";if("number"!==typeof qa.I)return{returnValue:!1,Jla:"Invalid PacketId Type"};
if("number"!==typeof qa.O)return{returnValue:!1,Jla:"Invalid Operation Type"};if("string"!==typeof qa.A)return{returnValue:!1,Jla:"Invalid ClientId Type"};if("object"!==typeof qa.AN)return{returnValue:!1,Jla:"Invalid Anchor Object Type"};if(!qa.AN)return{returnValue:!1,Jla:"Null AnchorObject"};if(!Wb(qa.AN)){let Rb;try{Rb=Q.c(qa.AN)}catch(Tc){Rb=String.format("Failed to JSON-serialize payload : {0}",Tc)}8E3<Rb.length&&(Rb=String.format("Payload exceeds maximum length: {0} > {1}, not logging",Rb.length,
8E3));Jb="Invalid AnchorObject: "+Rb+", Client: "+qa.C;return{returnValue:!1,Jla:Jb}}return!qa.O&&qa.AN.RK?(Jb="Invalid RangeKind:"+qa.AN.RK+" for Caret",{returnValue:!1,Jla:Jb}):2===qa.O&&("number"!==typeof qa.TF||"undefined"!==typeof qa.TX&&"string"!==typeof qa.TX||1!==qa.AN.RK&&qa.AN.RK)?{returnValue:!1,Jla:"Invalid TypingData"}:3!==qa.O||"object"===typeof qa.AP&&qa.AP&&"number"===typeof qa.AP.TFA&&"number"===typeof qa.AP.PN&&"number"===typeof qa.AP.TN&&2===qa.AN.RK?6!==qa.O||"object"===typeof qa.MP&&
qa.MP&&"number"===typeof qa.MP.PM&&"number"===typeof qa.MP.TM&&5===qa.AN.RK?4!==qa.O||"object"===typeof qa.SP&&qa.SP&&"number"===typeof qa.SP.PA&&"number"===typeof qa.SP.TA&&"number"===typeof qa.SP.PB&&"number"===typeof qa.SP.TBS&&3===qa.AN.RK&&(qa.AN.PS===qa.SP.PA||qa.AN.PS===qa.SP.PB)?7!==qa.O||"object"===typeof qa.SPS&&qa.SPS&&"string"===typeof qa.SPS.SF&&"boolean"===typeof qa.SPS.SL?null!=qa.ISS&&"number"!==typeof qa.ISS?{returnValue:!1,Jla:"invalid StrictlySequentialId"}:{returnValue:!0,Jla:Jb}:
{returnValue:!1,Jla:"Invalid SymbolData"}:{returnValue:!1,Jla:"Invalid SplitParaData"}:{returnValue:!1,Jla:"Invalid RemoveParaData"}:{returnValue:!1,Jla:"Invalid AddParaData"}};var Sb=d(1678);class cc{constructor(qa,Jb=null,Rb=null){this.M4=this.tjg=this.AIg=null;null!=qa&&(this.AIg=qa);null!=Jb&&(this.tjg=Jb);null!=Rb&&(this.M4=Rb)}}Object(f.a)(cc,"AddParaData",null,[]);class Gc{constructor(qa=null,Jb=null){this.Izc=this.sjg=null;null!=qa&&(this.sjg=qa);null!=Jb&&(this.Izc=Jb)}}Object(f.a)(Gc,"MergeRemoveParaData",
null,[]);class Oc{constructor(qa,Jb,Rb,Tc,vd,Td,Ed=null,lf=null,Bf=null,vf=null,fd=null,Wc=null,sg=0,Jf=null){this.lrd=this.text=this.E1b=this.Y0b=this.Ddd=this.Dcc=this.toa=null;this.packetId=qa;this.client=Rb;this.operationType=Tc;this.clientId=Jb.toLowerCase();this.yW=vd;this.version=sg;Td&&(this.toa=Td);null!=Ed&&(this.E1b=Ed);void 0!==lf&&null!==lf&&(this.text=lf);Bf&&(this.Dcc=Bf);vf&&(this.Ddd=vf);fd&&(this.Y0b=fd);Wc&&(this.lrd=Wc);this.strictlySequentialId=Jf}}Object(f.a)(Oc,"RTTData",null,
[]);class Zc{constructor(qa=null,Jb=null,Rb=null,Tc=null){this.zIg=this.rjg=this.wIg=this.qjg=null;null!=qa&&(this.qjg=qa);null!=Jb&&(this.wIg=Jb);null!=Rb&&(this.rjg=Rb);null!=Tc&&(this.zIg=Tc)}}Object(f.a)(Zc,"SplitParaData",null,[]);class kb{constructor(qa=null,Jb=null){this.aHg=this.$Gg=null;qa&&(this.$Gg=qa);null!=Jb&&(this.aHg=Jb)}}Object(f.a)(kb,"SymbolData",null,[]);class wd{constructor(qa,Jb=null,Rb=null){null!=qa&&(this.TFA=qa);null!=Jb&&(this.PN=Jb);null!=Rb&&(this.TN=Rb)}}Object(f.a)(wd,
"SerializableAddParaDataV1",null,[]);class qe{constructor(qa=null,Jb=null){null!=qa&&(this.PM=qa);null!=Jb&&(this.TM=Jb)}}Object(f.a)(qe,"SerializableMergeRemoveParaDataV1",null,[]);class Qd{}Object(f.a)(Qd,"SerializableRTTDataV1",null,[]);class me{constructor(qa=null,Jb=null,Rb=null,Tc=null){null!=qa&&(this.PA=qa);null!=Jb&&(this.TA=Jb);null!=Rb&&(this.PB=Rb);null!=Tc&&(this.TBS=Tc)}}Object(f.a)(me,"SerializableSplitParaDataV1",null,[]);class Ne{constructor(qa=null,Jb=null){qa&&(this.SF=qa);null!=
Jb&&(this.SL=Jb)}}Object(f.a)(Ne,"SerializableSymbolDataV1",null,[]);const Cd=qa=>{var Jb;if(!({Jla:Jb}=Hb(qa)).returnValue)return l.ULS.sendTraceTag(9188759,302,15,"Failed to parse RTT packet, InvalidFieldInfo {0}",Jb),null;let Rb=Jb=null,Tc=null,vd=null,Td=null,Ed=null,lf=null,Bf=null;qa.WD&&(Jb=qa.WD);null!=qa.TF&&(Rb=qa.TF);void 0!==qa.TX&&null!==qa.TX&&(Tc=qa.TX);qa.AP&&(vd=new cc(qa.AP.TFA,qa.AP.PN,qa.AP.TN));qa.MP&&(Td=new Gc(qa.MP.PM,qa.MP.TM));qa.SP&&(Ed=new Zc(qa.SP.PA,qa.SP.TA,qa.SP.PB,
qa.SP.TBS));qa.SPS&&(lf=new kb(qa.SPS.SF,qa.SPS.SL));null!=qa.ISS&&(Bf=qa.ISS);return new Oc(qa.I,qa.A,qa.C,qa.O,Sb.a(qa.AN),Jb,Rb,Tc,vd,Td,Ed,lf,1,Bf)},Pf=qa=>{let Jb=qa;if("number"===typeof Jb.V){if(1===Jb.V)return Cd(qa);l.ULS.sendTraceTag(9188758,302,15,"Unsupported Version");return null}let Rb=0,Tc=null;for(let vd=0;vd<qa.length;vd++)Jb=qa[vd],Cc.isSupported(Jb.V)&&Jb.V>Rb&&(Rb=Jb.V,Tc=qa[vd]);return 1===Rb?Cd(Tc):null},cg=qa=>{if(qa){const Jb=new Qd;Jb.I=qa.packetId;Jb.V=1;Jb.A=qa.clientId;
Jb.C=qa.client;Jb.O=qa.operationType;Jb.AN=Sb.c(qa.yW);qa.toa&&(Jb.WD=qa.toa);null!=qa.E1b&&(Jb.TF=qa.E1b);void 0!==qa.text&&null!==qa.text&&0<qa.text.length&&(Jb.TX=qa.text);qa.Dcc&&(Jb.AP=new wd(qa.Dcc.AIg,qa.Dcc.tjg,qa.Dcc.M4));qa.Ddd&&(Jb.MP=new qe(qa.Ddd.sjg,qa.Ddd.Izc));qa.Y0b&&(Jb.SP=new me(qa.Y0b.qjg,qa.Y0b.wIg,qa.Y0b.rjg,qa.Y0b.zIg));qa.lrd&&(Jb.SPS=new Ne(qa.lrd.$Gg,qa.lrd.aHg));Jb.ISS=qa.strictlySequentialId;qa=Jb}else qa=null;return qa};var mg=d(54);class ci{constructor(qa,Jb,Rb,Tc,vd,
Td,Ed,lf,Bf){this.LocalCobaltSessionId=qa;this.SkypeChatThreadId=Jb;this.ChatThreadDiscoveryUri=Rb;this.InChat=Tc;this.Capabilities=vd;this.Email=Td;this.UserName=Ed;this.IsAnonymous=lf;this.PresenceStatus=Bf}}Object(f.a)(ci,"SerializableWacData",null,[]);class Dd{constructor(){this.mNd=this.lNd=0}vBm(){this.mNd===Number.MAX_VALUE&&(this.mNd=0);this.mNd++;return this.mNd}uBm(){this.lNd===Number.MAX_VALUE&&(this.lNd=0);this.lNd++;return this.lNd}static get instance(){return Dd.DOk}}Dd.DOk=new Dd;Object(f.a)(Dd,
"StrictlySequentialIdGenerator",null,[792]);var Xc=d(1600);class Jd{constructor(qa,Jb,Rb,Tc,vd,Td,Ed,lf=0){this.bya=null;this.dryDeletion=0;this.$K=qa;this.vSa=Td;this.yd=vd;this.IJb=Ed;this.Yc=Jb;this.shapeId=lf;this.pNa=Rb;this.tca=Ed.create(this,Tc,vd,Td)}clone(){return new Jd(this.$K,this.Yc,this.pNa,this.tca.q3b,this.yd,this.vSa,this.IJb,this.shapeId)}get paragraphId(){return this.bya?this.bya:this.$K.brb(this.Yc)}Ngg(){this.bya||(this.bya=this.paragraphId,this.tca.Ngg())}isValid(){return 0<=
this.tca.cp}getData(){const qa=this.tca.q3b;return qa?new Xc.a(0,this.Yc,this.pNa,qa,null,null,null,0,this.shapeId):null}static vMb(qa,Jb,Rb,Tc,vd){return Jb?new Jd(Jb,parseInt(qa.iZa),qa.bfb,qa.ZU,Rb,Tc,vd,qa.shapeId):null}}Object(f.a)(Jd,"WordPresenceIp",null,[784,96,785]);class pf{constructor(qa,Jb,Rb){this.N_a=this.mga=this.vLc=!1;this.akb=qa;this.e3a=Rb;this.user=Jb}get ip(){return this.e3a}get wrc(){return this.vLc}set wrc(qa){(this.vLc=qa)&&this.ip.Ngg()}aOf(){const qa=Dd.instance.uBm();return new Oc(this.akb,
this.user.clientId,1,0,this.ip?this.ip.getData():null,new ci(this.user.IF,this.user.iVc,this.user.chatThreadDiscoveryUri,this.user.inChat,this.user.capabilities.capabilities,this.user.email,this.user.userName,this.user.isAnonymous,this.user.presenceStatus),void 0,void 0,void 0,void 0,void 0,void 0,void 0,qa)}Bzi(){return this.user.clientId+(this.ip?this.ip.paragraphId.toString():mg.a.nil.toString())}isValid(){const qa=!!this.user&&this.user.isValid(),Jb=!this.ip||this.ip.isValid();return qa&&Jb}clone(){const qa=
new pf;qa.akb=this.akb;qa.vLc=this.vLc;qa.user=this.user?this.user.clone():null;qa.e3a=this.ip?this.ip.clone():null;qa.mga=this.mga;qa.N_a=this.N_a;return qa}static Etf(qa,Jb,Rb,Tc,vd){if(!qa||!Jb)return null;if(qa.operationType)return l.ULS.sendTraceTag(7685324,302,15,"Presence packet is of unexpected operationType {0}",qa.operationType),null;let Td;Td=void 0!==qa.toa&&null!==qa.toa?Ja.z$h(qa.clientId,qa.toa.UserName,qa.toa.Capabilities,qa.toa.LocalCobaltSessionId,qa.toa.SkypeChatThreadId,qa.toa.Email,
qa.client,qa.toa.ChatThreadDiscoveryUri,qa.toa.InChat,!1,qa.toa.IsAnonymous,qa.toa.PresenceStatus):Ja.z$h(qa.clientId,null,0,void 0,void 0,void 0,qa.client);return new pf(qa.packetId,Td,Jd.vMb(qa.yW,Jb,Rb,Tc,vd))}}Object(f.a)(pf,"WordPresenceInfo",null,[783,96]);class Ce extends mb{constructor(qa,Jb,Rb,Tc,vd,Td,Ed,lf,Bf,vf,fd,Wc,sg,Jf){super(qa,Td,Jf,Jb);this.cqk=Rb;this.fMk=Tc;this.wKk=vd;this.hb=Ed;Ce.Sy=lf;this.$K=Bf;this.yd=vf;this.vSa=fd;this.Bdf=Wc;this.xQa=sg}JNg(qa){this.xQa.a5i(qa.CommandValueId);
return super.JNg(qa)}mvn(qa){let Jb;({rmg:Jb}=this.d0f(qa)).returnValue&&(this.fMk(Jb.ip.paragraphId,Jb.ip.tca.cp),m.AFrameworkApplication.K.$("WordEditorMoveIpToUserLocationIsEnabled")&&(qa=Ce.pKm(Jb),void 0!==qa&&null!==qa?(l.ULS.sendTraceTag(20764574,325,50,"Attempting to move IP to the editing location of the selected user"),this.hb.Ic(qa),Pa.FocusManager.vM()&&Pa.FocusManager.instance().Bg(rb.AFrame.Ho)):l.ULS.sendTraceTag(20764575,325,50,"IP will not be moved since the selection is either null or undefined")),
qa=new oa.a(2,1,0,()=>{this.ga.Pb(Ua.a.bAe,2,Jb)}),tb.a.instance.Zb(qa))}cFi(qa){return qa?(qa=pf.Etf(Pf(qa),this.$K,this.yd,this.vSa,this.Bdf.instance))&&qa.isValid()&&qa.ip?qa:null:null}fll(qa){return this.Ron(qa)?this.wll(qa)?!0:(l.ULS.sendTraceTag(41236613,325,50,"Cannot jump to user location because paragraph has not been loaded yet"),!1):(l.ULS.sendTraceTag(41236612,325,50,"Cannot jump to user location because presence is not valid"),!1)}Ron(qa){return!!this.cFi(qa)}d0f(qa){qa=this.cFi(qa);
return{returnValue:!!qa,rmg:qa}}wll(qa){let Jb;return({rmg:Jb}=this.d0f(qa)).returnValue?this.cqk(Jb.ip.paragraphId,Jb.ip.tca.cp):!1}thm(){if(!this.iF)return[];const qa=[];for(const Jb of this.iF.pqb())Jb.userName?qa.push(Jb):l.ULS.sendTraceTag(592229832,304,15,"The looked up RTC User has no name");return qa}NBl(qa){let Jb;return({rmg:Jb}=this.d0f(qa)).returnValue&&Jb.user&&Jb.user.presenceStatus&&"0"!==Jb.user.presenceStatus?String.format(WordEditorIntl.WordEditorStrings.l_PresenceStatusOnPage,Jb.user.presenceStatus):
CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown}Nro(){this.wKk(this.settings.id)}static createInstance(qa,Jb,Rb,Tc,vd,Td,Ed){const lf=ub.StaticActiveAppFrame.za().ib,Bf=m.AFrameworkApplication.va,vf=Ia.a.instance,fd=Fa.a.instance.resolve("Box4.ICoauthCashTelemetry");return new Ce(qa,Jb,Wc=>lf.sc.nj?lf.sc.Knf(Wc,!0):!1,(Wc,sg)=>{lf.sc.nj&&lf.sc.Pxb(Wc,sg,!0,!0,!1)},()=>{vb.App.Ew.kL.Ftd()},Bf,vf,lf,Rb,Tc,vd,Td,fd,Ed)}static pKm(qa){const Jb=Ce.Sy.$c.td.Eb(qa.ip.paragraphId);if(void 0===Jb||
null===Jb)return l.ULS.sendTraceTag(20764576,325,15,"The node could not be obtained"),null;if(!Ma.ParagraphReader.Xb(Jb))return l.ULS.sendTraceTag(20764577,325,15,"The obtained node is not a paragraph node"),null;qa=qb.a.Tc(Jb,qa.ip.tca.cp);return new Xb.Selection([qa],!0)}}Ce.Sy=null;Object(f.a)(Ce,"WordEditorPeoplesWell",mb,[]);class pc{constructor(){this.pz=()=>{m.AFrameworkApplication.Jsj?pc.vva.gD().continueWith(this.Xfd):l.ULS.sendTraceTag(23196872,325,50,"PeoplesWell control is explicitly disabled. Skipping initialization attempt")};
this.Xfd=()=>{pc.Yh=pc.vva.gD().result;if(pc.Yh){var qa=()=>{const Jb=ub.StaticActiveAppFrame.za().ib;return Jb?Jb.$c?Jb.$c.td:(l.ULS.sendTraceTag(23196876,325,15,"ActivePage is null"),null):(l.ULS.sendTraceTag(23196875,325,15,"Workspace is null"),null)};Yb.StaticTheCoauthManager.bta().continueWith(()=>{const Jb=Yb.StaticTheCoauthManager.bta().result.Sj,Rb=yb.a.qFm(m.AFrameworkApplication.Ys,m.AFrameworkApplication.Ys,m.AFrameworkApplication.Ys,m.AFrameworkApplication.Ys),Tc=Za.createInstance(Rb,
Jb,Object(Ya.a)(pc.Yh.Vve,pc.Yh.Vve.Alc,"getUserPresence"),Object(Ya.a)(pc.Yh.Vve,pc.Yh.Vve.pWa,"getUserStatusInfo"),m.AFrameworkApplication.K.$("WordEditorPresenceDedupeMultipleCoauthorInstances"));Fa.a.instance.ia("RealtimePresenceUI.WordEditorPeoplesWell",()=>Ce.createInstance(Tc,Qa.a.$p(pc.W.Qa("Common.IPeopleInfoProvider")),pc.W.Oa("WordEditor.ParagraphWordIdMapping"),pc.W.Oa("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),qa,pc.W.Qa("WordEditor.Presence.IWordPresenceCpFactory"),
pc.W.resolve("Common.App.People.IPeopleManager"))).as("Common.IPeoplesWell").ha();pc._instance=Fa.a.instance.resolve("Common.IPeoplesWell");pc._instance.pvo();l.ULS.sendTraceTag(23196877,325,50,"PeoplesWellControl is fully initialized")})}else l.ULS.sendTraceTag(23196873,325,15,"Can't initialize the PeoplesWell control because can't get a handle to RtcProxy")}}get name(){return"WordEditor.PeoplesWellControl"}wc(qa){pc.W=qa}init(){m.AFrameworkApplication.K.Rn(this.pz)}dispose(){pc._instance&&(pc._instance.dispose(),
pc._instance=null)}static get vva(){return null!=pc.F3g?pc.F3g:pc.F3g=Fa.a.instance.resolve("Box4.Presence.IRtcProxyProvider")}}pc._instance=null;pc.W=null;pc.Yh=null;Object(f.a)(pc,"WordEditorPeoplesWellControlPackage",null,[0,1]);var $c=d(110),id=d(173);class de{constructor(qa,Jb,Rb,Tc,vd,Td,Ed,lf,Bf=!1){this.xgb=null;this.USe=!0;this.c5e=this.Kl=this.CLe=null;this.sa=new ja.a;this.x5m=()=>{this.AO.result&&this.oAh.result&&(this.Kl=this.AO.result,this.c5e=this.oAh.result,this.Kl.jza(this.aV),this.CLe=
new oa.a(2,2,this.f$g,this.Wtp,88),de.Gb.Zb(this.CLe))};this.aV=(vf,fd)=>{(this.USe||this.uoo(fd.$ha))&&de.Gb.q4(this.CLe,0)};this.Wtp=vf=>{var fd=this.Kl.tjc();if(fd){var Wc=new Date,sg=!1;if(this.USe){this.xgb=fd;this.USe=!1;var Jf=this.xgb;for(var Qk in Jf){fd=Qk;var $e=Jf[Qk];$e.sqc<Wc&&(Wc=$e.sqc);2===$e.status&&(sg=!0,this.c5e.Wkd(fd))}sg&&this.pyj();de.Gb.q4(vf,this.QCi(Wc))}else{$e=new N.a;Qk=!1;var Ei=this.xgb;for(Jf in Ei){Ei=Jf;if(!(Ei in this.xgb)||this.pSa.clientId===Ei)continue;var ve=
this.xgb[Ei];const Ad=fd[Ei];if(ve&&Ad){ve=ve.status;const re=Ad.status;2===ve&&1===re?($e.add(Ei),l.ULS.sendTraceTag(38052609,392,50,Ei+" returned from away")):1===ve&&2===re&&(Qk=sg=!0,this.c5e.Wkd(Ei),l.ULS.sendTraceTag(38052610,392,50,Ei+" went away"));1===re&&Ad.sqc<Wc&&(Wc=Ad.sqc)}}this.xgb=fd;de.Gb.q4(vf,this.QCi(Wc));(0<$e.count||sg)&&this.pyj();0<$e.count&&!this.GKk?(vf=this.Jlm($e),this.Ckp(vf)):vf=new N.a;(Qk||0<vf.count)&&this.xJk(rc.a.BWd,2)}}};this.pSa=qa;this.AO=Jb;this.oAh=Rb;this.SNc=
Tc;this.f$g=Td;de.Gb=vd;this.xJk=Ed;this.z$=lf;this.GKk=Bf;z.Task.WAA(Jb,Rb).continueWith(this.x5m)}x2k(qa){this.sa.addHandler("u",qa)}pyj(){this.sa.raiseEvent("u",null,this)}uoo(qa){for(const Rb in qa){var Jb=this.SNc.U8d({key:Rb,value:qa[Rb]});if(Jb&&Jb.clientId&&(Jb=Jb.clientId.toLowerCase(),(Jb=this.xgb[Jb]||this.xgb[Jb.toUpperCase()])&&2===Jb.status))return!0}return!1}Ckp(qa){if(qa.count)for(const Jb of qa)qa=this.z$.nka(String.format(CommonUIStrings.l_EditorsToastArriving,Jb),!1),qa.image=5,
qa.Cla="CoAuth_AuthorStatus_16x16x32",this.z$.Uy(qa)}Jlm(qa){const Jb=this.Kl.oqb(),Rb=new N.a;for(const Tc in Jb){const vd={key:Tc,value:Jb[Tc]};if(qa.contains(vd.key)){const Td=this.SNc.U8d(vd);Td&&(Rb.add(Td.userName),qa.remove(vd.key))}}Rb.count||l.ULS.sendTraceTag(38052611,392,10,"There were no coauthor names found");return Rb}QCi(qa){const Jb=new Date;return Math.max(qa.getTime()+this.f$g-Jb.getTime(),0)}}de.Gb=null;Object(f.a)(de,"AwayManager",null,[]);var Ae=d(845);class gf{constructor(qa=
0){this.updates=qa}get TSf(){return 0!==this.updates}bLa(qa){return!!(this.updates&qa)}Ydb(qa){this.updates|=qa}toString(){if(this.bLa(0))return"none";const qa=new N.a;this.bLa(1)&&qa.add("user(s) joined");this.bLa(2)&&qa.add("user(s) disconnected");this.bLa(4)&&qa.add("user(s) updated");return qa.toArray().join(", ")}}Object(f.a)(gf,"UserUpdateEvent",null,[]);var uf=d(26);class Lf{constructor(qa,Jb,Rb,Tc,vd=null){this.sa=new ja.a;this.FM=this.Yh=null;this.Ovh=this.mwh=this.hm=!1;this.ir=new lb.a;
this.fNg=()=>{if(this.Yh){var Td=!1,Ed=this.Yh.tjc();for(const Bf in Ed){var lf=Ed[Bf];const vf=Bf;this.users.mb(vf)&&(lf=this.C2j(lf),Td=this.users.J(vf).LLb!==lf||Td,this.users.J(vf).LLb=lf)}Td&&(Td=new gf(4),this.$we(Td))}};this.Vnj=(Td,Ed)=>{2===Ed.newState&&(Td=this.b9f(this.Yh.oqb()),Td.TSf&&this.$we(Td))};this.kfd=(Td,Ed)=>{Td=new gf;var lf=this.FM.V1c();l.ULS.sendTraceTag(561894485,302,50,"editorstablemanager coauthors count is {0}, editorstableupdate old count of coauthors is {1}, editorstableupdate new count of coauthors is {2}",
lf.length,Ed.yTn,Ed.Pgj);const Bf=new lb.a;for(var vf of lf){lf=vf.Id;const fd=this.Mbi(lf);this.eNg(Td,fd);Bf.Z(lf,fd)}if((Ed=Ed.Y3f)&&0<Ed.length)for(vf=0;vf<Ed.length;vf++)l.ULS.sendTraceTag(562415168,302,50,"{0} users in coauth gallery. User leaving the editor table: {1}",this.users.count,Ed.J(vf).Id),({value:lf}=this.users.Dc(Ed.J(vf).Id)).returnValue?lf?(this.users.remove(Ed.J(vf).Id),Td.Ydb(2),Bf.Z(Ed.J(vf).Id,lf)):l.ULS.sendTraceTag(561287839,302,50,"Empty entry in PIP users: {0}",Ed.J(vf).Id):
l.ULS.sendTraceTag(570426140,302,15,"Disconnected user not found: {0}",Ed.J(vf).Id);Ed=this.Yh.oqb();for(const fd in Ed)vf=this.SNc.U8d({key:fd,value:Ed[fd]}),Bf.Z(vf.clientId,vf);for(const fd of this.users)Bf.mb(fd.value.clientId)||(l.ULS.sendTraceTag(561287840,302,15,"Coauth Gallery contains user not in Editors Table or RTC presence: {0}",fd.key),this.users.remove(fd.key),Td.Ydb(2));Td.TSf&&this.$we(Td)};this.Wnj=(Td,Ed)=>{Td=this.b9f(Ed.$ha);for(const lf of Ed.qZc)this.users.mb(lf)&&(Td.Ydb(2),
this.users.J(lf).LLb=2);Td.TSf&&this.$we(Td)};qa.continueWith(()=>{this.Yh=qa.result;this.Yh.jza(this.Wnj);this.Yh.b_(this.Vnj);this.fNg(null,null)});Jb.continueWith(()=>{this.FM=Jb.result;this.FM.dmb(this.kfd)});vd&&vd.continueWith(()=>{vd.result.x2k(this.fNg);this.fNg(null,null)});this.ISa=Rb;this.SNc=Tc}get users(){return this.ir}Scc(qa){this.sa.addHandler("UU",qa)}wtg(qa){this.sa.removeHandler("UU",qa)}C2j(qa){return 1===qa.status?0:1}pqb(){this.users.count||(this.mwh||(uf.b(42316242,302,50,"No users available at PeopleInfoProvider.GetAllUsers call"),
this.mwh=!0),this.Lco());const qa=[];for(const Jb of this.users)Array.add(qa,Jb.value);return qa}Lco(){if(this.Yh){var qa=this.Yh.oqb();this.b9f(qa)}if(this.FM){qa=this.FM.V1c();for(const Jb of qa)Jb.Id&&(qa=this.Mbi(Jb.Id),this.eNg(new gf,qa))}}l7f(qa){({value:qa}=this.users.Dc(qa));return qa}dispose(){this.hm||(this.Yh&&(this.Yh.$Za(this.Wnj),this.Yh.ZZa(this.Vnj)),this.FM&&this.FM.ADj(this.kfd),this.hm=!0)}b9f(qa){const Jb=new gf;if(!qa)return Jb;for(const Tc in qa){var Rb=this.SNc.U8d({key:Tc,
value:qa[Tc]});Rb&&(Rb=Rb.clone(),this.eNg(Jb,Rb))}return Jb}eNg(qa,Jb){if(Jb){var Rb=Jb.clientId,Tc=this.HGo(Jb);({value:Jb}=this.users.Dc(Rb)).returnValue?Jb.equals(Tc)||(qa.Ydb(4),this.users.Z(Rb,Tc)):(l.ULS.sendTraceTag(562415169,302,50,"{0} users in coauth gallery. User joining: {1}",this.users.count,Rb),qa.Ydb(1),this.users.Z(Rb,Tc))}}Mbi(qa){return this.users.mb(qa)?this.users.J(qa):ua.a.SFl(qa)}HGo(qa){if(!qa||!qa.clientId||!this.FM)return qa;const Jb=qa.clone();Jb.LLb=this.Ilm(qa);if(qa=
this.FM.Ljc(Jb.clientId))Jb.isReadOnly=Jb.isReadOnly||qa.IsReadOnly?!0:!1,Jb.userName=this.GGo(Jb,qa),Jb.capabilities=this.TLn(Jb.capabilities,qa.Capabilities),Jb.email=Jb.email||qa.SIPAddress||qa.EmailAddress,qa.JoinCoauthTime&&(Jb.YXa=qa.JoinCoauthTime);Jb.color=this.ISa.zlc(new Ae.a(Jb.email,void 0,Jb.userName,void 0,Jb.isAnonymous,Jb.clientId),3);return Jb}Ilm(qa){if(!this.Yh)return 2;if(qa&&qa.clientId){const Jb=this.Yh.tjc();if(qa.clientId in Jb)return this.C2j(Jb[qa.clientId])}return 2}axl(qa,
Jb){Jb.Name&&qa.userName&&Jb.Name!==qa.userName&&!this.Ovh&&(this.Ovh=!0,uf.b(42316243,302,15,"User names in EditorsTable and RTC don't match"))}TLn(qa,Jb){qa=qa||new sa.a;Jb&&(Jb.SupportsRealtimeChannel&&qa.Ydb(1),Jb.SupportsRename&&qa.Ydb(2),Jb.SupportsChat&&qa.Ydb(4));return qa}GGo(qa,Jb){this.axl(qa,Jb);return Jb.Name||qa.userName||(qa.isAnonymous||Jb.IsAnonymous?CommonUIStrings.l_GuestUserName:null)}$we(qa){l.ULS.sendTraceTag(42316245,302,100,"PeopleInfoProvider update detected: {0}",qa.toString());
this.sa.raiseEvent("UU")}}Object(f.a)(Lf,"PeopleInfoProvider",null,[1568,13]);var hg;(function(qa){qa[qa.cPn=0]="multipleBrowsersImageClassName";qa[qa.T$n=1]="peopleImageClassName";qa[qa.U$n=4]="peopleImageClusterPath";qa[qa.bPn=5]="multipleBrowserImageClusterPath";qa[qa.NRb=6]="imageDimension";qa[qa.rtl=8]="rtl";qa[qa.Bhd=9]="pointerInputManager";qa[qa.iL=10]="clickInputManager";qa[qa.vertical=11]="vertical";qa[qa.zIndex=12]="zIndex";qa[qa.VWc=13]="contextMenuInputManager";qa[qa.O3p=14]="imageDomElement";
qa[qa.hpq=15]="useIdleTooltip";qa[qa.pEp=16]="viewportBoundsCallback";qa[qa.m0p=17]="flipHorizontalDirection";qa[qa.h0p=18]="fixRemoveFadeOutElementCrash";qa[qa.w2m=19]="ignoreEventOnExpandedTooltip";qa[qa.Ucn=20]="ipWidthAdjustForFlyout"})(hg||(hg={}));Object(f.b)("PresenceTooltipSettingKeys",hg);class Vf{constructor(){this.Wv={}}get(qa,Jb=null){qa=hg[qa];return"number"===typeof Jb?(Jb=this.Wv[qa])?Number.parseInvariant(Jb.toString()):0:this.Wv[qa]}add(qa,Jb){this.Wv[hg[qa]]=Jb}NTa(qa,Jb){hg[qa]in
this.Wv||(this.Wv[hg[qa]]=Jb)}remove(qa){delete this.Wv[hg[qa]]}}Object(f.a)(Vf,"PresenceTooltipSettings",null,[]);class ic extends ja.a{constructor(qa){super();this._element=null;this.element=qa}get element(){return this._element}set element(qa){this._element=qa}get visible(){return"visible"===this.element.style.visibility}set visible(qa){this.element.style.visibility=qa?"visible":"hidden"}get rtl(){return"rtl"===this.element.dir.toLowerCase()}set rtl(qa){this.element.dir=qa?"rtl":"ltr"}get zIndex(){return this.element.style.zIndex}set zIndex(qa){this.element.style.zIndex=
String(qa)}dispose(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element);this.element=null;super.dispose()}createElement(qa){return this.element.ownerDocument.createElement(qa)}Rna(){return!0}static $ai(qa){return"prControl"+(qa?"Rtl":"")}}Object(f.a)(ic,"BasePresenceControl",ja.a,[13,1524]);class yc extends Sys.EventArgs{constructor(qa,Jb){super();this.type=qa;this.Kp=Jb}}yc.yX="InteractivityChanged";Object(f.a)(yc,"InteractivityChangedEventArgs",Sys.EventArgs,
[]);class bd{static Oom(qa){return bd.Pom(qa)}static Pom(qa){const Jb=document.createElementNS(bd.KPg,"svg");Jb.setAttribute("viewBox",String.format(bd.VMl,bd.Fak,bd.Eak));Jb.appendChild(bd.yMm(qa));return Jb}static yMm(qa){const Jb=bd.Fak/qa,Rb=2*Jb,Tc=bd.Eak/2;qa=(qa-12-8)*Jb/2;const vd=document.createElementNS(bd.KPg,"g");Sys.UI.DomElement.addCssClass(vd,bd.UMl);for(let Td=1;3>=Td;Td++)vd.appendChild(bd.tlm(Td,Rb,qa+(6*Td-2)*Jb,Tc));return vd}static tlm(qa,Jb,Rb,Tc){const vd=document.createElementNS(bd.KPg,
"circle");Sys.UI.DomElement.addCssClass(vd,String.format("{0}-{1}",bd.pql,qa));vd.setAttribute("cx",String.format("{0}",Rb));vd.setAttribute("cy",String.format("{0}",Tc));vd.setAttribute("r",String.format("{0}",Jb));return vd}}bd.KPg="http://www.w3.org/2000/svg";bd.UMl="prDancingDots";bd.pql="prAnimateCircle";bd.VMl="0 0 {0} {1}";bd.Eak=40;bd.Fak=120;Object(f.a)(bd,"ModernPresenceTooltipDancingDots",null,[]);var sd=d(103),ie=d(101),We=d(10),Pe=d(33),Re=d(150),Sf=d(60);class vg extends ic{constructor(qa,
Jb){super(qa);this.dKh=this.lib=this.qNe=this._img=this.gG=this.ox=this.Pg=null;this.bTa=Jb.get(8,!1);this.Thb=Jb.get(6,0);this.XRk=Jb.get(15,!1);this.Me=Jb;this.yhh=0;this.element=qa;this.element.className=vg.LEf;this._span=document.createElement("span");this.element.appendChild(this._span);this.iuk=bd.Oom(Jb.get(6,0));this.LE(Jb);this._state=5}cKb(qa){this.addHandler(yc.yX,qa)}sZb(qa){this.removeHandler(yc.yX,qa)}get user(){return this.dKh}get state(){return this._state}dispose(){this.element&&
(this.Pg.xc(We.a.click,this.element,Object(Ya.a)(this,this.onClick,"onClick")),this.Pg.xc(We.a.$C,this.element,Object(Ya.a)(this,this.Rna,"stopPropagationAndPreventDefaultBehavior")),this.ox.xc(We.a.nt,this.element,Object(Ya.a)(this,this.zE,"onPointerDown")),this.ox.xc(We.a.kH,this.element,Object(Ya.a)(this,this.ZL,"onPointerOut")),this.ox.xc(We.a.cM,this.element,Object(Ya.a)(this,this.hS,"onPointerOver")),this.gG.xc(this.element,Object(Ya.a)(this,this.Rna,"stopPropagationAndPreventDefaultBehavior")));
super.dispose()}LE(qa){this.Pg=qa.get(10);this.Pg.nb(We.a.click,this.element,Object(Ya.a)(this,this.onClick,"onClick"));this.Pg.nb(We.a.$C,this.element,Object(Ya.a)(this,this.Rna,"stopPropagationAndPreventDefaultBehavior"));this.ox=qa.get(9);this.ox.nb(We.a.cM,this.element,Object(Ya.a)(this,this.hS,"onPointerOver"));this.ox.nb(We.a.kH,this.element,Object(Ya.a)(this,this.ZL,"onPointerOut"));this.ox.nb(We.a.nt,this.element,Object(Ya.a)(this,this.zE,"onPointerDown"));this.gG=qa.get(13);this.gG.nb(this.element,
Object(Ya.a)(this,this.Rna,"stopPropagationAndPreventDefaultBehavior"))}hide(qa=null,Jb=0,Rb=0){this.XRk&&qa?this.R6o(qa,Jb,Rb):(3===this.state&&this.kCj(),this.visible=!1,this._state=5)}R6o(qa,Jb,Rb=0){this.show(qa,Jb,15,4,void 0,Rb)}VTj(qa,Jb,Rb=!1,Tc=!1,vd=!1,Td=0){this.show(qa,Jb,20,Rb?2:Tc?1:0,vd,Td)}o6o(qa,Jb,Rb,Tc=!1,vd=0){this.show(qa,Jb,Rb+20,3,Tc,vd)}show(qa,Jb,Rb,Tc=3,vd=!1,Td=0){!qa||Tc===this.state&&this.HZm(Jb,Rb)||(this.uVk(Tc,vd,Td),this.Dja(qa,Tc,Td),this._state=Tc,4===Td||0===Td&&
!this.bTa?this.element.style.left=Jb+"px":this.element.style.right=Jb+"px",this.element.style.top=Rb+"px",this.visible=!0)}Dja(qa,Jb,Rb){this.dKh=qa;Sf.a.rF(this._span);Re.a.fsl(this._span);this._span.id="fly_"+qa.clientId;this._span.style.backgroundColor=qa.color;4!==Jb?(this._span.style.height=this.Thb+"px",this._span.style.lineHeight=this.Thb+"px",Re.a.b0b(this._span,"border-radius",this.Thb+"px")):4===Rb||0===Rb&&!this.bTa?this._span.style.left="0px":this._span.style.right="0px";2!==Jb&&(4===
Jb?Sf.a.Ox(this._span,""):1===Jb?this._span.appendChild(this.iuk):(this._span.setAttribute("dir","auto"),Rb=Ub.a.twm(qa.userName),(!qa.isAnonymous||m.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.SharedOnline.IsCustomAnonymousNameEnabled",!1))&&Rb||0!==Jb?(qa=qa.userName,0===Jb&&(qa=Rb,Re.a.b0b(this._span,"text-align","center")),Sf.a.Ox(this._span,qa)):(this._img||(this._img=this.BDl()),this._span.appendChild(this._img),Re.a.b0b(this._span,"text-align","start"))))}onClick(qa){if(0===
this.state)return this.raiseEvent(yc.yX,new yc(1,qa)),!0;3===this.state&&l.ULS.sendTraceTag(50436114,302,50,"User clicked on presence pill.");return!1}ZL(qa){3===this.state&&this.raiseEvent(yc.yX,new yc(3,qa));return!1}hS(qa){3!==qa.Ag&&this.raiseEvent(yc.yX,new yc(2,qa));return!1}zE(qa){if(3!==qa.Ag)return!0;this.raiseEvent(yc.yX,new yc(4,qa));return!1}BDl(){const qa=document.createElement("img");qa.src=sd.a.Tea("doughperson_white_glyph.svg");qa.setAttribute("Unselectable","on");Pe.a.Ls(qa,Pe.a.Ph,
Pe.a.BA);return ie.createClusteredImageFromClusterWithImageClass(this.Thb,this.Thb,null,null,vg.fbm,"",!1,"",this.element.ownerDocument,qa)}uVk(qa,Jb=!1,Rb=0){if(!this.W8c(this.state)||!this.W8c(qa))switch(Sys.UI.DomElement.removeCssClass(this.element,this.qNe),this.state){case 4:3===qa?this.R5a(vg.MEf,vg.dqi):this.W8c(qa)&&this.R5a(vg.KEf,vg.dqi);break;case 3:4===qa?this.R5a(vg.PEf,vg.cqi):this.W8c(qa)&&(Jb&&this.kCj(),this.R5a(vg.KEf,vg.cqi,Jb?vg.ebm:""));break;case 0:case 1:case 2:4===qa?this.R5a(vg.PEf,
vg.NEf):3===qa&&(Jb&&this.DWk(),this.R5a(vg.MEf,vg.NEf,Jb?vg.eqi:"",3===Rb?vg.ibm:vg.gbm));break;default:4===qa?this.R5a(vg.PEf):3===qa?this.R5a(vg.MEf):this.W8c(qa)&&this.R5a(vg.KEf)}}R5a(...qa){this.qNe=qa.join(" ");Sys.UI.DomElement.addCssClass(this.element,this.qNe)}DWk(){this.yhh=window.setTimeout(()=>{this.element&&(this.lib=this.element.cloneNode(!0),this.element.parentNode.appendChild(this.lib),this.element.style.zIndex="2",this.lib.style.zIndex="1")},300)}kCj(){window.clearTimeout(this.yhh);
this.lib&&(Sys.UI.DomElement.removeCssClass(this.lib,vg.NEf+" "+vg.eqi),Sys.UI.DomElement.addCssClass(this.lib,vg.dbm),z.Task.delay(300).continueWith(()=>{this.element&&this.element.parentNode===this.lib.parentNode&&this.element.parentNode.removeChild(this.lib)}),Re.a.tvc(this.element,"z-index"))}W8c(qa){return 0===qa||1===qa||2===qa}HZm(qa,Jb){const Rb=Re.a.J0(this.element.style.top);return Re.a.J0(this.element.style.left)===qa&&Rb===Jb}Hug(qa){3===qa&&Re.a.Lea(this.element,"left")?(qa=Re.a.J0(this.element.style.left),
Re.a.tvc(this.element,"left"),this.element.style.right=-1*qa+"px"):4===qa&&Re.a.Lea(this.element,"right")&&(qa=Re.a.J0(this.element.style.right),Re.a.tvc(this.element,"right"),this.element.style.left=-1*qa+"px")}}vg.LEf="prModernFlyout UIFont";vg.PEf="flyoutIdle";vg.MEf="flyoutExpanded";vg.KEf="flyoutCollapsed";vg.dqi="flyoutFromIdle";vg.cqi="flyoutFromExpanded";vg.NEf="flyoutFromCollapsed";vg.eqi="flyoutStacked";vg.ebm="flyoutFromStacked";vg.dbm="flyoutFadeOut";vg.fbm="cui-img-cont-float cui-img-20by20";
vg.gbm="flyoutLtrDir";vg.ibm="flyoutRtlDir";Object(f.a)(vg,"ModernPresenceTooltipFlyoutControl",ic,[]);class Yg{constructor(qa,Jb,Rb=2,Tc=4){this.offsetTop=qa;this.offsetLeft=Jb;this.Bak=Rb;this.sPi=Tc}}Object(f.a)(Yg,"FlyoutsPositioningInfo",null,[]);var ph=d(41);class Di{constructor(qa=!1,Jb=!1){this.Zm=qa;this.ZSe=Jb}Lxm(qa,Jb,Rb,Tc,vd){const Td=vd.y,Ed=vd.height;var lf=this.Ljm(Tc);const Bf=lf+Jb,vf=qa*Rb+2*(qa-1);Rb=null;1===qa||this.Vkl(lf,vf,Td,Ed)?qa=new Yg(0,0,2):(qa=this.tEf(Bf,vf,Td,Ed),
qa.offsetTop-=lf);this.ZSe?Rb=new Yg(0,0,void 0,this.Zm?4:3):(Tc=this.Kjm(Tc,vd),lf=Math.max(0,vd.x),vd=vd.width,Jb=Tc+Jb,this.Wkl(Tc,lf,vd)?Rb=new Yg(0,0,void 0,this.Zm?3:4):this.Xkl(Jb,lf)&&(Rb=new Yg(0,0,void 0,this.Zm?4:3)),Rb||(Rb=this.R$l(Tc,Jb,lf,vd)));return new Yg(qa.offsetTop,Rb.offsetLeft,qa.Bak,Rb.sPi)}Ljm(qa){return ph.a.CKa(qa)}Kjm(qa,Jb){return this.Zm?Jb.width-ph.a.zui(qa):ph.a.IHf(qa)}Vkl(qa,Jb,Rb,Tc){return qa+Jb<=Rb+Tc}tEf(qa,Jb,Rb,Tc){let vd=1,Td=Math.max(Rb,qa-Jb);Jb>qa-Rb&&(vd=
2,Td=Jb<Tc?Tc-Jb:Rb);return new Yg(Td,0,vd)}Wkl(qa,Jb,Rb){return qa+150<=Jb+Rb}Xkl(qa,Jb){return 150<=qa-Jb}R$l(qa,Jb,Rb,Tc){Tc-Jb>=qa-Rb?qa=4:(Jb=qa,qa=3);return new Yg(0,Jb,void 0,qa)}}Object(f.a)(Di,"ModernPresenceTooltipPositioner",null,[]);class bj{constructor(qa,Jb,Rb,Tc,vd,Td,Ed){this.Ida=qa;this._parent=Jb;this.Tbh=Rb;this.Wqk=Tc;this.Vyk=vd;this.bbc=Td;this.bTa=Ed;this._element=document.createElement("div");this.element.className="prTouchTarget"}get element(){return this._element}update(qa,
Jb){if(3!==qa)if(5!==qa&&this.Ida&&this.Ida.length){if(4===qa){var Rb=this.Vyk;var Tc=(this.bbc-Rb)/2;this.element.style.height=this.bbc+"px";this.element.style.width=this.bbc+"px";qa=Re.a.J0(this.Ida[0].element.style.top);Jb=Re.a.J0(this.bTa?this.Ida[0].element.style.right:this.Ida[0].element.style.left)}else Rb=this.Tbh,Tc=(this.bbc-Rb)/2,this.element.style.height=this.bbc+"px",this.element.style.width=this.Mlm()+2*Tc+"px",qa=Re.a.J0(this.Ida[this.Ida.length-1].element.style.top),Jb=this.akl(this.Ida[this.Ida.length-
1].element,Rb,Jb);Re.a.b0b(this.element,"border-radius",this.bbc+"px");this.element.style.top=qa-Tc-Rb+"px";this.bTa?this.element.style.right=Jb-Tc+"px":this.element.style.left=Jb-Tc+"px";this.element.parentNode||this._parent.insertBefore(this.element,this._parent.firstChild)}else this.element.parentNode&&this.element.parentNode.removeChild(this.element)}akl(qa,Jb,Rb){return this.bTa&&!Rb?Re.a.J0(qa.style.right):this.bTa||Rb?this.bTa&&Rb?-Re.a.J0(qa.style.left)-Jb:-Re.a.J0(qa.style.right)-Jb:Re.a.J0(qa.style.left)}Mlm(){return this.Ida&&
this.Ida.length?this.Tbh+Math.min(this.Ida.length-1,2)*this.Wqk:0}}Object(f.a)(bj,"ModernPresenceTooltipTarget",null,[]);var gi=d(142),Zg=d(202);class Bb extends ic{constructor(qa,Jb,Rb){super(qa);this.A$b=this.NRa=this.Gmh=this.IDb=!1;this.ir=[];this.UYa=(Tc,vd)=>{Tc=this.R1b;this.Rcl()||2!==vd.type&&(4!==vd.type||3===Tc)?4===vd.type&&3===Tc?(this.NRa&&(this.NRa=!1),this.gqf()):3!==vd.type||3!==Tc||this.IDb||(1<this.F8a?(this.NRa=!0,z.Task.delay(250).continueWith(()=>{this.ffc(!0);this.NRa=!1})):
this.gqf()):(this.NRa&&(this.NRa=!1),3!==Tc&&(this.Bmi(),3===vd.Kp.Ag&&this.gqf(2E3)));this.raiseEvent(yc.yX,vd)};this.Esc=Tc=>{3===Tc.Ag?this.UYa(this,new yc(4,Tc)):Tc.eventName===We.a.cM?this.UYa(this,new yc(2,Tc)):Tc.eventName===We.a.kH&&this.UYa(this,new yc(3,Tc));return!1};this.rDd={};this.Me=Rb;this.Zm=Rb.get(8,!1);this.slh=Rb.get(15,!1);this.btk=Rb.get(12,0);this.Rmb=Rb.get(6,0);this.mqa=Jb;this.zKh=Rb.get(16);this.ZSe=Rb.get(17,!1);this.Yyk=Rb.get(19,!1);this.nJk=Rb.get(20,!1);this.eGd=0;
this.hJk=new Di(this.Zm,this.ZSe);this.eDc=this.fxi();this.PGb=!1;this.c4b=[];this.UIc=[];this.element.id=Bb.fqb();this.element.className=ic.$ai(this.Zm);this.I7a&&(this.zIndex=this.I7a);this.rtl=this.Zm;this.qzg(Jb);this.b$=this.createElement("div");this.b$.className="prFlyoutContainer";this.element.appendChild(this.b$);this.Ida=[];this.Lib=new bj(this.m7,this.element,this.Rmb,4,6,32,this.Zm);this.ox=Rb.get(9);this.ox.nb(We.a.nt,this.Lib.element,this.Esc);this.ox.nb(We.a.cM,this.Lib.element,this.Esc);
this.ox.nb(We.a.kH,this.Lib.element,this.Esc)}get cre(){return Zg.a.clone(this.ir)}get m7(){return this.Ida}get I7a(){return this.btk}get F8a(){return this.m7?this.m7.length:0}get R1b(){return 0<this.F8a?this.m7[0].state:5}get XYf(){return 3===this.R1b&&!this.IDb}cKb(qa){this.addHandler(yc.yX,qa)}sZb(qa){this.removeHandler(yc.yX,qa)}dispose(){if(this.XYf)this.PGb=!0;else{if(this.m7)for(const qa of this.m7)qa.sZb(this.UYa),$c.a.JD(qa);this.Ida=null;this.ox.xc(We.a.nt,this.Lib.element,this.Esc);this.ox.xc(We.a.cM,
this.Lib.element,this.Esc);this.ox.xc(We.a.kH,this.Lib.element,this.Esc);super.dispose()}}eyc(){this.ffc();this.visible=!0}Npd(){this.visible=!0;this.Bmi();this.IDb=!0}lDg(){this.Npd()}hide(){this.QCj();this.h$a();this.Lib.update(this.R1b,this.A$b)}Dja(qa){const Jb=this.R1b,Rb=this.IDb;qa.clientId||(qa.clientId=(Bb.oJc++).toString());if(qa.clientId in this.rDd){var Tc=this.COb(qa.clientId);if(0<=Tc){Tc=this.ir[Tc];if(Tc.color===qa.color&&Tc.userName===qa.userName)return;this.ndb(qa.clientId)}}this.hide();
Tc=new vg(this.createElement("div"),this.Me);Tc.cKb(this.UYa);this.b$.insertBefore(Tc.element,this.b$.firstChild);this.rDd[qa.clientId]=Tc;Array.add(this.ir,qa);Array.add(this.m7,Tc);this.K9j(Jb,Rb);this.visible=!0}ndb(qa){if(this.XYf)Array.add(this.UIc,qa);else{var Jb=this.R1b,Rb=this.IDb;this.hide();this.Vkd(qa);this.K9j(Jb,Rb)}}zfj(qa){const Jb=this.COb(qa);if(!(0>=Jb)){var Rb=this.ir[Jb];qa=this.rDd[qa];Array.removeAt(this.ir,Jb);Array.insert(this.ir,0,Rb);Array.removeAt(this.m7,Jb);Array.insert(this.m7,
0,qa);this.b$.removeChild(qa.element);this.b$.appendChild(qa.element);this.ffc()}}K9j(qa,Jb){0>=this.ir.length?this.hide():3===qa&&Jb?this.Npd():this.eyc()}aCf(qa){if(this.XYf&&this.Yyk)return!1;qa=Bb.wNf(qa);if(this.b$!==qa&&Sf.a.pXa(this.b$,qa))return!0;for(const Jb of this.m7)if(Sf.a.pXa(Jb.element,qa))return!0;return!1}position(qa,Jb){this.element.style.top=Jb+"px";this.element.style.left=qa+"px"}ffc(qa=!1){if(!qa||this.NRa){this.Gmh&&this.LPj(!0);var Jb=Math.min(3,this.F8a)-1;qa=0;var Rb=1,Tc=
0;this.A$b&&(qa=this.eDc,Rb=-1,Tc=-this.Rmb);for(let vd=this.F8a-1;vd>Jb;vd--)this.m7[vd].VTj(this.ir[vd],-4*Jb*Rb+Tc,!0,!1,!0,qa);for(;0<=Jb;Jb--)this.m7[Jb].VTj(this.ir[Jb],-4*Jb*Rb+Tc,0<Jb,Array.contains(this.c4b,this.ir[Jb].clientId),Jb!==this.eGd,qa);this.eGd=0;this.Lib.update(0,this.A$b);this.zIndex=this.I7a;this.IDb=!1;this.QCj(0);this.PGb&&this.dispose()}}Bmi(){this.Gmh&&this.LPj(!1);this.zIndex=this.I7a+1;const {offsetX:qa,offsetY:Jb,rPi:Rb}=this.PUo();for(let Tc=0;Tc<this.F8a;Tc++)this.m7[Tc].o6o(this.ir[Tc],
qa,Jb+(this.Rmb+2)*Tc,Tc!==this.eGd,Rb)}h$a(){let qa=0,Jb=0;this.A$b&&(qa=this.eDc,Jb=-6);for(let Rb=0;Rb<this.F8a;Rb++)this.m7[Rb].hide(this.ir[Rb],Jb,qa);this.zIndex=this.I7a;this.visible=this.IDb=!1;this.PGb&&this.dispose()}gqf(qa=0){qa?(this.NRa=!0,z.Task.delay(qa).continueWith(()=>{this.slh?this.x0m():this.ffc(!0);this.NRa=!1})):this.slh?this.hide():this.ffc()}x0m(){this.NRa&&this.hide()}Rcl(){if(m.AFrameworkApplication.ua&&m.AFrameworkApplication.ua.Ib.GCa&&gi.c()){const qa=appChrome.selectors.getShyState();
return qa.isActive&&0!==qa.state}return!1}qzg(qa){this.element.style.width=qa+"px";this.element.style.height=this.Rmb+"px"}Vkd(qa){this.dxo(qa);qa=this.COb(qa);if(!(0>qa)){var Jb=this.ir[qa];Array.removeAt(this.ir,qa);delete this.rDd[Jb.clientId];Jb=this.m7[qa];this.b$.removeChild(Jb.element);this.Me.get(18,!1)&&Jb.sZb(this.UYa);Array.removeAt(this.m7,qa);Jb.dispose()}}QCj(qa=5){if(this.UIc.length){this.visible&&this.h$a();for(let Jb=0;Jb<this.UIc.length;Jb++)this.Vkd(this.UIc[Jb]);Array.clear(this.UIc);
0>=this.ir.length||5===qa?this.hide():0===qa&&this.eyc()}}COb(qa){for(let Jb=0;Jb<this.ir.length;Jb++)if(this.ir[Jb].clientId===qa)return Jb;return-1}dxo(qa){-1===this.COb(qa)?l.ULS.sendTraceTag(41706452,302,50,"Cannot remove active editor because client id is invalid"):Array.contains(this.c4b,qa)&&(Array.remove(this.c4b,qa),this.ir[0].clientId===qa&&0<this.c4b.length&&this.zfj(this.c4b[this.c4b.length-1]),this.ir[0].clientId===qa&&1===this.R1b&&this.ffc())}LPj(qa){qa?Sys.UI.DomElement.addCssClass(this.b$,
"prBackgroundSelection"):Sys.UI.DomElement.removeCssClass(this.b$,"prBackgroundSelection")}PUo(){let qa,Jb;Jb=qa=0;var Rb=this.eDc;if(this.zKh){const Tc=this.zKh(this);if(!Tc)return{offsetX:qa,offsetY:Jb,rPi:Rb};const vd=4===this.R1b;Rb=this.hJk.Lxm(this.F8a,vd?6:this.Rmb,this.Rmb,this.element,Tc);Jb=Rb.offsetTop;this.eGd=this.hwm(Rb.Bak,Rb.offsetTop);Rb=Rb.sPi;Rb!==this.eDc&&(this.Hug(Rb),this.element.dir=3===Rb?"rtl":"ltr",this.eDc=Rb);Rb!==this.fxi()?(qa=this.nJk?-2:vd?-6:-this.Rmb,this.A$b=!0):
this.A$b=!1}return{offsetX:qa,offsetY:Jb,rPi:Rb}}hwm(qa,Jb){if(1===qa)return this.F8a-1;qa=Math.abs(Jb);return 0<qa?qa/(this.Rmb+2):0}Hug(qa){for(let Jb=0;Jb<this.F8a;Jb++)this.m7[Jb].Hug(qa)}fxi(){return this.Zm?3:4}static fqb(){return String.format("{0}-{1}","presencetooltip",Bb.oJc++)}static wNf(qa){return qa.Kb.rawEvent.relatedTarget}}Bb.oJc=0;Object(f.a)(Bb,"ModernPresenceTooltipControl",ic,[1549,13]);var Nb=d(249),Bc=d(291);class td{constructor(qa){this.Me=qa;this.Me.NTa(10,Nb.a.instance);this.Me.NTa(9,
id.a.instance);this.Me.NTa(6,20);this.Me.NTa(13,Bc.a.instance);this.Me.NTa(17,!1)}ktf(qa,Jb=!1){this.Me.NTa(15,Jb);return new Bb(qa,20,this.Me)}}Object(f.a)(td,"ModernPresenceTooltipFactory",null,[1548]);class Je extends ic{constructor(qa,Jb){super(qa);this.ir=null;this.bTa=Jb.get(8,!1);this.Thb=Jb.get(6,0);this.element=qa;this.element.className=Je.LEf;this._ul=this.createElement("ul");this.element.appendChild(this._ul);this.Pg=Jb.get(10);this.Pg.nb(We.a.click,this.element,Object(Ya.a)(this,this.onClick,
"onClick"));this.ox=Jb.get(9);this.ox.nb(We.a.kH,this.element,Object(Ya.a)(this,this.ZL,"onPointerOut"));this.ox.nb(We.a.nt,this.element,Object(Ya.a)(this,this.Rna,"stopPropagationAndPreventDefaultBehavior"));this.gG=Jb.get(13);this.gG.nb(this.element,Object(Ya.a)(this,this.Rna,"stopPropagationAndPreventDefaultBehavior"))}cKb(qa){this.addHandler(yc.yX,qa)}sZb(qa){this.removeHandler(yc.yX,qa)}get users(){return this.ir}dispose(){this.element&&(this.Pg.xc(We.a.click,this.element,Object(Ya.a)(this,this.onClick,
"onClick")),this.ox.xc(We.a.nt,this.element,Object(Ya.a)(this,this.Rna,"stopPropagationAndPreventDefaultBehavior")),this.ox.xc(We.a.kH,this.element,Object(Ya.a)(this,this.ZL,"onPointerOut")),this.gG.xc(this.element,Object(Ya.a)(this,this.Rna,"stopPropagationAndPreventDefaultBehavior")));super.dispose()}hide(){this.visible=!1}show(qa,Jb,Rb){this.hide();!qa||0>=qa.length||(this.bTa?this.element.style.right=Jb+"px":this.element.style.left=Jb+"px",this.element.style.top=Rb+"px",this.o_k(qa),this.visible=
!0)}o_k(qa){this.ir=qa;Sf.a.rF(this._ul);for(let Jb=qa.length-1;0<=Jb;Jb--)this.Dja(qa[Jb])}Dja(qa){const Jb=document.createElement("li");Jb.style.backgroundColor=qa.color;Jb.style.height=this.Thb+"px";Jb.id="fly_"+qa.clientId;Jb.style.lineHeight=this.Thb+"px";Sf.a.Ox(Jb,qa.userName);Jb.setAttribute("dir","auto");this._ul.appendChild(Jb)}onClick(){this.hide();return!1}ZL(qa){this.raiseEvent(yc.yX,new yc(3,qa));return!1}}Je.LEf="prFlyout UIFont";Object(f.a)(Je,"PresenceTooltipFlyoutControl",ic,[]);
class Ef extends ic{constructor(qa,Jb,Rb){super(qa);this._img=null;this.ir=[];this.element.className="prGlyph";this.Me=Jb;this.g$b=this.Me.get(9);this.Cr=this.Me.get(10);this.gG=this.Me.get(13);this.W0m();this.Dja(Rb);this.BXe=!1}get Ubb(){return this.ir.length}get users(){return this.ir}cKb(qa){this.addHandler(yc.yX,qa)}sZb(qa){this.removeHandler(yc.yX,qa)}dispose(){this.Krp();super.dispose()}Dja(qa){Array.add(this.ir,qa);2===this.Ubb?this.moa(!0):1===this.Ubb?this.moa(!1):this.moa(this.BXe)}ndb(qa){this.g8l(qa)&&
(1<this.Ubb&&this.moa(!0),1===this.Ubb?this.moa(!1):1>this.Ubb&&this.hide())}show(){this.moa(2<=this.Ubb);this.visible=!0}hide(){this.visible=!1}Tvm(qa){return qa?this.Dvi(0,5):this.Dvi(1,4)}g8l(qa){for(let Jb=0;Jb<this.Ubb;Jb++)if(this.ir[Jb].clientId===qa)return qa=this.ir[Jb],Array.removeAt(this.ir,Jb),qa;return null}moa(qa){this.BXe!==qa&&(this._img&&this.element.removeChild(this._img),this._img=this.Tvm(qa),this.element.appendChild(this._img),this.BXe=qa);this._img.childNodes[0].style.backgroundColor=
this.ir[this.ir.length-1].color}Dvi(qa,Jb){const Rb=this.Me.get(6,0),Tc=this.Me.get(14);return ie.createClusteredImageFromClusterWithImageClass(Rb,Rb,this.Me.get(qa),this.Me.get(Jb),"cui-img-cont-float cui-img-16by16","",!1,"",this.element.ownerDocument,Tc?Tc.cloneNode(!0):null)}hS(qa){3!==qa.Ag&&this.raiseEvent(yc.yX,new yc(2,qa));return!1}onClick(qa){this.raiseEvent(yc.yX,new yc(1,qa));return!0}ZL(qa){3!==qa.Ag&&this.raiseEvent(yc.yX,new yc(3,qa));return!1}Krp(){this.element&&(this.g$b.xc(We.a.nt,
this.element,Object(Ya.a)(this,this.Rna,"stopPropagationAndPreventDefaultBehavior")),this.g$b.xc(We.a.cM,this.element,Object(Ya.a)(this,this.hS,"onPointerOver")),this.g$b.xc(We.a.kH,this.element,Object(Ya.a)(this,this.ZL,"onPointerOut")),this.Cr.xc(We.a.$C,this.element,Object(Ya.a)(this,this.Rna,"stopPropagationAndPreventDefaultBehavior")),this.Cr.xc(We.a.click,this.element,Object(Ya.a)(this,this.onClick,"onClick")),this.gG.xc(this.element,Object(Ya.a)(this,this.Rna,"stopPropagationAndPreventDefaultBehavior")))}W0m(){this.element&&
(this.g$b.nb(We.a.nt,this.element,Object(Ya.a)(this,this.Rna,"stopPropagationAndPreventDefaultBehavior")),this.g$b.nb(We.a.cM,this.element,Object(Ya.a)(this,this.hS,"onPointerOver")),this.g$b.nb(We.a.kH,this.element,Object(Ya.a)(this,this.ZL,"onPointerOut")),this.Cr.nb(We.a.$C,this.element,Object(Ya.a)(this,this.Rna,"stopPropagationAndPreventDefaultBehavior")),this.Cr.nb(We.a.click,this.element,Object(Ya.a)(this,this.onClick,"onClick")),this.gG.nb(this.element,Object(Ya.a)(this,this.Rna,"stopPropagationAndPreventDefaultBehavior")))}}
Object(f.a)(Ef,"PresenceTooltipGlyph",ic,[]);class Ih extends ic{constructor(qa,Jb,Rb){super(qa);this.ir=[];this.VM=[];this.rSa=0;this.ZPc=this.l7b=!1;this.z8g=null;this.UYa=(Tc,vd)=>{var Td=Object(y.a)(Ef,Tc);Td=Td?this.zoi(Td):-1;if(2===vd.type||1===vd.type&&-1!==Td&&!this.vfa[Td].visible)this.Uqe(Tc);else if(1===vd.type)this.h$a(),this.l7b=!1;else if(3===vd.type){if(this.aCf(vd.Kp))return;this.l7b||this.h$a()}this.raiseEvent(yc.yX,vd)};this.sDd={};this.Me=Rb;this.Zm=Rb.get(8,!1);this.Ipa=Rb.get(11,
!1);qa=Rb.get(12,0);this.NRb=Rb.get(6,0);this.mqa=Jb;this.element.id=Ih.fqb();this.element.className=ic.$ai(this.Zm);qa&&(this.zIndex=qa);this.rtl=this.Zm;this.qzg(Jb);this.AGa=this.createElement("div");this.AGa.className=this.Ipa?"prContainerV":"prContainerHr";this.element.appendChild(this.AGa);this.Kih=Array(this.rSa);for(Jb=0;Jb<this.rSa;Jb++)this.vfa[Jb]=new Je(this.createElement("div"),this.Me),this.vfa[Jb].cKb(this.UYa),this.element.appendChild(this.vfa[Jb].element)}get cre(){return Zg.a.clone(this.ir)}get vfa(){return this.Kih}get yMh(){return this.z8g}get JAe(){return this.NRb+
2}get width(){return this.Ipa?this.JAe:this.mqa}get height(){return this.Ipa?this.mqa:this.JAe}cKb(qa){this.addHandler(yc.yX,qa)}sZb(qa){this.removeHandler(yc.yX,qa)}dispose(){if(this.vfa)for(const qa of this.vfa)qa.sZb(this.UYa),$c.a.JD(qa);$c.a.Kwg(this.VM);this.VM=this.Kih=null;super.dispose()}eyc(){this.h$a();this.zDg();this.visible=!0;this.l7b=!1}Npd(){!this.VM||1>this.VM.length||(this.h$a(),this.visible=!0,this.zDg(),this.Uqe(this.VM[this.VM.length-1]),this.l7b=!0)}lDg(){if(this.VM&&!(1>this.VM.length)){this.visible=
!0;this.zDg();var qa=0;for(const Jb of this.VM)this.Uqe(Jb,qa++);this.l7b=!1;this.ZPc=!0}}hide(){this.visible=!1;this.h$a();for(let qa=0;qa<this.VM.length;qa++)this.VM[qa].hide();this.l7b=!1}P1h(){if(!this.ZPc)return!1;let qa=0;for(const Jb of this.vfa)Jb.visible&&qa++;return this.ZPc=0<qa&&(this.ir.length<=this.rSa?qa===this.ir.length:qa===this.rSa)}Dja(qa){if(!(0>=this.rSa)){qa.clientId||(qa.clientId=(Ih.oJc++).toString());if(qa.clientId in this.sDd){var Jb=this.COb(qa.clientId);if(0<=Jb){Jb=this.ir[Jb];
if(Jb.color===qa.color&&Jb.userName===qa.userName)return;this.ndb(qa.clientId)}}Jb=this.P1h();var Rb=0;if(this.ir.length<this.rSa){var Tc=new Ef(this.createElement("div"),this.Me,qa);Tc.cKb(this.UYa);this.Zm&&!this.Ipa&&0<this.ir.length?this.AGa.insertBefore(Tc.element,this.AGa.firstChild):(this.AGa.appendChild(Tc.element),Rb=this.VM.length);Array.add(this.VM,Tc)}else this.Zm&&!this.Ipa?Tc=this.VM[0]:(Rb=this.VM.length-1,Tc=this.VM[Rb]),Tc.Dja(qa);Tc.show();this.sDd[qa.clientId]=Tc;Array.add(this.ir,
qa);this.n7j(Tc,Rb);Jb&&this.lDg()}}ndb(qa){const Jb=this.P1h();Jb&&this.h$a();this.Vkd(qa);this.ir.length>=this.rSa&&this.VM.length<this.rSa&&this.zoo();0>=this.ir.length?this.hide():Jb&&this.lDg()}zfj(){}Vkd(qa){var Jb=this.COb(qa);0>Jb||(qa=this.ir[Jb],Array.removeAt(this.ir,Jb),Jb=this.sDd[qa.clientId],delete this.sDd[qa.clientId],Jb.ndb(qa.clientId),this.n7j(Jb),0>=Jb.Ubb&&(this.AGa.removeChild(Jb.element),Array.remove(this.VM,Jb),Jb.dispose()))}zoo(){var qa=this.uDm();!qa||1>=qa.users.length||
(qa=Array.clone(this.ir),qa.forEach(Jb=>{this.Vkd(Jb.clientId)}),qa.forEach(Jb=>{this.Dja(Jb)}))}COb(qa){for(let Jb=0;Jb<this.ir.length;Jb++)if(this.ir[Jb].clientId===qa)return Jb;return-1}uDm(){return this.Zm&&!this.Ipa?this.VM[0]:this.VM[this.VM.length-1]}position(qa,Jb){this.element.style.top=Jb+"px";this.element.style.left=qa+"px"}zDg(){for(let qa=0;qa<this.VM.length;qa++)this.VM[qa].show()}h$a(){for(let qa=0;qa<this.rSa;qa++)this.vfa[qa].hide();this.ZPc=!1}Uqe(qa,Jb=0){if(qa)if(this.z8g=qa,this.Ipa){const Rb=
this.NRb;if(1<qa.users.length)this.vfa[Jb].show(qa.users,Rb,this.height-this.NRb);else{const Tc=this.AGa.children.length;for(let vd=0;vd<this.AGa.children.length;vd++)qa.element===this.AGa.children[vd]&&this.vfa[Jb].show(qa.users,Rb,this.height-(Tc-vd)*this.JAe+2)}}else this.vfa[Jb].show(qa.users,this.width,0)}aCf(qa){qa=Ih.wNf(qa);let Jb=!1;for(const Rb of this.vfa)if(Sf.a.pXa(Rb.element,qa)){Jb=!0;break}return this.AGa!==qa&&Sf.a.pXa(this.AGa,qa)||Jb}n7j(qa,Jb=0){const Rb=this.ddn(qa);Rb&&0>=qa.Ubb?
this.vfa[Jb].hide():Rb?this.Uqe(qa):this.vfa[Jb].hide()}zoi(qa){let Jb=0;for(const Rb of this.VM){if(qa===Rb)return Jb;Jb++}return-1}ddn(qa){const Jb=this.zoi(qa);return!!this.yMh&&qa===this.yMh&&-1!==Jb&&this.vfa[Jb].visible}qzg(qa){this.rSa=qa===this.NRb?1:Math.floor(qa/this.JAe);this.Ipa?(this.element.style.height=qa+"px",this.element.style.width=this.NRb+"px"):(this.element.style.width=qa+"px",this.element.style.height=this.NRb+"px")}static fqb(){return String.format("{0}-{1}","presencetooltip",
Ih.oJc++)}static wNf(qa){qa=qa.Kb.rawEvent;return qa.relatedTarget||qa.toElement}}Ih.oJc=0;Object(f.a)(Ih,"PresenceTooltipControl",ic,[1549,13]);class tg{constructor(qa){this.Me=qa;this.Me.NTa(10,Nb.a.instance);this.Me.NTa(9,id.a.instance);this.Me.NTa(6,16);this.Me.NTa(13,Bc.a.instance)}ktf(qa){return new Ih(qa,16,this.Me)}}Object(f.a)(tg,"PresenceTooltipFactory",null,[1548]);var Dh=d(258),Jh=d(131),Xh=d(57),Mf=d(5),Jg=d(115),ug=d(6),ze=d(13),pi=d(82),og=d(558),Jk=d(326),zk=d(122);class Xf extends Sys.EventArgs{constructor(qa,
Jb){super();this.paragraphId=qa;this.oyn=Jb}}Object(f.a)(Xf,"PresenceControlRenderedEventArgs",Sys.EventArgs,[]);class Gg extends ic{constructor(qa,Jb,Rb,Tc,vd,Td=null,Ed=null){super(null);this.lDd=this.$n=null;this.ybd=!1;this.iwa=0;this.nq=qa;this.bRc=Jb;this.ox=Rb;this.Vj=Tc;this.xQa=vd;Gg.$Db=0;this.ZRh=new lb.a;this.PGj=new lb.a;this.JZ=Td;this.Ga=Ed;this.Wvk=this.Ga.ic("PresenceIpRenderedFloodgateTimeLapseSec",30);this.hRk=this.Ga.ic("PresenceIpRenderedFloodgateTriggerThreshold",3);this.Xwa=
0}get Jbb(){return m.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled")}Z_k(qa){this.addHandler("CR",qa)}yDj(qa){this.removeHandler("CR",qa)}tte(){this.raiseEvent("CR",new Xf(this.nq.ip.paragraphId,this.ybd))}X9f(){if(Object(zk.a)(Bb,this.$n)){const qa=Object(y.a)(Bb,this.$n);Gg.$Db=0<Gg.$Db?Gg.$Db+1:qa.I7a+1;qa.zIndex=Gg.$Db;this.element.style.zIndex=String(Gg.$Db)}}KFo(){if(Object(zk.a)(Bb,this.$n)){const qa=Object(y.a)(Bb,this.$n);Gg.$Db=qa.I7a;qa.zIndex=qa.I7a;this.element.style.zIndex=
String(qa.I7a)}}paj(){this.JZ&&!this.Knp()&&this.JZ.continueWith(()=>{this.JZ.result.logActivity("PresenceIpRendered","PresenceIpRenderedFloodgateEnabled",this.Wvk)&&this.Xwa++})}Knp(){return this.Xwa>=this.hRk}static H$i(){Gg.uih||(Gg.uih=!0,l.ULS.sendTraceTag(4006594,302,50,"First presence ip rendered on the page"))}static fqb(qa){return Gg.n2m+qa.Bzi()}}Gg.Tuj="data-presence-control";Gg.yqj="OverlayControlElementOwner";Gg.n2m="ipId_";Gg.Uuj="WacPresence";Gg.k7n="PresenceIpPaddingDiv";Gg.uih=!1;
Gg.$Db=0;Object(f.a)(Gg,"APresenceControl",ic,[1809,13]);class Lg{constructor(){this.rotation=this.height=this.width=this.top=this.left=0;this.peb=!1}}Object(f.a)(Lg,"PresenceImageControlStyle",null,[1808]);var ak=d(197);class Rf extends Gg{constructor(qa,Jb,Rb,Tc,vd,Td=null,Ed=null){super(qa,Jb,Rb,Tc,vd,Td,Ed);this.ZL=()=>{this.Eej();return!1};this.Coe=lf=>{this.$n&&3===lf.Ag&&(2!==this.iwa?(this.X9f(),this.Q0b()):this.Eej());return!1}}ndb(qa){this.$n&&this.$n.ndb(qa)}VFe(){return this.$n?this.$n.cre.length:
0}updatePosition(qa){if(this.element&&this.element.parentNode){var Jb=this.cAi(qa);if(Jb){var Rb=Sys.UI.DomElement.getBounds(this.element.parentNode),Tc,vd;({left:Rb,top:Tc,height:vd,width:Jb}=this.eGm(Jb,Rb,this.element.parentNode,this.Vj.instance));this.element.style.top=Tc+"px";this.element.style.left=Rb+"px";this.element.style.height=vd+"px";this.element.style.width=Jb+"px";Rb=this.kAi(qa);Re.a.P8(this.element,Rb);qa=this.OKf(qa,this.nq.ip.shapeId);this.oQj(Rb,Jb,this.isSelected(qa),m.AFrameworkApplication.isRtl);
this.Q0b()}}}R0(){this.element&&(Sf.a.Dy(this.element),this.$n.ndb(this.nq.user.clientId),this.tte())}j6h(qa,Jb,Rb,Tc){Jb=new Lg;if(!Tc||!Rb)return Jb;Rb=this.cAi(qa);if(!Rb)return Jb;Jb.top=Rb.y;Jb.left=Rb.x;Jb.height=Rb.height;Jb.width=Rb.width;Jb.rotation=this.LIm(qa);Jb.peb=!0;return Jb}vEj(qa,Jb,Rb,Tc){Gg.H$i();this.lDd=qa;if(Tc){const vd=this.OKf(qa,this.nq.ip.shapeId);if(!vd)return;const Td=!this.element;Td&&this.otf(Jb.ownerDocument,qa);Td||!this.element.parentNode?vd.appendChild(this.element):
this.element.parentNode!==vd&&(this.element.parentNode.removeChild(this.element),vd.appendChild(this.element));this.$n.Dja(this.nq.user);this.element.style.borderColor=this.nq.user.color;this.element.id=Gg.fqb(this.nq);Rb.peb&&(this.element.style.height=Rb.height+"px",this.element.style.top=Rb.top+"px",this.element.style.left=Rb.left+"px",this.element.style.width=Rb.width+"px",Re.a.P8(this.element,Rb.rotation),Re.a.P8(this.$n.element,-1*Rb.rotation),this.oQj(Rb.rotation,Rb.width,this.isSelected(vd),
m.AFrameworkApplication.isRtl),this.Q0b())}this.ybd=!Tc;this.tte()}LIm(qa){return this.element&&this.element.parentNode&&this.AGi(Re.a.getTransform(this.element.parentNode))?this.AGi(Re.a.getTransform(this.element)):this.kAi(qa)}AGi(qa){return qa&&-1<qa.indexOf("deg")&&(qa=parseInt(qa.substring(qa.indexOf("(")+1,qa.indexOf("deg"))),!isNaN(qa))?qa:0}N6j(qa){this.element.style.borderColor=this.nq.user.color;this.element.id=Gg.fqb(this.nq);this.updatePosition(qa)}otf(qa,Jb){this.element=qa.createElement("div");
this.element.setAttribute(Gg.Tuj,!0);Jh.a.Hm(this.element,Gg.yqj,this);this.element.className=Rf.Veo;(qa=Jb.Cb)&&qa.ZT&&(this.element.style.pointerEvents="none");this.element.dir=m.AFrameworkApplication.isRtl?"rtl":"ltr";this.$n=this.bRc.ktf(this.createElement("div"),!0);this.$n.Dja(this.nq.user);this.$n.hide();this.ox.nb(We.a.kH,this.$n.element,this.ZL);this.ox.nb(We.a.nt,this.$n.element,this.Coe);this.$n.element.classList.add(Gg.Uuj);this.element.appendChild(this.$n.element)}eGm(qa,Jb,Rb,Tc){let vd=
qa.y,Td=qa.x,Ed=qa.height;qa=qa.width;(1<Math.abs(Jb.width-Rb.offsetWidth)||1<Math.abs(Jb.height-Rb.offsetHeight))&&Tc&&(vd=Math.round(vd/Tc.Aj),Td=Math.round(Td/Tc.Aj),Ed=Math.round(Ed/Tc.Aj),qa=Math.round(qa/Tc.Aj));return{left:Td,top:vd,height:Ed,width:qa}}isSelected(qa){return qa.classList.contains(Jk.a.Kgc)}oQj(qa,Jb,Rb,Tc){this.$n.element.style.left="auto";this.$n.element.style.top="auto";this.$n.element.style.right="auto";this.$n.element.style.bottom="auto";Rb=Rb?Math.round(.5*Rf.hwa)+Rf.slp:
0;0<=qa&&90>qa||360===qa?(this.$n.element.style.top=-.5*Rf.hwa-Rb+"px",Tc?this.$n.element.style.right=Jb-.5*Rf.hwa+"px":this.$n.element.style.left=Jb-.5*Rf.hwa+"px"):90<=qa&&180>qa?(this.$n.element.style.left=-.5*Rf.hwa-Rb+"px",Tc?this.$n.element.style.bottom=-.5*Rf.hwa+"px":this.$n.element.style.top=-.5*Rf.hwa+"px"):180<=qa&&270>qa?(this.$n.element.style.bottom=-.5*Rf.hwa-Rb+"px",Tc?this.$n.element.style.left=Jb-.5*Rf.hwa+"px":this.$n.element.style.right=Jb-.5*Rf.hwa+"px"):(this.$n.element.style.right=
-.5*Rf.hwa-Rb+"px",Tc?this.$n.element.style.top=-.5*Rf.hwa+"px":this.$n.element.style.bottom=-.5*Rf.hwa+"px")}Qj(qa,Jb){const Rb=this.k7d(qa,Jb);return Rb?Rb.properties:(qa=this.iAi(qa,Jb))?qa.properties:null}OKf(qa,Jb){var Rb=this.k7d(qa,Jb);return Rb&&(Rb=Rb.Tsa(qa.uh,qa))?Rb.element:(Jb=this.iAi(qa,Jb))?Object(y.a)(og.a,Jb).ue(qa.oc).htmlElement:null}k7d(qa,Jb){qa=pi.i(qa.Cb,5);for(const Rb of qa)if(Rb.properties.getValue(Mf.a.Nob)===Jb)return Rb;return null}iAi(qa,Jb){qa=ug.GraphIterator.eb(qa.Cb);
let Rb=qa.Ub(6);for(;Rb;){const Tc=Rb.properties.getValue(Mf.a.Nob);if(ze.ImageReader.Lt(Rb)&&Tc===Jb)return Rb;Rb=qa.Lf(6)}return null}Hvm(qa){const Jb=Xh.a.nf(ze.ImageReader.XB(qa),0);qa=Xh.a.nf(ze.ImageReader.fD(qa),1);return{woa:Jb,Q_m:qa}}kAi(qa){qa=this.Qj(qa,this.nq.ip.shapeId);return ze.ImageReader.g3(qa)}cAi(qa){var Jb=this.nq.ip;if(!Jb||!Jb.shapeId)return null;var Rb=this.Qj(qa,Jb.shapeId);const Tc=this.OKf(qa,Jb.shapeId);if(!Rb||!Tc)return null;let vd=qa=1,Td;({woa:Jb,Q_m:Td}=this.Hvm(Rb));
Object(ak.d)(Rb)?(Rb=ze.ImageReader.Hsa(Rb),qa=Xh.a.nf(Rb[Jg.a.left],0),vd=Xh.a.nf(Rb[Jg.a.top],1)):Rb.hasProperty(Mf.a.Xga)?(Rb=Rb.getValue(Mf.a.Xga),qa+=Xh.a.nf(Rb[Jg.a.left],0),vd+=Xh.a.nf(Rb[Jg.a.top],1)):(qa+=0<Tc.offsetWidth?(Tc.offsetWidth-Jb)/2:2,vd+=0<Tc.offsetHeight?(Tc.offsetHeight-Td)/2:2);return new Sys.UI.Bounds(Math.round(qa),Math.round(vd),Math.round(Jb),Math.round(Td))}Eej(){this.$n&&(this.$n.eyc(),this.iwa=1)}Q0b(){for(const qa of this.$n.cre)if(qa.clientId===this.nq.user.clientId&&
!qa.equals(this.nq.user)){this.$n.Dja(this.nq.user);break}if(this.nq.N_a||2===this.iwa)this.$n.Npd(),this.nq.N_a=!1,this.nq.mga=!0,this.iwa=2;this.nq.mga&&1!==this.iwa||(this.$n.eyc(),this.nq.mga=!0,this.iwa=1)}}Rf.Veo="WACImgPresenceHighlight";Rf.hwa=20;Rf.slp=6;Object(f.a)(Rf,"PresenceImageControl",Gg,[]);var Bg=d(295);class bk{constructor(){this.height=this.top=this.left=this.jVi=0;this.peb=!1;this.rw=this.Nh=null}}Object(f.a)(bk,"PresenceIpControlStyle",null,[1808]);var Kk=d(66);class Pi extends Gg{constructor(qa,
Jb,Rb,Tc,vd,Td=null,Ed=null,lf=null){super(qa,Jb,Rb,Tc,vd,Td,Ed);this.hQc=this.f3a=this.Aac=null;this.hS=Bf=>{!this.$n||this.Jbb&&!this.$n.aCf(Bf)||(this.X9f(),this.rwe(Bf));this.N6j(this.lDd);return!1};this.ZL=()=>{this.$n&&this.yU();return!1};this.Coe=Bf=>{this.$n&&3===Bf.Ag&&(2!==this.iwa?(this.X9f(),this.rwe(Bf)):this.yU());return!1};this.iF=lf}otf(qa){this.element=qa.createElement("div");this.element.setAttribute(Gg.Tuj,!0);Jh.a.Hm(this.element,Gg.yqj,this);this.element.className=Gg.k7n;this.element.dir=
m.AFrameworkApplication.isRtl?"rtl":"ltr";this.ox.nb(We.a.cM,this.element,this.hS);this.Jbb&&(this.ox.nb(We.a.kH,this.element,this.ZL),this.ox.nb(We.a.nt,this.element,this.Coe));this.f3a=this.createElement("div");this.f3a.className=Pi.Weo;this.Jbb||(this.hQc=this.createElement("div"),this.hQc.className=Pi.Zeo,this.f3a.appendChild(this.hQc));this.$n=this.bRc.ktf(this.createElement("div"),this.Jbb);qa=this.Ga.$("NoPresenceUserLookUpBeforeRender");this.iF&&!qa&&(this.nq.user=this.iF.l7f(this.nq.user.clientId)||
this.nq.user);this.$n.Dja(this.nq.user);this.$n.hide();this.$n.element.classList.add(this.Jbb?Gg.Uuj:Pi.L$n);this.f3a.appendChild(this.$n.element);this.element.appendChild(this.f3a)}iQl(){this.Aac&&(tb.a.instance.vf(this.Aac),this.Aac=null)}Q0b(qa){for(var Jb of this.$n.cre)if(Jb.clientId===this.nq.user.clientId&&!Jb.equals(this.nq.user)){this.$n.Dja(this.nq.user);break}Jb=!1;Pi.SNl===this.nq.user.color?({value:Jb}=this.ZRh.Dc(this.nq.user.clientId,!1),Jb||(this.ZRh.Z(this.nq.user.clientId,!0),l.ULS.sendTraceTag(17954772,
302,50,'{ "ClientID" : "'+this.nq.user.clientId+'" , "Event" : "RenderGrayPawn"}'))):({value:Jb}=this.PGj.Dc(this.nq.user.clientId,!1),Jb||(this.PGj.Z(this.nq.user.clientId,!0),l.ULS.sendTraceTag(17954773,302,50,'{ "ClientID" : "'+this.nq.user.clientId+'" , "Event" : "RenderColoredPawn"}')));return qa||this.nq.N_a||2===this.iwa?(this.paj(),this.$n.Npd(),this.nq.N_a=!1,this.nq.mga=!0,this.iwa=2,Pi.Wjp):this.nq.mga&&1!==this.iwa?0:(this.paj(),this.$n.eyc(),this.nq.mga=!0,this.iwa=1,Pi.Vjp)}rwe(qa=null){this.iQl();
const Jb=this.Q0b(!!qa);this.Jbb&&qa&&qa.eventName===We.a.cM||this.zLo(Jb)}yU(){this.$n&&this.iwa&&(this.KFo(),this.$n.hide(),this.iwa=0)}zLo(qa){this.Aac=new oa.a(2,1,qa,()=>{this.Aac=null;this.yU()},56);tb.a.instance.Zb(this.Aac)}updatePosition(qa){if(this.element&&this.element.parentNode){var Jb=this.TAi(qa);if(Jb){qa=Sys.UI.DomElement.getBounds(this.element.parentNode);Jb=new Sys.UI.Bounds(Jb.x-qa.x,Jb.y-qa.y,Pi.nVi,Jb.height);var Rb;({left:qa,top:Jb,height:Rb}=this.hGm(Jb,qa,this.element.parentNode,
this.Vj.instance));this.element.style.height=2*Pi.stc+Rb+"px";this.element.style.top=Jb-Pi.stc+"px";this.element.style.left=qa-Pi.stc+"px";this.f3a.style.height=Math.max(Pi.uej,Rb)+"px";this.rwe()}}}R0(){this.element&&(Sf.a.Dy(this.element),this.tte())}j6h(qa,Jb,Rb,Tc,vd){const Td=new bk;if(!Tc||!Rb)return Td;Tc=this.TAi(qa);if(!Tc)return Td;var Ed=Rb;Rb=qa;if(qa.Kj){var lf=qa.jc;Ed=qa.$f.ilc(this.nq.ip.tca.cp);0>Ed&&0==Ed;qa.jc.oCa?Sf.a.pXa(lf.editingElement,qa.$f.mj.J(Ed))||(Rb=Object(Kk.a)().zd.nl(qa.source),
Jb=Rb.$f.mj.J(Ed)):Jb=Rb.$f.mj.J(Ed);Ed=Jb.getBoundingClientRect()}Ed=new Sys.UI.Bounds(Tc.x-Ed.x,Tc.y-Ed.y,Pi.nVi,Tc.height);qa=Ed.y;Tc=Ed.x;Ed=Ed.height;lf=this.Vj.instance;vd&&lf&&(vd=lf.Aj,qa=Math.round(qa/vd),Tc=Math.round(Tc/vd),Ed=Math.round(Ed/vd));Td.top=qa-Pi.stc;Td.left=Tc-Pi.stc;Td.height=2*Pi.stc+Ed;Td.jVi=Math.max(Pi.uej,Ed);Td.peb=!0;Td.Nh=Jb;Td.rw=Rb;return Td}vEj(qa,Jb,Rb,Tc){Gg.H$i();this.lDd=qa;qa=Rb.Nh;Jb=Rb.rw;if(qa&&Jb){if(Tc){const vd=!this.element;vd&&this.otf(qa.ownerDocument);
vd||!this.element.parentNode?qa.appendChild(this.element):this.element.parentNode!==qa&&(this.element.parentNode.removeChild(this.element),qa.appendChild(this.element));this.lDd=Jb;qa=this.nq.user.color;this.f3a.style.borderColor=qa;this.Jbb||(this.hQc.style.borderColor=qa);this.element.id=Gg.fqb(this.nq);Rb.peb&&(this.element.style.height=Rb.height+"px",this.element.style.top=Rb.top+"px",this.element.style.left=Rb.left+"px",this.f3a.style.height=Rb.jVi+"px",this.rwe())}this.ybd=!Tc;this.tte()}else l.ULS.sendTraceTag(520950942,
302,50,`Skip IpControl rendering due to paragraphElement is null:${!qa} or paragraphViewElement is null:${!Jb}`)}dispose(){this.element&&(this.R0(),this.ox.xc(We.a.cM,this.element,this.hS),this.Jbb&&(this.ox.xc(We.a.kH,this.element,this.ZL),this.ox.xc(We.a.nt,this.element,this.Coe)),$c.a.JD(this.$n),this.element=this.$n=null);super.dispose()}N6j(qa){const Jb=this.nq.user.color;this.f3a.style.borderColor=Jb;this.Jbb||(this.hQc.style.borderColor=Jb);this.element.id=Gg.fqb(this.nq);this.updatePosition(qa)}hGm(qa,
Jb,Rb,Tc){let vd=qa.y,Td=qa.x;qa=qa.height;(1<Math.abs(Jb.width-Rb.offsetWidth)||1<Math.abs(Jb.height-Rb.offsetHeight))&&Tc&&(vd=Math.round(vd/Tc.Aj),Td=Math.round(Td/Tc.Aj),qa=Math.round(qa/Tc.Aj));return{left:Td,top:vd,height:qa}}TAi(qa){const Jb=this.nq.ip;if(!Jb)return null;let Rb;try{const Tc=Jb.tca.cp;Rb=Bg.a.F2(Tc,qa,0<Tc,!1,!1,!1)}catch(Tc){l.ULS.sendTraceTag(4301318,302,15,"Could not determine the bounds of IP: isYielding={0} message={1} stack={2}",tb.a.instance.Rw,Tc.message,Tc.stack),Rb=
null}return Rb}}Pi.L$n="WacPawn";Pi.nVi=2;Pi.Vjp=7E3;Pi.Wjp=2E3;Pi.stc=5;Pi.Weo="presenceIp";Pi.Zeo="PresenceSmallBox";Pi.uej=10;Pi.SNl="0xcccccc";Object(f.a)(Pi,"PresenceIpControl",Gg,[]);class Uj{constructor(qa,Jb,Rb,Tc,vd=null,Td=null,Ed=null){this.DFc={};this.BFc={};this.wbh={};this.bRc=qa;this.ox=Jb;this.eo=Rb;this.xQa=Tc;this.JZ=vd;this.Ga=Td;this.iF=Ed}get jMl(){return this.DFc}get rci(){return this.BFc}dGm(qa){const Jb=!!this.Ga&&this.Ga.$("PeoplesWellExtraButtonInfoIsEnabled");return qa.ip.shapeId&&
Jb?this.iGm(qa):this.jGm(qa)}iGm(qa){const Jb=qa.ip.shapeId.toString();this.wbh[qa.user.clientId]=Jb;const Rb=this.BFc[Jb];return Rb?(Rb.nq=qa,{returnValue:Rb,SFe:!0}):{returnValue:this.BFc[Jb]=new Rf(qa,this.bRc,this.ox,this.eo,this.xQa,this.JZ,this.Ga),SFe:!1}}jGm(qa){const Jb=qa.user.clientId,Rb=this.DFc[Jb];return Rb&&Rb.nq.user.equals(qa.user)?(Rb.nq=qa,{returnValue:Rb,SFe:!0}):{returnValue:this.DFc[Jb]=new Pi(qa,this.bRc,this.ox,this.eo,this.xQa,this.JZ,this.Ga,this.iF),SFe:!1}}UAi(qa){return this.DFc[qa]}Dvm(qa){return(qa=
this.BFc[this.wbh[qa]])&&!qa.VFe()?qa:null}JVl(){var qa=this.DFc;for(const Jb in qa)qa[Jb].dispose();qa=this.BFc;for(const Jb in qa)qa[Jb].dispose()}}Object(f.a)(Uj,"PresenceControlProvider",null,[]);var jk=d(748);class Bj{constructor(){this.akb=0}VCi(){this.akb++;this.akb===Number.MAX_VALUE&&(this.akb=1);return this.akb}static get instance(){return Bj.dNc}}Bj.dNc=new Bj;Object(f.a)(Bj,"PacketIdGenerator",null,[793]);class Vj{constructor(qa,Jb,Rb){this.MLo=qa;this.W3m=Jb;this.N5i=Rb}}Object(f.a)(Vj,
"SuccessfulInboundReplicationCallbackData",null,[]);class Cl{constructor(qa,Jb,Rb,Tc,vd,Td,Ed){this.oJo=(lf,Bf)=>{Bf.type||(lf=this.gm.fji>=this.muk,this.xQk&&lf?(lf=this.XTe())?lf.vBf():l.ULS.sendTraceTag(19682513,500,15,"ActivePage ContentReplicator was null, we are abandoning the inbound attempt."):this.dD())};this.d3n=lf=>{if(lf=Object(y.a)(Vj,lf)){var Bf=lf.W3m.Fi.toString(),vf=this.XTe(),fd=vf.Is,Wc="";fd!==lf.N5i&&(l.ULS.sendTraceTag(19964236,500,50,"Time saved due to force inbound on update notification message = {0} ms",
lf.MLo.toString()),Wc=this.aBm(vf,fd,lf.N5i));l.ULS.sendTraceTag(19964237,500,50,"Revisions: {0}, InboundDuration: {1}",Wc,Bf)}else l.ULS.sendTraceTag(19964235,500,10,"The callback data was null")};this.mJo=qa;this.XTe=Jb;this.gm=Rb;this.xQk=vd;this.muk=Td;this.v8b=Tc;this.Pp=Ed;this.mJo.JO(this.oJo)}dD(){const qa=this.XTe();if(!qa)l.ULS.sendTraceTag(19682514,500,15,"ActivePage ContentReplicator was null, we are abandoning the inbound attempt.");else if(!this.v8b()&&qa.oqc){let Jb=-1;null!=qa&&(Jb=
qa.mva());const Rb=this.Pp.Vf("Task","ShoulderTapInboundReplicationTimer");qa.dD(this.d3n,null,new Vj(Jb,Rb,qa.Is))}}aBm(qa,Jb,Rb){const Tc=new Sys.StringBuilder;qa=qa.node.td.store.getRevision(Jb);if(!qa)return l.ULS.sendTraceTag(19964238,500,10,"The revision we got from the last replicator revisionId was null - {0}",{["lastRevisionId"]:Jb}),"";for(Tc.append(qa.id.hu);Jb!==Rb;){Tc.append(", ");Tc.append(Jb.hu);qa=qa.zm;if(!qa)break;Jb=qa.id}return Tc.toString()}}Object(f.a)(Cl,"ContentNotificationManager",
null,[]);class ah extends Cl{constructor(qa,Jb,Rb,Tc,vd,Td,Ed){super(qa,Jb,Rb,Tc,vd,Td,Ed)}static get vva(){return null!=ah.H3g?ah.H3g:ah.H3g=Fa.a.instance.resolve("Box4.Presence.IRtcProxyProvider")}static init(){if(ub.StaticActiveAppFrame.za()){var qa=ub.StaticActiveAppFrame.za().ib;qa&&(qa.Eja(ah.Wed),qa=qa.$c)&&(ah.zJ=qa.yg,ah.zJ&&Yb.StaticTheCoauthManager.bta().continueWith(ah.Beg))}}static Beg(){ah.pyd=Yb.StaticTheCoauthManager.bta().result;ah.pyd&&ah.pyd.Jo&&ah.vva.gD().continueWith(ah.Xfd)}static Xfd(){ah.Yh=
ah.vva.gD().result;if(ah.Yh){var qa=m.AFrameworkApplication.K,Jb=qa.$("Box4ThrottleInboundRequests");qa=qa.ic("Box4ThrottleInboundsAtUserCount",20);ah.zJ.clc=()=>ah.Yh.Vba;ah.myd=ah.myd||new ah(ah.Yh,()=>ah.zJ,ah.pyd,()=>m.AFrameworkApplication.ol,Jb,qa,ub.StaticActiveAppFrame.za().hs);ah.myd.dD()}}static Wed(qa){ah.myd||(qa.pdb(ah.Wed),ah.init())}}ah.myd=null;ah.Yh=null;ah.zJ=null;ah.pyd=null;Object(f.a)(ah,"WordContentNotificationManager",Cl,[]);class zh{constructor(qa,Jb,Rb,Tc,vd,Td){this.fzd=
null;this.mAh=qa;this.yd=Rb;this.vSa=Tc;this.wC=vd;this.hi=Td;this.q3b=Jb}clone(){return new zh(this.mAh,this.q3b.clone(),this.yd,this.vSa,this.wC,this.hi)}get cp(){if(null!=this.fzd)return this.fzd;var qa=this.mAh.paragraphId;if(qa.equals(mg.a.nil))return 0;var Jb=this.vSa();if(!Jb)return 0;qa=Jb.Eb(qa);if(!qa)return l.ULS.sendTraceTag(7685326,302,15,"Paragraph Node is null so returning a CP with value 0"),0;Jb=this.yd.pMb(this.yd.lZa(qa.characterData,qa.qa),this.q3b);if(this.wC){const Rb=qb.a.Tc(qa,
Jb);this.hi&&qa.gv&&(Rb.Fb=this.hi.aMf(qa,Jb,this.q3b.iJa));Jb=this.wC.aAa(Rb,!0)}return Jb}Ngg(){null==this.fzd&&(this.fzd=this.cp)}equals(qa){return qa?this.q3b.isEqual(qa.q3b,!1):!1}}Object(f.a)(zh,"WordPresenceCp",null,[786,96,787]);class Ql{constructor(qa,Jb){this.wC=qa;this.hi=Jb}create(qa,Jb,Rb,Tc){return new zh(qa,Jb,Rb,Tc,this.wC,this.hi)}}Object(f.a)(Ql,"Factory",null,[765]);class al extends Sys.EventArgs{constructor(qa,Jb,Rb){super();this.paragraphId=qa;this.MI=Jb;this.tXf=Rb}}Object(f.a)(al,
"ParagraphChangedEventArg",Sys.EventArgs,[]);class ji{constructor(qa){this.cp=qa}equals(qa){return qa?this.cp===qa.cp:!1}clone(){return new ji(this.cp)}}Object(f.a)(ji,"PresenceCp",null,[786,96]);class kh{constructor(qa,Jb,Rb,Tc,vd){this.paragraphId=qa;this.cp=Jb;this.length=Rb;this.shapeId=Tc;this.dryDeletion=vd}}Object(f.a)(kh,"SerializablePresenceIpData",null,[]);class bh{constructor(qa,Jb,Rb,Tc=0,vd=0){this.bya=null;qa&&(this.bya=mg.a.Cf(qa));this.lAh=new ji(Jb);this.pNa=Rb;this.PEh=Tc;this.cgh=
vd}get paragraphId(){return this.bya}get tca(){return this.lAh}get shapeId(){return this.PEh}get dryDeletion(){return this.cgh}isValid(){return 0<=this.tca.cp&&!!this.paragraphId&&!this.paragraphId.equals(mg.a.nil)}getData(){return new kh(this.paragraphId.toString(),this.tca.cp,this.pNa,this.shapeId,this.dryDeletion)}clone(){const qa=new bh;qa.bya=this.paragraphId;qa.lAh=this.tca?this.tca.clone():null;qa.pNa=this.pNa;qa.PEh=this.shapeId;qa.cgh=this.dryDeletion;return qa}static vMb(qa){return qa.paragraphId&&
void 0!==qa.cp&&null!==qa.cp&&void 0!==qa.length&&null!==qa.length?new bh(qa.paragraphId,qa.cp,qa.length,void 0,qa.dryDeletion):null}}Object(f.a)(bh,"PresenceIp",null,[784,96]);class hj{constructor(qa,Jb){this.ip=qa;this.user=Jb}}Object(f.a)(hj,"SerializablePresenceData",null,[]);class uj{constructor(qa,Jb){this.N_a=this.mga=this.wrc=!1;this.e3a=Jb;this.user=qa}get ip(){return this.e3a}aOf(){return new hj(this.ip?this.ip.getData():null,this.user.getData())}Bzi(){return this.user.clientId+(this.e3a?
this.e3a.paragraphId.toString():mg.a.nil.toString())}isValid(){const qa=!!this.user&&this.user.isValid(),Jb=!this.ip||this.ip.isValid();return qa&&Jb}clone(){const qa=new uj;qa.user=this.user?this.user.clone():null;qa.e3a=this.e3a?this.e3a.clone():null;qa.mga=this.mga;qa.wrc=this.wrc;qa.N_a=this.N_a;return qa}static vMb(qa){return qa?new uj(Ja.vMb(qa.user),qa.ip?bh.vMb(qa.ip):null):null}}Object(f.a)(uj,"PresenceInfo",null,[783,96]);class wg extends ja.a{constructor(){super();this.pNc={};this.L1a=
{};this.pih=!1}get r8n(){return this.pNc}get k0i(){return!!m.AFrameworkApplication.K&&m.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled")}yQh(qa){this.addHandler("PPC",qa)}eEj(qa){this.removeHandler("PPC",qa)}g4c(qa){return qa.ip.paragraphId.toString()}xff(qa,Jb=!1){this.pih||(this.pih=!0,l.ULS.sendTraceTag(4289312,302,50,"First presence added to data manager"));var Rb=({Xeo:Tc}=this.ntn(qa)).returnValue;if(Tc&&!Jb)(Rb=this.L1a[qa.user.clientId])&&0<=Rb.length&&(Rb[Rb.length-1].ip.pNa=
qa.ip.pNa);else{Rb||this.UCj(qa.user.clientId);this.k0i&&Rb&&this.Swp(qa);Jb=this.g4c(qa);var Tc=qa.user.clientId;var vd=this.pNc[Jb]||[],Td=this.L1a[Tc]||[];Td.length>=wg.idj&&(Td=Td.splice(-wg.HSn,wg.idj));Rb||vd.push(Tc);Td.push(qa);this.pNc[Jb]=vd;this.L1a[Tc]=Td;qa.ip.paragraphId.equals(mg.a.nil)||this.Rpg(qa.ip.paragraphId,qa,!0)}}ntn(qa){var Jb=this.L1a[qa.user.clientId];const Rb=!Jb||0>=Jb.length?null:Jb[Jb.length-1],Tc=!!Rb&&this.g4c(Rb)===this.g4c(qa);Jb=Tc&&Rb.ip.tca.equals(qa.ip.tca)&&
Rb.user.equals(qa.user);this.k0i&&Jb&&Rb.ip.shapeId&&qa.ip.shapeId&&Rb.ip.shapeId!==qa.ip.shapeId&&(Jb=!1);return{returnValue:Tc,Xeo:Jb}}Swp(qa){const Jb=this.wMl(qa);Jb&&Jb.ip.shapeId&&(qa.ip.shapeId&&qa.ip.shapeId===Jb.ip.shapeId||this.Rpg(Jb.ip.paragraphId,Jb,!1))}wMl(qa){qa=this.L1a[qa.user.clientId];return!qa||0>=qa.length?null:qa[qa.length-1]}UCj(qa){const Jb=this.L1a[qa];if(Jb&&0<Jb.length){const Rb=Jb[0].ip.paragraphId,Tc=this.g4c(Jb[0]);delete this.L1a[qa];this.Ryo(Tc,qa);Rb.equals(mg.a.nil)||
this.Rpg(Rb,Jb[0],!1)}}wvi(qa){return this.pNc[qa]}Z1c(qa,Jb,Rb,Tc=!1){const vd=[],Td=this.wvi(qa);if(!Td)return vd;for(let Ed=0;Ed<Td.length;Ed++){const lf=Td[Ed],Bf=this.L1a[lf];let vf=!1;for(let fd=Bf.length-1;0<=fd;fd--){const Wc=Bf[fd];if(Tc){if(Wc.mga&&Wc.ip.paragraphId.equals(mg.a.Cf(qa))){vf=!0;vd.push(Wc);break}}else if(Object(zk.a)(uj,Wc)?Wc.ip.pNa===Jb:Wc.ip.pNa===Rb){vf=!0;Wc.wrc=!0;vd.push(Wc);this.L1a[lf]=Bf.splice(fd,Bf.length);break}}!vf&&0<Bf.length&&Bf[0].wrc&&Bf[0].ip.paragraphId.equals(mg.a.Cf(qa))&&
vd.push(Bf[0])}return vd}khm(qa){if(!qa||!qa.Ra||!qa.Ra.node)return null;qa=this.Z1c(qa.Ra.node.id.toString(),0,0,!0);qa=this.sQm(qa);qa.sort((Jb,Rb)=>{if(!(Jb&&Jb.userName&&Rb&&Rb.userName))return l.ULS.sendTraceTag(542165082,302,15,"Missing presence user info for user in PresenceInfos"),0});return qa}sQm(qa){if(!qa||!qa.length)return[];const Jb=[],Rb=new F.a(I.a.th());for(let Tc=0;Tc<qa.length;Tc++){const vd=qa[Tc].user;vd.isAnonymous&&Rb.contains(vd.clientId)||!vd.isAnonymous&&vd.email&&Rb.contains(vd.email)||
(Jb.push(vd),Rb.add(vd.isAnonymous?vd.clientId:vd.email))}return Jb}Rpg(qa,Jb,Rb){this.raiseEvent("PPC",new al(qa,Jb,Rb))}Ryo(qa,Jb){Array.remove(this.pNc[qa],Jb)}}wg.idj=10;wg.HSn=2;Object(f.a)(wg,"PresenceDataManager",ja.a,[1773]);class Ni extends wg{constructor(qa){super();this.nG=qa}xff(qa,Jb=!1){super.xff(qa,Jb)}g4c(qa){return qa.ip.Yc.toString()}wvi(qa){qa=this.nG.Eb(mg.a.Cf(qa));if(!qa)return null;qa=qa.ja(Mf.a.Yc,0);return this.r8n[qa.toString()]}}Object(f.a)(Ni,"WordPresenceDataManager",
wg,[]);var Md=d(1549),nf=d(1156),bn=d(1989),Wi=d(17),ee=d(1448);class qd{constructor(qa,Jb,Rb,Tc,vd,Td,Ed,lf,Bf,vf,fd,Wc,sg,Jf,Qk,$e,Ei,ve,Ad,re,ea,eb,Ob,Zb){this.xTa=Array(5);this.ncf=this._started=this.z8e=!1;this.$4e=null;this.MAh=new F.a(I.a.th());this.nJd={};this.EYe=!1;this.Y7n=()=>{if(!this.ncf&&!this.Bl.Hy){var mc=new oa.a(0,1,20,()=>{const Yc=new N.a;var ld=this.lkb.jMl;for(var oe in ld){const Vd=ld[oe];Vd.ybd&&Yc.add(Vd.nq.ip.paragraphId)}if(this.cme){ld=this.lkb.rci;for(const Vd in ld)oe=
ld[Vd],oe.ybd&&!Yc.contains(oe.nq.ip.paragraphId)&&Yc.add(oe.nq.ip.paragraphId)}this.Dti(Yc);this.ncf=!1},72);this.Gb.Zb(mc);this.ncf=!0}};this.mlj=()=>{this.z8e&&(this.Xxg(),this.z8e=!1)};this.o8=(mc,Yc)=>{this.RLj(Yc.Gm.currentSelection)};this.aV=(mc,Yc)=>{mc=Yc.$ha;for(var ld in mc){const oe=mc[ld];this.Ga.$("CashTelemetryIsEnabled")&&this.w_c(oe,new Date,null);oe.ip?this.nff(oe):this.Wkd(oe.user.clientId)}Yc=Yc.qZc;for(ld=0;ld<Yc.length;++ld)this.YQl(Yc[ld]);this.Hue()};this.Ogg=(mc,Yc)=>{Yc.paragraphId?
this.Yyp(Yc.paragraphId.toString(),Yc.oyn,this.nJd):l.ULS.shipAssertTag(8758481,302,!1,"null paraid")};this.Vuj=(mc,Yc)=>{Yc.paragraphId&&(mc=this.LK.Eb(Yc.paragraphId))&&((Object(zk.a)(uj,Yc.MI)?this.NTe(mc):this.OTe(mc))===Yc.MI.ip.pNa&&this.FLo(Yc.paragraphId),this.cme&&this.Yeo(Yc))};this.Wp=qa;this.hb=Tc;this.iF=vd;this.ZGb=Td;this.Bl=Bf;this.kuk=vf;this.lkb=fd;this.LK=Rb;this.NTe=sg;this.OTe=Jf;this.omk=Ed;this.nuk=lf;this.pSa=Qk;this.Oq=$e;this.Pc=Ei;this.Gb=ve;this.dIh=eb;this.oKk=Zb;this.a5e=
re;this.Ga=ea;this.RId=Jb;qd.TJd=new lb.a;for(qa=0;qa<this.RId.length;qa++)this.RId[qa].fvo(this);this.ZGb.yQh(this.Vuj);this.Wp.jza(this.aV);Ob&&this.Bl.A6(this.Y7n);this.Wp.Yte(this)}get cme(){return!!this.Ga&&this.Ga.$("PeoplesWellExtraButtonInfoIsEnabled")}Hue(qa=!1){this.dIh&&!qa||this.sEj()}sEj(){const qa=new N.a,Jb=this.nJd;for(const Rb in Jb)qa.add(mg.a.Cf(Rb));this.Dti(qa);this.nJd={}}Xxg(){this.hb.gb&&this.RLj(this.hb.gb.currentSelection,!0)}RLj(qa,Jb=!1){this.oKk||(this.LK.Bm.dma||Jb?qa?
(Jb=this.QIl(qa))?this.Wp.jyg(Jb):(this.Wp.jyg(null),l.ULS.sendTraceTag(4281418,302,50,"Not supported selection context {0}",qa.Ra.contextId)):this.Wp.jyg(null):this.z8e=!0)}QIl(qa){if(!this.cme||!qa.Ttb)if(qa=Wi.SelectionEditor.Wj(qa,!0,!1),!Wi.SelectionEditor.Dm(qa))return null;return this.kYh(qa)}kYh(qa){const Jb=qa.Ra.cpBegin,Rb=qa.Ra.node.id;qa=this.NTe(qa.Ra.node);return new bh(Rb.toString(),Jb,qa)}w_c(qa,Jb,Rb){if(this.a5e)if(qa&&qa.user&&qa.user.clientId){var Tc=qa.user.clientId;this.MAh.contains(Tc)||
(this.$4e?(this.$4e.w_c(Tc,Jb,null,qd.VIm(Rb||qa.user.client)),this.MAh.add(Tc)):this.a5e.continueWith(()=>{this.$4e=this.a5e.result;this.w_c(qa,Jb,Rb)}))}else l.ULS.sendTraceTag(42262876,302,15,"invalid presence")}fGm(qa){const Jb=new N.a;for(let Rb=0;Rb<qa.length;Rb++)Jb.add(this.jQm(qa[Rb]));return Jb}nff(qa){var Jb=null;qa&&qa.user&&(Jb=qa.user.client);qa=qa.clone();qa.user=this.iF.l7f(qa.user.clientId)||qa.user;this.Ga.$("CashTelemetryIsEnabled")&&this.w_c(qa,new Date,Jb);qa.isValid()&&!qa.user.wN()&&
(Jb=qa.user.clientId,qd.TJd.mb(Jb)||this.kMi(Jb),this.Nyp(Jb),qa.user.userName=CommonUIStrings.l_AnonymousUserName);this.ZGb.xff(qa,!1)}Nyp(qa){const {value:Jb}=qd.TJd.Dc(qa,!1);Jb||(qd.TJd.Z(qa,!0),l.ULS.sendTraceTag(17954774,302,50,'{ "ClientID" : "'+qa+'" , "Event" : "CreateAnonymousGrayPawn"}'))}kMi(){}Wkd(qa){this.ZGb.UCj(qa)}YQl(qa){this.Wkd(qa);const Jb=this.lkb.UAi(qa);Jb&&(Jb.yDj(this.Ogg),Jb.dispose());this.cme&&(qa=this.lkb.Dvm(qa))&&(qa.yDj(this.Ogg),qa.dispose())}Jkc(qa){if(12!==qa.type)return new N.a;
qa=this.ZGb.Z1c(qa.id.toString(),this.NTe(qa),this.OTe(qa));return 0>=qa.length?new N.a:this.fGm(qa)}Yyp(qa,Jb,Rb){!Jb&&qa in Rb&&delete Rb[qa]}dispose(){this.stop();this.ZGb.eEj(this.Vuj);this.Wp.$Za(this.aV);this.Wp.vLg(this);for(let qa=0;qa<this.RId.length;qa++)this.RId[qa].Fsp(this);$c.a.Kwg([this.omk,this.nuk,this.Wp]);this.lkb.JVl()}jQm(qa){let Jb=!1;qa=({SFe:Jb}=this.lkb.dGm(qa)).returnValue;Jb||qa.Z_k(this.Ogg);return qa}kKi(qa){qa=this.LK.Eb(qa);if(!qa)return this.xTa[0]||(l.ULS.sendTraceTag(4281420,
302,50,"Could not find the node in object space"),this.xTa[0]=!0),null;if(!Ma.ParagraphReader.Xb(qa))return this.xTa[1]||(l.ULS.sendTraceTag(4281421,302,50,"Not a paragraph node"),this.xTa[1]=!0),null;if(!qa.ue(this.Bl.oc))return this.xTa[2]||(l.ULS.sendTraceTag(4281422,302,50,"No ViewElement found for this node"),this.xTa[2]=!0),null;if(!qa.anchor)return this.xTa[3]||(l.ULS.sendTraceTag(4281423,302,50,"node is not anchored"),this.xTa[3]=!0),null;this.xTa[4]||(l.ULS.sendTraceTag(4564931,302,50,"Valid paragraph node found for rendering ip"),
this.xTa[4]=!0);return qa}ACj(qa){qa=this.ZGb.Z1c(qa.toString(),-1,-1,!0);if(!Zg.a.Tf(qa))for(const Jb of qa)(qa=this.lkb.UAi(Jb.user.clientId))&&qa.element&&qa.R0()}Dti(qa){if(qa.count){var Jb=new N.a;for(var Rb of qa)(qa=this.kKi(Rb))?Jb.add(qa):this.ACj(Rb);if(Jb.count){Rb=this.Pc.Mc(2);try{Rb.set(this.Oq);for(const Tc of Jb)this.zhi(Tc)}finally{Rb&&Rb.dispose()}}}}zhi(qa){qa.uI(this.Bl.oc,32,!0);qa.uI(this.kuk,32,!0)}FLo(qa){this.nJd[qa.toString()]=null;this.dIh&&!this.EYe&&(qa=new oa.a(0,1,200,
()=>{this.EYe=!1;this.sEj()},70),this.Gb.Zb(qa),this.EYe=!0)}Yeo(qa){if(qa.MI.ip.shapeId&&!qa.tXf){var Jb=this.lkb.rci[qa.MI.ip.shapeId.toString()];Jb&&Jb.ndb(qa.MI.user.clientId)}}stop(){this._started&&(this._started=!1,this.hb.nY(this.o8),ee.a.instance.$Dj(this.mlj))}start(){if(!this._started){this._started=!0;this.hb.Cw(this.o8);ee.a.instance.ORd(this.mlj);var qa=this.Wp.oqb();delete qa[this.pSa.clientId];this.aV(null,new bn.a(qa,[]));this.Xxg()}}bAe(qa){if(qa&&qa.isValid()&&qa.ip){var Jb=this.ZGb.Z1c(qa.ip.paragraphId.toString(),
-1,-1),Rb=!1,Tc=null;for(let vd=0;vd<Jb.length;vd++)if(Tc=Jb[vd],Tc.user.clientId===qa.user.clientId){Rb=Tc.N_a=!0;break}if(Rb)if(Jb=Tc.ip.paragraphId,qa=this.kKi(Jb)){Jb=this.Pc.Mc(2);try{Jb.Ab(qa),this.zhi(qa)}finally{Jb&&Jb.dispose()}}else this.ACj(Jb)}}static VIm(qa){return qa?qa?1===qa?1:2===qa?2:0:2:0}}qd.TJd=null;Object(f.a)(qd,"PresenceManager",null,[1769,13,729,1770,1771,1772]);class Il{constructor(qa,Jb,Rb,Tc){this.R5b=null;this._started=this.eXe=!1;this.rJb=null;this.Jua=(vd,Td)=>{if(!m.AFrameworkApplication.ol&&
(vd=this.Q7j(Td.Gm),this.R5b&&vd)){vd=this.DPe.Z1c(this.R5b.toString(),-1,-1,!0);for(Td=0;Td<vd.length;Td++)this.rJb[vd[Td].user.clientId]=vd[Td];0>=vd.length||(vd=this.pFl(vd),this.Rp.sendNotification(vd,!0))}};this.Zmj=(vd,Td)=>{this.hb.gb&&!m.AFrameworkApplication.ol&&this.eXe&&this.R5b&&this.R5b.equals(Td.paragraphId)&&(vd=null,!Td.tXf||Td.MI.user.clientId in this.rJb?Td.tXf||(vd=this.Jai(Td.MI.user.userName,!1),delete this.rJb[Td.MI.user.clientId]):(vd=this.Jai(Td.MI.user.userName,!0),this.rJb[Td.MI.user.clientId]=
Td.MI),vd&&this.Rp.sendNotification(vd,!0))};this.Yh=Tc;this.hb=Jb;this.DPe=qa;this.Rp=Rb;this.Yh.Yte(this)}start(){this._started||(this._started=!0,this.rJb={},this.DPe.yQh(this.Zmj),this.hb.Cw(this.Jua),this.Q7j(this.hb.gb))}stop(){this._started&&(this._started=!1,this.rJb=null,this.DPe.eEj(this.Zmj),this.hb.nY(this.Jua))}pFl(qa){if(1===qa.length)return String.format(Box4Intl.Box4Strings.l_OtherUsersEditingParagraphSingle,qa[0].user.userName);const Jb=[],Rb=qa.length;for(let Tc=0;Tc<Rb;Tc++)Jb.push(qa[Tc].user.userName);
return String.format(Box4Intl.Box4Strings.l_OtherUsersEditingParagraphMany,Jb.join(Box4Intl.Box4Strings.l_DisplayNameSeparator))}Jai(qa,Jb){return String.format(Jb?Box4Intl.Box4Strings.l_UserJoiningParagraph:Box4Intl.Box4Strings.l_UserLeavingParagraph,qa)}dispose(){this.Yh.vLg(this);this.stop()}Q7j(qa){if(!qa)return!1;qa=qa.currentSelection;if(!qa)return!1;qa=qa.Ra;if(!qa)return!1;this.eXe=Wi.SelectionEditor.mf(qa);qa=qa.node.id;if(qa.equals(this.R5b)||!this.eXe)return!1;this.R5b=qa;this.rJb={};return!0}}
Object(f.a)(Il,"PresenceAccessibilityManager",null,[13,729]);class Vg{constructor(qa,Jb){this._started=!1;this.FM=null;this.rEd=!1;this.kfd=()=>{this._started&&this.CLj()};this.Yh=qa;Jb&&(this.FM=Jb,this.FM.dmb(this.kfd));this.Yh.Yte(this)}start(){this._started||(this._started=!0,this.FM?this.CLj():this.Yh.nC(1,this.n$h()))}CLj(){const qa=this.rEd;(this.rEd=!!this.FM.mz)&&!qa&&this.Yh.nC(1,this.n$h())}n$h(){const qa={};qa.Id="{"+m.AFrameworkApplication.userSessionId.toUpperCase()+"}";qa.HQ=!1;qa.NT=
1;qa.WEB=!0;return qa}stop(){this._started&&(this._started=this.rEd=!1)}dispose(){this.Yh.vLg(this);this.FM&&this.FM.ADj(this.kfd)}}Object(f.a)(Vg,"EditorsTableNotifier",null,[13,729]);var oi=d(362),Ah=d(15);class ag extends qd{constructor(qa,Jb,Rb,Tc,vd,Td,Ed,lf,Bf,vf,fd,Wc,sg,Jf,Qk,$e,Ei,ve,Ad,re,ea,eb,Ob,Zb,mc,Yc,ld,oe,Vd,ce,pe){super(qa,Jb,Rb,Tc,vd,Td,Ed,lf,Bf,vf,fd,sg,Jf,Qk,$e,Ad,re,ea,eb,Ob,Zb,mc,Yc,Vd);this.gm=null;this.DZl=Sd=>{const Oe=!!this.gm.nB.Ljc(Sd);l.ULS.sendTraceTag(579179741,302,
50,"ClientId:{0} isPresentAfterPoll:{1}",Sd,Oe)};this.CZl=(Sd,Oe)=>{l.ULS.sendTraceTag(579179742,302,15,"EditorsReplicator failed with {0} when looking for ClientId {1}",Oe,Sd)};this.Jma=()=>{if(2===ag.Yh.connectionState&&!Ca.SessionStatusManager.instance.Aba){const Sd={};Sd.qs=m.AFrameworkApplication.rootQuerySignature;ag.Yh.s9(Sd)}};Wc.fb(Ah.a.C7o,bb.a.application,ag.yYk,64);Wc.fb(Ah.a.Csg,bb.a.application,ag.Csg,64);Wc.fb(Ah.a.jpg,bb.a.application,ag.jpg,96);Wc.fb(Ua.a.bAe,bb.a.application,ag.B7o,
64);this.$K=Ei;this.yd=ve;this.IJb=ld;this.pSa.ouc=oe;this.pSa.ouc.b2k(ag.$mj);ce.continueWith(()=>{this.gm=ce.result});l.ULS.sendTraceTag(4006600,302,50,"WordPresenceManager Initialized");(this.g2=pe)&&this.g2.execute(Sd=>{Sd.OTa(this.Jma)})}Pkc(qa){if(!qa||!qa.anchor)return null;for(qa=qa.anchor.Uq;qa;qa=qa.dC)if(qa.OLa)return qa.kt.node;return null}kYh(qa){var Jb=null;Jb=m.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled");var Rb=qa.Ra.cpBegin,Tc=qa.Ra.node;Jb&&ze.ImageReader.Lt(Tc)&&
(Tc=this.Pkc(Tc));if(!Tc)return l.ULS.sendTraceTag(51242309,302,15,"selectedNode is null"),null;Tc=this.OTe(Tc);const vd=qa.Ra.node.ja(Mf.a.Yc,0);if(!this.$K)return l.ULS.sendTraceTag(35997152,302,15,"paragraphWordIdMapping is null"),null;var Td=this.$K.value.brb(vd);const Ed=ag.nG.Eb(Td);if(!Ed)return l.ULS.sendTraceTag(16791249,302,15,"Can't find pid "+Td),null;Rb=this.yd.SBc(this.yd.lZa(Ed.characterData,Ed.qa),Rb);Rb.iJa=-1===qa.Ra.Fb?0:qa.Ra.Fb;Td=0;Jb&&qa.Ttb&&(Td=this.HKm(qa));return Jb=new Jd(this.$K.value,
vd,Tc,Rb,this.yd,()=>ag.nG,this.IJb,Td)}HKm(qa){const Jb=ze.ImageReader.MKa(qa.Ra);return Jb?Jb.properties.ja(Mf.a.Nob,0):qa.Ra.node.properties.ja(Mf.a.Nob,0)}kMi(qa){this.gm&&this.gm.fsa&&this.gm.fsa.dD(this.DZl,this.CZl,qa)}dispose(){this.g2&&this.g2.execute(qa=>{qa.wZb(this.Jma)});super.dispose()}static get Dw(){return Fa.a.instance.resolve("Common.Utils.IAriaNotifier")}static gD(){return ag.pJc.task}static get_instance(){return ag.SJd.task}static kGm(){return ag.nAh.task}static get vva(){return null!=
ag.G3g?ag.G3g:ag.G3g=Fa.a.instance.resolve("Box4.Presence.IRtcProxyProvider")}static init(){ag.SJd||(ag.SJd=new w.a);ag.Bih&&(l.ULS.sendTraceTag(4256585,302,50,"WordPresenceManager Init"),ag.Bih=!1);if(ub.StaticActiveAppFrame.za()){var qa=ub.StaticActiveAppFrame.za().ib;qa?(qa.Eja(ag.Wed),ag.kNc=qa.sc,qa.Ota()?(ag.BQ=qa.$c.yg,ag.BQ?(ag.nG=qa.$c.td,ag.nG?ag.vva.gD().continueWith(ag.Z1n):l.ULS.sendTraceTag(4006599,302,15,"Can't initialize the WordPresenceManager because we can't get a reference to content ObjectSpace of the app")):
l.ULS.sendTraceTag(4252228,302,15,"Can't initialize the WordPresenceManager because we can't get a reference to the GraphSpaceReplicator object")):l.ULS.sendTraceTag(4006598,302,50,"PageView doesn't seem to have been initialized yet. Will try again once we know it's initialized")):l.ULS.sendTraceTag(4006597,302,15,"Can't initialize the WordPresenceManager because workspace is not initialized")}else l.ULS.sendTraceTag(4006596,302,15,"Can't initialize the WordPresenceManager because active AppFrame is not initialized")}static Z1n(){ag.Yh=
ag.vva.gD().result;if(ag.Yh){var qa=[ag.kNc.ygd,ag.kNc.Ke.ygd],Jb=Ia.a.instance,Rb=Fa.a.instance.resolve("Box4.Presence.WordPresenceDataManager"),Tc=new Il(Rb,Jb,ag.Dw,ag.Yh),vd=m.AFrameworkApplication.K.$("DoNotAddToEditorsTableOnFrameIsEnabled")?Yb.StaticTheCoauthManager.ud().nB:null;vd=new Vg(ag.Yh,vd);var Td=Fa.a.instance.rf("WordEditor.IParagraphWordIdMapping"),Ed=Fa.a.instance.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),lf=Fa.a.instance.resolve("Common.IPeopleInfoProvider");
ag._instance=new ag(ag.Yh,qa,ag.nG,Jb,lf,Rb,Tc,vd,ag.kNc,ag.kNc.Ke.oc,Fa.a.instance.resolve("Box4.Presence.PresenceControlProvider"),m.AFrameworkApplication.va,ag.BQ,Ma.ParagraphReader.textLength,Ma.ParagraphReader.gsa,Fa.a.instance.resolve("Box4.Presence.MyPresenceUser"),Td,Ed,vb.App.jf.Il,new oi.a,tb.a.instance,Md.a.get_instance(),Qa.a.$p(Fa.a.instance.Qa("Common.App.CoauthTelemetry.IPresenceBootTelemetry")),m.AFrameworkApplication.K,m.AFrameworkApplication.K.$("Box4ThrottleAndBatchPresenceRendering"),
m.AFrameworkApplication.K.$("Box4DoNotRenderPresenceOutOfView"),Fa.a.instance.resolve("WordEditor.Presence.IWordPresenceCpFactory"),Fa.a.instance.resolve("Common.IPresenceStatusProvider"),!vb.App.Et&&!vb.App.pn,Yb.StaticTheCoauthManager.bta(),Fa.a.instance.Qa("Common.ISessionExpirationManager"));l.ULS.sendTraceTag(23196878,302,50,"WordPresenceManager instance created");ag.SJd.gg(ag._instance);ag.pJc.gg(ag._instance);ag.nAh.gg(ag._instance);qa=Fa.a.instance;qa.ia("WordEditor.Presence.WordPresenceManager",
()=>ag._instance).as("Common.IPresenceRemover").as("Common.IPresenceSender").ha();qa.resolve("WordEditor.Presence.WordPresenceManager")}else l.ULS.sendTraceTag(4203468,302,15,"Can't initialize the WordPresenceManager because can't get a handle to RtcProxy")}static Wed(qa){ag._instance||(l.ULS.sendTraceTag(4006601,302,50,"WordPresenceManager.OnAppIsInteractive: Trying to initialize again"),(qa=Object(y.a)(764,qa))&&qa.pdb(ag.Wed),ag.init())}static $mj(){ag._instance.Xxg()}static yYk(qa,Jb,Rb,Tc,vd){Rb=
vd.split(",");if(!Rb||3!==Rb.length)return 8;qa=Rb[0].trim();Jb=Rb[1].trim();Rb=Number.parseInvariant(Rb[2].trim());qa=new uj(new Ja(qa),new bh(Jb,Rb,-1));if(!ag.pJc.task.isCompleted)return 8;Jb=ag.gD().result;Jb.nff(qa);Jb.Hue();return 32}static Csg(qa,Jb,Rb,Tc,vd){if(!ag.pJc.task.isCompleted)return 8;qa=ag.gD().result;qa.Wkd(vd);qa.Hue();return 32}static B7o(qa,Jb,Rb,Tc,vd){if(!ag.pJc.task.isCompleted)return 8;qa=ag.gD().result;if(!qa)return 8;qa.bAe(vd);return 32}static jpg(qa,Jb,Rb,Tc,vd){if(1===
Rb)return 32;if(!ag.vva.gD().isCompleted)return 8;qa=ag.vva.gD().result;if(!qa)return l.ULS.sendTraceTag(4301136,302,10,"rtcProxy is null when trying to display RTC connection status"),8;vd[nf.a.Value]=2===qa.connectionState?WordEditorIntl.WordEditorStrings.L_RtcConnected:1===qa.connectionState?WordEditorIntl.WordEditorStrings.L_RtcConnecting:"";return 32}}ag._instance=null;ag.Bih=!0;ag.SJd=new w.a;ag.pJc=new w.a;ag.nAh=new w.a;ag.nG=null;ag.kNc=null;ag.BQ=null;ag.Yh=null;Object(f.a)(ag,"WordPresenceManager",
qd,[]);class Cg{constructor(qa){this.sa=new ja.a;this.E1=qa;this.E1.CWR(()=>this.E1.result.a0k(()=>{this.sa.raiseEvent("X")}))}b2k(qa){this.sa.addHandler("X",qa)}jBo(qa){this.sa.removeHandler("X",qa)}getStatus(){return this.E1.isCompleted&&this.E1.result?this.E1.result.BZd.toString():"0"}}Object(f.a)(Cg,"WordPresenceStatusProvider",null,[763]);class Sg{constructor(qa,Jb,Rb,Tc){this.Yh=null;this.tih=this.r0e=!1;this.$1n=()=>{this.AO.isCompleted&&this.AO.result?(this.Yh=this.AO.result,this.Yh.jza(this.aV),
l.ULS.sendTraceTag(5604372,302,50,"Presence Update Monitor is ready.")):l.ULS.sendTraceTag(5604373,302,15,"RtcTask did not complete successfully. No monitoring")};this.aV=(vd,Td)=>{vd=Td.$ha;for(const Ed in vd)if(Td=vd[Ed],!this.r0e&&Td.user.IF&&Td.user.IF!==this.DH.IF){l.ULS.sendTraceTag(5604375,302,15,"Presence received from different local cobalt session Mine:{0} Theirs:{1}",this.DH.IF,Td.user.IF);this.r0e=!0;break}this.r0e&&this.Yh.$Za(this.aV);this.tih||(l.ULS.sendTraceTag(5604374,302,50,"First presence received"),
this.tih=!0)};this.gm=qa;this.DH=Jb;this.AO=Rb;Rb.continueWith(this.$1n);this.fFk=Tc;this.fFk.R5f=this.DH}}Object(f.a)(Sg,"WordPresenceUpdateMonitor",null,[]);var ui=d(451),ck=d(1742),Zf=d(1535),ij=d(233),mj=d(1993),Jl=d(1994),Xi=d(1874);class Sh{constructor(qa,Jb,Rb,Tc,vd,Td,Ed){this.sa=new ja.a;this.jph=this.grh=this.EZe=this.Xth=!1;this.tcf=this.BPd=0;this.Gbc=null;this.pSa=Td;this.pSa.clientId=qa.clientId;this.Kl=qa;this.wda=Jb;this.Tda=Tc;this.iwk=vd;this.Gb=Rb;this.Ohb=new ij.a;this.vq=Ed;this.wda&&
this.wda.continueWith(()=>{this.wda.qp||this.wda.ij||this.wda.result.sPh(Object(Ya.a)(this,this.pjj,"onAmIAloneChanged"))})}get connectionState(){return this.Kl.connectionState}jza(qa){this.sa.addHandler("PU",qa)}$Za(qa){this.sa.removeHandler("PU",qa)}b_(qa){this.sa.addHandler("CSC",qa)}ZZa(qa){this.sa.removeHandler("CSC",qa)}gmb(qa){this.sa.addHandler("PSU",qa)}jxb(qa){this.sa.removeHandler("PSU",qa)}gKb(qa){this.sa.addHandler("PSC",qa)}xZb(qa){this.sa.removeHandler("PSC",qa)}iyg(){}get clientId(){return this.Kl.clientId}JO(qa){this.sa.addHandler("UN",
qa)}ZDa(qa){this.sa.removeHandler("UN",qa)}O5m(){this.Gbc=Array(12);for(let qa=0;12>qa;qa++)this.Gbc[qa]=0;this.grh=this.vq?this.vq.$("UpdateNotificationTaskExperimentIsEnabled"):!0;m.AFrameworkApplication.aJ(()=>{this.YFn()})}init(){this.Kl.b_(Object(Ya.a)(this,this.JN,"onConnectionStateChanged"));this.Kl.jza(Object(Ya.a)(this,this.aV,"onPresenceUpdated"));this.Kl.gmb(Object(Ya.a)(this,this.Oga,"onPersistentStateUpdated"));this.Kl.gKb(Object(Ya.a)(this,this.YYa,"onPersistentStateCleared"));this.Kl.JO(Object(Ya.a)(this,
this.iS,"onUpdateNotificationReceived"));this.z6h();this.O5m()}Yte(qa){this.Ohb.contains(qa,(Jb,Rb)=>Jb===Rb)||(this.Ohb.add(qa),2===this.connectionState&&qa.start())}vLg(qa){for(let Jb=0;Jb<this.Ohb.length;Jb++)if(this.Ohb.J(Jb)===qa){this.Ohb.dI(Jb);break}}connect(){this.EZe||this.Kl.connect()}disconnect(){this.Kl.disconnect()}get Vve(){return this.Kl}lfi(qa){return uj.vMb(qa)}Hyg(qa,Jb){return(new uj(qa,Jb)).aOf()}jyg(qa){qa&&qa.isValid()&&!this.Tda()?this.Kl.iyg(this.Hyg(this.pSa.FAm(),qa)):z.Task.p7(null)}qEa(qa,
Jb){return this.Kl.qEa(qa,Jb)}nqb(qa){return this.Kl.nqb(qa)}tjc(){return this.Kl.tjc()}nC(qa,Jb,Rb=!1){return this.Kl.nC(qa,Jb,Rb)}oqb(){return this.d$h(this.Kl.oqb())}s9(qa){const Jb=new w.a;Xi.a.getInstance().wte(qa,Jb);return Jb.task}get Vba(){return this.Kl.Vba}JN(qa,Jb){2===Jb.newState&&this.Ohb.forEach(Rb=>{Rb.start();return!0});Jb.newState||this.vq.$("SendRTCMessagesWhileDisconnectedIsEnabled")&&!this.EZe||this.Ohb.forEach(Rb=>{Rb.stop();return!0});this.sa.raiseEvent("CSC",Jb)}vEf(qa){return qa.toLowerCase()}aV(qa,
Jb){if(!this.Tda()){qa=this.d$h(Jb.$ha);Jb=this.f$h(Jb.qZc);var Rb=new bn.a(qa,Jb);Jb=new oa.a(0,1,0,()=>{this.sa.raiseEvent("PU",Rb)},57);this.Gb.Zb(Jb)}}d$h(qa){const Jb={};for(const Tc in qa){var Rb=Tc;const vd=this.lfi(qa[Tc]);vd&&vd.isValid()?Jb[this.vEf(Rb)]=vd:l.ULS.sendTraceTag(562661590,302,50,"No Valid User {0}",Rb)}return Jb}f$h(qa){const Jb=Array(qa.length);for(let Rb=0;Rb<qa.length;Rb++)Jb[Rb]=this.vEf(qa[Rb]);return Jb}Oga(qa,Jb){if(!this.Tda()){var Rb={};qa=Jb.$ha;for(var Tc in qa)Rb[this.vEf(Tc)]=
qa[Tc];Tc=new oa.a(0,1,0,()=>{this.sa.raiseEvent("PSU",new mj.a(Jb.type,Rb))},80);this.Gb.Zb(Tc)}}YYa(qa,Jb){if(!this.Tda()){qa=this.f$h(Jb.KLb);var Rb=new Jl.a(qa);qa=new oa.a(0,1,0,()=>{this.sa.raiseEvent("PSC",Rb)},81);this.Gb.Zb(qa)}}iS(qa,Jb){this.grh?this.kpj(Jb):(qa=new oa.a(0,1,0,()=>{this.kpj(Jb)},58),this.Gb.Zb(qa))}kpj(qa){var Jb=Date.now();this.sa.raiseEvent("UN",qa);Jb=Date.now()-Jb;500<=Jb&&(this.BPd++,l.ULS.sendTraceTag(42563487,302,15,"Update Notification Heuristics: UpdateNotification Type {0} took {1} ms",
qa.type,Jb),this.d$l(qa));this.tcf++}d$l(qa){0>qa.type||21<=qa.type?l.ULS.sendTraceTag(42541602,302,15,"Update Notification Heuristics: UpdateNotification Type out of range {0}",qa.type):this.Gbc[qa.type]++}YFn(){if(!this.jph){var qa={};qa.TC=this.tcf;qa.HRC=this.BPd;this.Gbc&&0<this.BPd&&(qa.TBC=this.Gbc);this.BPd=this.tcf=0;this.Gbc=null;l.ULS.sendTraceTag(42541603,302,50,"UpdateNotificationHeuristics: {0}",qa);this.jph=!0}}dispose(){this.Ohb=new ij.a;this.Kl.ZZa(Object(Ya.a)(this,this.JN,"onConnectionStateChanged"));
this.Kl.$Za(Object(Ya.a)(this,this.aV,"onPresenceUpdated"));this.Kl.jxb(Object(Ya.a)(this,this.Oga,"onPersistentStateUpdated"));this.Kl.xZb(Object(Ya.a)(this,this.YYa,"onPersistentStateCleared"));this.Kl.ZDa(Object(Ya.a)(this,this.iS,"onUpdateNotificationReceived"));this.wda&&this.wda.continueWith(()=>{this.wda.qp||this.wda.ij||this.wda.result.jAo(Object(Ya.a)(this,this.pjj,"onAmIAloneChanged"))});this.Kl.disconnect();l.ULS.sendTraceTag(4564935,302,50,"Disposing of rtcProxyCompleted")}pjj(){this.z6h()}z6h(){let qa=
!1;this.wda?this.wda.continueWith(()=>{this.wda.qp||this.wda.ij||(qa=!this.wda.result.Aq);this.Kl.connectionState||!qa&&!this.iwk()?2!==this.Kl.connectionState||qa||(this.disconnect(),l.ULS.sendTraceTag(4564937,302,50,"Disconnecting because there are no other users in the doc")):(this.connect(),l.ULS.sendTraceTag(4564936,302,15,"Connecting because there are other authors in the doc"));!this.Xth&&qa&&(l.ULS.sendTraceTag(4203466,302,50,"There are other real-time authors in this session"),this.Xth=!0)}):
(this.connect(),l.ULS.sendTraceTag(589321547,302,50,"Connecting to rtc because Rtc Always On is enabled"))}bhc(){this.EZe=!0;this.disconnect();l.ULS.sendTraceTag(4564938,302,50,"DisconnectForever")}}Object(f.a)(Sh,"RtcProxy",null,[1765,13,1437,1766]);class Vk extends Sh{constructor(qa,Jb,Rb,Tc,vd,Td,Ed,lf,Bf,vf,fd,Wc,sg){super(qa,Jb,Rb,Tc,vd,Td,sg);this.k6=null;this.$K=Ed;this.yd=lf;this.vSa=Bf;this.dNc=vf;this.k$e=fd;this.IJb=Wc}get tH(){return this.k6||(this.k6=this.k$e())}JN(qa,Jb){2===Jb.newState&&
l.ULS.sendTraceTag(4315102,302,50,"RTC Connected");this.nzp();super.JN(qa,Jb)}nzp(){this.tH&&this.tH.nS("RtcConnectionStatusLabel")}lfi(qa){return pf.Etf(Pf(qa),this.$K,this.yd,this.vSa,this.IJb)}Hyg(qa,Jb){return Object(zk.a)(Jd,Jb)?(qa=new pf(this.dNc.VCi(),qa,Jb),cg(qa.aOf())):super.Hyg(qa,Jb)}}Object(f.a)(Vk,"WordRtcProxy",Sh,[]);class nj{constructor(qa,Jb,Rb,Tc,vd,Td,Ed,lf,Bf,vf,fd,Wc,sg){this.Sq=new w.a;this.wFh=!0;this.Vd=Jb;this.Gb=Rb;this.Tda=Tc;this.pSa=vd;this.$K=Td;this.Tya=Ed;this.vSa=
lf;this.dNc=Bf;this.k$e=vf;this.g2=fd;this.IJb=Wc;this.Ga=sg}gD(){this.sop();return this.Sq.task}SPb(){return ui.a.then(this.gD(),qa=>qa)}sop(){if(this.wFh)if(this.wFh=!1,vb.App.W0f()&&vb.App.TZf()){var qa=m.AFrameworkApplication.Be;if(qa){var Jb="{"+m.AFrameworkApplication.userSessionId+"}",Rb=m.AFrameworkApplication.userSessionId,Tc=m.AFrameworkApplication.Dwg,vd=this.Ga.$("RtcAlwaysOnEnabled"),Td=lf=>{const Bf=new Vk(lf,vd?null:Yb.StaticTheCoauthManager.bta(),this.Gb,this.Tda,nj.tcm,this.pSa,this.$K,
this.Tya,this.vSa,this.dNc,this.k$e,this.IJb,m.AFrameworkApplication.K);Zf.a.gXo(Bf);this.Xuo(Bf);Bf.init();jk.a.aOa=Bf;this.g2.execute(vf=>{vf.fmb(()=>{Bf.bhc()})});this.Sq.gg(Bf)};if(m.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.WordOnline.LoadRtcFrom1JS",!1))Promise.all([d.e(5),d.e(2),d.e(10)]).then(d.bind(null,2203)).then(lf=>{Ed=lf.RealtimeChannelNetCore.createInstance(Jb,Rb,Tc,qa,this.g2,1,this.Vd,this.Ga.kb("RtcEndpointUrl"),void 0,void 0,null,this.Ga.$("FindSessionOnBootIsEnabled")?
Fa.a.instance.resolve("Common.IFindSessionUtils"):null,this.Ga.kb("RtcBootToken"));Td(Ed)});else{var Ed=ck.RealtimeChannel.createInstance(Jb,Rb,Tc,qa,this.g2,1,this.Vd,this.Ga.kb("RtcEndpointUrl"),void 0,void 0,null,this.Ga.$("FindSessionOnBootIsEnabled")?Fa.a.instance.resolve("Common.IFindSessionUtils"):null,this.Ga.kb("RtcBootToken"));Td(Ed)}}else l.ULS.sendTraceTag(8206365,302,15,"Can't initialize the RtcProxy because ClientRequestManager is null")}else l.ULS.sendTraceTag(8206362,302,10,"Can't initialize the RtcProxy because dependent scripts are not loaded")}Xuo(qa){const Jb=
Fa.a.instance;Jb.ia("WordEditor.Presence.WordRtcProxy",()=>qa).as("Box4.Presence.IRtcProxy").as("Common.IRealtimeChannelBasic").ha();Jb.resolve("Common.IRealtimeChannelBasic")}static tcm(){return!1}}Object(f.a)(nj,"WordRtcProxyProvider",null,[761,762]);class dk{constructor(){this.W=null;this.hm=!1}get name(){return"WordEditor.Presence"}init(){l.ULS.sendTraceTag(50995799,302,50,"PresencePackage Init");vb.App.eck&&(this.W.resolve("WordEditor.Presence.WordRtcProxyProvider").gD(),ag.init(),this.W.resolve("WordEditor.Presence.WordPresenceUpdateMonitor"));
vb.App.QWc&&ah.init();this.W.resolve("Common.App.Presence.AwayManager");this.W.resolve("Common.IPeopleInfoProvider");if(dk.Xoh){const qa=this.W.resolve("WordEditor.IMainViewModeManager");qa.fKb(this.etc);dk.jYe=1===qa.Ax||2===qa.Ax}}dispose(){if(!this.hm){this.hm=!0;ag.gD().continueWith(()=>{$c.a.JD(ag.gD().result)});var qa=this.W.resolve("Box4.Presence.MyPresenceUser");qa&&qa.ouc&&qa.ouc.jBo(ag.$mj)}}wc(qa){this.W=qa;this.W.ia("Box4.Presence.MyPresenceUser",()=>new nb).as("Box4.Presence.IMyPresenceUser").as("Common.IPresenceUser").as("Common.IPresenceConverter").ha();
qa.ia("WordEditor.Presence.IWordPresenceCpFactory",()=>new Ql(qa.resolve("Box4.CpConversionManagerImpl"),qa.resolve("Box4.IContentControlReader"))).ha();qa.ia("WordEditor.Presence.WordPresenceUpdateMonitor",()=>new Sg(new V.a(()=>Yb.StaticTheCoauthManager.ud()),Dh.a.instance,qa.resolve("WordEditor.Presence.WordRtcProxyProvider").SPb(),qa.resolve("Box4.Presence.IMyPresenceUser"))).ha();qa.ia("WordEditor.Presence.WordRtcProxyProvider",()=>new nj(m.AFrameworkApplication.buildVersion,ub.StaticActiveAppFrame.za().hs,
tb.a.instance,()=>m.AFrameworkApplication.ol,Fa.a.instance.resolve("Box4.Presence.IMyPresenceUser"),Fa.a.instance.Oa("WordEditor.ParagraphWordIdMapping"),Fa.a.instance.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),()=>m.AFrameworkApplication.ua&&ub.StaticActiveAppFrame.za().ib&&ub.StaticActiveAppFrame.za().ib.$c?ub.StaticActiveAppFrame.za().ib.$c.td:null,Bj.instance,()=>Fa.a.instance.Oa("WordEditor.IStatusBarUser"),Fa.a.instance.Qa("Common.ISessionExpirationManager"),Fa.a.instance.resolve("WordEditor.Presence.IWordPresenceCpFactory"),
m.AFrameworkApplication.K)).ha().as("Box4.Presence.IRtcProxyProvider").as("Common.Interface.IRtcBasicProvider");qa.ia("Box4.Presence.PresenceControlProvider",()=>new Uj(dk.SKl(),id.a.instance,Fa.a.instance.Qa("Common.IZoomManager"),Fa.a.instance.resolve("Box4.ICoauthCashTelemetry"),Qa.a.$p(Fa.a.instance.Qa("Common.ISystemInitiatedFeedbackWithTimeLapse")),m.AFrameworkApplication.K,qa.resolve("Common.IPeopleInfoProvider"))).ha();qa.ia("Common.App.Presence.AwayManager",()=>new de(Fa.a.instance.resolve("Common.IPresenceUser"),
Fa.a.instance.resolve("WordEditor.Presence.WordRtcProxyProvider").SPb(),ag.kGm(),Fa.a.instance.resolve("Common.IPresenceConverter"),tb.a.instance,m.AFrameworkApplication.K.$("AwayStatusOneMinuteTimeoutIsEnabled")?6E4:m.AFrameworkApplication.K.ic("AwayCoauthorThresholdMs",9E5),Object(Ya.a)(m.AFrameworkApplication.va,m.AFrameworkApplication.va.Ob,"processAction"),ub.StaticActiveAppFrame.za().nK,m.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled"))).ha();qa.ia("WordEditor.Presence.WordPresenceStatusProvider",
()=>new Cg(Qa.a.$p(Fa.a.instance.Qa("Common.ICurrentPageCalculator")))).as("Common.IPresenceStatusProvider").ha();qa.ia("Common.App.Presence.PeopleInfoProvider",()=>new Lf(qa.resolve("WordEditor.Presence.WordRtcProxyProvider").SPb(),Yb.StaticTheCoauthManager.bta().CWR(()=>Yb.StaticTheCoauthManager.bta().result.nB),qa.resolve("Common.App.People.IPeopleColorUtils"),qa.resolve("Common.IPresenceConverter"),Qa.a.$p(qa.Qa("Common.App.Presence.AwayManager")))).as("Common.IPeopleInfoProvider").ha();qa.ia("Box4.Presence.WordPresenceDataManager",
()=>new Ni(ub.StaticActiveAppFrame.za().ib.$c.td)).as("Box4.IPresenceDataManager").ha()}etc(qa,Jb){ub.StaticActiveAppFrame.za()&&ub.StaticActiveAppFrame.za().aG&&(dk.OId=null,dk.jYe=1===Jb.Nbb||2===Jb.Nbb)}static get nqj(){!dk.OId&&ub.StaticActiveAppFrame.za()&&ub.StaticActiveAppFrame.za().aG&&(dk.OId=jk.a.en.aG.getElementsByClassName(dk.jYe&&dk.Xoh?"PaginatedContentContainerDisplayWrapper":"OutlineContainerDisplayWrapper")[0]);return dk.OId}static SKl(){const qa=m.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled"),
Jb=m.AFrameworkApplication.K.$("PresenceIgnoreEventOnExpandedTooltip"),Rb=m.AFrameworkApplication.K.$("PresenceIpWidthAdjustForFlyout"),Tc=new Vf;Tc.add(hg.cPn,ie.getImageClassWithCluster(m.AFrameworkApplication.Vfa,"MoreUsersGlyph16"));Tc.add(hg.bPn,m.AFrameworkApplication.Ys);Tc.add(hg.T$n,ie.getImageClassWithCluster(m.AFrameworkApplication.Vfa,qa?"DoughboyWhiteGlyph_20x20x32":"SingleCollabUserGlyph16"));Tc.add(hg.U$n,m.AFrameworkApplication.Ys);Tc.add(hg.zIndex,1);Tc.add(hg.rtl,m.AFrameworkApplication.isRtl);
Tc.add(hg.pEp,dk.XQm);Tc.add(hg.w2m,Jb);Tc.add(hg.Ucn,Rb);return qa?new td(Tc):new tg(Tc)}static XQm(){return dk.nqj?ph.a.getElementBounds(dk.nqj):null}}dk.jYe=!0;dk.Xoh=m.AFrameworkApplication.K.$("FlippedFlyoutForPaginationViewIsEnabled");dk.OId=null;Object(f.a)(dk,"WordPresencePackage",null,[0,1]);var mm=d(1132),Ai=d(1458),nm=d(1141),rm=d(200);class qi{constructor(qa,Jb){this.pff=qa;this.paragraphId=Jb}get opType(){return 2}get operation(){return this.pff}}Object(f.a)(qi,"RttAppliedAddParagraphOp",
null,[771]);class Yi{constructor(qa,Jb){this.vDo=qa;this.paragraphId=Jb}get opType(){return 6}get operation(){return this.vDo}}Object(f.a)(Yi,"RttAppliedReplaceSymbolRangeOp",null,[771]);class Zl{constructor(qa,Jb){this.zDo=qa;this.paragraphId=Jb}get opType(){return 1}get operation(){return this.zDo}}Object(f.a)(Zl,"RttAppliedReplaceTextRangeOp",null,[771]);class Qi{constructor(qa,Jb,Rb){this.eXj=qa;this.IAe=Jb;this.fYc=Rb}get opType(){return 4}get operation(){return this.eXj}get uTk(){return this.eXj.Xfc()?
this.fYc:this.IAe}}Object(f.a)(Qi,"RttAppliedSplitParagraphOp",null,[771]);class Oh{constructor(){this.Kgb=new lb.a}I2f(qa){return qa.toString()}nSc(qa,Jb){qa=this.I2f(qa);this.Kgb.mb(qa)||this.Kgb.Z(qa,new N.a);this.Kgb.J(qa).add(Jb)}vgg(qa){switch(qa.opType){case 1:var Jb=Object(y.a)(Zl,qa);this.nSc(Jb.paragraphId,qa);break;case 6:Jb=Object(y.a)(Yi,qa);this.nSc(Jb.paragraphId,qa);break;case 4:Jb=Object(y.a)(Qi,qa);this.nSc(Jb.IAe,qa);this.nSc(Jb.fYc,qa);break;case 2:Jb=Object(y.a)(qi,qa),this.nSc(Jb.paragraphId,
qa)}}uYn(qa){return this.Evb(qa)}Evb(qa){qa=this.I2f(qa);if(!this.Kgb.mb(qa))return new N.a;const Jb=this.Kgb.J(qa);this.Kgb.remove(qa);for(const Rb of Jb)Rb.operation&&(Rb.operation.daa=null);return Jb}NCm(qa){let Jb;return({value:Jb}=this.Kgb.Dc(this.I2f(qa),Jb)).returnValue?Jb:new N.a}vgm(qa){for(const Jb of this.Kgb.values){if(!Jb.count)continue;if(2!==Jb.J(0).opType)continue;const Rb=Jb.J(0);if(Rb.pff.Wbg===qa)return Rb}return null}}Object(f.a)(Oh,"RttAppliedOpTracker",null,[801]);var hb=d(270),
wc;(function(qa){qa[qa.x4l=0]="expired";qa[qa.AYp=1]="dried"})(wc||(wc={}));Object(f.b)("RemoveChangeReason",wc);class cd{constructor(){this.sFa=new hb.a}pVk(qa){if(!qa)return l.ULS.sendTraceTag(7685333,355,15,"Cannot add a null change to RTTStore"),!1;const Jb=qa.Yc,Rb=qa.Tj;this.sFa.mb(Jb)||this.sFa.add(Jb,new hb.a);this.sFa.J(Jb).Z(Rb,qa);return this.TMl(Jb,Rb)?(l.ULS.sendTraceTag(7619921,355,15,"Detected an infinite loop in paragraph {0}, dropping the last packet!",Jb),this.sFa.J(Jb).remove(Rb),
!1):!0}eMf(qa,Jb){if(!this.sFa.mb(qa))return null;qa=this.sFa.J(qa);return qa.mb(Jb)?qa.J(Jb):null}o8d(qa){const Jb=new N.a;for(const Rb of this.sFa.keys){const Tc=this.sFa.J(Rb);for(const vd of Tc.keys){const Td=Tc.J(vd);qa(Td)&&Jb.add(Td)}}return Jb}MCj(qa,Jb){let Rb=null;({value:Rb}=this.sFa.Dc(qa.Yc,Rb)).returnValue?(qa.activity.veg(wc[Jb]),Rb.remove(qa.Tj),Rb.count||this.sFa.remove(qa.Yc)):l.ULS.sendTraceTag(50938848,355,15,"Cannot remove an op that not exist in _changes. WordId: {0}; Reason: {1}",
qa.Yc,Jb)}jsg(qa){this.MCj(qa,1)}msg(qa){this.MCj(qa,0)}TMl(qa,Jb){if(!this.sFa.mb(qa))return!1;qa=this.sFa.J(qa);if(!qa.mb(Jb))return!1;for(var Rb=qa.J(Jb);Rb;){Rb=Rb.M4;if(Rb===Jb)return!0;if(!qa.mb(Rb))break;Rb=qa.J(Rb)}return!1}}Object(f.a)(cd,"RttDataStore",null,[740,741]);var Rd=d(306),cf=d(62),Ge=d(292),Wg=d(217),ge=d(16),oj=d(63);class uh{constructor(qa,Jb){this.ane=(Rb,Tc)=>{4===this.jp.opType?l.ULS.shipAssertTag(9204866,355,12===Tc.node.type||11===Tc.node.type,"Unexpected graph modification detected during RTT edit"):
l.ULS.shipAssertTag(9204867,355,!1,"Unexpected graph modification detected during RTT edit")};this.Evb=()=>{l.ULS.shipAssertTag(9204868,355,!1,"Unexpected graph modification detected during RTT edit")};this.nlj=()=>{l.ULS.shipAssertTag(9204869,355,!1,"Unexpected graph modification detected during RTT edit")};this.jp=qa;if(this.Xm=Jb)qa=this.Xm.Ve(12),qa.Zt(this.ane),qa.Bw(this.Evb),qa.fo(this.nlj)}dispose(){if(this.Xm){const qa=this.Xm.Ve(12);qa.jV(this.ane);qa.hha(this.Evb);qa.QN(this.nlj)}}}Object(f.a)(uh,
"GraphChangeValidator",null,[13]);class Pj{constructor(qa,Jb,Rb,Tc){this.id=qa;this.cpBegin=Jb;this.cpEnd=Rb;this.Fnl=Tc}XCp(qa){var Jb=this.id===qa.id;Jb&&(Jb=this.Fnl.replace("\u00a0"," "),qa=qa.characterData.substr(this.cpBegin,this.cpEnd-this.cpBegin).replace("\u00a0"," "),Jb=Jb===qa);return Jb}}Object(f.a)(Pj,"RttOpValidator",null,[789]);class eh{constructor(qa,Jb){this.daa=this.zBc=this.activity=null;this.opType=qa;this.metadata=Jb}YOf(){return""}serialize(){return null}}Object(f.a)(eh,"RttOp",
null,[760]);class xf extends eh{constructor(qa,Jb,Rb,Tc,vd,Td,Ed,lf,Bf){super(Bf,lf);this.Yc=qa;this.Tj=Jb;this.ZU=Rb;this.h8=Tc;this.M4=vd;this.Hzb=Td;this.TJ=Ed}gbi(){return this.ZU.isEqual(this.h8,!0)?new Xc.a(0,this.Yc,this.Tj,this.ZU,void 0,void 0,void 0,this.TJ):new Xc.a(1,this.Yc,this.Tj,this.ZU,this.Yc,this.Tj,this.h8,this.TJ)}static y3j(qa){let Jb,Rb;var Tc=qa.yW;if(1===Tc.Ate&&(Tc.iZa!==Tc.jNa||Tc.bfb!==Tc.Hzc))return l.ULS.sendTraceTag(8914769,355,15,"We received a ReplaceRange operation spanning multiple paragraphs"),
Rb=Jb=null,qa=Tc=-1,{returnValue:!1,ZU:Rb,h8:Jb,Yc:qa,Tj:Tc};if(Tc.TJ)return Rb=Jb=null,qa=Tc=-1,{returnValue:!1,ZU:Rb,h8:Jb,Yc:qa,Tj:Tc};Jb=Rb=Tc.ZU;1===Tc.Ate&&(Jb=Tc.h8);qa=Tc.iZa;Tc=Tc.bfb;return{returnValue:!0,ZU:Rb,h8:Jb,Yc:qa,Tj:Tc}}}Object(f.a)(xf,"RttReplaceRangeOp",eh,[]);var gh=d(1457),Ue=d(496),gb=d(1101),Mb=d(540),hc=d(477);class Kc extends Mb.a{constructor(){super();this.RttStatusRecords=this.FileId=null}lm(){return hc.a.sJo}static Xea(qa,Jb){const Rb=new Kc;Rb.FileId=qa;Rb.RttStatusRecords=
Jb;return Rb}}Object(f.a)(Kc,"RttStatusRequest",Mb.a,[]);class Vc{}Object(f.a)(Vc,"RttStatusOp",null,[]);class od{constructor(){this.contentState=this.contentType=this.timeToRender=this.strictlySequentialId=this.packetVersion=this.clientType=this.clientId=this.packetId=null}}Object(f.a)(od,"WireRttStatusOpRecord",null,[]);class Od extends Ue.a{constructor(){super();const {App:qa}=d(248);this.V$b=new N.a;this.E7e=new N.a;this.Zk=new gh.a(m.AFrameworkApplication.K.ic("WordEditorRttStatusReplicatorIntervalMs",
6E4));this.enabled=1;qa.d1.register(this)}hjk(){const qa=Date.now();for(const Jb of this.V$b)Jb.XWb&&1===Jb.XWb&&(Jb.XWb=2,Jb.timeToRender=qa-Jb.metadata.SIg)}BHe(qa){const Jb=new Vc;Jb.metadata=qa.operation.metadata;Jb.opType=qa.opType;Jb.XWb=1;this.V$b.add(Jb)}get yma(){return"RttStatusReplicator"}nba(){return this.ie&&this.ie.status===gb.a.rS?!0:1===this.enabled&&this.Zk.W_()?this.KL():!1}KL(){for(const qa of this.V$b)if(qa.XWb&&2===qa.XWb)return!0;return!1}ONa(){if(1===this._state){this._state=
3;const Jb=this.V$b.toArray().filter(Rb=>2===Rb.XWb);var qa=this.KEl(Jb);qa=Kc.Xea(m.AFrameworkApplication.rootQuerySignature,qa);Jb.forEach(Rb=>this.V$b.remove(Rb));Jb.forEach(Rb=>this.E7e.add(Rb));this.ie.ar=qa;this.ie.GE="RttStatusRequest";this.ie.status=gb.a.nH}else 3===this._state&&this.ie&&this.ie.status===gb.a.rS&&(this.Zk.X4(),2!==this.ie.statusCode&&this.V$b.pD(0,this.E7e),this.E7e.clear(),this._state=1)}KEl(qa){const Jb=[];qa.forEach(Rb=>{const Tc=new od;Tc.clientId=Rb.metadata.clientId;
Tc.clientType=Rb.metadata.clientType;Tc.packetId=Rb.metadata.packetId;Tc.packetVersion=Rb.metadata.packetVersion;Tc.strictlySequentialId=Rb.metadata.strictlySequentialId;Tc.contentType=Rb.opType;Tc.contentState=Rb.XWb;Tc.timeToRender=Rb.timeToRender;Jb.push(Tc)});return Jb}A0b(){return!0}dD(){}CF(){}}Object(f.a)(Od,"RttStatusReplicator",Ue.a,[]);class Ld{constructor(qa,Jb,Rb,Tc,vd,Td){this.packetId=qa;this.clientId=Jb;this.clientType=Rb;this.SIg=Tc;this.packetVersion=vd;this.strictlySequentialId=
Td}static create(qa){let Jb=null;null!=qa.strictlySequentialId&&(Jb=qa.strictlySequentialId);return new Ld(qa.packetId,qa.clientId,qa.client,Date.now(),qa.version,Jb)}}Object(f.a)(Ld,"RttOpMetadata",null,[]);class Af extends eh{constructor(qa,Jb,Rb,Tc,vd,Td,Ed,lf,Bf){super(4,Bf);this.M4=0;this.Yc=qa;this.Tj=Jb;this.offset=Rb;this.TJ=Tc;this.mPg=vd;this.xIg=Td;this.cHe=Ed;this.yIg=lf;this.mPg===this.Yc?this.M4=this.xIg:this.cHe===this.Yc?this.M4=this.yIg:(l.ULS.sendTraceTag(8397766,355,10,"Bad data passed to RttSplitParagraphOp"),
this.M4=0)}Xfc(){return this.Yc===this.cHe}get Fip(){return this.M4}get MGp(){return this.Xfc()?this.mPg:this.cHe}get i0j(){return this.Xfc()?this.xIg:this.yIg}serialize(){const qa=new Xc.a(3,this.Yc,this.Tj,this.offset,null,null,null,this.TJ),Jb=new Zc(this.mPg,this.xIg,this.cHe,this.yIg);return new Oc(this.metadata.packetId,this.metadata.clientId,1,4,qa,null,void 0,void 0,void 0,void 0,Jb,void 0,void 0,this.metadata.strictlySequentialId)}static create(qa){const Jb=qa.yW,Rb=qa.Y0b;return new Af(Jb.iZa,
Jb.bfb,Jb.ZU,Jb.TJ,Rb.qjg,Rb.wIg,Rb.rjg,Rb.zIg,Ld.create(qa))}static dJm(qa,Jb,Rb){if(1!==qa.type)return null;const Tc=Rb.lZa(qa.i8.characterData,qa.i8.qa);return new Af(qa.i8.Yc,qa.i8.Tj,Rb.SBc(Tc,qa.RWj),qa.TJ,qa.LJb.Yc,qa.LJb.Tj,qa.VTc.Yc,qa.VTc.Tj,Jb)}}Object(f.a)(Af,"RttSplitParagraphOp",eh,[733,760]);class Tb{constructor(qa,Jb,Rb,Tc){this.vUn=()=>{this.QHb.hjk()};this.Noa=qa;this.zMc=Jb;this.zpa=Rb;this.QIb=Tc;null!=m.AFrameworkApplication.K&&m.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.WordOnline.WordEditorRttStatusReplicatorIsEnabled",
!1)&&(this.QHb=new Od,Rd.GraphTransactionManager.instance.rPh(this.vUn))}q8k(qa,Jb,Rb,Tc=null){if(Jb.isDirty)return Tc&&Tc.properties.Z(Tb.Arj,"1"),!1;const vd=new uh(qa,Jb.pk);try{if(1===qa.opType||6===qa.opType){const lf=Object(y.a)(xf,qa),Bf=this.kAl(lf,Jb);var Td=Bf.node.characterData;const vf=10<=Bf.cpBegin?Bf.cpBegin-10:0;let fd=Bf.cpEnd+10<=Td.length?Bf.cpEnd+10:Td.length;const Wc=Td.substr(vf,Bf.cpBegin-vf),sg=Td.substr(Bf.cpEnd,fd-Bf.cpEnd);fd=fd+lf.Hzb.length-(Bf.cpEnd-Bf.cpBegin);var Ed=
new Pj(Bf.node.id,vf,fd,Wc+lf.Hzb+sg);const Jf=6===lf.opType;Td="";Jf&&(Td=lf.font);if(!this.fDo(Bf,lf.Hzb,Jf,Td,Tc))return!1;let Qk;Qk=1===qa.opType?new Zl(lf,Jb.id):new Yi(lf,Jb.id);Jb.gsa=qa.M4;lf.zBc=Ed;qa.daa=Qk;Rb.vgg(Qk);null!=this.QHb&&this.QHb.BHe(Qk)}else return 4===qa.opType?this.p8k(qa,Jb,Rb):!1}finally{vd&&vd.dispose()}return!0}p8k(qa,Jb,Rb){const Tc=Object(y.a)(Af,qa);var vd=this.QIb.lZa(Jb.characterData,Jb.qa);vd=this.QIb.pMb(vd,Tc.offset);if(!this.Y1i(qb.a.createTextRange(Jb,0,Ma.ParagraphReader.textLength(Jb))))return!1;
var Td=ug.GraphIterator.eb(Jb);Td.zb(10);if(this.Ffe(Td))return!1;let Ed;Td=this.zpa.Mc(3);try{Td.Ab(Jb);const lf=Jb.a1();try{const Bf=ug.GraphIterator.eb(Jb);Bf.zb(10);Bf.ld(11);let vf=Bf.currentNode;Tc.Xfc()&&(Bf.bZf?vf=null:(Bf.bK(),vf=Bf.currentNode));Bf.uc();const fd=this.zMc.dob();Bf.fK(fd,vf,89);Bf.Yj(fd);Ed=Jb.clone();const Wc=Ed.a1();try{Ed.setValue(Mf.a.Yc,Tc.MGp);Ed.setValue(Mf.a.Tj,Tc.i0j);Ed.isDirty=!1;Bf.Uf(Ed,2);Bf.Yj(Ed);this.iCl(Jb,Ed);const sg=Tc.Xfc()?Ed:Jb,Jf=Tc.Xfc()?Jb:Ed;sg.XQ=
!0;Jf.XQ=!0;this.Noa.fug(this.rJa(sg,vd,Ma.ParagraphReader.textLength(sg)),"",!1,"");this.Noa.fug(this.rJa(Jf,0,vd),"",!1,"");Jb.gsa=Tc.Fip;Ed.gsa=Tc.i0j}finally{Wc&&Wc.dispose()}}finally{lf&&lf.dispose()}Td.s_a()}finally{Td&&Td.dispose()}Jb=new Qi(Tc,Jb.id,Ed.id);qa.daa=Jb;Rb.vgg(Jb);null!=this.QHb&&this.QHb.BHe(Jb);return!0}Ffe(qa){const Jb=new ug.GraphIterator;Jb.hd(qa);Jb.ld(11);return cf.ListItemReader.Hg(Jb)?(l.ULS.sendTraceTag(16868566,355,50,"Blocked RTT para operation: in a list"),!0):!1}h9l(qa,
Jb,Rb){var Tc=Jb.brb(qa.Yc);if(Tc.equals(mg.a.nil))return null;Tc=Rb.Eb(Tc);if(!Tc||!Ma.ParagraphReader.Xb(Tc)||!Tc.isConnected)return null;const vd=ug.GraphIterator.eb(Tc);if(!vd.zb(23))return null;if(qa.lPg){qa=Jb.brb(qa.lPg);if(qa.equals(mg.a.nil))return null;Rb=Rb.Eb(qa);if(!Rb||!Ma.ParagraphReader.Xb(Rb)||!Rb.isConnected)return null;Rb=ug.GraphIterator.eb(Rb);if(!Rb.zb(23))return null;Rb.ld(11);Rb.bK();Rb.Xd();if(Rb.currentNode!==Tc)return null}return this.Ffe(vd)?null:vd}jop(qa,Jb,Rb,Tc){const vd=
Jb.currentNode,Td=this.zpa.Mc(3);try{Td.Ab(vd);Jb.ld(11);const Ed=Jb.currentNode;Jb.uc();const lf=this.zMc.dob();Jb.fK(lf,Ed,89);Jb.Yj(lf);const Bf=Ge.a.instance.createInstance(oj.a.paragraphNode),vf=Bf.a1();try{Bf.setValue(ge.a.Un,""),Bf.PLa=!0,Tc.qZb(Bf),Tc=[0],Bf.setValue(Mf.a.Kq,Tc),Bf.setValue(Mf.a.Nt,Tc),Bf.PLa=!1,Bf.setValue(Mf.a.Yc,qa.Wbg),Bf.setValue(Mf.a.Tj,qa.Vbg),Bf.isDirty=!1,Jb.Uf(Bf,2),Bf.XQ=!0,Bf.gsa=qa.Vbg}finally{vf&&vf.dispose()}Td.s_a();qa.daa=new qi(qa,Bf.id);Rb.vgg(qa.daa);null!=
this.QHb&&this.QHb.BHe(qa.daa)}finally{Td&&Td.dispose()}return!0}rJa(qa,Jb,Rb){return Jb===Rb?qb.a.Tc(qa,Jb):qb.a.createTextRange(qa,Jb,Rb)}fDo(qa,Jb,Rb,Tc,vd=null){const Td=qa.node;if(qa.cpBegin!==qa.cpEnd&&!this.Y1i(qa))return vd&&vd.properties.Z(Tb.z5j,"1"),!1;vd=this.zpa.Mc(3);try{vd.Ab(Td);const Ed=Td.a1();try{Td.XQ=!0,this.Noa.fug(qa,Jb,Rb,Tc)}finally{Ed&&Ed.dispose()}vd.s_a()}finally{vd&&vd.dispose()}return!0}iCl(qa,Jb){Jb.PLa=!0;Jb.Dva(qa.characterData);Jb.gsa=qa.gsa;Jb.qa.clear();for(var Rb=
0;Rb<qa.qa.length;Rb++){const Tc=qa.qa.J(Rb).qra(Jb);Jb.qa.add(Tc)}Jb.Jl();if(Jb.qe.length)for(qa=0;qa<Jb.qa.length;qa++){if((Rb=Jb.qa.J(qa).formatting)&&-1!==Rb.oe)for(;Jb.qe.length<=Rb.oe;)Jb.qe.wX(Jb.qe.length-1,256)}else l.ULS.sendTraceTag(9204881,355,15,"Cannot update WordRunProperties after splitting paragraph");Jb.PLa=!1}e2f(qa){qa=ug.GraphIterator.eb(qa);qa.zb(23);qa.uc();return{returnValue:89===qa.role,iterator:qa}}Wsg(qa){const Jb=new ug.GraphIterator;Jb.hd(qa);Jb.uc();const Rb=this.zpa.Mc(3);
try{Rb.Ab(Jb.currentNode),qa.eh()}finally{Rb&&Rb.dispose()}}pxo(qa){if(qa.anchor)if(({iterator:Jb}=this.e2f(qa)).returnValue)this.Wsg(Jb);else{var Jb=qa.Lc.Bm;var Rb=this.zpa.Mc(3);try{Rb.Ab(qa),qa.load(Object(Wg.d)(Jb).Eb(qa.id)),qa.anchor.j0(4)}finally{Rb&&Rb.dispose()}}}Wvg(qa,Jb,Rb){for(let Td=Jb.count-1;0<=Td;Td--){var Tc=Jb.J(Td);switch(Tc.opType){case 4:Tc=Object(y.a)(Qi,Tc);if(!qa.id.equals(Tc.IAe)){l.ULS.shipAssertTag(9204885,355,qa.id.equals(Tc.fYc));continue}Tc=Rb.Eb(Tc.fYc);if(!Tc)break;
if(!Tc||!Ma.ParagraphReader.Xb(Tc)){l.ULS.shipAssertTag(9204886,355,!1);break}if(!Tc.isConnected)continue;var vd=({iterator:Tc}=this.e2f(Tc)).returnValue;l.ULS.shipAssertTag(9204887,355,vd);vd&&this.Wsg(Tc);break;case 2:(Tc=Object(y.a)(qi,Tc),qa.id.equals(Tc.paragraphId))?qa.isConnected&&(vd=({iterator:Tc}=this.e2f(qa)).returnValue,l.ULS.shipAssertTag(16820002,355,vd),vd&&this.Wsg(Tc)):l.ULS.shipAssertTag(16820001,355,!1)}}}kAl(qa,Jb){const Rb=this.QIb.lZa(Jb.characterData,Jb.qa),Tc=this.QIb.pMb(Rb,
qa.ZU);qa=this.QIb.pMb(Rb,qa.h8);return Tc===qa?qb.a.Tc(Jb,Tc):qb.a.createTextRange(Jb,Tc,qa)}Y1i(qa){const Jb=qa.node.qa,Rb=qa.cpBegin;qa=qa.cpEnd;for(let Tc=0;Tc<Jb.length;Tc++){const vd=Jb.J(Tc);if(vd.cp>=qa)break;if(vd.cp>=Rb){if(vd.kf)return l.ULS.sendTraceTag(8242647,355,15,"Rejected unsafe wet change: range contains comment"),!1;if(vd.blob)return l.ULS.sendTraceTag(8242648,355,15,"Rejected unsafe wet change: range contains blob"),!1;if(vd.fc||vd.HCa||vd.doc)return l.ULS.sendTraceTag(8242649,
355,15,"Rejected unsafe wet change: range contains field"),!1}}return!0}}Tb.Arj="ParagraphAlreadyDirty";Tb.z5j="UnsafeWetChange";Object(f.a)(Tb,"RttEditor",null,[739]);var Dg=d(20),Kh=d(1502),rg=d(271);class ai{constructor(){this.Iwd=new N.a}add(qa){this.Iwd.add(qa);return!0}o8d(qa){const Jb=new N.a;for(const Rb of this.Iwd)qa(Rb)&&Jb.add(Rb);return Jb}jsg(qa){qa.activity.veg("dried");this.Iwd.remove(qa)}msg(qa){qa.activity.veg("expired");this.Iwd.remove(qa)}}Object(f.a)(ai,"RttAddParagraphDataStore",
null,[]);class kl extends eh{constructor(qa,Jb,Rb,Tc,vd,Td,Ed,lf){super(2,lf);this.Yc=qa;this.Tj=Jb;this.M4=Rb;this.lPg=Tc;this.Wbg=vd;this.Vbg=Td;this.TJ=Ed}serialize(){const qa=new Xc.a(2,this.Yc,this.Tj,null,this.lPg,null,null,this.TJ),Jb=new cc(this.M4,this.Wbg,this.Vbg);return new Oc(this.metadata.packetId,this.metadata.clientId,1,3,qa,null,void 0,void 0,Jb,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(qa){const Jb=qa.yW,Rb=qa.Dcc;let Tc=null;null!=qa.yW.jNa&&
(Tc=qa.yW.jNa);return new kl(Jb.iZa,Jb.bfb,Rb.AIg,Tc,Rb.tjg,Rb.M4,Jb.TJ,Ld.create(qa))}static $Im(qa,Jb){return 3!==qa.type?null:new kl(qa.Gua.Yc,qa.Gua.Tj,qa.PPn.Tj,qa.PYa?qa.PYa.Yc:null,qa.cDa.Yc,qa.cDa.Tj,qa.TJ,Jb)}}Object(f.a)(kl,"RttAddParagraphOp",eh,[]);class Fe{constructor(qa){this.OY=qa}vzj(){this.OY&&this.OY.properties.Z(Fe.eni,"1")}Roo(qa){this.OY&&(this.OY.properties.mb(Fe.i$f)||this.OY.properties.Z(Fe.i$f,(qa-this.OY.startTime).toString()))}veg(qa){this.OY&&(this.OY.properties.Z(Fe.hEj,
qa),this.OY.end())}nqo(qa){this.OY&&this.OY.properties.Z(Fe.Eqj,qa.toString())}mqo(qa){this.OY&&this.OY.properties.Z(Fe.$pj,qa)}static ZUf(qa){qa.K8(Ah.a.c_b,Fe.eni,Kh.a.oZj);qa.K8(Ah.a.c_b,Fe.N5l,Kh.a.oZj);qa.K8(Ah.a.c_b,Fe.i$f,Kh.a.mbl);qa.K8(Ah.a.c_b,Fe.hEj,Kh.a.cAa);qa.K8(Ah.a.c_b,Fe.Eqj,Kh.a.cAa);qa.K8(Ah.a.c_b,Fe.$pj,Kh.a.cAa)}static create(qa){if(!qa)return null;qa=qa.rq(Ah.a.c_b,Fe.vFp);return new Fe(qa)}}Fe.eni="FailedToFindInitialParaID";Fe.N5l="FailedToFindInitialTextID";Fe.i$f="MsecUntilApplied";
Fe.hEj="RemovedBecause";Fe.Eqj="PacketVersions";Fe.$pj="OperationType";Fe.vFp=48E4;Object(f.a)(Fe,"RttOpActivity",null,[]);var vh;(function(qa){qa[qa.unknown=0]="unknown";qa[qa.Khq=1]="replaceTextRangeOp";qa[qa.KSp=2]="addParagraphOp";qa[qa.vXp=3]="deleteParagraphOp";qa[qa.emq=4]="splitParagraphOp";qa[qa.x7p=5]="mergeParagraphOp";qa[qa.Jhq=6]="replaceSymbolRangeOp"})(vh||(vh={}));Object(f.b)("RttOpType",vh);var te=d(128);class jj extends xf{constructor(qa,Jb,Rb,Tc,vd,Td,Ed,lf,Bf,vf,fd){super(Tc,vd,
Td,Ed,lf,Bf,vf,fd,6);this.font=qa;this.ryn=Jb}YOf(){return"OffsetStart: "+this.ZU+"OffsetEnd: "+this.h8}serialize(){const qa=this.gbi();return new Oc(this.metadata.packetId,this.metadata.clientId,1,7,qa,null,this.M4,this.Hzb,void 0,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(qa){let Jb,Rb,Tc,vd;if(!({ZU:Jb,h8:Rb,Yc:Tc,Tj:vd}=xf.y3j(qa)).returnValue)return null;let Td,Ed;if(1===qa.text.length)Td=!1,Ed=te.AParagraphNode.oE;else if(2===qa.text.length)if(Ub.a.iZi(qa.text,
0)&&Ub.a.YA(qa.text,1))Td=!0,Ed=qa.text;else return l.ULS.sendTraceTag(8914772,355,15,"RTT symbol packet has text length 2 but is not a valid surrogate pair",qa.operationType),null;else return l.ULS.sendTraceTag(8914773,355,15,"RTT symbol packet text is of unsupported length (length must be 1 or 2)",qa.operationType),null;const lf=qa.lrd,Bf=Ld.create(qa);return new jj(lf.$Gg,lf.aHg,Td,Tc,vd,Jb,Rb,qa.E1b,Ed,qa.yW.TJ,Bf)}}Object(f.a)(jj,"RttReplaceSymbolRangeOp",xf,[733,760]);class ek extends xf{constructor(qa,
Jb,Rb,Tc,vd,Td,Ed,lf){super(qa,Jb,Rb,Tc,vd,Td,Ed,lf,1)}YOf(){return"OffsetStart: "+this.ZU+"OffsetEnd: "+this.h8+"TextAddedLength: "+this.Hzb.length}serialize(){const qa=this.gbi();return new Oc(this.metadata.packetId,this.metadata.clientId,1,2,qa,null,this.M4,this.Hzb,void 0,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(qa){let Jb,Rb,Tc,vd;if(!({ZU:Jb,h8:Rb,Yc:Tc,Tj:vd}=xf.y3j(qa)).returnValue)return null;let Td="";qa.text&&(Td=qa.text);const Ed=Ld.create(qa);return new ek(Tc,
vd,Jb,Rb,qa.E1b,Td,qa.yW.TJ,Ed)}static cIm(qa,Jb,Rb){if(qa.type)return null;const Tc=Rb.lZa(qa.i8.characterData,qa.i8.qa);return new ek(qa.i8.Yc,qa.i8.Tj,Rb.SBc(Tc,qa.cpBegin),Rb.SBc(Tc,qa.cpEnd),qa.cDa.Tj,qa.Yba,qa.TJ,Jb)}}Object(f.a)(ek,"RttReplaceTextRangeOp",xf,[733,760]);class pg{constructor(qa,Jb,Rb,Tc,vd,Td,Ed,lf,Bf,vf,fd,Wc,sg,Jf,Qk,$e,Ei,ve,Ad){this.Kl=null;this.FYe=this.WKh=!1;this.zAd=!0;this.Jwh=0;this.oEh=this.A8e=this.qEh=this.nEh=this.pEh=!1;this.chg=()=>{l.ULS.sendTraceTag(7685328,
355,50,"All prerequisite ready for RttManager");this.Kl=this.AO.result;l.ULS.sendTraceTag(7685330,355,50,"Subscribing to presence updates");this.Kl.JO(this.iS)};this.iS=(re,ea)=>{if(3===ea.type||10===ea.type)if(10===ea.type)this.Jwh="boolean"===typeof ea.nA?ea.nA?1:0:ea.nA;else{if(vb.App.Lna){if(vb.App.Ak&&vb.App.Ak.Orb){l.ULS.sendTraceTag(508351552,355,15,"RTT channel did not get disconnected on lock release");return}}else if(this.f9b.value&&!this.f9b.value.Orb){l.ULS.sendTraceTag(8454939,355,15,
"RTT channel did not get disconnected on lock release");return}if(ea.nA){if(this.zqo(),(re=this.pRl(ea.nA))&&1!==re.metadata.clientType&&(this.yqo(),(!this.Ap||this.Ap.Hba||Dg.a.Qsb||Dg.a.XR||Dg.a.Qsb||Dg.a.XR)&&2!==this.Jwh))switch(this.zAd&&(this.U$b.Fzj(),this.zAd=!1),this.WKh||this.Q5m(),re.opType){case 1:case 6:case 4:if(!({Rg:re}=this.qVk(re)).returnValue)break;this.eIh?this.UJj(re):this.C4j(re);break;case 2:this.kDc.add(re),this.LRi(re),this.eIh?this.UJj(mg.a.nil):this.B4j(re)}}else l.ULS.sendTraceTag(7685331,
355,15,"RTT packet was empty")}};this.w4l=()=>{const re=this.Ei.value;if(re){var ea=this.dF()-pg.Bxo,eb=this.GCb.o8d(Zb=>Zb.metadata.SIg<ea);0<eb.count&&this.Soo();var Ob=new rg.a;for(const Zb of eb)if(this.GCb.msg(Zb),Zb.daa)switch(Zb.daa.opType){case 1:Ob.add(Zb.daa.paragraphId.toString());break;case 6:Ob.add(Zb.daa.paragraphId.toString());break;case 4:Ob.add(Zb.daa.IAe.toString()),Ob.add(Zb.daa.fYc.toString())}eb=this.kDc.o8d(Zb=>Zb.metadata.SIg<ea);for(const Zb of eb)this.kDc.msg(Zb),Zb.daa&&
Ob.add(Zb.daa.paragraphId.toString());for(const Zb of Ob)(Ob=re.Eb(mg.a.Cf(Zb)))?Ob.XQ?(this.PHb.pxo(Ob),Ob.XQ||this.$Kc.value.wDj(Ob)):l.ULS.sendTraceTag(8765829,355,15,"Expiring wet change from paragraph with no applied changes"):l.ULS.sendTraceTag(8765828,355,15,"Expiring wet change with invalid object ID")}else this.Ei.USf&&l.ULS.sendTraceTag(7685332,355,10,"Failed to find the IObjectSpace! Wet changes will never expire")};this.PHb=qa;this.GCb=Jb;this.$Kc=Rb;this.f9b=Tc;this.$K=vd;this.AO=Td;
this.Ei=Ed;this.Gb=lf;this.dF=Bf;this.QIb=vf;this.vd=fd;this.d5e=sg;this.Pc=Jf;this.eIh=Qk;this.U$b=$e;this.xBb=Ei;this.Bdf=ve;this.qNc=new F.a(I.a.th());this.kDc=new ai;Wc.execute(pg.ZUf);this.Ap=Ad}Q5m(){const qa=new oa.a(3,2,pg.Jzo,this.w4l);this.Gb.Zb(qa);this.WKh=!0}init(){return this.AO?this.AO.continueWith(this.chg):z.Task.p7(!1)}pRl(qa){qa=Pf(qa);if(!qa)return null;switch(qa.operationType){case 2:return ek.create(qa);case 7:return jj.create(qa);case 4:return Af.create(qa);case 3:return kl.create(qa);
default:return l.ULS.sendTraceTag(8459668,355,50,"RTT packet is of unexpected operationType {0}",qa.operationType),null}}qVk(qa){let Jb=mg.a.nil;if(!this.GCb.pVk(qa))return{returnValue:!1,Rg:Jb};this.LRi(qa);if(!this.$K)return{returnValue:!1,Rg:Jb};const Rb=this.$K.brb(qa.Yc);if(Rb.equals(mg.a.nil)||!this.Ei.value.Eb(Rb))return qa.activity.vzj(),{returnValue:!1,Rg:Jb};this.Hzj();return{returnValue:!0,Rg:Rb}}UJj(qa){qa.equals(mg.a.nil)||this.qNc.add(qa.toString());this.FYe||(qa=new oa.a(0,1,200,()=>
{this.lqp();this.FYe=!1},71),this.Gb.Zb(qa),this.FYe=!0)}uLo(qa){qa=new oa.a(0,1,0,qa,71);this.Gb.Zb(qa)}LRi(qa){qa.activity=Fe.create(this.vd);qa.activity.nqo(qa.metadata.packetVersion);qa.activity.mqo(vh[qa.opType])}lqp(){var qa=this.kDc.o8d(Rb=>!Rb.daa);for(const Rb of qa)this.B4j(Rb);if(this.qNc.count){qa=null;for(var Jb of this.qNc){Jb=mg.a.Cf(Jb);qa=this.Ei.value.Eb(Jb);break}Jb=this.Pc.Mc(3);try{Jb.Ab(qa);for(const Rb of this.qNc)this.C4j(mg.a.Cf(Rb))}finally{Jb&&Jb.dispose()}this.qNc.clear()}}C4j(qa){qa=
this.Ei.value.Eb(qa);let Jb;const Rb=this.Pc.Mc(3);try{Rb.Ab(qa);Jb=this.vd.rq(Ah.a.ITh);const Tc=this.NTh(qa,Jb);Jb.end();Tc&&this.xYk(Tc)}finally{Rb&&Rb.dispose(),this.U$b.Eqg(1),this.zAd=!0}}B4j(qa){var Jb=this.PHb.h9l(qa,this.$K,this.Ei.value);Jb&&(this.Hzj(),this.PHb.jop(qa,Jb,this.xBb,Fa.a.instance.resolve("Box4.IParagraphEditor"))&&(Jb=this.Ei.value.Eb(qa.daa.paragraphId),this.eUh(Jb,qa),this.U$b.Eqg(1),this.zAd=!0))}xYk(qa){this.d5e.continueWith(()=>{if(1===qa.opType){var Jb=this.gGm(qa);
Jb&&(this.d5e.result.nff(Jb),this.d5e.result.Hue(!0))}})}gGm(qa){const Jb=qa.serialize();if(2!==Jb.operationType||Jb.yW.jNa&&Jb.yW.iZa!==Jb.yW.jNa)return null;const Rb=qa.ZU.clone();0<qa.Hzb.length&&(Rb.x3h(),Rb.cp+=qa.Hzb.length);Jb.operationType=0;Jb.text=null;Jb.yW.Ate=0;Jb.yW.ZU=Rb;Jb.yW.bfb=Jb.E1b;Jb.yW.jNa=null;Jb.yW.Hzc=null;Jb.yW.h8=null;Jb.E1b=null;return pf.Etf(Jb,this.$K,this.QIb,()=>this.Ei.value,this.Bdf.instance)}eUh(qa,Jb){return this.$Kc.value?this.$Kc.value.ZTk(qa,Jb.metadata.clientId).returnValue?
!0:(l.ULS.sendTraceTag(7866379,355,15,"Unable to apply a wet change lock"),!1):(l.ULS.shipAssertTag(7866378,355,!!this.$Kc.value,"Unable to apply wet changes as LockManager unavailable"),!1)}MTh(qa,Jb){this.NTh(qa,Jb)}NTh(qa,Jb){if(!qa)return null;if(!qa.anchor)return Jb&&Jb.properties.Z(pg.uhj,"1"),null;if(!qa.hasProperty(Mf.a.Yc))return l.ULS.sendTraceTag(7619922,355,15,"Paragraph is missing the WordId property"),null;if(!qa.hasProperty(Mf.a.Tj))return l.ULS.sendTraceTag(8197722,355,15,"Paragraph is missing the TextId property"),
null;if(qa.hasProperty(Mf.a.Cgi)&&qa.getValue(Mf.a.Cgi))return l.ULS.sendTraceTag(16815506,355,50,"RTT edit disabled in paragraph"),null;const Rb=qa.getValue(Mf.a.Yc);var Tc=qa.gsa;Jb&&(Jb.properties.Z(pg.PQn,Tc.toString()),Jb.properties.Z(pg.RQn,Rb.toString()));Tc=this.GCb.eMf(Rb,Tc);if(!Tc)return Jb&&Jb.properties.Z(pg.ihj,"1"),null;if(!this.eUh(qa,Tc))return Jb&&Jb.properties.Z(pg.d9h,"1"),null;let vd=0,Td=null;for(;Tc;){if(!this.PHb.q8k(Tc,qa,this.xBb,Jb)){Jb&&Jb.properties.Z(pg.pbk,"1");break}vd++;
Tc.activity.Roo(this.dF());Td=Tc;Tc=qa.gsa;Tc=this.GCb.eMf(Rb,Tc)}0<vd&&this.izj();Jb&&Jb.properties.add(pg.qbk,vd.toString());return Td}pue(qa){if(qa.hasProperty(Mf.a.Yc)&&qa.hasProperty(Mf.a.Tj)){var Jb=qa.getValue(Mf.a.Yc),Rb=qa.ja(Mf.a.Tj,0),Tc=this.vd.rq(Ah.a.BBj),vd=this.xBb.uYn(qa.id);0<vd.count&&(this.PHb.Wvg(qa,vd,this.Ei.value),this.Yxo(qa,vd,Rb));var Td=this.xBb.vgm(Jb);if(Td&&!qa.id.equals(Td.paragraphId)){const Ed=this.Ei.value;this.uLo(()=>{const lf=this.xBb.Evb(Td.paragraphId),Bf=Ed.Eb(Td.paragraphId);
l.ULS.shipAssertTag(16820032,355,!!Bf,"Could not find added graph node");Bf&&(this.PHb.Wvg(Bf,lf,Ed),this.kDc.jsg(Td.pff))})}this.GCb.eMf(Jb,Rb)||this.$Kc.value.wDj(qa);this.MTh(qa,Tc);Tc.end()}}Yxo(qa,Jb,Rb){let Tc=!1;for(let Td=Jb.count-1;0<=Td;Td--){var vd=Jb.J(Td);switch(vd.opType){case 1:case 6:case 4:vd=Object(y.a)(733,vd.operation);break;default:continue}vd.M4===Rb&&(Tc=!0,vd.zBc&&!vd.zBc.XCp(qa)&&l.ULS.sendTraceTag(8765831,355,15,"Validating wet change location failed. Type {0} OffsetInfo {1} NodeId {2} ValidatorNodeId {3} ValidatorNodeCpBegin {4} ValidatorNodeCpEnd {5}",
vd.opType,vd.YOf(),qa.id,vd.zBc.id,vd.zBc.cpBegin,vd.zBc.cpEnd));Tc&&this.GCb.jsg(vd)}Tc&&this.izj()}Ifd(qa){const Jb=this.xBb.Evb(qa.id);0<Jb.count&&(2===Jb.J(0).opType&&Jb.removeAt(0),this.PHb.Wvg(qa,Jb,this.Ei.value))}aze(qa){var Jb=this.xBb.NCm(qa.id);for(const Rb of Jb)if(4===Rb.opType&&(Jb=Object(y.a)(Qi,Rb),qa.id.equals(Jb.uTk)))return!0;return!1}zqo(){this.pEh||(l.ULS.sendTraceTag(8704354,355,50,"Received a wet change"),this.pEh=!0)}yqo(){this.nEh||(l.ULS.sendTraceTag(8185606,355,50,"Received a wet change that we could deserialize"),
this.nEh=!0)}Hzj(){this.qEh||(l.ULS.sendTraceTag(17147533,355,50,"Received a usable wet change"),this.qEh=!0)}izj(){this.A8e||(l.ULS.sendTraceTag(8185607,355,50,"Successfully applied a wet change"),this.A8e=!0)}Soo(){this.A8e||this.oEh||(l.ULS.sendTraceTag(8185608,355,15,"Failed to apply any wet changes so far"),this.oEh=!0)}static ZUf(qa){const Jb=[Ah.a.ITh,Ah.a.BBj];for(const Rb of Jb)qa.K8(Rb,pg.qbk,Kh.a.cAa),qa.K8(Rb,pg.ihj,Kh.a.cAa),qa.K8(Rb,pg.uhj,Kh.a.cAa),qa.K8(Rb,pg.d9h,Kh.a.cAa),qa.K8(Rb,
pg.pbk,Kh.a.cAa),qa.K8(Rb,Tb.Arj,Kh.a.cAa),qa.K8(Rb,Tb.z5j,Kh.a.cAa);Fe.ZUf(qa)}}pg.Jzo=6E4;pg.Bxo=18E4;pg.qbk="WetChangeCount";pg.ihj="NoChangesToApply";pg.uhj="NodeNotConnected";pg.d9h="CouldNotGetLock";pg.pbk="WetChangeBlocked";pg.RQn="NodeWordId";pg.PQn="NodeTextId";Object(f.a)(pg,"RttManager",null,[734]);class Ak{constructor(qa,Jb){this.DIj=0;this.Rj=qa;this.rJo=Jb}Fzj(){this.DIj=this.Rj()}Eqg(qa){const Jb=this.Rj()-this.DIj;0<=Jb&&this.rJo.track(Math.round(Jb),0===qa?"CTB":"RTP")}}Object(f.a)(Ak,
"RttPerfCounter",null,[732]);var Ri=d(2097);class wi{constructor(){this.YOc=new Ri.a}ZYk(qa,Jb){this.YOc.back()&&Jb&&this.YOc.back().vnb(qa)||this.YOc.enqueue(qa)}eBm(){return this.YOc.isEmpty?null:this.YOc.dequeue()}}Object(f.a)(wi,"RttSendDataStore",null,[730]);class Bk extends eh{constructor(qa,Jb,Rb,Tc){super(3,Tc);this.Yc=qa;this.Tj=Jb;this.TJ=Rb}get M4(){return 0}serialize(){const qa=new Xc.a(4,this.Yc,this.Tj,null,null,null,null,this.TJ);return new Oc(this.metadata.packetId,this.metadata.clientId,
1,5,qa,null,void 0,void 0,void 0,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(qa){const Jb=qa.yW;return new Bk(Jb.iZa,Jb.bfb,Jb.TJ,Ld.create(qa))}static aJm(qa,Jb){return 4!==qa.type?null:new Bk(qa.Pgc.Yc,qa.Pgc.Tj,qa.TJ,Jb)}}Object(f.a)(Bk,"RttDeleteParagraphOp",eh,[733,760]);class Ph extends eh{constructor(qa,Jb,Rb,Tc,vd,Td,Ed,lf){super(5,lf);this.kPg=qa;this.h0j=Jb;this.LGp=Rb;this.Gip=Tc;this.TJ=vd;this.hck=Td;this.Izc=Ed}get Yc(){return this.kPg}get Tj(){return this.h0j}get M4(){return this.kPg===
this.hck?this.Izc:0}serialize(){const qa=new Xc.a(5,this.kPg,this.h0j,null,this.LGp,this.Gip,null,this.TJ),Jb=new Gc(this.hck,this.Izc);return new Oc(this.metadata.packetId,this.metadata.clientId,1,6,qa,null,void 0,void 0,void 0,Jb,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(qa){const Jb=qa.yW,Rb=qa.Ddd;return new Ph(Jb.iZa,Jb.bfb,Jb.jNa,Jb.Hzc,Jb.TJ,Rb.sjg,Rb.Izc,Ld.create(qa))}static bJm(qa,Jb){return 2!==qa.type?null:new Ph(qa.Gua.Yc,qa.Gua.Tj,qa.PYa.Yc,qa.PYa.Tj,qa.TJ,
qa.eke.Yc,qa.eke.Tj,Jb)}}Object(f.a)(Ph,"RttMergeParagraphOp",eh,[733,760]);class po{constructor(qa,Jb,Rb,Tc,vd,Td){this.CPc=this.Yh=null;this.V5=!1;this.rbf=this.DIh=0;this.LNd=this.SJh=!1;this.D7e=0;this.chg=()=>{l.ULS.sendTraceTag(8245954,355,50,"All prerequisites ready for RttSendManager");this.Yh=this.AO.result;this.Yh.Yte(this)};this.Nmj=(Ed,lf)=>{if(this.Yh&&(m.AFrameworkApplication.Ld("i100g733;fbhi3553"),!(m.AFrameworkApplication.K.getBooleanFeatureGate("StopRTTMessageWhenAlone",!1)&&this.Bdn()||
2!==this.Yh.connectionState)&&(Ed=lf.YG,Ed.length)))if(lf.laa)100>this.rbf&&(this.rbf++,l.ULS.sendTraceTag(8270467,355,50,"Blocking send. Reason: {0} OverallSends: {1} OverallBlocked: {2}",lf.Ucl,this.DIh,this.rbf));else{for(lf=0;lf<Ed.length;lf++)if(!this.Dtn(Ed[lf]))return;for(lf=0;lf<Ed.length;lf++){const Bf=Ed[lf];this.rDh.ZYk(Bf,!Bf.type&&!lf)}this.CPc||this.omj(this.CPc,this.Yh)}};this.AO=qa;this.rDh=Jb;this.vjb=Rb;this.Sy=Tc;this.Tya=vd;this.U$b=Td}get Om(){return this.vjb.value}init(){return this.AO?
this.AO.continueWith(this.chg):z.Task.p7(!1)}start(){this.V5||(this.Sy.$c?(this.Sy.$c.YG.W1k(this.Nmj),this.V5=!0):l.ULS.sendTraceTag(522740420,355,10,"No activePage, RttSendManager not started"))}stop(){this.V5&&(this.V5=!1,this.Sy.$c.YG.fBo(this.Nmj))}Bdn(){return this.Om&&this.Om.nB.gMa?!0:!1}Dtn(qa){return qa&&-1!==qa.TJ?qa.type&&3!==qa.type&&1!==qa.type?!1:!0:!1}kFn(){this.LNd||(this.SJh||(l.ULS.sendTraceTag(8270468,355,50,"Preparing to send RTT change"),this.SJh=!0),!this.LNd&&5>=this.D7e&&
this.D7e++)}yFn(){!this.LNd&&5>=this.D7e&&(l.ULS.sendTraceTag(8270469,355,50,"Sent Rtt Message"),this.LNd=!0)}omj(qa,Jb){this.kFn();qa&&(qa.ij||qa.qp)&&l.ULS.sendTraceTag(8245956,355,15,"Task is faulted or cancelled with exception {0}",qa.vk);this.U$b.Fzj();(qa=this.cJm(this.rDh.eBm()))?(this.DIh++,this.CPc=Jb.nC(3,cg(qa.serialize())),this.yFn(),this.U$b.Eqg(0),this.CPc.continueWith(Rb=>{this.omj(Rb,Jb)})):this.CPc=null}cJm(qa){if(!qa)return null;if(!this.Om)return l.ULS.sendTraceTag(8245957,355,
15,"GetParagraphAnchoredOpFromGraphTransactionOperation: CoAuth manager is null"),null;const Jb=new Ld(Bj.instance.VCi(),this.Om.Sj,1,0,0,Dd.instance.vBm());let Rb=null;switch(qa.type){case 0:Rb=ek.cIm(qa,Jb,this.Tya);break;case 4:Rb=Bk.aJm(qa,Jb);break;case 3:Rb=kl.$Im(qa,Jb);break;case 2:Rb=Ph.bJm(qa,Jb);break;case 1:Rb=Af.dJm(qa,Jb,this.Tya)}return Rb}}Object(f.a)(po,"RttSendManager",null,[729]);class Lh{constructor(){this.W=null;this.Yym=()=>Yb.StaticTheCoauthManager.ud()&&Yb.StaticTheCoauthManager.ud().Ak?
Yb.StaticTheCoauthManager.ud().Ak:(l.ULS.sendTraceTag(7866377,304,15,"Unable to get the lock manager"),null)}get name(){return"WordEditor.RealTimeTyping"}wc(qa){const Jb=Qa.a.$p(qa.Qa("Box4.IOutlineElementEditor")),Rb=Qa.a.$p(qa.Qa("Box4.IFeatureHelper")),Tc=Qa.a.$p(qa.Qa("Common.IActivityAggregationInfo")),vd=Qa.a.$p(qa.Qa("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator")),Td=Qa.a.$p(qa.Qa("Box4.CompositionStateManager"));this.W=qa;const Ed=new oi.a;z.Task.WAA.call(null,Jb,Rb,Tc,vd,
Td).continueWith(()=>{qa.ia("WordEditor.RealTimeTyping.IRttEditor",()=>new Tb(qa.resolve("Box4.ICharacterPropertiesEditor"),qa.resolve("Box4.IOutlineElementEditor"),Ed,qa.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"))).ha();qa.register(Ak,"WordEditor.RttPerfCounter").as("WordEditor.IRttPerfCounter").ha().Rd(()=>new Ak(ph.a.Ee,mm.a.UG(17,1,new Ai.a(new nm.a(.25)))));qa.ia("WordEditor.RealTimeTyping.RttManager",()=>new pg(qa.resolve("WordEditor.RealTimeTyping.IRttEditor"),
new cd(rm.a.instance),new V.a(this.Yym),new V.a(()=>vb.App.uV),qa.resolve("WordEditor.ParagraphWordIdMapping"),qa.resolve("Box4.Presence.IRtcProxyProvider").gD(),new V.a(()=>ub.StaticActiveAppFrame.za().ib&&ub.StaticActiveAppFrame.za().ib.$c?ub.StaticActiveAppFrame.za().ib.$c.td:(l.ULS.sendTraceTag(522740419,304,10,"No activePage or workspace."),null)),tb.a.instance,()=>Date.now(),qa.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),rm.a.instance,qa.Qa("Common.IActivityAggregationInfo"),
ag.gD(),Ed,m.AFrameworkApplication.K.$("WordEditorThrottleAndBatchRTTRendering"),qa.resolve("WordEditor.IRttPerfCounter"),new Oh,qa.Qa("WordEditor.Presence.IWordPresenceCpFactory"),qa.resolve("Box4.CompositionStateManager"))).as("WordEditor.RealTimeTyping.IRttManager").ha();qa.ia("WordEditor.RealTimeTyping.RttSendManager",()=>new po(qa.resolve("Box4.Presence.IRtcProxyProvider").gD(),new wi,new V.a(()=>Yb.StaticTheCoauthManager.ud()),ub.StaticActiveAppFrame.za().ib,qa.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),
qa.resolve("WordEditor.IRttPerfCounter"))).ha();this.$Uf()})}$Uf(){this.W.resolve("WordEditor.RealTimeTyping.RttManager").init();this.W.resolve("WordEditor.RealTimeTyping.RttSendManager").init()}init(){}dispose(){}static main(){ia.a.instance.Jc(new Lh)}}Object(f.a)(Lh,"WordEditorRealTimeTypingPackage",null,[0,1]);Type.registerNamespace("BPr");Type.registerNamespace("Box4.Presence");Type.registerNamespace("RealtimePresenceUI");Type.registerNamespace("WERTT");Type.registerNamespace("WordEditor.PeoplesWellControl");
Type.registerNamespace("WordEditor.Presence");null!=m.AFrameworkApplication.K&&m.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.WordOnline.LoadRtcFrom1JS",!1)?Promise.all([d.e(5),d.e(2),d.e(10)]).then(d.bind(null,2203)).then(qa=>qa.initRealtimechannel()):Type.registerNamespace("AppRealtimeChannel");Type.registerNamespace("Common.App.CoauthTelemetry");ya.main();Type.registerNamespace("Common.App.CollabControls");Ja.prototype.toString=ua.a.prototype.toString;nb.prototype.toString=ua.a.prototype.toString;
ia.a.instance.Jc(new dk);Lh.main();Type.registerNamespace("RealtimePresenceUI");ia.a.instance.Jc(new pc);Type.registerNamespace("Common.App.RtcHostNotificationSubscription");xa.main()}}]);

//# sourceMappingURL=https://res-dev.cdn.officeppe.net/1js/build/22137596/wdjs/WordEditorDS.collab.js.map